(self.webpackChunkmapasApp=self.webpackChunkmapasApp||[]).push([[179],{574:(er,Gt,Le)=>{"use strict";var Y=Le(808),Oe=Le(223);class Mt extends Y.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class u extends Mt{static makeCurrent(){(0,Y.HT)(new u)}onAndCancel(de,ae,Se){return de.addEventListener(ae,Se,!1),()=>{de.removeEventListener(ae,Se,!1)}}dispatchEvent(de,ae){de.dispatchEvent(ae)}remove(de){de.parentNode&&de.parentNode.removeChild(de)}createElement(de,ae){return(ae=ae||this.getDefaultDocument()).createElement(de)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(de){return de.nodeType===Node.ELEMENT_NODE}isShadowRoot(de){return de instanceof DocumentFragment}getGlobalEventTarget(de,ae){return"window"===ae?window:"document"===ae?de:"body"===ae?de.body:null}getBaseHref(de){const ae=function en(){return wt=wt||document.querySelector("base"),wt?wt.getAttribute("href"):null}();return null==ae?null:function et(ve){Nt=Nt||document.createElement("a"),Nt.setAttribute("href",ve);const de=Nt.pathname;return"/"===de.charAt(0)?de:`/${de}`}(ae)}resetBaseElement(){wt=null}getUserAgent(){return window.navigator.userAgent}getCookie(de){return(0,Y.Mx)(document.cookie,de)}}let Nt,wt=null;const Et=new Oe.OlP("TRANSITION_ID"),st=[{provide:Oe.ip1,useFactory:function Me(ve,de,ae){return()=>{ae.get(Oe.CZH).donePromise.then(()=>{const Se=(0,Y.q)(),Ze=de.querySelectorAll(`style[ng-transition="${ve}"]`);for(let At=0;At<Ze.length;At++)Se.remove(Ze[At])})}},deps:[Et,Y.K0,Oe.zs3],multi:!0}];class Ot{static init(){(0,Oe.VLi)(new Ot)}addToWindow(de){Oe.dqk.getAngularTestability=(Se,Ze=!0)=>{const At=de.findTestabilityInTree(Se,Ze);if(null==At)throw new Error("Could not find testability for element.");return At},Oe.dqk.getAllAngularTestabilities=()=>de.getAllTestabilities(),Oe.dqk.getAllAngularRootElements=()=>de.getAllRootElements(),Oe.dqk.frameworkStabilizers||(Oe.dqk.frameworkStabilizers=[]),Oe.dqk.frameworkStabilizers.push(Se=>{const Ze=Oe.dqk.getAllAngularTestabilities();let At=Ze.length,Xt=!1;const Er=function(Tr){Xt=Xt||Tr,At--,0==At&&Se(Xt)};Ze.forEach(function(Tr){Tr.whenStable(Er)})})}findTestabilityInTree(de,ae,Se){if(null==ae)return null;const Ze=de.getTestability(ae);return null!=Ze?Ze:Se?(0,Y.q)().isShadowRoot(ae)?this.findTestabilityInTree(de,ae.host,!0):this.findTestabilityInTree(de,ae.parentElement,!0):null}}let Bn=(()=>{class ve{build(){return new XMLHttpRequest}}return ve.\u0275fac=function(ae){return new(ae||ve)},ve.\u0275prov=Oe.Yz7({token:ve,factory:ve.\u0275fac}),ve})();const Ft=new Oe.OlP("EventManagerPlugins");let Rt=(()=>{class ve{constructor(ae,Se){this._zone=Se,this._eventNameToPlugin=new Map,ae.forEach(Ze=>Ze.manager=this),this._plugins=ae.slice().reverse()}addEventListener(ae,Se,Ze){return this._findPluginFor(Se).addEventListener(ae,Se,Ze)}addGlobalEventListener(ae,Se,Ze){return this._findPluginFor(Se).addGlobalEventListener(ae,Se,Ze)}getZone(){return this._zone}_findPluginFor(ae){const Se=this._eventNameToPlugin.get(ae);if(Se)return Se;const Ze=this._plugins;for(let At=0;At<Ze.length;At++){const Xt=Ze[At];if(Xt.supports(ae))return this._eventNameToPlugin.set(ae,Xt),Xt}throw new Error(`No event manager plugin found for event ${ae}`)}}return ve.\u0275fac=function(ae){return new(ae||ve)(Oe.LFG(Ft),Oe.LFG(Oe.R0b))},ve.\u0275prov=Oe.Yz7({token:ve,factory:ve.\u0275fac}),ve})();class an{constructor(de){this._doc=de}addGlobalEventListener(de,ae,Se){const Ze=(0,Y.q)().getGlobalEventTarget(this._doc,de);if(!Ze)throw new Error(`Unsupported event target ${Ze} for event ${ae}`);return this.addEventListener(Ze,ae,Se)}}let It=(()=>{class ve{constructor(){this._stylesSet=new Set}addStyles(ae){const Se=new Set;ae.forEach(Ze=>{this._stylesSet.has(Ze)||(this._stylesSet.add(Ze),Se.add(Ze))}),this.onStylesAdded(Se)}onStylesAdded(ae){}getAllStyles(){return Array.from(this._stylesSet)}}return ve.\u0275fac=function(ae){return new(ae||ve)},ve.\u0275prov=Oe.Yz7({token:ve,factory:ve.\u0275fac}),ve})(),Nn=(()=>{class ve extends It{constructor(ae){super(),this._doc=ae,this._hostNodes=new Map,this._hostNodes.set(ae.head,[])}_addStylesToHost(ae,Se,Ze){ae.forEach(At=>{const Xt=this._doc.createElement("style");Xt.textContent=At,Ze.push(Se.appendChild(Xt))})}addHost(ae){const Se=[];this._addStylesToHost(this._stylesSet,ae,Se),this._hostNodes.set(ae,Se)}removeHost(ae){const Se=this._hostNodes.get(ae);Se&&Se.forEach(zn),this._hostNodes.delete(ae)}onStylesAdded(ae){this._hostNodes.forEach((Se,Ze)=>{this._addStylesToHost(ae,Ze,Se)})}ngOnDestroy(){this._hostNodes.forEach(ae=>ae.forEach(zn))}}return ve.\u0275fac=function(ae){return new(ae||ve)(Oe.LFG(Y.K0))},ve.\u0275prov=Oe.Yz7({token:ve,factory:ve.\u0275fac}),ve})();function zn(ve){(0,Y.q)().remove(ve)}const xn={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},ut=/%COMP%/g;function $e(ve,de,ae){for(let Se=0;Se<de.length;Se++){let Ze=de[Se];Array.isArray(Ze)?$e(ve,Ze,ae):(Ze=Ze.replace(ut,ve),ae.push(Ze))}return ae}function He(ve){return de=>{if("__ngUnwrap__"===de)return ve;!1===ve(de)&&(de.preventDefault(),de.returnValue=!1)}}let _t=(()=>{class ve{constructor(ae,Se,Ze){this.eventManager=ae,this.sharedStylesHost=Se,this.appId=Ze,this.rendererByCompId=new Map,this.defaultRenderer=new Ve(ae)}createRenderer(ae,Se){if(!ae||!Se)return this.defaultRenderer;switch(Se.encapsulation){case Oe.ifc.Emulated:{let Ze=this.rendererByCompId.get(Se.id);return Ze||(Ze=new br(this.eventManager,this.sharedStylesHost,Se,this.appId),this.rendererByCompId.set(Se.id,Ze)),Ze.applyToHost(ae),Ze}case 1:case Oe.ifc.ShadowDom:return new hn(this.eventManager,this.sharedStylesHost,ae,Se);default:if(!this.rendererByCompId.has(Se.id)){const Ze=$e(Se.id,Se.styles,[]);this.sharedStylesHost.addStyles(Ze),this.rendererByCompId.set(Se.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return ve.\u0275fac=function(ae){return new(ae||ve)(Oe.LFG(Rt),Oe.LFG(Nn),Oe.LFG(Oe.AFp))},ve.\u0275prov=Oe.Yz7({token:ve,factory:ve.\u0275fac}),ve})();class Ve{constructor(de){this.eventManager=de,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(de,ae){return ae?document.createElementNS(xn[ae]||ae,de):document.createElement(de)}createComment(de){return document.createComment(de)}createText(de){return document.createTextNode(de)}appendChild(de,ae){de.appendChild(ae)}insertBefore(de,ae,Se){de&&de.insertBefore(ae,Se)}removeChild(de,ae){de&&de.removeChild(ae)}selectRootElement(de,ae){let Se="string"==typeof de?document.querySelector(de):de;if(!Se)throw new Error(`The selector "${de}" did not match any elements`);return ae||(Se.textContent=""),Se}parentNode(de){return de.parentNode}nextSibling(de){return de.nextSibling}setAttribute(de,ae,Se,Ze){if(Ze){ae=Ze+":"+ae;const At=xn[Ze];At?de.setAttributeNS(At,ae,Se):de.setAttribute(ae,Se)}else de.setAttribute(ae,Se)}removeAttribute(de,ae,Se){if(Se){const Ze=xn[Se];Ze?de.removeAttributeNS(Ze,ae):de.removeAttribute(`${Se}:${ae}`)}else de.removeAttribute(ae)}addClass(de,ae){de.classList.add(ae)}removeClass(de,ae){de.classList.remove(ae)}setStyle(de,ae,Se,Ze){Ze&(Oe.JOm.DashCase|Oe.JOm.Important)?de.style.setProperty(ae,Se,Ze&Oe.JOm.Important?"important":""):de.style[ae]=Se}removeStyle(de,ae,Se){Se&Oe.JOm.DashCase?de.style.removeProperty(ae):de.style[ae]=""}setProperty(de,ae,Se){de[ae]=Se}setValue(de,ae){de.nodeValue=ae}listen(de,ae,Se){return"string"==typeof de?this.eventManager.addGlobalEventListener(de,ae,He(Se)):this.eventManager.addEventListener(de,ae,He(Se))}}class br extends Ve{constructor(de,ae,Se,Ze){super(de),this.component=Se;const At=$e(Ze+"-"+Se.id,Se.styles,[]);ae.addStyles(At),this.contentAttr=function ft(ve){return"_ngcontent-%COMP%".replace(ut,ve)}(Ze+"-"+Se.id),this.hostAttr=function Ne(ve){return"_nghost-%COMP%".replace(ut,ve)}(Ze+"-"+Se.id)}applyToHost(de){super.setAttribute(de,this.hostAttr,"")}createElement(de,ae){const Se=super.createElement(de,ae);return super.setAttribute(Se,this.contentAttr,""),Se}}class hn extends Ve{constructor(de,ae,Se,Ze){super(de),this.sharedStylesHost=ae,this.hostEl=Se,this.shadowRoot=Se.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const At=$e(Ze.id,Ze.styles,[]);for(let Xt=0;Xt<At.length;Xt++){const Er=document.createElement("style");Er.textContent=At[Xt],this.shadowRoot.appendChild(Er)}}nodeOrShadowRoot(de){return de===this.hostEl?this.shadowRoot:de}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(de,ae){return super.appendChild(this.nodeOrShadowRoot(de),ae)}insertBefore(de,ae,Se){return super.insertBefore(this.nodeOrShadowRoot(de),ae,Se)}removeChild(de,ae){return super.removeChild(this.nodeOrShadowRoot(de),ae)}parentNode(de){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(de)))}}let $r=(()=>{class ve extends an{constructor(ae){super(ae)}supports(ae){return!0}addEventListener(ae,Se,Ze){return ae.addEventListener(Se,Ze,!1),()=>this.removeEventListener(ae,Se,Ze)}removeEventListener(ae,Se,Ze){return ae.removeEventListener(Se,Ze)}}return ve.\u0275fac=function(ae){return new(ae||ve)(Oe.LFG(Y.K0))},ve.\u0275prov=Oe.Yz7({token:ve,factory:ve.\u0275fac}),ve})();const yi=["alt","control","meta","shift"],vi={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Fi={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},Eo={alt:ve=>ve.altKey,control:ve=>ve.ctrlKey,meta:ve=>ve.metaKey,shift:ve=>ve.shiftKey};let Zi=(()=>{class ve extends an{constructor(ae){super(ae)}supports(ae){return null!=ve.parseEventName(ae)}addEventListener(ae,Se,Ze){const At=ve.parseEventName(Se),Xt=ve.eventCallback(At.fullKey,Ze,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,Y.q)().onAndCancel(ae,At.domEventName,Xt))}static parseEventName(ae){const Se=ae.toLowerCase().split("."),Ze=Se.shift();if(0===Se.length||"keydown"!==Ze&&"keyup"!==Ze)return null;const At=ve._normalizeKey(Se.pop());let Xt="";if(yi.forEach(Tr=>{const Fr=Se.indexOf(Tr);Fr>-1&&(Se.splice(Fr,1),Xt+=Tr+".")}),Xt+=At,0!=Se.length||0===At.length)return null;const Er={};return Er.domEventName=Ze,Er.fullKey=Xt,Er}static getEventFullKey(ae){let Se="",Ze=function Lr(ve){let de=ve.key;if(null==de){if(de=ve.keyIdentifier,null==de)return"Unidentified";de.startsWith("U+")&&(de=String.fromCharCode(parseInt(de.substring(2),16)),3===ve.location&&Fi.hasOwnProperty(de)&&(de=Fi[de]))}return vi[de]||de}(ae);return Ze=Ze.toLowerCase()," "===Ze?Ze="space":"."===Ze&&(Ze="dot"),yi.forEach(At=>{At!=Ze&&Eo[At](ae)&&(Se+=At+".")}),Se+=Ze,Se}static eventCallback(ae,Se,Ze){return At=>{ve.getEventFullKey(At)===ae&&Ze.runGuarded(()=>Se(At))}}static _normalizeKey(ae){return"esc"===ae?"escape":ae}}return ve.\u0275fac=function(ae){return new(ae||ve)(Oe.LFG(Y.K0))},ve.\u0275prov=Oe.Yz7({token:ve,factory:ve.\u0275fac}),ve})();const ds=(0,Oe.eFA)(Oe._c5,"browser",[{provide:Oe.Lbi,useValue:Y.bD},{provide:Oe.g9A,useValue:function $n(){u.makeCurrent(),Ot.init()},multi:!0},{provide:Y.K0,useFactory:function Cn(){return(0,Oe.RDi)(document),document},deps:[]}]),Gr=[{provide:Oe.zSh,useValue:"root"},{provide:Oe.qLn,useFactory:function Gn(){return new Oe.qLn},deps:[]},{provide:Ft,useClass:$r,multi:!0,deps:[Y.K0,Oe.R0b,Oe.Lbi]},{provide:Ft,useClass:Zi,multi:!0,deps:[Y.K0]},{provide:_t,useClass:_t,deps:[Rt,Nn,Oe.AFp]},{provide:Oe.FYo,useExisting:_t},{provide:It,useExisting:Nn},{provide:Nn,useClass:Nn,deps:[Y.K0]},{provide:Oe.dDg,useClass:Oe.dDg,deps:[Oe.R0b]},{provide:Rt,useClass:Rt,deps:[Ft,Oe.R0b]},{provide:Y.JF,useClass:Bn,deps:[]}];let Es=(()=>{class ve{constructor(ae){if(ae)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(ae){return{ngModule:ve,providers:[{provide:Oe.AFp,useValue:ae.appId},{provide:Et,useExisting:Oe.AFp},st]}}}return ve.\u0275fac=function(ae){return new(ae||ve)(Oe.LFG(ve,12))},ve.\u0275mod=Oe.oAB({type:ve}),ve.\u0275inj=Oe.cJS({providers:Gr,imports:[Y.ez,Oe.hGG]}),ve})();"undefined"!=typeof window&&window;var _e=Le(140);const Ie=[{path:"mapas",loadChildren:()=>Le.e(161).then(Le.bind(Le,161)).then(ve=>ve.MapasModule)},{path:"**",redirectTo:"mapas"}];let Pe=(()=>{class ve{}return ve.\u0275fac=function(ae){return new(ae||ve)},ve.\u0275mod=Oe.oAB({type:ve}),ve.\u0275inj=Oe.cJS({imports:[[_e.Bz.forRoot(Ie,{useHash:!0})],_e.Bz]}),ve})();var Ee=Le(26);const Xe=function(ve){return[ve]};function nt(ve,de){if(1&ve&&(Oe.TgZ(0,"li",2),Oe._uU(1),Oe.qZA()),2&ve){const ae=de.$implicit;Oe.Q6J("routerLink",Oe.VKq(2,Xe,ae.ruta)),Oe.xp6(1),Oe.hij(" ",ae.nombre," ")}}let it=(()=>{class ve{constructor(){this.menuItems=[{ruta:"/mapas/fullscreen",nombre:"Pantalla Completa"},{ruta:"/mapas/zoom-range",nombre:"Rango de enfoque"},{ruta:"/mapas/marcadores",nombre:"Marcadores"},{ruta:"/mapas/propiedades",nombre:"Propiedades"}]}}return ve.\u0275fac=function(ae){return new(ae||ve)},ve.\u0275cmp=Oe.Xpm({type:ve,selectors:[["app-menu"]],decls:2,vars:1,consts:[[1,"list-group"],["class","list-group-item","routerLinkActive","active",3,"routerLink",4,"ngFor","ngForOf"],["routerLinkActive","active",1,"list-group-item",3,"routerLink"]],template:function(ae,Se){1&ae&&(Oe.TgZ(0,"ul",0),Oe.YNc(1,nt,2,4,"li",1),Oe.qZA()),2&ae&&(Oe.xp6(1),Oe.Q6J("ngForOf",Se.menuItems))},directives:[Y.sg,_e.Od,_e.rH],styles:["li[_ngcontent-%COMP%]{cursor:pointer}"]}),ve})(),Ht=(()=>{class ve{constructor(){this.title="mapasApp"}ngOnInit(){Ee.accessToken="pk.eyJ1Ijoic2VoZGV6IiwiYSI6ImNsMGNxYWloMDAwZzAzY2xjeHQ2dzU2dHEifQ.INe5POc9y0I4b1YLb3qzfw"}}return ve.\u0275fac=function(ae){return new(ae||ve)},ve.\u0275cmp=Oe.Xpm({type:ve,selectors:[["app-root"]],decls:2,vars:0,template:function(ae,Se){1&ae&&Oe._UZ(0,"app-menu")(1,"router-outlet")},directives:[it,_e.lC],styles:[""]}),ve})(),Kt=(()=>{class ve{}return ve.\u0275fac=function(ae){return new(ae||ve)},ve.\u0275mod=Oe.oAB({type:ve,bootstrap:[Ht]}),ve.\u0275inj=Oe.cJS({providers:[],imports:[[Es,Pe]]}),ve})();(0,Oe.G48)(),ds().bootstrapModule(Kt).catch(ve=>console.error(ve))},306:(er,Gt,Le)=>{"use strict";Le.d(Gt,{y:()=>Me});var Y=Le(961),Oe=Le(727),Mt=Le(822),u=Le(671);var Nt=Le(416),et=Le(576),Et=Le(806);let Me=(()=>{class Ft{constructor(an){an&&(this._subscribe=an)}lift(an){const It=new Ft;return It.source=this,It.operator=an,It}subscribe(an,It,Nn){const zn=function Bn(Ft){return Ft&&Ft instanceof Y.Lv||function Ot(Ft){return Ft&&(0,et.m)(Ft.next)&&(0,et.m)(Ft.error)&&(0,et.m)(Ft.complete)}(Ft)&&(0,Oe.Nn)(Ft)}(an)?an:new Y.Hp(an,It,Nn);return(0,Et.x)(()=>{const{operator:xn,source:ut}=this;zn.add(xn?xn.call(zn,ut):ut?this._subscribe(zn):this._trySubscribe(zn))}),zn}_trySubscribe(an){try{return this._subscribe(an)}catch(It){an.error(It)}}forEach(an,It){return new(It=st(It))((Nn,zn)=>{const xn=new Y.Hp({next:ut=>{try{an(ut)}catch(Dt){zn(Dt),xn.unsubscribe()}},error:zn,complete:Nn});this.subscribe(xn)})}_subscribe(an){var It;return null===(It=this.source)||void 0===It?void 0:It.subscribe(an)}[Mt.L](){return this}pipe(...an){return function en(Ft){return 0===Ft.length?u.y:1===Ft.length?Ft[0]:function(an){return Ft.reduce((It,Nn)=>Nn(It),an)}}(an)(this)}toPromise(an){return new(an=st(an))((It,Nn)=>{let zn;this.subscribe(xn=>zn=xn,xn=>Nn(xn),()=>It(zn))})}}return Ft.create=Rt=>new Ft(Rt),Ft})();function st(Ft){var Rt;return null!==(Rt=null!=Ft?Ft:Nt.v.Promise)&&void 0!==Rt?Rt:Promise}},579:(er,Gt,Le)=>{"use strict";Le.d(Gt,{x:()=>Nt});var Y=Le(306),Oe=Le(727);const u=(0,Le(888).d)(Et=>function(){Et(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var wt=Le(737),en=Le(806);let Nt=(()=>{class Et extends Y.y{constructor(){super(),this.closed=!1,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(st){const Ot=new et(this,this);return Ot.operator=st,Ot}_throwIfClosed(){if(this.closed)throw new u}next(st){(0,en.x)(()=>{if(this._throwIfClosed(),!this.isStopped){const Ot=this.observers.slice();for(const Bn of Ot)Bn.next(st)}})}error(st){(0,en.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=st;const{observers:Ot}=this;for(;Ot.length;)Ot.shift().error(st)}})}complete(){(0,en.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:st}=this;for(;st.length;)st.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=null}get observed(){var st;return(null===(st=this.observers)||void 0===st?void 0:st.length)>0}_trySubscribe(st){return this._throwIfClosed(),super._trySubscribe(st)}_subscribe(st){return this._throwIfClosed(),this._checkFinalizedStatuses(st),this._innerSubscribe(st)}_innerSubscribe(st){const{hasError:Ot,isStopped:Bn,observers:Ft}=this;return Ot||Bn?Oe.Lc:(Ft.push(st),new Oe.w0(()=>(0,wt.P)(Ft,st)))}_checkFinalizedStatuses(st){const{hasError:Ot,thrownError:Bn,isStopped:Ft}=this;Ot?st.error(Bn):Ft&&st.complete()}asObservable(){const st=new Y.y;return st.source=this,st}}return Et.create=(Me,st)=>new et(Me,st),Et})();class et extends Nt{constructor(Me,st){super(),this.destination=Me,this.source=st}next(Me){var st,Ot;null===(Ot=null===(st=this.destination)||void 0===st?void 0:st.next)||void 0===Ot||Ot.call(st,Me)}error(Me){var st,Ot;null===(Ot=null===(st=this.destination)||void 0===st?void 0:st.error)||void 0===Ot||Ot.call(st,Me)}complete(){var Me,st;null===(st=null===(Me=this.destination)||void 0===Me?void 0:Me.complete)||void 0===st||st.call(Me)}_subscribe(Me){var st,Ot;return null!==(Ot=null===(st=this.source)||void 0===st?void 0:st.subscribe(Me))&&void 0!==Ot?Ot:Oe.Lc}}},961:(er,Gt,Le)=>{"use strict";Le.d(Gt,{Hp:()=>an,Lv:()=>Ot});var Y=Le(576),Oe=Le(727),Mt=Le(416),u=Le(849);function wt(){}const en=Et("C",void 0,void 0);function Et(ut,Dt,fn){return{kind:ut,value:Dt,error:fn}}var Me=Le(410),st=Le(806);class Ot extends Oe.w0{constructor(Dt){super(),this.isStopped=!1,Dt?(this.destination=Dt,(0,Oe.Nn)(Dt)&&Dt.add(this)):this.destination=xn}static create(Dt,fn,Wt){return new an(Dt,fn,Wt)}next(Dt){this.isStopped?zn(function et(ut){return Et("N",ut,void 0)}(Dt),this):this._next(Dt)}error(Dt){this.isStopped?zn(function Nt(ut){return Et("E",void 0,ut)}(Dt),this):(this.isStopped=!0,this._error(Dt))}complete(){this.isStopped?zn(en,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Dt){this.destination.next(Dt)}_error(Dt){try{this.destination.error(Dt)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Bn=Function.prototype.bind;function Ft(ut,Dt){return Bn.call(ut,Dt)}class Rt{constructor(Dt){this.partialObserver=Dt}next(Dt){const{partialObserver:fn}=this;if(fn.next)try{fn.next(Dt)}catch(Wt){It(Wt)}}error(Dt){const{partialObserver:fn}=this;if(fn.error)try{fn.error(Dt)}catch(Wt){It(Wt)}else It(Dt)}complete(){const{partialObserver:Dt}=this;if(Dt.complete)try{Dt.complete()}catch(fn){It(fn)}}}class an extends Ot{constructor(Dt,fn,Wt){let tn;if(super(),(0,Y.m)(Dt)||!Dt)tn={next:null!=Dt?Dt:void 0,error:null!=fn?fn:void 0,complete:null!=Wt?Wt:void 0};else{let ft;this&&Mt.v.useDeprecatedNextContext?(ft=Object.create(Dt),ft.unsubscribe=()=>this.unsubscribe(),tn={next:Dt.next&&Ft(Dt.next,ft),error:Dt.error&&Ft(Dt.error,ft),complete:Dt.complete&&Ft(Dt.complete,ft)}):tn=Dt}this.destination=new Rt(tn)}}function It(ut){Mt.v.useDeprecatedSynchronousErrorHandling?(0,st.O)(ut):(0,u.h)(ut)}function zn(ut,Dt){const{onStoppedNotification:fn}=Mt.v;fn&&Me.z.setTimeout(()=>fn(ut,Dt))}const xn={closed:!0,next:wt,error:function Nn(ut){throw ut},complete:wt}},727:(er,Gt,Le)=>{"use strict";Le.d(Gt,{Lc:()=>en,w0:()=>wt,Nn:()=>Nt});var Y=Le(576);const Mt=(0,Le(888).d)(Et=>function(st){Et(this),this.message=st?`${st.length} errors occurred during unsubscription:\n${st.map((Ot,Bn)=>`${Bn+1}) ${Ot.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=st});var u=Le(737);class wt{constructor(Me){this.initialTeardown=Me,this.closed=!1,this._parentage=null,this._teardowns=null}unsubscribe(){let Me;if(!this.closed){this.closed=!0;const{_parentage:st}=this;if(st)if(this._parentage=null,Array.isArray(st))for(const Ft of st)Ft.remove(this);else st.remove(this);const{initialTeardown:Ot}=this;if((0,Y.m)(Ot))try{Ot()}catch(Ft){Me=Ft instanceof Mt?Ft.errors:[Ft]}const{_teardowns:Bn}=this;if(Bn){this._teardowns=null;for(const Ft of Bn)try{et(Ft)}catch(Rt){Me=null!=Me?Me:[],Rt instanceof Mt?Me=[...Me,...Rt.errors]:Me.push(Rt)}}if(Me)throw new Mt(Me)}}add(Me){var st;if(Me&&Me!==this)if(this.closed)et(Me);else{if(Me instanceof wt){if(Me.closed||Me._hasParent(this))return;Me._addParent(this)}(this._teardowns=null!==(st=this._teardowns)&&void 0!==st?st:[]).push(Me)}}_hasParent(Me){const{_parentage:st}=this;return st===Me||Array.isArray(st)&&st.includes(Me)}_addParent(Me){const{_parentage:st}=this;this._parentage=Array.isArray(st)?(st.push(Me),st):st?[st,Me]:Me}_removeParent(Me){const{_parentage:st}=this;st===Me?this._parentage=null:Array.isArray(st)&&(0,u.P)(st,Me)}remove(Me){const{_teardowns:st}=this;st&&(0,u.P)(st,Me),Me instanceof wt&&Me._removeParent(this)}}wt.EMPTY=(()=>{const Et=new wt;return Et.closed=!0,Et})();const en=wt.EMPTY;function Nt(Et){return Et instanceof wt||Et&&"closed"in Et&&(0,Y.m)(Et.remove)&&(0,Y.m)(Et.add)&&(0,Y.m)(Et.unsubscribe)}function et(Et){(0,Y.m)(Et)?Et():Et.unsubscribe()}},416:(er,Gt,Le)=>{"use strict";Le.d(Gt,{v:()=>Y});const Y={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},515:(er,Gt,Le)=>{"use strict";Le.d(Gt,{E:()=>Oe});const Oe=new(Le(306).y)(wt=>wt.complete())},76:(er,Gt,Le)=>{"use strict";Le.d(Gt,{D:()=>Wt});var Y=Le(421),Oe=Le(672),Mt=Le(482),u=Le(403);function wt(tn,ft=0){return(0,Mt.e)((Ne,$e)=>{Ne.subscribe((0,u.x)($e,He=>(0,Oe.f)($e,tn,()=>$e.next(He),ft),()=>(0,Oe.f)($e,tn,()=>$e.complete(),ft),He=>(0,Oe.f)($e,tn,()=>$e.error(He),ft)))})}function en(tn,ft=0){return(0,Mt.e)((Ne,$e)=>{$e.add(tn.schedule(()=>Ne.subscribe($e),ft))})}var Et=Le(306),st=Le(202),Ot=Le(576);function Ft(tn,ft){if(!tn)throw new Error("Iterable cannot be null");return new Et.y(Ne=>{(0,Oe.f)(Ne,ft,()=>{const $e=tn[Symbol.asyncIterator]();(0,Oe.f)(Ne,ft,()=>{$e.next().then(He=>{He.done?Ne.complete():Ne.next(He.value)})},0,!0)})})}var Rt=Le(670),an=Le(239),It=Le(144),Nn=Le(495),zn=Le(206),xn=Le(532),ut=Le(260);function Wt(tn,ft){return ft?function fn(tn,ft){if(null!=tn){if((0,Rt.c)(tn))return function Nt(tn,ft){return(0,Y.Xf)(tn).pipe(en(ft),wt(ft))}(tn,ft);if((0,It.z)(tn))return function Me(tn,ft){return new Et.y(Ne=>{let $e=0;return ft.schedule(function(){$e===tn.length?Ne.complete():(Ne.next(tn[$e++]),Ne.closed||this.schedule())})})}(tn,ft);if((0,an.t)(tn))return function et(tn,ft){return(0,Y.Xf)(tn).pipe(en(ft),wt(ft))}(tn,ft);if((0,zn.D)(tn))return Ft(tn,ft);if((0,Nn.T)(tn))return function Bn(tn,ft){return new Et.y(Ne=>{let $e;return(0,Oe.f)(Ne,ft,()=>{$e=tn[st.h](),(0,Oe.f)(Ne,ft,()=>{let He,qe;try{({value:He,done:qe}=$e.next())}catch(_t){return void Ne.error(_t)}qe?Ne.complete():Ne.next(He)},0,!0)}),()=>(0,Ot.m)(null==$e?void 0:$e.return)&&$e.return()})}(tn,ft);if((0,ut.L)(tn))return function Dt(tn,ft){return Ft((0,ut.Q)(tn),ft)}(tn,ft)}throw(0,xn.z)(tn)}(tn,ft):(0,Y.Xf)(tn)}},421:(er,Gt,Le)=>{"use strict";Le.d(Gt,{Xf:()=>Bn});var Y=Le(655),Oe=Le(144),Mt=Le(239),u=Le(306),wt=Le(670),en=Le(206),Nt=Le(532),et=Le(495),Et=Le(260),Me=Le(576),st=Le(849),Ot=Le(822);function Bn(ut){if(ut instanceof u.y)return ut;if(null!=ut){if((0,wt.c)(ut))return function Ft(ut){return new u.y(Dt=>{const fn=ut[Ot.L]();if((0,Me.m)(fn.subscribe))return fn.subscribe(Dt);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(ut);if((0,Oe.z)(ut))return function Rt(ut){return new u.y(Dt=>{for(let fn=0;fn<ut.length&&!Dt.closed;fn++)Dt.next(ut[fn]);Dt.complete()})}(ut);if((0,Mt.t)(ut))return function an(ut){return new u.y(Dt=>{ut.then(fn=>{Dt.closed||(Dt.next(fn),Dt.complete())},fn=>Dt.error(fn)).then(null,st.h)})}(ut);if((0,en.D)(ut))return Nn(ut);if((0,et.T)(ut))return function It(ut){return new u.y(Dt=>{for(const fn of ut)if(Dt.next(fn),Dt.closed)return;Dt.complete()})}(ut);if((0,Et.L)(ut))return function zn(ut){return Nn((0,Et.Q)(ut))}(ut)}throw(0,Nt.z)(ut)}function Nn(ut){return new u.y(Dt=>{(function xn(ut,Dt){var fn,Wt,tn,ft;return(0,Y.mG)(this,void 0,void 0,function*(){try{for(fn=(0,Y.KL)(ut);!(Wt=yield fn.next()).done;)if(Dt.next(Wt.value),Dt.closed)return}catch(Ne){tn={error:Ne}}finally{try{Wt&&!Wt.done&&(ft=fn.return)&&(yield ft.call(fn))}finally{if(tn)throw tn.error}}Dt.complete()})})(ut,Dt).catch(fn=>Dt.error(fn))})}},403:(er,Gt,Le)=>{"use strict";Le.d(Gt,{x:()=>Oe});var Y=Le(961);function Oe(u,wt,en,Nt,et){return new Mt(u,wt,en,Nt,et)}class Mt extends Y.Lv{constructor(wt,en,Nt,et,Et,Me){super(wt),this.onFinalize=Et,this.shouldUnsubscribe=Me,this._next=en?function(st){try{en(st)}catch(Ot){wt.error(Ot)}}:super._next,this._error=et?function(st){try{et(st)}catch(Ot){wt.error(Ot)}finally{this.unsubscribe()}}:super._error,this._complete=Nt?function(){try{Nt()}catch(st){wt.error(st)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var wt;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:en}=this;super.unsubscribe(),!en&&(null===(wt=this.onFinalize)||void 0===wt||wt.call(this))}}}},4:(er,Gt,Le)=>{"use strict";Le.d(Gt,{U:()=>Mt});var Y=Le(482),Oe=Le(403);function Mt(u,wt){return(0,Y.e)((en,Nt)=>{let et=0;en.subscribe((0,Oe.x)(Nt,Et=>{Nt.next(u.call(wt,Et,et++))}))})}},189:(er,Gt,Le)=>{"use strict";Le.d(Gt,{J:()=>Mt});var Y=Le(577),Oe=Le(671);function Mt(u=1/0){return(0,Y.z)(Oe.y,u)}},577:(er,Gt,Le)=>{"use strict";Le.d(Gt,{z:()=>et});var Y=Le(4),Oe=Le(421),Mt=Le(482),u=Le(672),wt=Le(403),Nt=Le(576);function et(Et,Me,st=1/0){return(0,Nt.m)(Me)?et((Ot,Bn)=>(0,Y.U)((Ft,Rt)=>Me(Ot,Ft,Bn,Rt))((0,Oe.Xf)(Et(Ot,Bn))),st):("number"==typeof Me&&(st=Me),(0,Mt.e)((Ot,Bn)=>function en(Et,Me,st,Ot,Bn,Ft,Rt,an){const It=[];let Nn=0,zn=0,xn=!1;const ut=()=>{xn&&!It.length&&!Nn&&Me.complete()},Dt=Wt=>Nn<Ot?fn(Wt):It.push(Wt),fn=Wt=>{Ft&&Me.next(Wt),Nn++;let tn=!1;(0,Oe.Xf)(st(Wt,zn++)).subscribe((0,wt.x)(Me,ft=>{null==Bn||Bn(ft),Ft?Dt(ft):Me.next(ft)},()=>{tn=!0},void 0,()=>{if(tn)try{for(Nn--;It.length&&Nn<Ot;){const ft=It.shift();Rt?(0,u.f)(Me,Rt,()=>fn(ft)):fn(ft)}ut()}catch(ft){Me.error(ft)}}))};return Et.subscribe((0,wt.x)(Me,Dt,()=>{xn=!0,ut()})),()=>{null==an||an()}}(Ot,Bn,Et,st)))}},698:(er,Gt,Le)=>{"use strict";Le.d(Gt,{q:()=>u});var Y=Le(515),Oe=Le(482),Mt=Le(403);function u(wt){return wt<=0?()=>Y.E:(0,Oe.e)((en,Nt)=>{let et=0;en.subscribe((0,Mt.x)(Nt,Et=>{++et<=wt&&(Nt.next(Et),wt<=et&&Nt.complete())}))})}},410:(er,Gt,Le)=>{"use strict";Le.d(Gt,{z:()=>Y});const Y={setTimeout(...Oe){const{delegate:Mt}=Y;return((null==Mt?void 0:Mt.setTimeout)||setTimeout)(...Oe)},clearTimeout(Oe){const{delegate:Mt}=Y;return((null==Mt?void 0:Mt.clearTimeout)||clearTimeout)(Oe)},delegate:void 0}},202:(er,Gt,Le)=>{"use strict";Le.d(Gt,{h:()=>Oe});const Oe=function Y(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},822:(er,Gt,Le)=>{"use strict";Le.d(Gt,{L:()=>Y});const Y="function"==typeof Symbol&&Symbol.observable||"@@observable"},669:(er,Gt,Le)=>{"use strict";Le.d(Gt,{_6:()=>en,jO:()=>u,yG:()=>wt});var Y=Le(576);function Mt(Nt){return Nt[Nt.length-1]}function u(Nt){return(0,Y.m)(Mt(Nt))?Nt.pop():void 0}function wt(Nt){return function Oe(Nt){return Nt&&(0,Y.m)(Nt.schedule)}(Mt(Nt))?Nt.pop():void 0}function en(Nt,et){return"number"==typeof Mt(Nt)?Nt.pop():et}},737:(er,Gt,Le)=>{"use strict";function Y(Oe,Mt){if(Oe){const u=Oe.indexOf(Mt);0<=u&&Oe.splice(u,1)}}Le.d(Gt,{P:()=>Y})},888:(er,Gt,Le)=>{"use strict";function Y(Oe){const u=Oe(wt=>{Error.call(wt),wt.stack=(new Error).stack});return u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u}Le.d(Gt,{d:()=>Y})},806:(er,Gt,Le)=>{"use strict";Le.d(Gt,{x:()=>Mt,O:()=>u});var Y=Le(416);let Oe=null;function Mt(wt){if(Y.v.useDeprecatedSynchronousErrorHandling){const en=!Oe;if(en&&(Oe={errorThrown:!1,error:null}),wt(),en){const{errorThrown:Nt,error:et}=Oe;if(Oe=null,Nt)throw et}}else wt()}function u(wt){Y.v.useDeprecatedSynchronousErrorHandling&&Oe&&(Oe.errorThrown=!0,Oe.error=wt)}},672:(er,Gt,Le)=>{"use strict";function Y(Oe,Mt,u,wt=0,en=!1){const Nt=Mt.schedule(function(){u(),en?Oe.add(this.schedule(null,wt)):this.unsubscribe()},wt);if(Oe.add(Nt),!en)return Nt}Le.d(Gt,{f:()=>Y})},671:(er,Gt,Le)=>{"use strict";function Y(Oe){return Oe}Le.d(Gt,{y:()=>Y})},144:(er,Gt,Le)=>{"use strict";Le.d(Gt,{z:()=>Y});const Y=Oe=>Oe&&"number"==typeof Oe.length&&"function"!=typeof Oe},206:(er,Gt,Le)=>{"use strict";Le.d(Gt,{D:()=>Oe});var Y=Le(576);function Oe(Mt){return Symbol.asyncIterator&&(0,Y.m)(null==Mt?void 0:Mt[Symbol.asyncIterator])}},576:(er,Gt,Le)=>{"use strict";function Y(Oe){return"function"==typeof Oe}Le.d(Gt,{m:()=>Y})},670:(er,Gt,Le)=>{"use strict";Le.d(Gt,{c:()=>Mt});var Y=Le(822),Oe=Le(576);function Mt(u){return(0,Oe.m)(u[Y.L])}},495:(er,Gt,Le)=>{"use strict";Le.d(Gt,{T:()=>Mt});var Y=Le(202),Oe=Le(576);function Mt(u){return(0,Oe.m)(null==u?void 0:u[Y.h])}},239:(er,Gt,Le)=>{"use strict";Le.d(Gt,{t:()=>Oe});var Y=Le(576);function Oe(Mt){return(0,Y.m)(null==Mt?void 0:Mt.then)}},260:(er,Gt,Le)=>{"use strict";Le.d(Gt,{Q:()=>Mt,L:()=>u});var Y=Le(655),Oe=Le(576);function Mt(wt){return(0,Y.FC)(this,arguments,function*(){const Nt=wt.getReader();try{for(;;){const{value:et,done:Et}=yield(0,Y.qq)(Nt.read());if(Et)return yield(0,Y.qq)(void 0);yield yield(0,Y.qq)(et)}}finally{Nt.releaseLock()}})}function u(wt){return(0,Oe.m)(null==wt?void 0:wt.getReader)}},482:(er,Gt,Le)=>{"use strict";Le.d(Gt,{A:()=>Oe,e:()=>Mt});var Y=Le(576);function Oe(u){return(0,Y.m)(null==u?void 0:u.lift)}function Mt(u){return wt=>{if(Oe(wt))return wt.lift(function(en){try{return u(en,this)}catch(Nt){this.error(Nt)}});throw new TypeError("Unable to lift unknown Observable type")}}},849:(er,Gt,Le)=>{"use strict";Le.d(Gt,{h:()=>Mt});var Y=Le(416),Oe=Le(410);function Mt(u){Oe.z.setTimeout(()=>{const{onUnhandledError:wt}=Y.v;if(!wt)throw u;wt(u)})}},532:(er,Gt,Le)=>{"use strict";function Y(Oe){return new TypeError(`You provided ${null!==Oe&&"object"==typeof Oe?"an invalid object":`'${Oe}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}Le.d(Gt,{z:()=>Y})},26:function(er){er.exports=function(){"use strict";var Gt,Le,Y;function Oe(u,wt){if(Gt)if(Le){var en="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Gt+")(sharedChunk); ("+Le+")(sharedChunk); self.onerror = null;",Nt={};Gt(Nt),Y=wt(Nt),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(Y.workerUrl=window.URL.createObjectURL(new Blob([en],{type:"text/javascript"})))}else Le=wt;else Gt=wt}return Oe(0,function(u){var en=Nt;function Nt(t,e,r,s){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=s,this.p2x=r,this.p2y=s}Nt.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},Nt.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},Nt.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},Nt.prototype.solveCurveX=function(t,e){var r,s,c,d,m;for(void 0===e&&(e=1e-6),c=t,m=0;m<8;m++){if(d=this.sampleCurveX(c)-t,Math.abs(d)<e)return c;var y=this.sampleCurveDerivativeX(c);if(Math.abs(y)<1e-6)break;c-=d/y}if((c=t)<(r=0))return r;if(c>(s=1))return s;for(;r<s;){if(d=this.sampleCurveX(c),Math.abs(d-t)<e)return c;t>d?r=c:s=c,c=.5*(s-r)+r}return c},Nt.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var et=Et;function Et(t,e){this.x=t,this.y=e}Et.prototype={clone:function(){return new Et(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,r=t.y-this.y;return e*e+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),r=Math.sin(t),s=r*this.x+e*this.y;return this.x=e*this.x-r*this.y,this.y=s,this},_rotateAround:function(t,e){var r=Math.cos(t),s=Math.sin(t),c=e.y+s*(this.x-e.x)+r*(this.y-e.y);return this.x=e.x+r*(this.x-e.x)-s*(this.y-e.y),this.y=c,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Et.convert=function(t){return t instanceof Et?t:Array.isArray(t)?new Et(t[0],t[1]):t};var Me="undefined"!=typeof self?self:{},st=1e-6,Ot="undefined"!=typeof Float32Array?Float32Array:Array;function Bn(){var t=new Ot(9);return Ot!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Ft(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Rt(t,e,r){var s=e[0],c=e[1],d=e[2],m=e[3],y=e[4],b=e[5],E=e[6],I=e[7],P=e[8],R=e[9],j=e[10],H=e[11],Q=e[12],ne=e[13],ce=e[14],ye=e[15],De=r[0],Ae=r[1],ke=r[2],Re=r[3];return t[0]=De*s+Ae*y+ke*P+Re*Q,t[1]=De*c+Ae*b+ke*R+Re*ne,t[2]=De*d+Ae*E+ke*j+Re*ce,t[3]=De*m+Ae*I+ke*H+Re*ye,t[4]=(De=r[4])*s+(Ae=r[5])*y+(ke=r[6])*P+(Re=r[7])*Q,t[5]=De*c+Ae*b+ke*R+Re*ne,t[6]=De*d+Ae*E+ke*j+Re*ce,t[7]=De*m+Ae*I+ke*H+Re*ye,t[8]=(De=r[8])*s+(Ae=r[9])*y+(ke=r[10])*P+(Re=r[11])*Q,t[9]=De*c+Ae*b+ke*R+Re*ne,t[10]=De*d+Ae*E+ke*j+Re*ce,t[11]=De*m+Ae*I+ke*H+Re*ye,t[12]=(De=r[12])*s+(Ae=r[13])*y+(ke=r[14])*P+(Re=r[15])*Q,t[13]=De*c+Ae*b+ke*R+Re*ne,t[14]=De*d+Ae*E+ke*j+Re*ce,t[15]=De*m+Ae*I+ke*H+Re*ye,t}function an(t,e,r){var s,c,d,m,y,b,E,I,P,R,j,H,Q=r[0],ne=r[1],ce=r[2];return e===t?(t[12]=e[0]*Q+e[4]*ne+e[8]*ce+e[12],t[13]=e[1]*Q+e[5]*ne+e[9]*ce+e[13],t[14]=e[2]*Q+e[6]*ne+e[10]*ce+e[14],t[15]=e[3]*Q+e[7]*ne+e[11]*ce+e[15]):(c=e[1],d=e[2],m=e[3],y=e[4],b=e[5],E=e[6],I=e[7],P=e[8],R=e[9],j=e[10],H=e[11],t[0]=s=e[0],t[1]=c,t[2]=d,t[3]=m,t[4]=y,t[5]=b,t[6]=E,t[7]=I,t[8]=P,t[9]=R,t[10]=j,t[11]=H,t[12]=s*Q+y*ne+P*ce+e[12],t[13]=c*Q+b*ne+R*ce+e[13],t[14]=d*Q+E*ne+j*ce+e[14],t[15]=m*Q+I*ne+H*ce+e[15]),t}function It(t,e,r){var s=r[0],c=r[1],d=r[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*c,t[5]=e[5]*c,t[6]=e[6]*c,t[7]=e[7]*c,t[8]=e[8]*d,t[9]=e[9]*d,t[10]=e[10]*d,t[11]=e[11]*d,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Nn(t,e,r){var s=Math.sin(r),c=Math.cos(r),d=e[4],m=e[5],y=e[6],b=e[7],E=e[8],I=e[9],P=e[10],R=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=d*c+E*s,t[5]=m*c+I*s,t[6]=y*c+P*s,t[7]=b*c+R*s,t[8]=E*c-d*s,t[9]=I*c-m*s,t[10]=P*c-y*s,t[11]=R*c-b*s,t}function zn(t,e,r){var s=Math.sin(r),c=Math.cos(r),d=e[0],m=e[1],y=e[2],b=e[3],E=e[8],I=e[9],P=e[10],R=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*c-E*s,t[1]=m*c-I*s,t[2]=y*c-P*s,t[3]=b*c-R*s,t[8]=d*s+E*c,t[9]=m*s+I*c,t[10]=y*s+P*c,t[11]=b*s+R*c,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var xn=Rt;function ut(){var t=new Ot(3);return Ot!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Dt(t){var e=new Ot(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function fn(t){return Math.hypot(t[0],t[1],t[2])}function Wt(t,e,r){var s=new Ot(3);return s[0]=t,s[1]=e,s[2]=r,s}function tn(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function ft(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function Ne(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function $e(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t}function He(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function qe(t,e,r,s){return t[0]=e[0]+r[0]*s,t[1]=e[1]+r[1]*s,t[2]=e[2]+r[2]*s,t}function _t(t,e){var r=e[0],s=e[1],c=e[2],d=r*r+s*s+c*c;return d>0&&(d=1/Math.sqrt(d)),t[0]=e[0]*d,t[1]=e[1]*d,t[2]=e[2]*d,t}function Ve(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function En(t,e,r){var s=e[0],c=e[1],d=e[2],m=r[0],y=r[1],b=r[2];return t[0]=c*b-d*y,t[1]=d*m-s*b,t[2]=s*y-c*m,t}function Qt(t,e,r){var s=e[0],c=e[1],d=e[2],m=r[3]*s+r[7]*c+r[11]*d+r[15];return t[0]=(r[0]*s+r[4]*c+r[8]*d+r[12])/(m=m||1),t[1]=(r[1]*s+r[5]*c+r[9]*d+r[13])/m,t[2]=(r[2]*s+r[6]*c+r[10]*d+r[14])/m,t}function br(t,e,r){var s=r[0],c=r[1],d=r[2],m=e[0],y=e[1],b=e[2],E=c*b-d*y,I=d*m-s*b,P=s*y-c*m,R=c*P-d*I,j=d*E-s*P,H=s*I-c*E,Q=2*r[3];return I*=Q,P*=Q,j*=2,H*=2,t[0]=m+(E*=Q)+(R*=2),t[1]=y+I+j,t[2]=b+P+H,t}var hn,t,$r=ft,yi=Ne,ur=fn;function vi(t,e,r){var s=e[0],c=e[1],d=e[2],m=e[3];return t[0]=r[0]*s+r[4]*c+r[8]*d+r[12]*m,t[1]=r[1]*s+r[5]*c+r[9]*d+r[13]*m,t[2]=r[2]*s+r[6]*c+r[10]*d+r[14]*m,t[3]=r[3]*s+r[7]*c+r[11]*d+r[15]*m,t}function Fi(){var t=new Ot(4);return Ot!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Eo(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Zi(t,e,r){r*=.5;var s=e[0],c=e[1],d=e[2],m=e[3],y=Math.sin(r),b=Math.cos(r);return t[0]=s*b+m*y,t[1]=c*b+d*y,t[2]=d*b-c*y,t[3]=m*b-s*y,t}function Lr(t,e){return t[0]===e[0]&&t[1]===e[1]}ut(),hn=new Ot(4),Ot!=Float32Array&&(hn[0]=0,hn[1]=0,hn[2]=0,hn[3]=0),ut(),Wt(1,0,0),Wt(0,1,0),Fi(),Fi(),Bn(),t=new Ot(2),Ot!=Float32Array&&(t[0]=0,t[1]=0);const $n=Math.PI/180,Gn=180/Math.PI;function Cn(t){return t*$n}function qi(t){return t*Gn}const ds=[[0,0],[1,0],[1,1],[0,1]];function Gr(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,r=e*t;return 4*(t<.5?r:3*(t-e)+r-.75)}function Es(t,e,r,s){const c=new en(t,e,r,s);return function(d){return c.solve(d)}}const To=Es(.25,.1,.25,1);function Pn(t,e,r){return Math.min(r,Math.max(e,t))}function Yr(t,e,r){return(r=Pn((r-t)/(e-t),0,1))*r*(3-2*r)}function Kr(t,e,r){const s=r-e,c=((t-e)%s+s)%s+e;return c===e?r:c}function ti(t,e,r){if(!t.length)return r(null,[]);let s=t.length;const c=new Array(t.length);let d=null;t.forEach((m,y)=>{e(m,(b,E)=>{b&&(d=b),c[y]=E,0==--s&&r(d,c)})})}function xi(t){const e=[];for(const r in t)e.push(t[r]);return e}function cr(t,...e){for(const r of e)for(const s in r)t[s]=r[s];return t}let uo=1;function fs(){return uo++}function ho(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Jt(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function wr(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function un(t,e){t.forEach(r=>{e[r]&&(e[r]=e[r].bind(e))})}function cn(t,e){return-1!==t.indexOf(e,t.length-e.length)}function fo(t,e,r){const s={};for(const c in t)s[c]=e.call(r||this,t[c],c,t);return s}function Po(t,e,r){const s={};for(const c in t)e.call(r||this,t[c],c,t)&&(s[c]=t[c]);return s}function hr(t){return Array.isArray(t)?t.map(hr):"object"==typeof t&&t?fo(t,hr):t}const fi={};function Hn(t){fi[t]||("undefined"!=typeof console&&console.warn(t),fi[t]=!0)}function po(t,e,r){return(r.y-t.y)*(e.x-t.x)>(e.y-t.y)*(r.x-t.x)}function Zn(t){let e=0;for(let r,s,c=0,d=t.length,m=d-1;c<d;m=c++)r=t[c],s=t[m],e+=(s.x-r.x)*(r.y+s.y);return e}function mo(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function qt(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(r,s,c,d)=>{const m=c||d;return e[s]=!m||m.toLowerCase(),""}),e["max-age"]){const r=parseInt(e["max-age"],10);isNaN(r)?delete e["max-age"]:e["max-age"]=r}return e}let ps,pi,Kn,no=null;function ko(t){if(null==no){const e=t.navigator?t.navigator.userAgent:null;no=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return no}function ro(t){try{const e=Me[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(e){return!1}}const Sn={now:()=>void 0!==Kn?Kn:Me.performance.now(),setNow(t){Kn=t},restoreNow(){Kn=void 0},frame(t){const e=Me.requestAnimationFrame(t);return{cancel:()=>Me.cancelAnimationFrame(e)}},getImageData(t,e=0){const r=Me.document.createElement("canvas"),s=r.getContext("2d");if(!s)throw new Error("failed to create canvas 2d context");return r.width=t.width,r.height=t.height,s.drawImage(t,0,0,t.width,t.height),s.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:t=>(ps||(ps=Me.document.createElement("a")),ps.href=t,ps.href),get devicePixelRatio(){return Me.devicePixelRatio},get prefersReducedMotion(){return!!Me.matchMedia&&(null==pi&&(pi=Me.matchMedia("(prefers-reduced-motion: reduce)")),pi.matches)}};let oe;const V={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==oe){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{oe=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch(e){oe=t}}return oe},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Z={supported:!1,testSupport:function(t){!_e&&le&&(Ie?Pe(t):se=t)}};let se,le,_e=!1,Ie=!1;function Pe(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,le),t.isContextLost())return;Z.supported=!0}catch(r){}t.deleteTexture(e),_e=!0}Me.document&&(le=Me.document.createElement("img"),le.onload=function(){se&&Pe(se),se=null,Ie=!0},le.onerror=function(){_e=!0,se=null},le.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Ee="01",Fe="NO_ACCESS_TOKEN";function Xe(t){return 0===t.indexOf("mapbox:")}function nt(t){return V.API_URL_REGEX.test(t)}const it=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ht(t){const e=t.match(it);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Kt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function ve(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Me.atob(e[1]).split("").map(r=>"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(r){return null}}class de{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const r=ve(V.ACCESS_TOKEN);let s="";return s=r&&r.u?Me.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(c,d)=>String.fromCharCode(Number("0x"+d)))):V.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=ro("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const c=Me.localStorage.getItem(r);c&&(this.eventData=JSON.parse(c));const d=Me.localStorage.getItem(s);d&&(this.anonId=d)}catch(c){Hn("Unable to read from LocalStorage")}}saveEventData(){const e=ro("localStorage"),r=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{Me.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Me.localStorage.setItem(r,JSON.stringify(this.eventData))}catch(c){Hn("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,r,s,c){if(!V.EVENTS_URL)return;const d=Ht(V.EVENTS_URL);d.params.push(`access_token=${c||V.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.7.0",skuId:Ee,userId:this.anonId},y=r?cr(m,r):m,b={url:Kt(d),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=io(b,E=>{this.pendingRequest=null,s(E),this.saveEventData(),this.processRequests(c)})}queueRequest(e,r){this.queue.push(e),this.processRequests(r)}}const ae=new class extends de{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){V.EVENTS_URL&&V.ACCESS_TOKEN&&Array.isArray(t)&&t.some(r=>Xe(r)||nt(r))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=ve(V.ACCESS_TOKEN),r=e?e.u:V.ACCESS_TOKEN;let s=r!==this.eventData.tokenU;wr(this.anonId)||(this.anonId=ho(),s=!0);const c=this.queue.shift();if(this.eventData.lastSuccess){const d=new Date(this.eventData.lastSuccess),m=new Date(c),y=(c-this.eventData.lastSuccess)/864e5;s=s||y>=1||y<-1||d.getDate()!==m.getDate()}else s=!0;if(!s)return this.processRequests();this.postEvent(c,{"enabled.telemetry":!1},d=>{d||(this.eventData.lastSuccess=c,this.eventData.tokenU=r)},t)}},Se=ae.postTurnstileEvent.bind(ae),Ze=new class extends de{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,r,s){this.skuToken=e,this.errorCb=s,V.EVENTS_URL&&(r||V.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(Fe)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),wr(this.anonId)||(this.anonId=ho()),this.postEvent(r,{skuToken:this.skuToken},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}},At=Ze.postMapLoadEvent.bind(Ze),Xt=new class extends de{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,r,s){if(!V.API_URL||!V.SESSION_PATH)return;const c=Ht(V.API_URL+V.SESSION_PATH);c.params.push(`sku=${e||""}`),c.params.push(`access_token=${s||V.ACCESS_TOKEN||""}`);const d={url:Kt(c),headers:{"Content-Type":"text/plain"}};this.pendingRequest=qo(d,m=>{this.pendingRequest=null,r(m),this.saveEventData(),this.processRequests(s)})}getSessionAPI(t,e,r,s){this.skuToken=e,this.errorCb=s,V.SESSION_PATH&&V.API_URL&&(r||V.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},r):this.errorCb(new Error(Fe)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:r}=this.queue.shift();e&&this.success[e]||this.getSession(r,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}},Er=Xt.getSessionAPI.bind(Xt),Tr=new Set,Fr="mapbox-tiles";let Si,Or,ms=500,Mi=50;function Ut(){Me.caches&&!Si&&(Si=Me.caches.open(Fr))}function kn(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}let dr=1/0;const ci={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(ci);class go extends Error{constructor(e,r,s){401===r&&nt(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(e),this.status=r,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Qr=mo()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Me.location.protocol?Me.parent:Me).location.href,mi=function(t,e){if(!(/^file:/.test(r=t.url)||/^file:/.test(Qr())&&!/^\w+:/.test(r))){if(Me.fetch&&Me.Request&&Me.AbortController&&Me.Request.prototype.hasOwnProperty("signal"))return function(s,c){const d=new Me.AbortController,m=new Me.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Qr(),signal:d.signal});let y=!1,b=!1;const E=(I=m.url).indexOf("sku=")>0&&nt(I);var I;"json"===s.type&&m.headers.set("Accept","application/json");const P=(j,H,Q)=>{if(b)return;if(j&&"SecurityError"!==j.message&&Hn(j),H&&Q)return R(H);const ne=Date.now();Me.fetch(m).then(ce=>{if(ce.ok){const ye=E?ce.clone():null;return R(ce,ye,ne)}return c(new go(ce.statusText,ce.status,s.url))}).catch(ce=>{20!==ce.code&&c(new Error(ce.message))})},R=(j,H,Q)=>{("arrayBuffer"===s.type?j.arrayBuffer():"json"===s.type?j.json():j.text()).then(ne=>{b||(H&&Q&&function(ce,ye,De){if(Ut(),!Si)return;const Ae={status:ye.status,statusText:ye.statusText,headers:new Me.Headers};ye.headers.forEach((Re,rt)=>Ae.headers.set(rt,Re));const ke=qt(ye.headers.get("Cache-Control")||"");ke["no-store"]||(ke["max-age"]&&Ae.headers.set("Expires",new Date(De+1e3*ke["max-age"]).toUTCString()),new Date(Ae.headers.get("Expires")).getTime()-De<42e4||function(Re,rt){if(void 0===Or)try{new Response(new ReadableStream),Or=!0}catch(Je){Or=!1}Or?rt(Re.body):Re.blob().then(rt)}(ye,Re=>{const rt=new Me.Response(Re,Ae);Ut(),Si&&Si.then(Je=>Je.put(kn(ce.url),rt)).catch(Je=>Hn(Je.message))}))}(m,H,Q),y=!0,c(null,ne,j.headers.get("Cache-Control"),j.headers.get("Expires")))}).catch(ne=>{b||c(new Error(ne.message))})};return E?function(j,H){if(Ut(),!Si)return H(null);const Q=kn(j.url);Si.then(ne=>{ne.match(Q).then(ce=>{const ye=function(De){if(!De)return!1;const Ae=new Date(De.headers.get("Expires")||0),ke=qt(De.headers.get("Cache-Control")||"");return Ae>Date.now()&&!ke["no-cache"]}(ce);ne.delete(Q),ye&&ne.put(Q,ce.clone()),H(null,ce,ye)}).catch(H)}).catch(H)}(m,P):P(null,null),{cancel:()=>{b=!0,y||d.abort()}}}(t,e);if(mo()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var r;return function(s,c){const d=new Me.XMLHttpRequest;d.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(d.responseType="arraybuffer");for(const m in s.headers)d.setRequestHeader(m,s.headers[m]);return"json"===s.type&&(d.responseType="text",d.setRequestHeader("Accept","application/json")),d.withCredentials="include"===s.credentials,d.onerror=()=>{c(new Error(d.statusText))},d.onload=()=>{if((d.status>=200&&d.status<300||0===d.status)&&null!==d.response){let m=d.response;if("json"===s.type)try{m=JSON.parse(d.response)}catch(y){return c(y)}c(null,m,d.getResponseHeader("Cache-Control"),d.getResponseHeader("Expires"))}else c(new go(d.statusText,d.status,s.url))},d.send(s.body),{cancel:()=>d.abort()}}(t,e)},Dr=function(t,e){return mi(cr(t,{type:"arrayBuffer"}),e)},io=function(t,e){return mi(cr(t,{method:"POST"}),e)},qo=function(t,e){return mi(cr(t,{method:"GET"}),e)};function Mn(t){const e=Me.document.createElement("a");return e.href=t,e.protocol===Me.document.location.protocol&&e.host===Me.document.location.host}const Ro="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let oo,Wo;oo=[],Wo=0;const Ts=function(t,e){if(Z.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Wo>=V.MAX_PARALLEL_IMAGE_REQUESTS){const d={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return oo.push(d),d}Wo++;let r=!1;const s=()=>{if(!r)for(r=!0,Wo--;oo.length&&Wo<V.MAX_PARALLEL_IMAGE_REQUESTS;){const d=oo.shift(),{requestParameters:m,callback:y,cancelled:b}=d;b||(d.cancel=Ts(m,y).cancel)}},c=Dr(t,(d,m,y,b)=>{s(),d?e(d):m&&(Me.createImageBitmap?function(E,I){const P=new Me.Blob([new Uint8Array(E)],{type:"image/png"});Me.createImageBitmap(P).then(R=>{I(null,R)}).catch(R=>{I(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(E,I)=>e(E,I,y,b)):function(E,I){const P=new Me.Image,R=Me.URL;P.onload=()=>{I(null,P),R.revokeObjectURL(P.src),P.onload=null,Me.requestAnimationFrame(()=>{P.src=Ro})},P.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const j=new Me.Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?R.createObjectURL(j):Ro}(m,(E,I)=>e(E,I,y,b)))});return{cancel:()=>{c.cancel(),s()}}};function Ii(t,e,r){r[t]&&-1!==r[t].indexOf(e)||(r[t]=r[t]||[],r[t].push(e))}function Xo(t,e,r){if(r&&r[t]){const s=r[t].indexOf(e);-1!==s&&r[t].splice(s,1)}}class Ai{constructor(e,r={}){cr(this,r),this.type=e}}class Hr extends Ai{constructor(e,r={}){super("error",cr({error:e},r))}}class Rn{on(e,r){return this._listeners=this._listeners||{},Ii(e,r,this._listeners),this}off(e,r){return Xo(e,r,this._listeners),Xo(e,r,this._oneTimeListeners),this}once(e,r){return r?(this._oneTimeListeners=this._oneTimeListeners||{},Ii(e,r,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,r){"string"==typeof e&&(e=new Ai(e,r||{}));const s=e.type;if(this.listens(s)){e.target=this;const c=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const y of c)y.call(this,e);const d=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const y of d)Xo(s,y,this._oneTimeListeners),y.call(this,e);const m=this._eventedParent;m&&(cr(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof Hr&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,r){return this._eventedParent=e,this._eventedParentData=r,this}}var We=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class kt{constructor(e,r,s,c){this.message=(e?`${e}: `:"")+s,c&&(this.identifier=c),null!=r&&r.__line__&&(this.line=r.__line__)}}function Jr(t){const e=t.value;return e?[new kt(t.key,e,"constants have been deprecated as of v8")]:[]}function Nr(t,...e){for(const r of e)for(const s in r)t[s]=r[s];return t}function Pr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function _o(t){if(Array.isArray(t))return t.map(_o);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const r in t)e[r]=_o(t[r]);return e}return Pr(t)}class Pi extends Error{constructor(e,r){super(r),this.message=r,this.key=e}}class Oi{constructor(e,r=[]){this.parent=e,this.bindings={};for(const[s,c]of r)this.bindings[s]=c}concat(e){return new Oi(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Lo={kind:"null"},Pt={kind:"number"},In={kind:"string"},Tn={kind:"boolean"},Yo={kind:"color"},Ko={kind:"object"},An={kind:"value"},Ra={kind:"collator"},Ds={kind:"formatted"},Cs={kind:"resolvedImage"};function zi(t,e){return{kind:"array",itemType:t,N:e}}function kr(t){if("array"===t.kind){const e=kr(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Ol=[Lo,Pt,In,Tn,Yo,Ds,Ko,zi(An),Cs];function Bi(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Bi(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const r of Ol)if(!Bi(r,e))return null}return`Expected ${kr(t)} but found ${kr(e)} instead.`}function ol(t,e){return e.some(r=>r.kind===t.kind)}function Ss(t,e){return e.some(r=>"null"===r?null===t:"array"===r?Array.isArray(t):"object"===r?t&&!Array.isArray(t)&&"object"==typeof t:r===typeof t)}function Ms(t){var e={exports:{}};return t(e,e.exports),e.exports}var Is=Ms(function(t,e){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function s(y){return(y=Math.round(y))<0?0:y>255?255:y}function c(y){return s("%"===y[y.length-1]?parseFloat(y)/100*255:parseInt(y))}function d(y){return(b="%"===y[y.length-1]?parseFloat(y)/100:parseFloat(y))<0?0:b>1?1:b;var b}function m(y,b,E){return E<0?E+=1:E>1&&(E-=1),6*E<1?y+(b-y)*E*6:2*E<1?b:3*E<2?y+(b-y)*(2/3-E)*6:y}try{e.parseCSSColor=function(y){var b,E=y.replace(/ /g,"").toLowerCase();if(E in r)return r[E].slice();if("#"===E[0])return 4===E.length?(b=parseInt(E.substr(1),16))>=0&&b<=4095?[(3840&b)>>4|(3840&b)>>8,240&b|(240&b)>>4,15&b|(15&b)<<4,1]:null:7===E.length&&(b=parseInt(E.substr(1),16))>=0&&b<=16777215?[(16711680&b)>>16,(65280&b)>>8,255&b,1]:null;var I=E.indexOf("("),P=E.indexOf(")");if(-1!==I&&P+1===E.length){var R=E.substr(0,I),j=E.substr(I+1,P-(I+1)).split(","),H=1;switch(R){case"rgba":if(4!==j.length)return null;H=d(j.pop());case"rgb":return 3!==j.length?null:[c(j[0]),c(j[1]),c(j[2]),H];case"hsla":if(4!==j.length)return null;H=d(j.pop());case"hsl":if(3!==j.length)return null;var Q=(parseFloat(j[0])%360+360)%360/360,ne=d(j[1]),ce=d(j[2]),ye=ce<=.5?ce*(ne+1):ce+ne-ce*ne,De=2*ce-ye;return[s(255*m(De,ye,Q+1/3)),s(255*m(De,ye,Q)),s(255*m(De,ye,Q-1/3)),H];default:return null}}return null}}catch(y){}});class Un{constructor(e,r,s,c=1){this.r=e,this.g=r,this.b=s,this.a=c}static parse(e){if(!e)return;if(e instanceof Un)return e;if("string"!=typeof e)return;const r=Is.parseCSSColor(e);return r?new Un(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}toString(){const[e,r,s,c]=this.toArray();return`rgba(${Math.round(e)},${Math.round(r)},${Math.round(s)},${c})`}toArray(){const{r:e,g:r,b:s,a:c}=this;return 0===c?[0,0,0,0]:[255*e/c,255*r/c,255*s/c,c]}}Un.black=new Un(0,0,0,1),Un.white=new Un(1,1,1,1),Un.transparent=new Un(0,0,0,0),Un.red=new Un(1,0,0,1),Un.blue=new Un(0,0,1,1);class qs{constructor(e,r,s){this.sensitivity=e?r?"variant":"case":r?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,r){return this.collator.compare(e,r)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ca{constructor(e,r,s,c,d){this.text=e.normalize?e.normalize():e,this.image=r,this.scale=s,this.fontStack=c,this.textColor=d}}class bn{constructor(e){this.sections=e}static fromString(e){return new bn([new ca(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof bn?e:bn.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const r of this.sections){if(r.image){e.push(["image",r.image.name]);continue}e.push(r.text);const s={};r.fontStack&&(s["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(s["font-scale"]=r.scale),r.textColor&&(s["text-color"]=["rgba"].concat(r.textColor.toArray())),e.push(s)}return e}}class so{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new so({name:e,available:!1}):null}serialize(){return["image",this.name]}}function gs(t,e,r,s){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,r,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[t,e,r,s]:[t,e,r]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ua(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Un||t instanceof qs||t instanceof bn||t instanceof so)return!0;if(Array.isArray(t)){for(const e of t)if(!ua(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!ua(t[e]))return!1;return!0}return!1}function Ur(t){if(null===t)return Lo;if("string"==typeof t)return In;if("boolean"==typeof t)return Tn;if("number"==typeof t)return Pt;if(t instanceof Un)return Yo;if(t instanceof qs)return Ra;if(t instanceof bn)return Ds;if(t instanceof so)return Cs;if(Array.isArray(t)){const e=t.length;let r;for(const s of t){const c=Ur(s);if(r){if(r===c)continue;r=An;break}r=c}return zi(r||An,e)}return Ko}function ha(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Un||t instanceof bn||t instanceof so?t.toString():JSON.stringify(t)}class As{constructor(e,r){this.type=e,this.value=r}static parse(e,r){if(2!==e.length)return r.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!ua(e[1]))return r.error("invalid value");const s=e[1];let c=Ur(s);const d=r.expectedType;return"array"!==c.kind||0!==c.N||!d||"array"!==d.kind||"number"==typeof d.N&&0!==d.N||(c=d),new As(c,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Un?["rgba"].concat(this.value.toArray()):this.value instanceof bn?this.value.serialize():this.value}}class bi{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Ws={string:In,number:Pt,boolean:Tn,object:Ko};class ni{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");let s,c=1;const d=e[0];if("array"===d){let y,b;if(e.length>2){const E=e[1];if("string"!=typeof E||!(E in Ws)||"object"===E)return r.error('The item type argument of "array" must be one of string, number, boolean',1);y=Ws[E],c++}else y=An;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return r.error('The length argument to "array" must be a positive integer literal',2);b=e[2],c++}s=zi(y,b)}else s=Ws[d];const m=[];for(;c<e.length;c++){const y=r.parse(e[c],c,An);if(!y)return null;m.push(y)}return new ni(s,m)}evaluate(e){for(let r=0;r<this.args.length;r++){const s=this.args[r].evaluate(e);if(!Bi(this.type,Ur(s)))return s;if(r===this.args.length-1)throw new bi(`Expected value to be of type ${kr(this.type)}, but found ${kr(Ur(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,r=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){r.push(s.kind);const c=e.N;("number"==typeof c||this.args.length>1)&&r.push(c)}}return r.concat(this.args.map(s=>s.serialize()))}}class Fo{constructor(e){this.type=Ds,this.sections=e}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return r.error("First argument must be an image or text section.");const c=[];let d=!1;for(let m=1;m<=e.length-1;++m){const y=e[m];if(d&&"object"==typeof y&&!Array.isArray(y)){d=!1;let b=null;if(y["font-scale"]&&(b=r.parse(y["font-scale"],1,Pt),!b))return null;let E=null;if(y["text-font"]&&(E=r.parse(y["text-font"],1,zi(In)),!E))return null;let I=null;if(y["text-color"]&&(I=r.parse(y["text-color"],1,Yo),!I))return null;const P=c[c.length-1];P.scale=b,P.font=E,P.textColor=I}else{const b=r.parse(e[m],1,An);if(!b)return null;const E=b.type.kind;if("string"!==E&&"value"!==E&&"null"!==E&&"resolvedImage"!==E)return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");d=!0,c.push({content:b,scale:null,font:null,textColor:null})}}return new Fo(c)}evaluate(e){return new bn(this.sections.map(r=>{const s=r.content.evaluate(e);return Ur(s)===Cs?new ca("",s,null,null,null):new ca(ha(s),null,r.scale?r.scale.evaluate(e):null,r.font?r.font.evaluate(e).join(","):null,r.textColor?r.textColor.evaluate(e):null)}))}eachChild(e){for(const r of this.sections)e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const r of this.sections){e.push(r.content.serialize());const s={};r.scale&&(s["font-scale"]=r.scale.serialize()),r.font&&(s["text-font"]=r.font.serialize()),r.textColor&&(s["text-color"]=r.textColor.serialize()),e.push(s)}return e}}class ki{constructor(e){this.type=Cs,this.input=e}static parse(e,r){if(2!==e.length)return r.error("Expected two arguments.");const s=r.parse(e[1],1,In);return s?new ki(s):r.error("No image name provided.")}evaluate(e){const r=this.input.evaluate(e),s=so.fromString(r);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(r)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const dc={"to-boolean":Tn,"to-color":Yo,"to-number":Pt,"to-string":In};class ri{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return r.error("Expected one argument.");const c=dc[s],d=[];for(let m=1;m<e.length;m++){const y=r.parse(e[m],m,An);if(!y)return null;d.push(y)}return new ri(c,d)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let r,s;for(const c of this.args){if(r=c.evaluate(e),s=null,r instanceof Un)return r;if("string"==typeof r){const d=e.parseColor(r);if(d)return d}else if(Array.isArray(r)&&(s=r.length<3||r.length>4?`Invalid rbga value ${JSON.stringify(r)}: expected an array containing either three or four numeric values.`:gs(r[0],r[1],r[2],r[3]),!s))return new Un(r[0]/255,r[1]/255,r[2]/255,r[3])}throw new bi(s||`Could not parse color from value '${"string"==typeof r?r:String(JSON.stringify(r))}'`)}if("number"===this.type.kind){let r=null;for(const s of this.args){if(r=s.evaluate(e),null===r)return 0;const c=Number(r);if(!isNaN(c))return c}throw new bi(`Could not convert ${JSON.stringify(r)} to number.`)}return"formatted"===this.type.kind?bn.fromString(ha(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?so.fromString(ha(this.args[0].evaluate(e))):ha(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Fo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ki(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(r=>{e.push(r.serialize())}),e}}const La=["Unknown","Point","LineString","Polygon"];class z{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?La[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:s,y:c}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*r-e[0])+this.featureDistanceData.bearing[1]*(c*r-e[1])}return 0}parseColor(e){let r=this._parseColorCache[e];return r||(r=this._parseColorCache[e]=Un.parse(e)),r}}class W{constructor(e,r,s,c){this.name=e,this.type=r,this._evaluate=s,this.args=c}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,r){const s=e[0],c=W.definitions[s];if(!c)return r.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const d=Array.isArray(c)?c[0]:c.type,m=Array.isArray(c)?[[c[1],c[2]]]:c.overloads,y=m.filter(([E])=>!Array.isArray(E)||E.length===e.length-1);let b=null;for(const[E,I]of y){b=new ks(r.registry,r.path,null,r.scope);const P=[];let R=!1;for(let j=1;j<e.length;j++){const H=e[j],Q=Array.isArray(E)?E[j-1]:E.type,ne=b.parse(H,1+P.length,Q);if(!ne){R=!0;break}P.push(ne)}if(!R)if(Array.isArray(E)&&E.length!==P.length)b.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let j=0;j<P.length;j++){const H=Array.isArray(E)?E[j]:E.type,Q=P[j];b.concat(j+1).checkSubtype(H,Q.type)}if(0===b.errors.length)return new W(s,d,I,P)}}if(1===y.length)r.errors.push(...b.errors);else{const E=(y.length?y:m).map(([P])=>{return R=P,Array.isArray(R)?`(${R.map(kr).join(", ")})`:`(${kr(R.type)}...)`;var R}).join(" | "),I=[];for(let P=1;P<e.length;P++){const R=r.parse(e[P],1+I.length);if(!R)return null;I.push(kr(R.type))}r.error(`Expected arguments of type ${E}, but found (${I.join(", ")}) instead.`)}return null}static register(e,r){W.definitions=r;for(const s in r)e[s]=W}}class B{constructor(e,r,s){this.type=Ra,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=r}static parse(e,r){if(2!==e.length)return r.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return r.error("Collator options argument must be an object.");const c=r.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Tn);if(!c)return null;const d=r.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Tn);if(!d)return null;let m=null;return s.locale&&(m=r.parse(s.locale,1,In),!m)?null:new B(c,d,m)}evaluate(e){return new qs(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const J=8192;function Te(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ye(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function yt(t,e){const r=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,c=Math.pow(2,e.z);return[Math.round(r*c*J),Math.round(s*c*J)]}function rn(t,e,r){const s=t[0]-e[0],c=t[1]-e[1],d=t[0]-r[0],m=t[1]-r[1];return s*m-d*c==0&&s*d<=0&&c*m<=0}function gn(t,e){let r=!1;for(let m=0,y=e.length;m<y;m++){const b=e[m];for(let E=0,I=b.length;E<I-1;E++){if(rn(t,b[E],b[E+1]))return!1;(c=b[E])[1]>(s=t)[1]!=(d=b[E+1])[1]>s[1]&&s[0]<(d[0]-c[0])*(s[1]-c[1])/(d[1]-c[1])+c[0]&&(r=!r)}}var s,c,d;return r}function Cr(t,e){for(let r=0;r<e.length;r++)if(gn(t,e[r]))return!0;return!1}function Sr(t,e,r,s){const c=s[0]-r[0],d=s[1]-r[1],m=(t[0]-r[0])*d-c*(t[1]-r[1]),y=(e[0]-r[0])*d-c*(e[1]-r[1]);return m>0&&y<0||m<0&&y>0}function dn(t,e,r){for(const E of r)for(let I=0;I<E.length-1;++I)if((y=[(m=E[I+1])[0]-(d=E[I])[0],m[1]-d[1]])[0]*(b=[(c=e)[0]-(s=t)[0],c[1]-s[1]])[1]-y[1]*b[0]!=0&&Sr(s,c,d,m)&&Sr(d,m,s,c))return!0;var s,c,d,m,y,b;return!1}function _r(t,e){for(let r=0;r<t.length;++r)if(!gn(t[r],e))return!1;for(let r=0;r<t.length-1;++r)if(dn(t[r],t[r+1],e))return!1;return!0}function Vr(t,e){for(let r=0;r<e.length;r++)if(_r(t,e[r]))return!0;return!1}function ei(t,e,r){const s=[];for(let c=0;c<t.length;c++){const d=[];for(let m=0;m<t[c].length;m++){const y=yt(t[c][m],r);Te(e,y),d.push(y)}s.push(d)}return s}function ii(t,e,r){const s=[];for(let c=0;c<t.length;c++){const d=ei(t[c],e,r);s.push(d)}return s}function yo(t,e,r,s){if(t[0]<r[0]||t[0]>r[2]){const c=.5*s;let d=t[0]-r[0]>c?-s:r[0]-t[0]>c?s:0;0===d&&(d=t[0]-r[2]>c?-s:r[2]-t[0]>c?s:0),t[0]+=d}Te(e,t)}function Ps(t,e,r,s){const c=Math.pow(2,s.z)*J,d=[s.x*J,s.y*J],m=[];for(const y of t)for(const b of y){const E=[b.x+d[0],b.y+d[1]];yo(E,e,r,c),m.push(E)}return m}function vo(t,e,r,s){const c=Math.pow(2,s.z)*J,d=[s.x*J,s.y*J],m=[];for(const b of t){const E=[];for(const I of b){const P=[I.x+d[0],I.y+d[1]];Te(e,P),E.push(P)}m.push(E)}if(e[2]-e[0]<=c/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of m)for(const E of b)yo(E,e,r,c)}var y;return m}class oi{constructor(e,r){this.type=Tn,this.geojson=e,this.geometries=r}static parse(e,r){if(2!==e.length)return r.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(ua(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let c=0;c<s.features.length;++c){const d=s.features[c].geometry.type;if("Polygon"===d||"MultiPolygon"===d)return new oi(s,s.features[c].geometry)}else if("Feature"===s.type){const c=s.geometry.type;if("Polygon"===c||"MultiPolygon"===c)return new oi(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new oi(s,s)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(r,s){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if("Polygon"===s.type){const y=ei(s.coordinates,d,m),b=Ps(r.geometry(),c,d,m);if(!Ye(c,d))return!1;for(const E of b)if(!gn(E,y))return!1}if("MultiPolygon"===s.type){const y=ii(s.coordinates,d,m),b=Ps(r.geometry(),c,d,m);if(!Ye(c,d))return!1;for(const E of b)if(!Cr(E,y))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(r,s){const c=[1/0,1/0,-1/0,-1/0],d=[1/0,1/0,-1/0,-1/0],m=r.canonicalID();if("Polygon"===s.type){const y=ei(s.coordinates,d,m),b=vo(r.geometry(),c,d,m);if(!Ye(c,d))return!1;for(const E of b)if(!_r(E,y))return!1}if("MultiPolygon"===s.type){const y=ii(s.coordinates,d,m),b=vo(r.geometry(),c,d,m);if(!Ye(c,d))return!1;for(const E of b)if(!Vr(E,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Qo(t){if(t instanceof W&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof oi)return!1;let e=!0;return t.eachChild(r=>{e&&!Qo(r)&&(e=!1)}),e}function Do(t){if(t instanceof W&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(r=>{e&&!Do(r)&&(e=!1)}),e}function Fa(t,e){if(t instanceof W&&e.indexOf(t.name)>=0)return!1;let r=!0;return t.eachChild(s=>{r&&!Fa(s,e)&&(r=!1)}),r}class Oo{constructor(e,r){this.type=r.type,this.name=e,this.boundExpression=r}static parse(e,r){if(2!==e.length||"string"!=typeof e[1])return r.error("'var' expression requires exactly one string literal argument.");const s=e[1];return r.scope.has(s)?new Oo(s,r.scope.get(s)):r.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ks{constructor(e,r=[],s,c=new Oi,d=[]){this.registry=e,this.path=r,this.key=r.map(m=>`[${m}]`).join(""),this.scope=c,this.errors=d,this.expectedType=s}parse(e,r,s,c,d={}){return r?this.concat(r,s,c)._parse(e,d):this._parse(e,d)}_parse(e,r){function s(c,d,m){return"assert"===m?new ni(d,[c]):"coerce"===m?new ri(d,[c]):c}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const c=e[0];if("string"!=typeof c)return this.error(`Expression name must be a string, but found ${typeof c} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const d=this.registry[c];if(d){let m=d.parse(e,this);if(!m)return null;if(this.expectedType){const y=this.expectedType,b=m.type;if("string"!==y.kind&&"number"!==y.kind&&"boolean"!==y.kind&&"object"!==y.kind&&"array"!==y.kind||"value"!==b.kind)if("color"!==y.kind&&"formatted"!==y.kind&&"resolvedImage"!==y.kind||"value"!==b.kind&&"string"!==b.kind){if(this.checkSubtype(y,b))return null}else m=s(m,y,r.typeAnnotation||"coerce");else m=s(m,y,r.typeAnnotation||"assert")}if(!(m instanceof As)&&"resolvedImage"!==m.type.kind&&da(m)){const y=new z;try{m=new As(m.type,m.evaluate(y))}catch(b){return this.error(b.message),null}}return m}return this.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,r,s){const c="number"==typeof e?this.path.concat(e):this.path,d=s?this.scope.concat(s):this.scope;return new ks(this.registry,c,r||null,d,this.errors)}error(e,...r){const s=`${this.key}${r.map(c=>`[${c}]`).join("")}`;this.errors.push(new Pi(s,e))}checkSubtype(e,r){const s=Bi(e,r);return s&&this.error(s),s}}function da(t){if(t instanceof Oo)return da(t.boundExpression);if(t instanceof W&&"error"===t.name||t instanceof B||t instanceof oi)return!1;const e=t instanceof ri||t instanceof ni;let r=!0;return t.eachChild(s=>{r=e?r&&da(s):r&&s instanceof As}),!!r&&Qo(t)&&Fa(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function pn(t,e){const r=t.length-1;let s,c,d=0,m=r,y=0;for(;d<=m;)if(y=Math.floor((d+m)/2),s=t[y],c=t[y+1],s<=e){if(y===r||e<c)return y;d=y+1}else{if(!(s>e))throw new bi("Input is not a number.");m=y-1}return 0}class sl{constructor(e,r,s){this.type=e,this.input=r,this.labels=[],this.outputs=[];for(const[c,d]of s)this.labels.push(c),this.outputs.push(d)}static parse(e,r){if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");const s=r.parse(e[1],1,Pt);if(!s)return null;const c=[];let d=null;r.expectedType&&"value"!==r.expectedType.kind&&(d=r.expectedType);for(let m=1;m<e.length;m+=2){const y=1===m?-1/0:e[m],b=e[m+1],E=m,I=m+1;if("number"!=typeof y)return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(c.length&&c[c.length-1][0]>=y)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=r.parse(b,I,d);if(!P)return null;d=d||P.type,c.push([y,P])}return new sl(d,s,c)}evaluate(e){const r=this.labels,s=this.outputs;if(1===r.length)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const d=r.length;return c>=r[d-1]?s[d-1].evaluate(e):s[pn(r,c)].evaluate(e)}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let r=0;r<this.labels.length;r++)r>0&&e.push(this.labels[r]),e.push(this.outputs[r].serialize());return e}}function or(t,e,r){return t*(1-r)+e*r}var zl=Object.freeze({__proto__:null,number:or,color:function(t,e,r){return new Un(or(t.r,e.r,r),or(t.g,e.g,r),or(t.b,e.b,r),or(t.a,e.a,r))},array:function(t,e,r){return t.map((s,c)=>or(s,e[c],r))}});const fc=4/29,za=6/29,mt=3*za*za,tr=Math.PI/180,al=180/Math.PI;function si(t){return t>.008856451679035631?Math.pow(t,1/3):t/mt+fc}function ll(t){return t>za?t*t*t:mt*(t-fc)}function Jo(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function xo(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Xs(t){const e=xo(t.r),r=xo(t.g),s=xo(t.b),c=si((.4124564*e+.3575761*r+.1804375*s)/.95047),d=si((.2126729*e+.7151522*r+.072175*s)/1);return{l:116*d-16,a:500*(c-d),b:200*(d-si((.0193339*e+.119192*r+.9503041*s)/1.08883)),alpha:t.a}}function Bl(t){let e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*ll(e),r=.95047*ll(r),s=1.08883*ll(s),new Un(Jo(3.2404542*r-1.5371385*e-.4985314*s),Jo(-.969266*r+1.8760108*e+.041556*s),Jo(.0556434*r-.2040259*e+1.0572252*s),t.alpha)}function fh(t,e,r){const s=e-t;return t+r*(s>180||s<-180?s-360*Math.round(s/360):s)}const Rs={forward:Xs,reverse:Bl,interpolate:function(t,e,r){return{l:or(t.l,e.l,r),a:or(t.a,e.a,r),b:or(t.b,e.b,r),alpha:or(t.alpha,e.alpha,r)}}},Ys={forward:function(t){const{l:e,a:r,b:s}=Xs(t),c=Math.atan2(s,r)*al;return{h:c<0?c+360:c,c:Math.sqrt(r*r+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*tr,r=t.c;return Bl({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:fh(t.h,e.h,r),c:or(t.c,e.c,r),l:or(t.l,e.l,r),alpha:or(t.alpha,e.alpha,r)}}};var cl=Object.freeze({__proto__:null,lab:Rs,hcl:Ys});class Mr{constructor(e,r,s,c,d){this.type=e,this.operator=r,this.interpolation=s,this.input=c,this.labels=[],this.outputs=[];for(const[m,y]of d)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(e,r,s,c){let d=0;if("exponential"===e.name)d=zo(r,e.base,s,c);else if("linear"===e.name)d=zo(r,1,s,c);else if("cubic-bezier"===e.name){const m=e.controlPoints;d=new en(m[0],m[1],m[2],m[3]).solve(zo(r,1,s,c))}return d}static parse(e,r){let[s,c,d,...m]=e;if(!Array.isArray(c)||0===c.length)return r.error("Expected an interpolation type expression.",1);if("linear"===c[0])c={name:"linear"};else if("exponential"===c[0]){const E=c[1];if("number"!=typeof E)return r.error("Exponential interpolation requires a numeric base.",1,1);c={name:"exponential",base:E}}else{if("cubic-bezier"!==c[0])return r.error(`Unknown interpolation type ${String(c[0])}`,1,0);{const E=c.slice(1);if(4!==E.length||E.some(I=>"number"!=typeof I||I<0||I>1))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);c={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(d=r.parse(d,2,Pt),!d)return null;const y=[];let b=null;"interpolate-hcl"===s||"interpolate-lab"===s?b=Yo:r.expectedType&&"value"!==r.expectedType.kind&&(b=r.expectedType);for(let E=0;E<m.length;E+=2){const I=m[E],P=m[E+1],R=E+3,j=E+4;if("number"!=typeof I)return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(y.length&&y[y.length-1][0]>=I)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const H=r.parse(P,j,b);if(!H)return null;b=b||H.type,y.push([I,H])}return"number"===b.kind||"color"===b.kind||"array"===b.kind&&"number"===b.itemType.kind&&"number"==typeof b.N?new Mr(b,s,c,d,y):r.error(`Type ${kr(b)} is not interpolatable.`)}evaluate(e){const r=this.labels,s=this.outputs;if(1===r.length)return s[0].evaluate(e);const c=this.input.evaluate(e);if(c<=r[0])return s[0].evaluate(e);const d=r.length;if(c>=r[d-1])return s[d-1].evaluate(e);const m=pn(r,c),y=Mr.interpolationFactor(this.interpolation,c,r[m],r[m+1]),b=s[m].evaluate(e),E=s[m+1].evaluate(e);return"interpolate"===this.operator?zl[this.type.kind.toLowerCase()](b,E,y):"interpolate-hcl"===this.operator?Ys.reverse(Ys.interpolate(Ys.forward(b),Ys.forward(E),y)):Rs.reverse(Rs.interpolate(Rs.forward(b),Rs.forward(E),y))}eachChild(e){e(this.input);for(const r of this.outputs)e(r)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const r=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)r.push(this.labels[s],this.outputs[s].serialize());return r}}function zo(t,e,r,s){const c=s-r,d=t-r;return 0===c?0:1===e?d/c:(Math.pow(e,d)-1)/(Math.pow(e,c)-1)}class Ks{constructor(e,r){this.type=e,this.args=r}static parse(e,r){if(e.length<2)return r.error("Expectected at least one argument.");let s=null;const c=r.expectedType;c&&"value"!==c.kind&&(s=c);const d=[];for(const y of e.slice(1)){const b=r.parse(y,1+d.length,s,void 0,{typeAnnotation:"omit"});if(!b)return null;s=s||b.type,d.push(b)}const m=c&&d.some(y=>Bi(c,y.type));return new Ks(m?An:s,d)}evaluate(e){let r,s=null,c=0;for(const d of this.args){if(c++,s=d.evaluate(e),s&&s instanceof so&&!s.available&&(r||(r=s),s=null,c===this.args.length))return r;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class Ls{constructor(e,r){this.type=r.type,this.bindings=[].concat(e),this.result=r}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const r of this.bindings)e(r[1]);e(this.result)}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let d=1;d<e.length-1;d+=2){const m=e[d];if("string"!=typeof m)return r.error(`Expected string, but found ${typeof m} instead.`,d);if(/[^a-zA-Z0-9_]/.test(m))return r.error("Variable names must contain only alphanumeric characters or '_'.",d);const y=r.parse(e[d+1],d+1);if(!y)return null;s.push([m,y])}const c=r.parse(e[e.length-1],e.length-1,r.expectedType,s);return c?new Ls(s,c):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[r,s]of this.bindings)e.push(r,s.serialize());return e.push(this.result.serialize()),e}}class es{constructor(e,r,s){this.type=e,this.index=r,this.input=s}static parse(e,r){if(3!==e.length)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,Pt),c=r.parse(e[2],2,zi(r.expectedType||An));return s&&c?new es(c.type.itemType,s,c):null}evaluate(e){const r=this.index.evaluate(e),s=this.input.evaluate(e);if(r<0)throw new bi(`Array index out of bounds: ${r} < 0.`);if(r>=s.length)throw new bi(`Array index out of bounds: ${r} > ${s.length-1}.`);if(r!==Math.floor(r))throw new bi(`Array index must be an integer, but found ${r} instead.`);return s[r]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class pc{constructor(e,r){this.type=Tn,this.needle=e,this.haystack=r}static parse(e,r){if(3!==e.length)return r.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,An),c=r.parse(e[2],2,An);return s&&c?ol(s.type,[Tn,In,Pt,Lo,An])?new pc(s,c):r.error(`Expected first argument to be of type boolean, string, number or null, but found ${kr(s.type)} instead`):null}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!s)return!1;if(!Ss(r,["boolean","string","number","null"]))throw new bi(`Expected first argument to be of type boolean, string, number or null, but found ${kr(Ur(r))} instead.`);if(!Ss(s,["string","array"]))throw new bi(`Expected second argument to be of type array or string, but found ${kr(Ur(s))} instead.`);return s.indexOf(r)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Bo{constructor(e,r,s){this.type=Pt,this.needle=e,this.haystack=r,this.fromIndex=s}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,An),c=r.parse(e[2],2,An);if(!s||!c)return null;if(!ol(s.type,[Tn,In,Pt,Lo,An]))return r.error(`Expected first argument to be of type boolean, string, number or null, but found ${kr(s.type)} instead`);if(4===e.length){const d=r.parse(e[3],3,Pt);return d?new Bo(s,c,d):null}return new Bo(s,c)}evaluate(e){const r=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Ss(r,["boolean","string","number","null"]))throw new bi(`Expected first argument to be of type boolean, string, number or null, but found ${kr(Ur(r))} instead.`);if(!Ss(s,["string","array"]))throw new bi(`Expected second argument to be of type array or string, but found ${kr(Ur(s))} instead.`);if(this.fromIndex){const c=this.fromIndex.evaluate(e);return s.indexOf(r,c)}return s.indexOf(r)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ul{constructor(e,r,s,c,d,m){this.inputType=e,this.type=r,this.input=s,this.cases=c,this.outputs=d,this.otherwise=m}static parse(e,r){if(e.length<5)return r.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return r.error("Expected an even number of arguments.");let s,c;r.expectedType&&"value"!==r.expectedType.kind&&(c=r.expectedType);const d={},m=[];for(let E=2;E<e.length-1;E+=2){let I=e[E];const P=e[E+1];Array.isArray(I)||(I=[I]);const R=r.concat(E);if(0===I.length)return R.error("Expected at least one branch label.");for(const H of I){if("number"!=typeof H&&"string"!=typeof H)return R.error("Branch labels must be numbers or strings.");if("number"==typeof H&&Math.abs(H)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof H&&Math.floor(H)!==H)return R.error("Numeric branch labels must be integer values.");if(s){if(R.checkSubtype(s,Ur(H)))return null}else s=Ur(H);if(void 0!==d[String(H)])return R.error("Branch labels must be unique.");d[String(H)]=m.length}const j=r.parse(P,E,c);if(!j)return null;c=c||j.type,m.push(j)}const y=r.parse(e[1],1,An);if(!y)return null;const b=r.parse(e[e.length-1],e.length-1,c);return b?"value"!==y.type.kind&&r.concat(1).checkSubtype(s,y.type)?null:new ul(s,c,y,d,m,b):null}evaluate(e){const r=this.input.evaluate(e);return(Ur(r)===this.inputType&&this.outputs[this.cases[r]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),s=[],c={};for(const m of r){const y=c[this.cases[m]];void 0===y?(c[this.cases[m]]=s.length,s.push([this.cases[m],[m]])):s[y][1].push(m)}const d=m=>"number"===this.inputType.kind?Number(m):m;for(const[m,y]of s)e.push(1===y.length?d(y[0]):y.map(d)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class Qs{constructor(e,r,s){this.type=e,this.branches=r,this.otherwise=s}static parse(e,r){if(e.length<4)return r.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return r.error("Expected an odd number of arguments.");let s;r.expectedType&&"value"!==r.expectedType.kind&&(s=r.expectedType);const c=[];for(let m=1;m<e.length-1;m+=2){const y=r.parse(e[m],m,Tn);if(!y)return null;const b=r.parse(e[m+1],m+1,s);if(!b)return null;c.push([y,b]),s=s||b.type}const d=r.parse(e[e.length-1],e.length-1,s);return d?new Qs(s,c,d):null}evaluate(e){for(const[r,s]of this.branches)if(r.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[r,s]of this.branches)e(r),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,r])=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(r=>{e.push(r.serialize())}),e}}class fa{constructor(e,r,s,c){this.type=e,this.input=r,this.beginIndex=s,this.endIndex=c}static parse(e,r){if(e.length<=2||e.length>=5)return r.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=r.parse(e[1],1,An),c=r.parse(e[2],2,Pt);if(!s||!c)return null;if(!ol(s.type,[zi(An),In,An]))return r.error(`Expected first argument to be of type array or string, but found ${kr(s.type)} instead`);if(4===e.length){const d=r.parse(e[3],3,Pt);return d?new fa(s.type,s,c,d):null}return new fa(s.type,s,c)}evaluate(e){const r=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Ss(r,["string","array"]))throw new bi(`Expected first argument to be of type array or string, but found ${kr(Ur(r))} instead.`);if(this.endIndex){const c=this.endIndex.evaluate(e);return r.slice(s,c)}return r.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Nl(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function hl(t,e,r,s){return 0===s.compare(e,r)}function _s(t,e,r){const s="=="!==t&&"!="!==t;return class E0{constructor(d,m,y){this.type=Tn,this.lhs=d,this.rhs=m,this.collator=y,this.hasUntypedArgument="value"===d.type.kind||"value"===m.type.kind}static parse(d,m){if(3!==d.length&&4!==d.length)return m.error("Expected two or three arguments.");const y=d[0];let b=m.parse(d[1],1,An);if(!b)return null;if(!Nl(y,b.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${kr(b.type)}'.`);let E=m.parse(d[2],2,An);if(!E)return null;if(!Nl(y,E.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${kr(E.type)}'.`);if(b.type.kind!==E.type.kind&&"value"!==b.type.kind&&"value"!==E.type.kind)return m.error(`Cannot compare types '${kr(b.type)}' and '${kr(E.type)}'.`);s&&("value"===b.type.kind&&"value"!==E.type.kind?b=new ni(E.type,[b]):"value"!==b.type.kind&&"value"===E.type.kind&&(E=new ni(b.type,[E])));let I=null;if(4===d.length){if("string"!==b.type.kind&&"string"!==E.type.kind&&"value"!==b.type.kind&&"value"!==E.type.kind)return m.error("Cannot use collator to compare non-string types.");if(I=m.parse(d[3],3,Ra),!I)return null}return new E0(b,E,I)}evaluate(d){const m=this.lhs.evaluate(d),y=this.rhs.evaluate(d);if(s&&this.hasUntypedArgument){const b=Ur(m),E=Ur(y);if(b.kind!==E.kind||"string"!==b.kind&&"number"!==b.kind)throw new bi(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${b.kind}, ${E.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const b=Ur(m),E=Ur(y);if("string"!==b.kind||"string"!==E.kind)return e(d,m,y)}return this.collator?r(d,m,y,this.collator.evaluate(d)):e(d,m,y)}eachChild(d){d(this.lhs),d(this.rhs),this.collator&&d(this.collator)}outputDefined(){return!0}serialize(){const d=[t];return this.eachChild(m=>{d.push(m.serialize())}),d}}}const mc=_s("==",function(t,e,r){return e===r},hl),gc=_s("!=",function(t,e,r){return e!==r},function(t,e,r,s){return!hl(0,e,r,s)}),pa=_s("<",function(t,e,r){return e<r},function(t,e,r,s){return s.compare(e,r)<0}),Ul=_s(">",function(t,e,r){return e>r},function(t,e,r,s){return s.compare(e,r)>0}),dl=_s("<=",function(t,e,r){return e<=r},function(t,e,r,s){return s.compare(e,r)<=0}),Vl=_s(">=",function(t,e,r){return e>=r},function(t,e,r,s){return s.compare(e,r)>=0});class fl{constructor(e,r,s,c,d){this.type=In,this.number=e,this.locale=r,this.currency=s,this.minFractionDigits=c,this.maxFractionDigits=d}static parse(e,r){if(3!==e.length)return r.error("Expected two arguments.");const s=r.parse(e[1],1,Pt);if(!s)return null;const c=e[2];if("object"!=typeof c||Array.isArray(c))return r.error("NumberFormat options argument must be an object.");let d=null;if(c.locale&&(d=r.parse(c.locale,1,In),!d))return null;let m=null;if(c.currency&&(m=r.parse(c.currency,1,In),!m))return null;let y=null;if(c["min-fraction-digits"]&&(y=r.parse(c["min-fraction-digits"],1,Pt),!y))return null;let b=null;return c["max-fraction-digits"]&&(b=r.parse(c["max-fraction-digits"],1,Pt),!b)?null:new fl(s,d,m,y,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class ma{constructor(e){this.type=Pt,this.input=e}static parse(e,r){if(2!==e.length)return r.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=r.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?r.error(`Expected argument of type string or array, but found ${kr(s.type)} instead.`):new ma(s):null}evaluate(e){const r=this.input.evaluate(e);if("string"==typeof r||Array.isArray(r))return r.length;throw new bi(`Expected value to be of type string or array, but found ${kr(Ur(r))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(r=>{e.push(r.serialize())}),e}}const ts={"==":mc,"!=":gc,">":Ul,"<":pa,">=":Vl,"<=":dl,array:ni,at:es,boolean:ni,case:Qs,coalesce:Ks,collator:B,format:Fo,image:ki,in:pc,"index-of":Bo,interpolate:Mr,"interpolate-hcl":Mr,"interpolate-lab":Mr,length:ma,let:Ls,literal:As,match:ul,number:ni,"number-format":fl,object:ni,slice:fa,step:sl,string:ni,"to-boolean":ri,"to-color":ri,"to-number":ri,"to-string":ri,var:Oo,within:oi};function _c(t,[e,r,s,c]){e=e.evaluate(t),r=r.evaluate(t),s=s.evaluate(t);const d=c?c.evaluate(t):1,m=gs(e,r,s,d);if(m)throw new bi(m);return new Un(e/255*d,r/255*d,s/255*d,d)}function Ri(t,e){return t in e}function No(t,e){const r=e[t];return void 0===r?null:r}function fr(t){return{type:t}}function Nc(t){return{result:"success",value:t}}function Fs(t){return{result:"error",value:t}}function Ba(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function jl(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function $l(t){return!!t.expression&&t.expression.interpolated}function rr(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function ga(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function _a(t){return t}function Js(t,e){const r="color"===e.type,s=t.stops&&"object"==typeof t.stops[0][0],c=s||!(s||void 0!==t.property),d=t.type||($l(e)?"exponential":"interval");if(r&&((t=Nr({},t)).stops&&(t.stops=t.stops.map(E=>[E[0],Un.parse(E[1])])),t.default=Un.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!cl[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let m,y,b;if("exponential"===d)m=ui;else if("interval"===d)m=Mu;else if("categorical"===d){m=pl,y=Object.create(null);for(const E of t.stops)y[E[0]]=E[1];b=typeof t.stops[0][0]}else{if("identity"!==d)throw new Error(`Unknown function type "${d}"`);m=ml}if(s){const E={},I=[];for(let j=0;j<t.stops.length;j++){const H=t.stops[j],Q=H[0].zoom;void 0===E[Q]&&(E[Q]={zoom:Q,type:t.type,property:t.property,default:t.default,stops:[]},I.push(Q)),E[Q].stops.push([H[0].value,H[1]])}const P=[];for(const j of I)P.push([E[j].zoom,Js(E[j],e)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Mr.interpolationFactor.bind(void 0,R),zoomStops:P.map(j=>j[0]),evaluate:({zoom:j},H)=>ui({stops:P,base:t.base},e,j).evaluate(j,H)}}if(c){const E="exponential"===d?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:Mr.interpolationFactor.bind(void 0,E),zoomStops:t.stops.map(I=>I[0]),evaluate:({zoom:I})=>m(t,e,I,y,b)}}return{kind:"source",evaluate(E,I){const P=I&&I.properties?I.properties[t.property]:void 0;return void 0===P?gi(t.default,e.default):m(t,e,P,y,b)}}}function gi(t,e,r){return void 0!==t?t:void 0!==e?e:void 0!==r?r:void 0}function pl(t,e,r,s,c){return gi(typeof r===c?s[r]:void 0,t.default,e.default)}function Mu(t,e,r){if("number"!==rr(r))return gi(t.default,e.default);const s=t.stops.length;if(1===s||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[s-1][0])return t.stops[s-1][1];const c=pn(t.stops.map(d=>d[0]),r);return t.stops[c][1]}function ui(t,e,r){const s=void 0!==t.base?t.base:1;if("number"!==rr(r))return gi(t.default,e.default);const c=t.stops.length;if(1===c||r<=t.stops[0][0])return t.stops[0][1];if(r>=t.stops[c-1][0])return t.stops[c-1][1];const d=pn(t.stops.map(I=>I[0]),r),m=function(I,P,R,j){const H=j-R,Q=I-R;return 0===H?0:1===P?Q/H:(Math.pow(P,Q)-1)/(Math.pow(P,H)-1)}(r,s,t.stops[d][0],t.stops[d+1][0]),y=t.stops[d][1],b=t.stops[d+1][1];let E=zl[e.type]||_a;if(t.colorSpace&&"rgb"!==t.colorSpace){const I=cl[t.colorSpace];E=(P,R)=>I.reverse(I.interpolate(I.forward(P),I.forward(R),m))}return"function"==typeof y.evaluate?{evaluate(...I){const P=y.evaluate.apply(void 0,I),R=b.evaluate.apply(void 0,I);if(void 0!==P&&void 0!==R)return E(P,R,m)}}:E(y,b,m)}function ml(t,e,r){return"color"===e.type?r=Un.parse(r):"formatted"===e.type?r=bn.fromString(r.toString()):"resolvedImage"===e.type?r=so.fromString(r.toString()):rr(r)===e.type||"enum"===e.type&&e.values[r]||(r=void 0),gi(r,t.default,e.default)}W.register(ts,{error:[{kind:"error"},[In],(t,[e])=>{throw new bi(e.evaluate(t))}],typeof:[In,[An],(t,[e])=>kr(Ur(e.evaluate(t)))],"to-rgba":[zi(Pt,4),[Yo],(t,[e])=>e.evaluate(t).toArray()],rgb:[Yo,[Pt,Pt,Pt],_c],rgba:[Yo,[Pt,Pt,Pt,Pt],_c],has:{type:Tn,overloads:[[[In],(t,[e])=>Ri(e.evaluate(t),t.properties())],[[In,Ko],(t,[e,r])=>Ri(e.evaluate(t),r.evaluate(t))]]},get:{type:An,overloads:[[[In],(t,[e])=>No(e.evaluate(t),t.properties())],[[In,Ko],(t,[e,r])=>No(e.evaluate(t),r.evaluate(t))]]},"feature-state":[An,[In],(t,[e])=>No(e.evaluate(t),t.featureState||{})],properties:[Ko,[],t=>t.properties()],"geometry-type":[In,[],t=>t.geometryType()],id:[An,[],t=>t.id()],zoom:[Pt,[],t=>t.globals.zoom],pitch:[Pt,[],t=>t.globals.pitch||0],"distance-from-center":[Pt,[],t=>t.distanceFromCenter()],"heatmap-density":[Pt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Pt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Pt,[],t=>t.globals.skyRadialProgress||0],accumulated:[An,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Pt,fr(Pt),(t,e)=>{let r=0;for(const s of e)r+=s.evaluate(t);return r}],"*":[Pt,fr(Pt),(t,e)=>{let r=1;for(const s of e)r*=s.evaluate(t);return r}],"-":{type:Pt,overloads:[[[Pt,Pt],(t,[e,r])=>e.evaluate(t)-r.evaluate(t)],[[Pt],(t,[e])=>-e.evaluate(t)]]},"/":[Pt,[Pt,Pt],(t,[e,r])=>e.evaluate(t)/r.evaluate(t)],"%":[Pt,[Pt,Pt],(t,[e,r])=>e.evaluate(t)%r.evaluate(t)],ln2:[Pt,[],()=>Math.LN2],pi:[Pt,[],()=>Math.PI],e:[Pt,[],()=>Math.E],"^":[Pt,[Pt,Pt],(t,[e,r])=>Math.pow(e.evaluate(t),r.evaluate(t))],sqrt:[Pt,[Pt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Pt,[Pt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Pt,[Pt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Pt,[Pt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Pt,[Pt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Pt,[Pt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Pt,[Pt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Pt,[Pt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Pt,[Pt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Pt,[Pt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Pt,fr(Pt),(t,e)=>Math.min(...e.map(r=>r.evaluate(t)))],max:[Pt,fr(Pt),(t,e)=>Math.max(...e.map(r=>r.evaluate(t)))],abs:[Pt,[Pt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Pt,[Pt],(t,[e])=>{const r=e.evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[Pt,[Pt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Pt,[Pt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Tn,[In,An],(t,[e,r])=>t.properties()[e.value]===r.value],"filter-id-==":[Tn,[An],(t,[e])=>t.id()===e.value],"filter-type-==":[Tn,[In],(t,[e])=>t.geometryType()===e.value],"filter-<":[Tn,[In,An],(t,[e,r])=>{const s=t.properties()[e.value],c=r.value;return typeof s==typeof c&&s<c}],"filter-id-<":[Tn,[An],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r<s}],"filter->":[Tn,[In,An],(t,[e,r])=>{const s=t.properties()[e.value],c=r.value;return typeof s==typeof c&&s>c}],"filter-id->":[Tn,[An],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r>s}],"filter-<=":[Tn,[In,An],(t,[e,r])=>{const s=t.properties()[e.value],c=r.value;return typeof s==typeof c&&s<=c}],"filter-id-<=":[Tn,[An],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r<=s}],"filter->=":[Tn,[In,An],(t,[e,r])=>{const s=t.properties()[e.value],c=r.value;return typeof s==typeof c&&s>=c}],"filter-id->=":[Tn,[An],(t,[e])=>{const r=t.id(),s=e.value;return typeof r==typeof s&&r>=s}],"filter-has":[Tn,[An],(t,[e])=>e.value in t.properties()],"filter-has-id":[Tn,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Tn,[zi(In)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Tn,[zi(An)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Tn,[In,zi(An)],(t,[e,r])=>r.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Tn,[In,zi(An)],(t,[e,r])=>function(s,c,d,m){for(;d<=m;){const y=d+m>>1;if(c[y]===s)return!0;c[y]>s?m=y-1:d=y+1}return!1}(t.properties()[e.value],r.value,0,r.value.length-1)],all:{type:Tn,overloads:[[[Tn,Tn],(t,[e,r])=>e.evaluate(t)&&r.evaluate(t)],[fr(Tn),(t,e)=>{for(const r of e)if(!r.evaluate(t))return!1;return!0}]]},any:{type:Tn,overloads:[[[Tn,Tn],(t,[e,r])=>e.evaluate(t)||r.evaluate(t)],[fr(Tn),(t,e)=>{for(const r of e)if(r.evaluate(t))return!0;return!1}]]},"!":[Tn,[Tn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Tn,[In],(t,[e])=>{const r=t.globals&&t.globals.isSupportedScript;return!r||r(e.evaluate(t))}],upcase:[In,[In],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[In,[In],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[In,fr(An),(t,e)=>e.map(r=>ha(r.evaluate(t))).join("")],"resolved-locale":[In,[Ra],(t,[e])=>e.evaluate(t).resolvedLocale()]});class Na{constructor(e,r){var s;this.expression=e,this._warningHistory={},this._evaluator=new z,this._defaultValue=r?"color"===(s=r).type&&ga(s.default)?new Un(0,0,0,0):"color"===s.type?Un.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=r&&"enum"===r.type?r.values:null}evaluateWithoutErrorHandling(e,r,s,c,d,m,y,b){return this._evaluator.globals=e,this._evaluator.feature=r,this._evaluator.featureState=s,this._evaluator.canonical=c,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,r,s,c,d,m,y,b){this._evaluator.globals=e,this._evaluator.feature=r||null,this._evaluator.featureState=s||null,this._evaluator.canonical=c,this._evaluator.availableImages=d||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const E=this.expression.evaluate(this._evaluator);if(null==E||"number"==typeof E&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new bi(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,"undefined"!=typeof console&&console.warn(E.message)),this._defaultValue}}}function Os(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in ts}function ns(t,e){const r=new ks(ts,[],e?function(c){const d={color:Yo,string:In,number:Pt,enum:In,boolean:Tn,formatted:Ds,resolvedImage:Cs};return"array"===c.type?zi(d[c.value]||An,c.length):d[c.type]}(e):void 0),s=r.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?Nc(new Na(s,e)):Fs(r.errors)}class Uo{constructor(e,r){this.kind=e,this._styleExpression=r,this.isStateDependent="constant"!==e&&!Do(r.expression)}evaluateWithoutErrorHandling(e,r,s,c,d,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,d,m)}evaluate(e,r,s,c,d,m){return this._styleExpression.evaluate(e,r,s,c,d,m)}}class Gl{constructor(e,r,s,c){this.kind=e,this.zoomStops=s,this._styleExpression=r,this.isStateDependent="camera"!==e&&!Do(r.expression),this.interpolationType=c}evaluateWithoutErrorHandling(e,r,s,c,d,m){return this._styleExpression.evaluateWithoutErrorHandling(e,r,s,c,d,m)}evaluate(e,r,s,c,d,m){return this._styleExpression.evaluate(e,r,s,c,d,m)}interpolationFactor(e,r,s){return this.interpolationType?Mr.interpolationFactor(this.interpolationType,e,r,s):0}}function Uc(t,e){if("error"===(t=ns(t,e)).result)return t;const r=t.value.expression,s=Qo(r);if(!s&&!Ba(e))return Fs([new Pi("","data expressions not supported")]);const c=Fa(r,["zoom","pitch","distance-from-center"]);if(!c&&!jl(e))return Fs([new Pi("","zoom expressions not supported")]);const d=yc(r);return d||c?d instanceof Pi?Fs([d]):d instanceof Mr&&!$l(e)?Fs([new Pi("",'"interpolate" expressions cannot be used with this property')]):Nc(d?new Gl(s?"camera":"composite",t.value,d.labels,d instanceof Mr?d.interpolation:void 0):new Uo(s?"constant":"source",t.value)):Fs([new Pi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Ua{constructor(e,r){this._parameters=e,this._specification=r,Nr(this,Js(this._parameters,this._specification))}static deserialize(e){return new Ua(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function yc(t){let e=null;if(t instanceof Ls)e=yc(t.result);else if(t instanceof Ks){for(const r of t.args)if(e=yc(r),e)break}else(t instanceof sl||t instanceof Mr)&&t.input instanceof W&&"zoom"===t.input.name&&(e=t);return e instanceof Pi||t.eachChild(r=>{const s=yc(r);s instanceof Pi?e=s:!e&&s?e=new Pi("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Pi("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Wi(t){const e=t.key,r=t.value,s=t.valueSpec||{},c=t.objectElementValidators||{},d=t.style,m=t.styleSpec;let y=[];const b=rr(r);if("object"!==b)return[new kt(e,r,`object expected, ${b} found`)];for(const E in r){const I=E.split(".")[0],P=s[I]||s["*"];let R;if(c[I])R=c[I];else if(s[I])R=zt;else if(c["*"])R=c["*"];else{if(!s["*"]){y.push(new kt(e,r[E],`unknown property "${E}"`));continue}R=zt}y=y.concat(R({key:(e&&`${e}.`)+E,value:r[E],valueSpec:P,style:d,styleSpec:m,object:r,objectKey:E},r))}for(const E in s)c[E]||s[E].required&&void 0===s[E].default&&void 0===r[E]&&y.push(new kt(e,r,`missing required property "${E}"`));return y}function gl(t){const e=t.value,r=t.valueSpec,s=t.style,c=t.styleSpec,d=t.key,m=t.arrayElementValidator||zt;if("array"!==rr(e))return[new kt(d,e,`array expected, ${rr(e)} found`)];if(r.length&&e.length!==r.length)return[new kt(d,e,`array length ${r.length} expected, length ${e.length} found`)];if(r["min-length"]&&e.length<r["min-length"])return[new kt(d,e,`array length at least ${r["min-length"]} expected, length ${e.length} found`)];let y={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum};c.$version<7&&(y.function=r.function),"object"===rr(r.value)&&(y=r.value);let b=[];for(let E=0;E<e.length;E++)b=b.concat(m({array:e,arrayIndex:E,value:e[E],valueSpec:y,style:s,styleSpec:c,key:`${d}[${E}]`}));return b}function Va(t){const e=t.key,r=t.value,s=t.valueSpec;let c=rr(r);if("number"===c&&r!=r&&(c="NaN"),"number"!==c)return[new kt(e,r,`number expected, ${c} found`)];if("minimum"in s){let d=s.minimum;if("array"===rr(s.minimum)&&(d=s.minimum[t.arrayIndex]),r<d)return[new kt(e,r,`${r} is less than the minimum value ${d}`)]}if("maximum"in s){let d=s.maximum;if("array"===rr(s.maximum)&&(d=s.maximum[t.arrayIndex]),r>d)return[new kt(e,r,`${r} is greater than the maximum value ${d}`)]}return[]}function ja(t){const e=t.valueSpec,r=Pr(t.value.type);let s,c,d,m={};const y="categorical"!==r&&void 0===t.value.property,b=!y,E="array"===rr(t.value.stops)&&"array"===rr(t.value.stops[0])&&"object"===rr(t.value.stops[0][0]),I=Wi({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(j){if("identity"===r)return[new kt(j.key,j.value,'identity function may not have a "stops" property')];let H=[];const Q=j.value;return H=H.concat(gl({key:j.key,value:Q,valueSpec:j.valueSpec,style:j.style,styleSpec:j.styleSpec,arrayElementValidator:P})),"array"===rr(Q)&&0===Q.length&&H.push(new kt(j.key,Q,"array must have at least one stop")),H},default:function(j){return zt({key:j.key,value:j.value,valueSpec:e,style:j.style,styleSpec:j.styleSpec})}}});return"identity"===r&&y&&I.push(new kt(t.key,t.value,'missing required property "property"')),"identity"===r||t.value.stops||I.push(new kt(t.key,t.value,'missing required property "stops"')),"exponential"===r&&t.valueSpec.expression&&!$l(t.valueSpec)&&I.push(new kt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(b&&!Ba(t.valueSpec)?I.push(new kt(t.key,t.value,"property functions not supported")):y&&!jl(t.valueSpec)&&I.push(new kt(t.key,t.value,"zoom functions not supported"))),"categorical"!==r&&!E||void 0!==t.value.property||I.push(new kt(t.key,t.value,'"property" property is required')),I;function P(j){let H=[];const Q=j.value,ne=j.key;if("array"!==rr(Q))return[new kt(ne,Q,`array expected, ${rr(Q)} found`)];if(2!==Q.length)return[new kt(ne,Q,`array length 2 expected, length ${Q.length} found`)];if(E){if("object"!==rr(Q[0]))return[new kt(ne,Q,`object expected, ${rr(Q[0])} found`)];if(void 0===Q[0].zoom)return[new kt(ne,Q,"object stop key must have zoom")];if(void 0===Q[0].value)return[new kt(ne,Q,"object stop key must have value")];if(d&&d>Pr(Q[0].zoom))return[new kt(ne,Q[0].zoom,"stop zoom values must appear in ascending order")];Pr(Q[0].zoom)!==d&&(d=Pr(Q[0].zoom),c=void 0,m={}),H=H.concat(Wi({key:`${ne}[0]`,value:Q[0],valueSpec:{zoom:{}},style:j.style,styleSpec:j.styleSpec,objectElementValidators:{zoom:Va,value:R}}))}else H=H.concat(R({key:`${ne}[0]`,value:Q[0],valueSpec:{},style:j.style,styleSpec:j.styleSpec},Q));return Os(_o(Q[1]))?H.concat([new kt(`${ne}[1]`,Q[1],"expressions are not allowed in function stops.")]):H.concat(zt({key:`${ne}[1]`,value:Q[1],valueSpec:e,style:j.style,styleSpec:j.styleSpec}))}function R(j,H){const Q=rr(j.value),ne=Pr(j.value),ce=null!==j.value?j.value:H;if(s){if(Q!==s)return[new kt(j.key,ce,`${Q} stop domain type must match previous stop domain type ${s}`)]}else s=Q;if("number"!==Q&&"string"!==Q&&"boolean"!==Q)return[new kt(j.key,ce,"stop domain value must be a number, string, or boolean")];if("number"!==Q&&"categorical"!==r){let ye=`number expected, ${Q} found`;return Ba(e)&&void 0===r&&(ye+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new kt(j.key,ce,ye)]}return"categorical"!==r||"number"!==Q||isFinite(ne)&&Math.floor(ne)===ne?"categorical"!==r&&"number"===Q&&void 0!==c&&ne<c?[new kt(j.key,ce,"stop domain values must appear in ascending order")]:(c=ne,"categorical"===r&&ne in m?[new kt(j.key,ce,"stop domain values must be unique")]:(m[ne]=!0,[])):[new kt(j.key,ce,`integer expected, found ${ne}`)]}}function Xi(t){const e=("property"===t.expressionContext?Uc:ns)(_o(t.value),t.valueSpec);if("error"===e.result)return e.value.map(s=>new kt(`${t.key}${s.key}`,t.value,s.message));const r=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!r.outputDefined())return[new kt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Do(r))return[new kt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return _l(r,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Fa(r,["zoom","feature-state"]))return[new kt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Qo(r))return[new kt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function _l(t,e){const r=new Set(["zoom","feature-state","pitch","distance-from-center"]);for(const c of e.valueSpec.expression.parameters)r.delete(c);if(0===r.size)return[];const s=[];return t instanceof W&&r.has(t.name)?[new kt(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(c=>{s.push(..._l(c,e))}),s)}function zs(t){const e=t.key,r=t.value,s=t.valueSpec,c=[];return Array.isArray(s.values)?-1===s.values.indexOf(Pr(r))&&c.push(new kt(e,r,`expected one of [${s.values.join(", ")}], ${JSON.stringify(r)} found`)):-1===Object.keys(s.values).indexOf(Pr(r))&&c.push(new kt(e,r,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(r)} found`)),c}function Hl(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Hl(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Bs(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Hl(t)||(t=Zl(t));const r=t;let s=!0;try{s=function(E){if(!vl(E))return E;let I=_o(E);return yl(I),I=$a(I),I}(r)}catch(E){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(r,null,2)}\n        `)}const c=We[`filter_${e}`],d=ns(s,c);let m=null;if("error"===d.result)throw new Error(d.value.map(E=>`${E.key}: ${E.message}`).join(", "));m=(E,I,P)=>d.value.evaluate(E,I,{},P);let y=null,b=null;if(s!==r){const E=ns(r,c);if("error"===E.result)throw new Error(E.value.map(I=>`${I.key}: ${I.message}`).join(", "));y=(I,P,R,j,H)=>E.value.evaluate(I,P,{},R,void 0,void 0,j,H),b=!Qo(E.value.expression)}return m=m,{filter:m,dynamicFilter:y||void 0,needGeometry:xc(s),needFeature:!!b}}function $a(t){if(!Array.isArray(t))return t;const e=function(r){if(vc.has(r[0]))for(let s=1;s<r.length;s++)if(vl(r[s]))return!0;return r}(t);return!0===e?e:e.map(r=>$a(r))}function yl(t){let e=!1;const r=[];if("case"===t[0]){for(let s=1;s<t.length-1;s+=2)e=e||vl(t[s]),r.push(t[s+1]);r.push(t[t.length-1])}else if("match"===t[0]){e=e||vl(t[1]);for(let s=2;s<t.length-1;s+=2)r.push(t[s+1]);r.push(t[t.length-1])}else if("step"===t[0]){e=e||vl(t[1]);for(let s=1;s<t.length-1;s+=2)r.push(t[s+1])}e&&(t.length=0,t.push("any",...r));for(let s=1;s<t.length;s++)yl(t[s])}function vl(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let r=1;r<t.length;r++)if(vl(t[r]))return!0;return!1}const vc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Vc(t,e){return t<e?-1:t>e?1:0}function xc(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(xc(t[e]))return!0;return!1}function Zl(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Ns(t[1],t[2],"=="):"!="===e?ea(Ns(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Ns(t[1],t[2],e):"any"===e?(r=t.slice(1),["any"].concat(r.map(Zl))):"all"===e?["all"].concat(t.slice(1).map(Zl)):"none"===e?["all"].concat(t.slice(1).map(Zl).map(ea)):"in"===e?ql(t[1],t.slice(2)):"!in"===e?ea(ql(t[1],t.slice(2))):"has"===e?Wl(t[1]):"!has"===e?ea(Wl(t[1])):"within"!==e||t;var r}function Ns(t,e,r){switch(t){case"$type":return[`filter-type-${r}`,e];case"$id":return[`filter-id-${r}`,e];default:return[`filter-${r}`,t,e]}}function ql(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(r=>typeof r!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Vc)]]:["filter-in-small",t,["literal",e]]}}function Wl(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ea(t){return["!",t]}function Ga(t){if(Hl(_o(t.value))){const e=_o(t.layerType);return Xi(Nr({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${e||"fill"}`]}))}return Iu(t)}function Iu(t){const e=t.value,r=t.key;if("array"!==rr(e))return[new kt(r,e,`array expected, ${rr(e)} found`)];const s=t.styleSpec;let c,d=[];if(e.length<1)return[new kt(r,e,"filter array must have at least 1 element")];switch(d=d.concat(zs({key:`${r}[0]`,value:e[0],valueSpec:s.filter_operator,style:t.style,styleSpec:t.styleSpec})),Pr(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Pr(e[1])&&d.push(new kt(r,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&d.push(new kt(r,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(c=rr(e[1]),"string"!==c&&d.push(new kt(`${r}[1]`,e[1],`string expected, ${c} found`)));for(let m=2;m<e.length;m++)c=rr(e[m]),"$type"===Pr(e[1])?d=d.concat(zs({key:`${r}[${m}]`,value:e[m],valueSpec:s.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==c&&"number"!==c&&"boolean"!==c&&d.push(new kt(`${r}[${m}]`,e[m],`string, number, or boolean expected, ${c} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)d=d.concat(Iu({key:`${r}[${m}]`,value:e[m],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":c=rr(e[1]),2!==e.length?d.push(new kt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==c&&d.push(new kt(`${r}[1]`,e[1],`string expected, ${c} found`));break;case"within":c=rr(e[1]),2!==e.length?d.push(new kt(r,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==c&&d.push(new kt(`${r}[1]`,e[1],`object expected, ${c} found`))}return d}function A(t,e){const r=t.key,s=t.style,c=t.styleSpec,d=t.value,m=t.objectKey,y=c[`${e}_${t.layerType}`];if(!y)return[];const b=m.match(/^(.*)-transition$/);if("paint"===e&&b&&y[b[1]]&&y[b[1]].transition)return zt({key:r,value:d,valueSpec:c.transition,style:s,styleSpec:c});const E=t.valueSpec||y[m];if(!E)return[new kt(r,d,`unknown property "${m}"`)];let I;if("string"===rr(d)&&Ba(E)&&!E.tokens&&(I=/^{([^}]+)}$/.exec(d)))return[new kt(r,d,`"${m}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(I[1])} }\`.`)];const P=[];return"symbol"===t.layerType&&("text-field"===m&&s&&!s.glyphs&&P.push(new kt(r,d,'use of "text-field" requires a style "glyphs" property')),"text-font"===m&&ga(_o(d))&&"identity"===Pr(d.type)&&P.push(new kt(r,d,'"text-font" does not support identity functions'))),P.concat(zt({key:t.key,value:d,valueSpec:E,style:s,styleSpec:c,expressionContext:"property",propertyType:e,propertyKey:m}))}function C(t){return A(t,"paint")}function D(t){return A(t,"layout")}function L(t){let e=[];const r=t.value,s=t.key,c=t.style,d=t.styleSpec;r.type||r.ref||e.push(new kt(s,r,'either "type" or "ref" is required'));let m=Pr(r.type);const y=Pr(r.ref);if(r.id){const b=Pr(r.id);for(let E=0;E<t.arrayIndex;E++){const I=c.layers[E];Pr(I.id)===b&&e.push(new kt(s,r.id,`duplicate layer id "${r.id}", previously used at line ${I.id.__line__}`))}}if("ref"in r){let b;["type","source","source-layer","filter","layout"].forEach(E=>{E in r&&e.push(new kt(s,r[E],`"${E}" is prohibited for ref layers`))}),c.layers.forEach(E=>{Pr(E.id)===y&&(b=E)}),b?b.ref?e.push(new kt(s,r.ref,"ref cannot reference another ref layer")):m=Pr(b.type):e.push(new kt(s,r.ref,`ref layer "${y}" not found`))}else if("background"!==m&&"sky"!==m)if(r.source){const b=c.sources&&c.sources[r.source],E=b&&Pr(b.type);b?"vector"===E&&"raster"===m?e.push(new kt(s,r.source,`layer "${r.id}" requires a raster source`)):"raster"===E&&"raster"!==m?e.push(new kt(s,r.source,`layer "${r.id}" requires a vector source`)):"vector"!==E||r["source-layer"]?"raster-dem"===E&&"hillshade"!==m?e.push(new kt(s,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==m||!r.paint||!r.paint["line-gradient"]||"geojson"===E&&b.lineMetrics||e.push(new kt(s,r,`layer "${r.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new kt(s,r,`layer "${r.id}" must specify a "source-layer"`)):e.push(new kt(s,r.source,`source "${r.source}" not found`))}else e.push(new kt(s,r,'missing required property "source"'));return e=e.concat(Wi({key:s,value:r,valueSpec:d.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>zt({key:`${s}.type`,value:r.type,valueSpec:d.layer.type,style:t.style,styleSpec:t.styleSpec,object:r,objectKey:"type"}),filter:b=>Ga(Nr({layerType:m},b)),layout:b=>Wi({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":E=>D(Nr({layerType:m},E))}}),paint:b=>Wi({layer:r,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":E=>C(Nr({layerType:m},E))}})}})),e}function U(t){const e=t.value,r=t.key,s=rr(e);return"string"!==s?[new kt(r,e,`string expected, ${s} found`)]:[]}const X={promoteId:function({key:t,value:e}){if("string"===rr(e))return U({key:t,value:e});{const r=[];for(const s in e)r.push(...U({key:`${t}.${s}`,value:e[s]}));return r}}};function he(t){const e=t.value,r=t.key,s=t.styleSpec,c=t.style;if(!e.type)return[new kt(r,e,'"type" is required')];const d=Pr(e.type);let m;switch(d){case"vector":case"raster":case"raster-dem":return m=Wi({key:r,value:e,valueSpec:s[`source_${d.replace("-","_")}`],style:t.style,styleSpec:s,objectElementValidators:X}),m;case"geojson":if(m=Wi({key:r,value:e,valueSpec:s.source_geojson,style:c,styleSpec:s,objectElementValidators:X}),e.cluster)for(const y in e.clusterProperties){const[b,E]=e.clusterProperties[y],I="string"==typeof b?[b,["accumulated"],["get",y]]:b;m.push(...Xi({key:`${r}.${y}.map`,value:E,expressionContext:"cluster-map"})),m.push(...Xi({key:`${r}.${y}.reduce`,value:I,expressionContext:"cluster-reduce"}))}return m;case"video":return Wi({key:r,value:e,valueSpec:s.source_video,style:c,styleSpec:s});case"image":return Wi({key:r,value:e,valueSpec:s.source_image,style:c,styleSpec:s});case"canvas":return[new kt(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zs({key:`${r}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:c,styleSpec:s})}}function we(t){const e=t.value,r=t.styleSpec,s=r.light,c=t.style;let d=[];const m=rr(e);if(void 0===e)return d;if("object"!==m)return d=d.concat([new kt("light",e,`object expected, ${m} found`)]),d;for(const y in e){const b=y.match(/^(.*)-transition$/);d=d.concat(b&&s[b[1]]&&s[b[1]].transition?zt({key:y,value:e[y],valueSpec:r.transition,style:c,styleSpec:r}):s[y]?zt({key:y,value:e[y],valueSpec:s[y],style:c,styleSpec:r}):[new kt(y,e[y],`unknown property "${y}"`)])}return d}function je(t){const e=t.value,r=t.key,s=t.style,c=t.styleSpec,d=c.terrain;let m=[];const y=rr(e);if(void 0===e)return m;if("object"!==y)return m=m.concat([new kt("terrain",e,`object expected, ${y} found`)]),m;for(const b in e){const E=b.match(/^(.*)-transition$/);m=m.concat(E&&d[E[1]]&&d[E[1]].transition?zt({key:b,value:e[b],valueSpec:c.transition,style:s,styleSpec:c}):d[b]?zt({key:b,value:e[b],valueSpec:d[b],style:s,styleSpec:c}):[new kt(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=s.sources&&s.sources[e.source],E=b&&Pr(b.type);b?"raster-dem"!==E&&m.push(new kt(r,e.source,`terrain cannot be used with a source of type ${E}, it only be used with a "raster-dem" source type`)):m.push(new kt(r,e.source,`source "${e.source}" not found`))}else m.push(new kt(r,e,'terrain is missing required property "source"'));return m}function Lt(t){const e=t.value,r=t.style,s=t.styleSpec,c=s.fog;let d=[];const m=rr(e);if(void 0===e)return d;if("object"!==m)return d=d.concat([new kt("fog",e,`object expected, ${m} found`)]),d;for(const y in e){const b=y.match(/^(.*)-transition$/);d=d.concat(b&&c[b[1]]&&c[b[1]].transition?zt({key:y,value:e[y],valueSpec:s.transition,style:r,styleSpec:s}):c[y]?zt({key:y,value:e[y],valueSpec:c[y],style:r,styleSpec:s}):[new kt(y,e[y],`unknown property "${y}"`)])}return d}const _n={"*":()=>[],array:gl,boolean:function(t){const e=t.value,r=t.key,s=rr(e);return"boolean"!==s?[new kt(r,e,`boolean expected, ${s} found`)]:[]},number:Va,color:function(t){const e=t.key,r=t.value,s=rr(r);return"string"!==s?[new kt(e,r,`color expected, ${s} found`)]:null===Is.parseCSSColor(r)?[new kt(e,r,`color expected, "${r}" found`)]:[]},constants:Jr,enum:zs,filter:Ga,function:ja,layer:L,object:Wi,source:he,light:we,terrain:je,fog:Lt,string:U,formatted:function(t){return 0===U(t).length?[]:Xi(t)},resolvedImage:function(t){return 0===U(t).length?[]:Xi(t)},projection:function(t){const e=t.value,r=t.styleSpec,s=r.projection,c=t.style;let d=[];const m=rr(e);if("object"===m)for(const y in e)d=d.concat(zt({key:y,value:e[y],valueSpec:s[y],style:c,styleSpec:r}));else"string"!==m&&(d=d.concat([new kt("projection",e,`object or string expected, ${m} found`)]));return d}};function zt(t){const e=t.value,r=t.valueSpec,s=t.styleSpec;return r.expression&&ga(Pr(e))?ja(t):r.expression&&Os(_o(e))?Xi(t):r.type&&_n[r.type]?_n[r.type](t):Wi(Nr({},t,{valueSpec:r.type?s[r.type]:r}))}function pr(t){const e=t.value,r=t.key,s=U(t);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new kt(r,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new kt(r,e,'"glyphs" url must include a "{range}" token'))),s}function Qn(t,e=We){let r=[];return r=r.concat(zt({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:pr,"*":()=>[]}})),t.constants&&(r=r.concat(Jr({key:"constants",value:t.constants,style:t,styleSpec:e}))),Us(r)}function Us(t){return[].concat(t).sort((e,r)=>e.line-r.line)}function Zr(t){return function(...e){return Us(t.apply(this,e))}}Qn.source=Zr(he),Qn.light=Zr(we),Qn.terrain=Zr(je),Qn.fog=Zr(Lt),Qn.layer=Zr(L),Qn.filter=Zr(Ga),Qn.paintProperty=Zr(C),Qn.layoutProperty=Zr(D);const Ni=Qn,Ui=Ni.light,ta=Ni.fog,rs=Ni.paintProperty,Vs=Ni.layoutProperty;function Au(t,e){let r=!1;if(e&&e.length)for(const s of e)t.fire(new Hr(new Error(s.message))),r=!0;return r}var bc=sr;function sr(t,e,r){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var c=new Int32Array(this.arrayBuffer);t=c[0],this.d=(e=c[1])+2*(r=c[2]);for(var d=0;d<this.d*this.d;d++){var m=c[3+d],y=c[3+d+1];s.push(m===y?null:c.subarray(m,y))}var b=c[3+s.length+1];this.keys=c.subarray(c[3+s.length],b),this.bboxes=c.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*r;for(var E=0;E<this.d*this.d;E++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=r,this.scale=e/t,this.uid=0;var I=r/e*t;this.min=-I,this.max=t+I}sr.prototype.insert=function(t,e,r,s,c){this._forEachCell(e,r,s,c,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(r),this.bboxes.push(s),this.bboxes.push(c)},sr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},sr.prototype._insertCell=function(t,e,r,s,c,d){this.cells[c].push(d)},sr.prototype.query=function(t,e,r,s,c){var d=this.min,m=this.max;if(t<=d&&e<=d&&m<=r&&m<=s&&!c)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(t,e,r,s,this._queryCell,y,{},c),y},sr.prototype._queryCell=function(t,e,r,s,c,d,m,y){var b=this.cells[c];if(null!==b)for(var E=this.keys,I=this.bboxes,P=0;P<b.length;P++){var R=b[P];if(void 0===m[R]){var j=4*R;(y?y(I[j+0],I[j+1],I[j+2],I[j+3]):t<=I[j+2]&&e<=I[j+3]&&r>=I[j+0]&&s>=I[j+1])?(m[R]=!0,d.push(E[R])):m[R]=!1}}},sr.prototype._forEachCell=function(t,e,r,s,c,d,m,y){for(var b=this._convertToCellCoord(t),E=this._convertToCellCoord(e),I=this._convertToCellCoord(r),P=this._convertToCellCoord(s),R=b;R<=I;R++)for(var j=E;j<=P;j++){var H=this.d*j+R;if((!y||y(this._convertFromCellCoord(R),this._convertFromCellCoord(j),this._convertFromCellCoord(R+1),this._convertFromCellCoord(j+1)))&&c.call(this,t,e,r,s,H,d,m,y))return}},sr.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},sr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},sr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,r=0,s=0;s<this.cells.length;s++)r+=this.cells[s].length;var c=new Int32Array(e+r+this.keys.length+this.bboxes.length);c[0]=this.extent,c[1]=this.n,c[2]=this.padding;for(var d=e,m=0;m<t.length;m++){var y=t[m];c[3+m]=d,c.set(y,d),d+=y.length}return c[3+t.length]=d,c.set(this.keys,d),c[3+t.length+1]=d+=this.keys.length,c.set(this.bboxes,d),d+=this.bboxes.length,c.buffer};const{ImageData:wc,ImageBitmap:Ec}=Me,jc={};function jt(t,e,r={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),jc[t]={klass:e,omit:r.omit||[],shallow:r.shallow||[]}}jt("Object",Object),bc.serialize=function(t,e){const r=t.toArrayBuffer();return e&&e.push(r),{buffer:r}},bc.deserialize=function(t){return new bc(t.buffer)},jt("Grid",bc),jt("Color",Un),jt("Error",Error),jt("ResolvedImage",so),jt("StylePropertyFunction",Ua),jt("StyleExpression",Na,{omit:["_evaluator"]}),jt("ZoomDependentExpression",Gl),jt("ZoomConstantExpression",Uo),jt("CompoundExpression",W,{omit:["_evaluate"]});for(const t in ts)ts[t]._classRegistryKey||jt(`Expression_${t}`,ts[t]);function Tc(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function hd(t){return Ec&&t instanceof Ec}function $c(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Tc(t)||hd(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const r=t;return e&&e.push(r.buffer),r}if(t instanceof wc)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const r=[];for(const s of t)r.push($c(s,e));return r}if("object"==typeof t){const r=t.constructor,s=r._classRegistryKey;if(!s)throw new Error("can't serialize object of unregistered class");const c=r.serialize?r.serialize(t,e):{};if(!r.serialize){for(const d in t){if(!t.hasOwnProperty(d)||jc[s].omit.indexOf(d)>=0)continue;const m=t[d];c[d]=jc[s].shallow.indexOf(d)>=0?m:$c(m,e)}t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(c.$name=s),c}throw new Error("can't serialize object of type "+typeof t)}function ys(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Tc(t)||hd(t)||ArrayBuffer.isView(t)||t instanceof wc)return t;if(Array.isArray(t))return t.map(ys);if("object"==typeof t){const e=t.$name||"Object",{klass:r}=jc[e];if(!r)throw new Error(`can't deserialize unregistered class ${e}`);if(r.deserialize)return r.deserialize(t);const s=Object.create(r.prototype);for(const c of Object.keys(t)){if("$name"===c)continue;const d=t[c];s[c]=jc[e].shallow.indexOf(c)>=0?d:ys(d)}return s}throw new Error("can't deserialize object of type "+typeof t)}class f{constructor(){this.first=!0}update(e,r){const s=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=r):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=r),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=s,!0))}}const n=t=>t>=1536&&t<=1791,l=t=>t>=1872&&t<=1919,p=t=>t>=2208&&t<=2303,_=t=>t>=11904&&t<=12031,x=t=>t>=12032&&t<=12255,w=t=>t>=12272&&t<=12287,S=t=>t>=12288&&t<=12351,F=t=>t>=12352&&t<=12447,O=t=>t>=12448&&t<=12543,N=t=>t>=12544&&t<=12591,$=t=>t>=12704&&t<=12735,K=t=>t>=12736&&t<=12783,re=t=>t>=12784&&t<=12799,te=t=>t>=12800&&t<=13055,ie=t=>t>=13056&&t<=13311,xe=t=>t>=13312&&t<=19903,ee=t=>t>=19968&&t<=40959,ge=t=>t>=40960&&t<=42127,me=t=>t>=42128&&t<=42191,fe=t=>t>=44032&&t<=55215,pe=t=>t>=63744&&t<=64255,be=t=>t>=64336&&t<=65023,ze=t=>t>=65040&&t<=65055,Ge=t=>t>=65072&&t<=65103,bt=t=>t>=65104&&t<=65135,ht=t=>t>=65136&&t<=65279,lt=t=>t>=65280&&t<=65519;function Ke(t){for(const e of t)if(Qe(e.charCodeAt(0)))return!0;return!1}function Ue(t){for(const e of t)if(!ct(e.charCodeAt(0)))return!1;return!0}function ct(t){return!(n(t)||l(t)||p(t)||be(t)||ht(t))}function Qe(t){return!(746!==t&&747!==t&&(t<4352||!($(t)||N(t)||Ge(t)&&!(t>=65097&&t<=65103)||pe(t)||ie(t)||_(t)||K(t)||!(!S(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||xe(t)||ee(t)||te(t)||(e=t,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||fe(t)||F(t)||w(t)||(e=>e>=12688&&e<=12703)(t)||x(t)||re(t)||O(t)&&12540!==t||!(!lt(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!bt(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||ze(t)||(e=>e>=19904&&e<=19967)(t)||ge(t)||me(t))));var e}function Yt(t){return!(Qe(t)||(e=t,(r=e)>=128&&r<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(r=>r>=8192&&r<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(r=>r>=8448&&r<=8527)(e)||(r=>r>=8528&&r<=8591)(e)||(r=>r>=8960&&r<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(r=>r>=9216&&r<=9279)(e)&&9251!==e||(r=>r>=9280&&r<=9311)(e)||(r=>r>=9312&&r<=9471)(e)||(r=>r>=9632&&r<=9727)(e)||(r=>r>=9728&&r<=9983)(e)&&!(e>=9754&&e<=9759)||(r=>r>=11008&&r<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||S(e)||O(e)||(r=>r>=57344&&r<=63743)(e)||Ge(e)||bt(e)||lt(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,r}function on(t){return t>=1424&&t<=2303||be(t)||ht(t)}function Ln(t,e){return!(!e&&on(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(r=t,r>=6016&&r<=6143));var r}function xt(t){for(const e of t)if(on(e.charCodeAt(0)))return!0;return!1}const ln="deferred",yn="loading",yr="loaded";let mr=null,mn="unavailable",Vn=null;const Fn=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(mn="error"),mr&&mr(t)};function wi(){Vo.fire(new Ai("pluginStateChange",{pluginStatus:mn,pluginURL:Vn}))}const Vo=new Rn,jo=function(){return mn},Co=function(){if(mn!==ln||!Vn)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");mn=yn,wi(),Vn&&Dr({url:Vn},t=>{t?Fn(t):(mn=yr,wi())})},nr={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>mn===yr||null!=nr.applyArabicShaping,isLoading:()=>mn===yn,setState(t){mn=t.pluginStatus,Vn=t.pluginURL},isParsed:()=>null!=nr.applyArabicShaping&&null!=nr.processBidirectionalText&&null!=nr.processStyledBidirectionalText,getPluginURL:()=>Vn};class wn{constructor(e,r){this.zoom=e,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.zoomHistory=r.zoomHistory,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new f,this.transition={},this.pitch=0)}isSupportedScript(e){return function(r,s){for(const c of r)if(!Ln(c.charCodeAt(0),s))return!1;return!0}(e,nr.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,r=e-Math.floor(e),s=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:r+(1-r)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*r}}}class qn{constructor(e,r){this.property=e,this.value=r,this.expression=function(s,c){if(ga(s))return new Ua(s,c);if(Os(s)){const d=Uc(s,c);if("error"===d.result)throw new Error(d.value.map(m=>`${m.key}: ${m.message}`).join(", "));return d.value}{let d=s;return"string"==typeof s&&"color"===c.type&&(d=Un.parse(s)),{kind:"constant",evaluate:()=>d}}}(void 0===r?e.specification.default:r,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,r,s){return this.property.possiblyEvaluate(this,e,r,s)}}class qr{constructor(e){this.property=e,this.value=new qn(e,void 0)}transitioned(e,r){return new zr(this.property,this.value,r,cr({},e.transition,this.transition),e.now)}untransitioned(){return new zr(this.property,this.value,null,{},0)}}class ao{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return hr(this._values[e].value.value)}setValue(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new qr(this._values[e].property)),this._values[e].value=new qn(this._values[e].property,null===r?void 0:hr(r))}getTransition(e){return hr(this._values[e].transition)}setTransition(e,r){this._values.hasOwnProperty(e)||(this._values[e]=new qr(this._values[e].property)),this._values[e].transition=hr(r)||void 0}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);void 0!==s&&(e[r]=s);const c=this.getTransition(r);void 0!==c&&(e[`${r}-transition`]=c)}return e}transitioned(e,r){const s=new lo(this._properties);for(const c of Object.keys(this._values))s._values[c]=this._values[c].transitioned(e,r._values[c]);return s}untransitioned(){const e=new lo(this._properties);for(const r of Object.keys(this._values))e._values[r]=this._values[r].untransitioned();return e}}class zr{constructor(e,r,s,c,d){const m=c.delay||0,y=c.duration||0;d=d||0,this.property=e,this.value=r,this.begin=d+m,this.end=this.begin+y,e.specification.transition&&(c.delay||c.duration)&&(this.prior=s)}possiblyEvaluate(e,r,s){const c=e.now||0,d=this.value.possiblyEvaluate(e,r,s),m=this.prior;if(m){if(c>this.end)return this.prior=null,d;if(this.value.isDataDriven())return this.prior=null,d;if(c<this.begin)return m.possiblyEvaluate(e,r,s);{const y=(c-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,r,s),d,Gr(y))}}return d}}class lo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,r,s){const c=new ya(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,r,s);return c}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Dc{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return hr(this._values[e].value)}setValue(e,r){this._values[e]=new qn(this._values[e].property,null===r?void 0:hr(r))}serialize(){const e={};for(const r of Object.keys(this._values)){const s=this.getValue(r);void 0!==s&&(e[r]=s)}return e}possiblyEvaluate(e,r,s){const c=new ya(this._properties);for(const d of Object.keys(this._values))c._values[d]=this._values[d].possiblyEvaluate(e,r,s);return c}}class So{constructor(e,r,s){this.property=e,this.value=r,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,r,s,c){return this.property.evaluate(this.value,this.parameters,e,r,s,c)}}class ya{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class $t{constructor(e){this.specification=e}possiblyEvaluate(e,r){return e.expression.evaluate(r)}interpolate(e,r,s){const c=zl[this.specification.type];return c?c(e,r,s):e}}class sn{constructor(e,r){this.specification=e,this.overrides=r}possiblyEvaluate(e,r,s,c){return new So(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(r,null,{},s,c)}:e.expression,r)}interpolate(e,r,s){if("constant"!==e.value.kind||"constant"!==r.value.kind)return e;if(void 0===e.value.value||void 0===r.value.value)return new So(this,{kind:"constant",value:void 0},e.parameters);const c=zl[this.specification.type];return c?new So(this,{kind:"constant",value:c(e.value.value,r.value.value,s)},e.parameters):e}evaluate(e,r,s,c,d,m){return"constant"===e.kind?e.value:e.evaluate(r,s,c,d,m)}}class Yi extends sn{possiblyEvaluate(e,r,s,c){if(void 0===e.value)return new So(this,{kind:"constant",value:void 0},r);if("constant"===e.expression.kind){const d=e.expression.evaluate(r,null,{},s,c),m="resolvedImage"===e.property.specification.type&&"string"!=typeof d?d.name:d,y=this._calculate(m,m,m,r);return new So(this,{kind:"constant",value:y},r)}if("camera"===e.expression.kind){const d=this._calculate(e.expression.evaluate({zoom:r.zoom-1}),e.expression.evaluate({zoom:r.zoom}),e.expression.evaluate({zoom:r.zoom+1}),r);return new So(this,{kind:"constant",value:d},r)}return new So(this,e.expression,r)}evaluate(e,r,s,c,d,m){if("source"===e.kind){const y=e.evaluate(r,s,c,d,m);return this._calculate(y,y,y,r)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(r.zoom)-1},s,c),e.evaluate({zoom:Math.floor(r.zoom)},s,c),e.evaluate({zoom:Math.floor(r.zoom)+1},s,c),r):e.value}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r,other:s}:{from:s,to:r,other:e}}interpolate(e){return e}}class xl{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){if(void 0!==e.value){if("constant"===e.expression.kind){const d=e.expression.evaluate(r,null,{},s,c);return this._calculate(d,d,d,r)}return this._calculate(e.expression.evaluate(new wn(Math.floor(r.zoom-1),r)),e.expression.evaluate(new wn(Math.floor(r.zoom),r)),e.expression.evaluate(new wn(Math.floor(r.zoom+1),r)),r)}}_calculate(e,r,s,c){return c.zoom>c.zoomHistory.lastIntegerZoom?{from:e,to:r}:{from:s,to:r}}interpolate(e){return e}}class is{constructor(e){this.specification=e}possiblyEvaluate(e,r,s,c){return!!e.expression.evaluate(r,null,{},s,c)}interpolate(){return!1}}class Ei{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const r in e){const s=e[r];s.specification.overridable&&this.overridableProperties.push(r);const c=this.defaultPropertyValues[r]=new qn(s,void 0),d=this.defaultTransitionablePropertyValues[r]=new qr(s);this.defaultTransitioningPropertyValues[r]=d.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=c.possiblyEvaluate({})}}}function Zf(t,e){return 256*(t=Pn(Math.floor(t),0,255))+Pn(Math.floor(e),0,255)}jt("DataDrivenProperty",sn),jt("DataConstantProperty",$t),jt("CrossFadedDataDrivenProperty",Yi),jt("CrossFadedProperty",xl),jt("ColorRampProperty",is);const B_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Gc{constructor(e,r){this._structArray=e,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ti{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,r){return e._trim(),r&&(e.isTransferred=!0,r.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const r=Object.create(this.prototype);return r.arrayBuffer=e.arrayBuffer,r.length=e.length,r.capacity=e.arrayBuffer.byteLength/r.bytesPerElement,r._refreshViews(),r}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const r=this.uint8;this._refreshViews(),r&&this.uint8.set(r)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function hi(t,e=1){let r=0,s=0;return{members:t.map(c=>{const d=B_[c.type].BYTES_PER_ELEMENT,m=r=qf(r,Math.max(e,d)),y=c.components||1;return s=Math.max(s,d),r+=d*y,{name:c.name,type:c.type,components:y,offset:m}}),size:qf(r,Math.max(s,e)),alignment:e}}function qf(t,e){return Math.ceil(t/e)*e}class Hc extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.int16[c+0]=r,this.int16[c+1]=s,e}}Hc.prototype.bytesPerElement=4,jt("StructArrayLayout2i4",Hc);class Zc extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,c)}emplace(e,r,s,c,d){const m=4*e;return this.int16[m+0]=r,this.int16[m+1]=s,this.int16[m+2]=c,this.int16[m+3]=d,e}}Zc.prototype.bytesPerElement=8,jt("StructArrayLayout4i8",Zc);class qc extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,s,c,d,m,y)}emplace(e,r,s,c,d,m,y,b){const E=6*e,I=12*e,P=3*e;return this.int16[E+0]=r,this.int16[E+1]=s,this.uint8[I+4]=c,this.uint8[I+5]=d,this.uint8[I+6]=m,this.uint8[I+7]=y,this.float32[P+2]=b,e}}qc.prototype.bytesPerElement=12,jt("StructArrayLayout2i4ub1f12",qc);class Xl extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const d=3*e;return this.float32[d+0]=r,this.float32[d+1]=s,this.float32[d+2]=c,e}}Xl.prototype.bytesPerElement=12,jt("StructArrayLayout3f12",Xl);class js extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,y,b,E,I){const P=this.length;return this.resize(P+1),this.emplace(P,e,r,s,c,d,m,y,b,E,I)}emplace(e,r,s,c,d,m,y,b,E,I,P){const R=10*e;return this.uint16[R+0]=r,this.uint16[R+1]=s,this.uint16[R+2]=c,this.uint16[R+3]=d,this.uint16[R+4]=m,this.uint16[R+5]=y,this.uint16[R+6]=b,this.uint16[R+7]=E,this.uint16[R+8]=I,this.uint16[R+9]=P,e}}js.prototype.bytesPerElement=20,jt("StructArrayLayout10ui20",js);class ph extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,y,b){const E=this.length;return this.resize(E+1),this.emplace(E,e,r,s,c,d,m,y,b)}emplace(e,r,s,c,d,m,y,b,E){const I=8*e;return this.uint16[I+0]=r,this.uint16[I+1]=s,this.uint16[I+2]=c,this.uint16[I+3]=d,this.uint16[I+4]=m,this.uint16[I+5]=y,this.uint16[I+6]=b,this.uint16[I+7]=E,e}}ph.prototype.bytesPerElement=16,jt("StructArrayLayout8ui16",ph);class dd extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,y,b,E,I,P,R,j,H,Q,ne){const ce=this.length;return this.resize(ce+1),this.emplace(ce,e,r,s,c,d,m,y,b,E,I,P,R,j,H,Q,ne)}emplace(e,r,s,c,d,m,y,b,E,I,P,R,j,H,Q,ne,ce){const ye=16*e;return this.int16[ye+0]=r,this.int16[ye+1]=s,this.int16[ye+2]=c,this.int16[ye+3]=d,this.uint16[ye+4]=m,this.uint16[ye+5]=y,this.uint16[ye+6]=b,this.uint16[ye+7]=E,this.int16[ye+8]=I,this.int16[ye+9]=P,this.int16[ye+10]=R,this.int16[ye+11]=j,this.int16[ye+12]=H,this.int16[ye+13]=Q,this.int16[ye+14]=ne,this.int16[ye+15]=ce,e}}dd.prototype.bytesPerElement=32,jt("StructArrayLayout4i4ui4i4i32",dd);class Wf extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint32[1*e+0]=r,e}}Wf.prototype.bytesPerElement=4,jt("StructArrayLayout1ul4",Wf);class Wc extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,y,b,E,I,P,R,j){const H=this.length;return this.resize(H+1),this.emplace(H,e,r,s,c,d,m,y,b,E,I,P,R,j)}emplace(e,r,s,c,d,m,y,b,E,I,P,R,j,H){const Q=20*e,ne=10*e;return this.int16[Q+0]=r,this.int16[Q+1]=s,this.int16[Q+2]=c,this.int16[Q+3]=d,this.int16[Q+4]=m,this.float32[ne+3]=y,this.float32[ne+4]=b,this.float32[ne+5]=E,this.float32[ne+6]=I,this.int16[Q+14]=P,this.uint32[ne+8]=R,this.uint16[Q+18]=j,this.uint16[Q+19]=H,e}}Wc.prototype.bytesPerElement=40,jt("StructArrayLayout5i4f1i1ul2ui40",Wc);class Xc extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,s,c,d,m,y)}emplace(e,r,s,c,d,m,y,b){const E=8*e;return this.int16[E+0]=r,this.int16[E+1]=s,this.int16[E+2]=c,this.int16[E+4]=d,this.int16[E+5]=m,this.int16[E+6]=y,this.int16[E+7]=b,e}}Xc.prototype.bytesPerElement=16,jt("StructArrayLayout3i2i2i16",Xc);class mh extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,r,s,c,d)}emplace(e,r,s,c,d,m){const y=4*e,b=8*e;return this.float32[y+0]=r,this.float32[y+1]=s,this.float32[y+2]=c,this.int16[b+6]=d,this.int16[b+7]=m,e}}mh.prototype.bytesPerElement=16,jt("StructArrayLayout2f1f2i16",mh);class gh extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,c)}emplace(e,r,s,c,d){const m=12*e,y=3*e;return this.uint8[m+0]=r,this.uint8[m+1]=s,this.float32[y+1]=c,this.float32[y+2]=d,e}}gh.prototype.bytesPerElement=12,jt("StructArrayLayout2ub2f12",gh);class vs extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const d=3*e;return this.uint16[d+0]=r,this.uint16[d+1]=s,this.uint16[d+2]=c,e}}vs.prototype.bytesPerElement=6,jt("StructArrayLayout3ui6",vs);class _h extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,y,b,E,I,P,R,j,H,Q,ne,ce,ye,De,Ae,ke){const Re=this.length;return this.resize(Re+1),this.emplace(Re,e,r,s,c,d,m,y,b,E,I,P,R,j,H,Q,ne,ce,ye,De,Ae,ke)}emplace(e,r,s,c,d,m,y,b,E,I,P,R,j,H,Q,ne,ce,ye,De,Ae,ke,Re){const rt=30*e,Je=15*e,Tt=60*e;return this.int16[rt+0]=r,this.int16[rt+1]=s,this.int16[rt+2]=c,this.float32[Je+2]=d,this.float32[Je+3]=m,this.uint16[rt+8]=y,this.uint16[rt+9]=b,this.uint32[Je+5]=E,this.uint32[Je+6]=I,this.uint32[Je+7]=P,this.uint16[rt+16]=R,this.uint16[rt+17]=j,this.uint16[rt+18]=H,this.float32[Je+10]=Q,this.float32[Je+11]=ne,this.uint8[Tt+48]=ce,this.uint8[Tt+49]=ye,this.uint8[Tt+50]=De,this.uint32[Je+13]=Ae,this.int16[rt+28]=ke,this.uint8[Tt+58]=Re,e}}_h.prototype.bytesPerElement=60,jt("StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60",_h);class fd extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,y,b,E,I,P,R,j,H,Q,ne,ce,ye,De,Ae,ke,Re,rt,Je,Tt,vt,tt,gt,St,at){const Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,e,r,s,c,d,m,y,b,E,I,P,R,j,H,Q,ne,ce,ye,De,Ae,ke,Re,rt,Je,Tt,vt,tt,gt,St,at)}emplace(e,r,s,c,d,m,y,b,E,I,P,R,j,H,Q,ne,ce,ye,De,Ae,ke,Re,rt,Je,Tt,vt,tt,gt,St,at,Bt){const Zt=38*e,Xn=19*e;return this.int16[Zt+0]=r,this.int16[Zt+1]=s,this.int16[Zt+2]=c,this.float32[Xn+2]=d,this.float32[Xn+3]=m,this.int16[Zt+8]=y,this.int16[Zt+9]=b,this.int16[Zt+10]=E,this.int16[Zt+11]=I,this.int16[Zt+12]=P,this.int16[Zt+13]=R,this.uint16[Zt+14]=j,this.uint16[Zt+15]=H,this.uint16[Zt+16]=Q,this.uint16[Zt+17]=ne,this.uint16[Zt+18]=ce,this.uint16[Zt+19]=ye,this.uint16[Zt+20]=De,this.uint16[Zt+21]=Ae,this.uint16[Zt+22]=ke,this.uint16[Zt+23]=Re,this.uint16[Zt+24]=rt,this.uint16[Zt+25]=Je,this.uint16[Zt+26]=Tt,this.uint16[Zt+27]=vt,this.uint16[Zt+28]=tt,this.uint32[Xn+15]=gt,this.float32[Xn+16]=St,this.float32[Xn+17]=at,this.float32[Xn+18]=Bt,e}}fd.prototype.bytesPerElement=76,jt("StructArrayLayout3i2f6i15ui1ul3f76",fd);class yh extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.float32[1*e+0]=r,e}}yh.prototype.bytesPerElement=4,jt("StructArrayLayout1f4",yh);class pd extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,r,s){const c=this.length;return this.resize(c+1),this.emplace(c,e,r,s)}emplace(e,r,s,c){const d=3*e;return this.int16[d+0]=r,this.int16[d+1]=s,this.int16[d+2]=c,e}}pd.prototype.bytesPerElement=6,jt("StructArrayLayout3i6",pd);class Pu extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c,d,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,r,s,c,d,m,y)}emplace(e,r,s,c,d,m,y,b){const E=7*e;return this.float32[E+0]=r,this.float32[E+1]=s,this.float32[E+2]=c,this.float32[E+3]=d,this.float32[E+4]=m,this.float32[E+5]=y,this.float32[E+6]=b,e}}Pu.prototype.bytesPerElement=28,jt("StructArrayLayout7f28",Pu);class md extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,c)}emplace(e,r,s,c,d){const m=6*e;return this.uint32[3*e+0]=r,this.uint16[m+2]=s,this.uint16[m+3]=c,this.uint16[m+4]=d,e}}md.prototype.bytesPerElement=12,jt("StructArrayLayout1ul3ui12",md);class os extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.uint16[c+0]=r,this.uint16[c+1]=s,e}}os.prototype.bytesPerElement=4,jt("StructArrayLayout2ui4",os);class Yl extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const r=this.length;return this.resize(r+1),this.emplace(r,e)}emplace(e,r){return this.uint16[1*e+0]=r,e}}Yl.prototype.bytesPerElement=2,jt("StructArrayLayout1ui2",Yl);class vh extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r){const s=this.length;return this.resize(s+1),this.emplace(s,e,r)}emplace(e,r,s){const c=2*e;return this.float32[c+0]=r,this.float32[c+1]=s,e}}vh.prototype.bytesPerElement=8,jt("StructArrayLayout2f8",vh);class Xf extends Ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,r,s,c){const d=this.length;return this.resize(d+1),this.emplace(d,e,r,s,c)}emplace(e,r,s,c,d){const m=4*e;return this.float32[m+0]=r,this.float32[m+1]=s,this.float32[m+2]=c,this.float32[m+3]=d,e}}Xf.prototype.bytesPerElement=16,jt("StructArrayLayout4f16",Xf);class zm extends Gc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}zm.prototype.size=40;class Yf extends Wc{get(e){return new zm(this,e)}}jt("CollisionBoxArray",Yf);class Bm extends Gc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Bm.prototype.size=60;class Nm extends _h{get(e){return new Bm(this,e)}}jt("PlacedSymbolArray",Nm);class gd extends Gc{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}gd.prototype.size=76;class Kf extends fd{get(e){return new gd(this,e)}}jt("SymbolInstanceArray",Kf);class Qf extends yh{getoffsetX(e){return this.float32[1*e+0]}}jt("GlyphOffsetArray",Qf);class Jf extends pd{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}jt("SymbolLineVertexArray",Jf);class ep extends Gc{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ep.prototype.size=12;class Um extends md{get(e){return new ep(this,e)}}jt("FeatureIndexArray",Um);class tp extends Gc{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}tp.prototype.size=4;class ku extends os{get(e){return new tp(this,e)}}jt("FillExtrusionCentroidArray",ku);const np=hi([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Ha=hi([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Yc=Ms(function(t){t.exports=function(e,r){var s,c,d,m,y,b,E,I;for(c=e.length-(s=3&e.length),d=r,y=3432918353,b=461845907,I=0;I<c;)E=255&e.charCodeAt(I)|(255&e.charCodeAt(++I))<<8|(255&e.charCodeAt(++I))<<16|(255&e.charCodeAt(++I))<<24,++I,d=27492+(65535&(m=5*(65535&(d=(d^=E=(65535&(E=(E=(65535&E)*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*b+(((E>>>16)*b&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(E=0,s){case 3:E^=(255&e.charCodeAt(I+2))<<16;case 2:E^=(255&e.charCodeAt(I+1))<<8;case 1:d^=E=(65535&(E=(E=(65535&(E^=255&e.charCodeAt(I)))*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*b+(((E>>>16)*b&65535)<<16)&4294967295}return d^=e.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0}}),rp=Ms(function(t){t.exports=function(e,r){for(var s,c=e.length,d=r^c,m=0;c>=4;)s=1540483477*(65535&(s=255&e.charCodeAt(m)|(255&e.charCodeAt(++m))<<8|(255&e.charCodeAt(++m))<<16|(255&e.charCodeAt(++m))<<24))+((1540483477*(s>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(s=1540483477*(65535&(s^=s>>>24))+((1540483477*(s>>>16)&65535)<<16)),c-=4,++m;switch(c){case 3:d^=(255&e.charCodeAt(m+2))<<16;case 2:d^=(255&e.charCodeAt(m+1))<<8;case 1:d=1540483477*(65535&(d^=255&e.charCodeAt(m)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0}}),Kc=Yc,ip=rp;Kc.murmur3=Yc,Kc.murmur2=ip;class _d{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,r,s,c){this.ids.push(Vm(e)),this.positions.push(r,s,c)}getPositions(e){const r=Vm(e);let s=0,c=this.ids.length-1;for(;s<c;){const m=s+c>>1;this.ids[m]>=r?c=m:s=m+1}const d=[];for(;this.ids[s]===r;)d.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return d}static serialize(e,r){const s=new Float64Array(e.ids),c=new Uint32Array(e.positions);return op(s,c,0,s.length-1),r&&r.push(s.buffer,c.buffer),{ids:s,positions:c}}static deserialize(e){const r=new _d;return r.ids=e.ids,r.positions=e.positions,r.indexed=!0,r}}function Vm(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Kc(String(t))}function op(t,e,r,s){for(;r<s;){const c=t[r+s>>1];let d=r-1,m=s+1;for(;;){do{d++}while(t[d]<c);do{m--}while(t[m]>c);if(d>=m)break;Qc(t,d,m),Qc(e,3*d,3*m),Qc(e,3*d+1,3*m+1),Qc(e,3*d+2,3*m+2)}m-r<s-m?(op(t,e,r,m),r=m+1):(op(t,e,m+1,s),s=m)}}function Qc(t,e,r){const s=t[e];t[e]=t[r],t[r]=s}jt("FeaturePositionMap",_d);class va{constructor(e,r){this.gl=e.gl,this.location=r}}class Jc extends va{constructor(e,r){super(e,r),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class jm extends va{constructor(e,r){super(e,r),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class $m extends va{constructor(e,r){super(e,r),this.current=Un.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const sp=new Float32Array(16),Gm=new Float32Array(9),Hm=new Float32Array(4);function yd(t){return[Zf(255*t.r,255*t.g),Zf(255*t.b,255*t.a)]}class Ru{constructor(e,r,s){this.value=e,this.uniformNames=r.map(c=>`u_${c}`),this.type=s}setUniform(e,r,s){e.set(s.constantOr(this.value))}getBinding(e,r,s){return"color"===this.type?new $m(e,r):new Jc(e,r)}}class Cc{constructor(e,r){this.uniformNames=r.map(s=>`u_${s}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,r){this.pixelRatioFrom=r.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=r.tl.concat(r.br),this.patternTo=e.tl.concat(e.br)}setUniform(e,r,s,c){const d="u_pattern_to"===c||"u_dash_to"===c?this.patternTo:"u_pattern_from"===c||"u_dash_from"===c?this.patternFrom:"u_pixel_ratio_to"===c?this.pixelRatioTo:"u_pixel_ratio_from"===c?this.pixelRatioFrom:null;d&&e.set(d)}getBinding(e,r,s){return"u_pattern_from"===s||"u_pattern_to"===s||"u_dash_from"===s||"u_dash_to"===s?new jm(e,r):new Jc(e,r)}}class na{constructor(e,r,s,c){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=r.map(d=>({name:`a_${d}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new c}populatePaintArray(e,r,s,c,d,m){const y=this.paintVertexArray.length,b=this.expression.evaluate(new wn(0),r,{},d,c,m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,b)}updatePaintArray(e,r,s,c,d){const m=this.expression.evaluate({zoom:0},s,c,void 0,d);this._setPaintValue(e,r,m)}_setPaintValue(e,r,s){if("color"===this.type){const c=yd(s);for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,c[0],c[1])}else{for(let c=e;c<r;c++)this.paintVertexArray.emplace(c,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xa{constructor(e,r,s,c,d,m){this.expression=e,this.uniformNames=r.map(y=>`u_${y}_t`),this.type=s,this.useIntegerZoom=c,this.zoom=d,this.maxValue=0,this.paintVertexAttributes=r.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,r,s,c,d,m){const y=this.expression.evaluate(new wn(this.zoom),r,{},d,c,m),b=this.expression.evaluate(new wn(this.zoom+1),r,{},d,c,m),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,y,b)}updatePaintArray(e,r,s,c,d){const m=this.expression.evaluate({zoom:this.zoom},s,c,void 0,d),y=this.expression.evaluate({zoom:this.zoom+1},s,c,void 0,d);this._setPaintValue(e,r,m,y)}_setPaintValue(e,r,s,c){if("color"===this.type){const d=yd(s),m=yd(c);for(let y=e;y<r;y++)this.paintVertexArray.emplace(y,d[0],d[1],m[0],m[1])}else{for(let d=e;d<r;d++)this.paintVertexArray.emplace(d,s,c);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(c))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,r){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,c=Pn(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);e.set(c)}getBinding(e,r,s){return new Jc(e,r)}}class Za{constructor(e,r,s,c,d,m,y){this.expression=e,this.type=s,this.useIntegerZoom=c,this.zoom=d,this.layerId=y,this.paintVertexAttributes=("array"===s?Ha:np).members;for(let b=0;b<r.length;++b);this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,r,s){const c=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(c,e,r.patterns&&r.patterns[this.layerId],s)}updatePaintArray(e,r,s,c,d,m){this._setPaintValues(e,r,s.patterns&&s.patterns[this.layerId],m)}_setPaintValues(e,r,s,c){if(!c||!s)return;const{min:d,mid:m,max:y}=s,b=c[d],E=c[m],I=c[y];if(b&&E&&I)for(let P=e;P<r;P++)this._setPaintValue(this.zoomInPaintVertexArray,P,E,b),this._setPaintValue(this.zoomOutPaintVertexArray,P,E,I)}_setPaintValue(e,r,s,c){e.emplace(r,s.tl[0],s.tl[1],s.br[0],s.br[1],c.tl[0],c.tl[1],c.br[0],c.br[1],s.pixelRatio,c.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class bl{constructor(e,r,s=(()=>!0)){this.binders={},this._buffers=[];const c=[];for(const d in e.paint._values){if(!s(d))continue;const m=e.paint.get(d);if(!(m instanceof So&&Ba(m.property.specification)))continue;const y=qm(d,e.type),b=m.value,E=m.property.specification.type,I=m.property.useIntegerZoom,P=m.property.specification["property-type"],R="cross-faded"===P||"cross-faded-data-driven"===P,j="line-dasharray"===String(d)&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==b.kind||j)if("source"===b.kind||j||R){const H=lp(d,E,"source");this.binders[d]=R?new Za(b,y,E,I,r,H,e.id):new na(b,y,E,H),c.push(`/a_${d}`)}else{const H=lp(d,E,"composite");this.binders[d]=new xa(b,y,E,I,r,H),c.push(`/z_${d}`)}else this.binders[d]=R?new Cc(b.value,y):new Ru(b.value,y,E),c.push(`/u_${d}`)}this.cacheKey=c.sort().join("")}getMaxValue(e){const r=this.binders[e];return r instanceof na||r instanceof xa?r.maxValue:0}populatePaintArrays(e,r,s,c,d,m){for(const y in this.binders){const b=this.binders[y];(b instanceof na||b instanceof xa||b instanceof Za)&&b.populatePaintArray(e,r,s,c,d,m)}}setConstantPatternPositions(e,r){for(const s in this.binders){const c=this.binders[s];c instanceof Cc&&c.setConstantPatternPositions(e,r)}}updatePaintArrays(e,r,s,c,d,m){let y=!1;for(const b in e){const E=r.getPositions(b);for(const I of E){const P=s.feature(I.index);for(const R in this.binders){const j=this.binders[R];if((j instanceof na||j instanceof xa||j instanceof Za)&&!0===j.expression.isStateDependent){const H=c.paint.get(R);j.expression=H.value,j.updatePaintArray(I.start,I.end,P,e[b],d,m),y=!0}}}}return y}defines(){const e=[];for(const r in this.binders){const s=this.binders[r];(s instanceof Ru||s instanceof Cc)&&e.push(...s.uniformNames.map(c=>`#define HAS_UNIFORM_${c}`))}return e}getBinderAttributes(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof na||s instanceof xa||s instanceof Za)for(let c=0;c<s.paintVertexAttributes.length;c++)e.push(s.paintVertexAttributes[c].name)}return e}getBinderUniforms(){const e=[];for(const r in this.binders){const s=this.binders[r];if(s instanceof Ru||s instanceof Cc||s instanceof xa)for(const c of s.uniformNames)e.push(c)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,r){const s=[];for(const c in this.binders){const d=this.binders[c];if(d instanceof Ru||d instanceof Cc||d instanceof xa)for(const m of d.uniformNames)if(r[m]){const y=d.getBinding(e,r[m],m);s.push({name:m,property:c,binding:y})}}return s}setUniforms(e,r,s,c){for(const{name:d,property:m,binding:y}of r)this.binders[m].setUniform(y,c,s.get(m),d)}updatePaintBuffers(e){this._buffers=[];for(const r in this.binders){const s=this.binders[r];if(e&&s instanceof Za){const c=2===e.fromScale?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;c&&this._buffers.push(c)}else(s instanceof na||s instanceof xa)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}}upload(e){for(const r in this.binders){const s=this.binders[r];(s instanceof na||s instanceof xa||s instanceof Za)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const r=this.binders[e];(r instanceof na||r instanceof xa||r instanceof Za)&&r.destroy()}}}class ai{constructor(e,r,s=(()=>!0)){this.programConfigurations={};for(const c of e)this.programConfigurations[c.id]=new bl(c,r,s);this.needsUpload=!1,this._featureMap=new _d,this._bufferOffset=0}populatePaintArrays(e,r,s,c,d,m,y){for(const b in this.programConfigurations)this.programConfigurations[b].populatePaintArrays(e,r,c,d,m,y);void 0!==r.id&&this._featureMap.add(r.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,r,s,c,d){for(const m of s)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,r,m,c,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const r in this.programConfigurations)this.programConfigurations[r].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Zm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function qm(t,e){return Zm[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const vd={"line-pattern":{source:js,composite:js},"fill-pattern":{source:js,composite:js},"fill-extrusion-pattern":{source:js,composite:js},"line-dasharray":{source:ph,composite:ph}},ap={color:{source:vh,composite:Xf},number:{source:yh,composite:vh}};function lp(t,e,r){const s=vd[t];return s&&s[r]||ap[e][r]}jt("ConstantBinder",Ru),jt("CrossFadedConstantBinder",Cc),jt("SourceExpressionBinder",na),jt("CrossFadedCompositeBinder",Za),jt("CompositeExpressionBinder",xa),jt("ProgramConfiguration",bl,{omit:["_buffers"]}),jt("ProgramConfigurationSet",ai);const xh="-transition";class ba extends Rn{constructor(e,r){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=(e=e).metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),r.layout&&(this._unevaluatedLayout=new Dc(r.layout)),r.paint)){this._transitionablePaint=new ao(r.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new ya(r.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,r,s={}){null!=r&&this._validate(Vs,`layers.${this.id}.layout.${e}`,e,r,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,r):this.visibility=r)}getPaintProperty(e){return cn(e,xh)?this._transitionablePaint.getTransition(e.slice(0,-xh.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,r,s={}){if(null!=r&&this._validate(rs,`layers.${this.id}.paint.${e}`,e,r,s))return!1;if(cn(e,xh))return this._transitionablePaint.setTransition(e.slice(0,-xh.length),r||void 0),!1;{const c=this._transitionablePaint._values[e],d="cross-faded-data-driven"===c.property.specification["property-type"],m=c.value.isDataDriven(),y=c.value;this._transitionablePaint.setValue(e,r),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||m||d||this._handleOverridablePaintPropertyUpdate(e,y,b)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,r,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,r){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,r)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,r)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Po(e,(r,s)=>!(void 0===r||"layout"===s&&!Object.keys(r).length||"paint"===s&&!Object.keys(r).length))}_validate(e,r,s,c,d={}){return(!d||!1!==d.validate)&&Au(this,e.call(Ni,{key:r,layerType:this.type,objectKey:s,value:c,styleSpec:We,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const r=this.paint.get(e);if(r instanceof So&&Ba(r.property.specification)&&("source"===r.value.kind||"composite"===r.value.kind)&&r.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Bs(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Wm=hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Xm}=Wm;class Li{constructor(e=[]){this.segments=e}prepareSegment(e,r,s,c){let d=this.segments[this.segments.length-1];return e>Li.MAX_VERTEX_ARRAY_LENGTH&&Hn(`Max vertices per segment is ${Li.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!d||d.vertexLength+e>Li.MAX_VERTEX_ARRAY_LENGTH||d.sortKey!==c)&&(d={vertexOffset:r.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==c&&(d.sortKey=c),this.segments.push(d)),d}get(){return this.segments}destroy(){for(const e of this.segments)for(const r in e.vaos)e.vaos[r].destroy()}static simpleSegment(e,r,s,c){return new Li([{vertexOffset:e,primitiveOffset:r,vertexLength:s,primitiveLength:c,vaos:{},sortKey:0}])}}Li.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,jt("SegmentVector",Li);var Wn=8192;class wa{constructor(e,r){e&&(r?this.setSouthWest(e).setNorthEast(r):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof vr?new vr(e.lng,e.lat):vr.convert(e),this}setSouthWest(e){return this._sw=e instanceof vr?new vr(e.lng,e.lat):vr.convert(e),this}extend(e){const r=this._sw,s=this._ne;let c,d;if(e instanceof vr)c=e,d=e;else{if(!(e instanceof wa))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(wa.convert(e)):this.extend(vr.convert(e)):this;if(c=e._sw,d=e._ne,!c||!d)return this}return r||s?(r.lng=Math.min(c.lng,r.lng),r.lat=Math.min(c.lat,r.lat),s.lng=Math.max(d.lng,s.lng),s.lat=Math.max(d.lat,s.lat)):(this._sw=new vr(c.lng,c.lat),this._ne=new vr(d.lng,d.lat)),this}getCenter(){return new vr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new vr(this.getWest(),this.getNorth())}getSouthEast(){return new vr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:r,lat:s}=vr.convert(e);let c=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&c}static convert(e){return!e||e instanceof wa?e:new wa(e)}}const $o=6371008.8;class vr{constructor(e,r){if(isNaN(e)||isNaN(r))throw new Error(`Invalid LngLat object: (${e}, ${r})`);if(this.lng=+e,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new vr(Kr(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const r=Math.PI/180,s=this.lat*r,c=e.lat*r,d=Math.sin(s)*Math.sin(c)+Math.cos(s)*Math.cos(c)*Math.cos((e.lng-this.lng)*r);return $o*Math.acos(Math.min(d,1))}toBounds(e=0){const r=360*e/40075017,s=r/Math.cos(Math.PI/180*this.lat);return new wa(new vr(this.lng-s,this.lat-r),new vr(this.lng+s,this.lat+r))}static convert(e){if(e instanceof vr)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new vr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new vr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const xd=2*Math.PI*$o;function bd(t){return xd*Math.cos(t*Math.PI/180)}function Vi(t){return(180+t)/360}function qa(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function $s(t,e){return t/bd(e)}function wl(t){return 360*t-180}function ra(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function wd(t,e){return t*bd(ra(e))}const Wa=85.051129;class Lu{constructor(e,r,s=0){this.x=+e,this.y=+r,this.z=+s}static fromLngLat(e,r=0){const s=vr.convert(e);return new Lu(Vi(s.lng),qa(s.lat),$s(r,s.lat))}toLngLat(){return new vr(wl(this.x),ra(this.y))}toAltitude(){return wd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/xd*(e=ra(this.y),1/Math.cos(e*Math.PI/180));var e}}function Ed(t,e,r,s,c,d,m,y,b){const E=(e+s)/2,I=(r+c)/2,P=new et(E,I);y(P),function(R,j,H,Q,ne,ce){const ye=H-ne,De=Q-ce;return Math.abs((Q-j)*ye-(H-R)*De)/Math.hypot(ye,De)}(P.x,P.y,d.x,d.y,m.x,m.y)>=b?(Ed(t,e,r,E,I,d,P,y,b),Ed(t,E,I,s,c,P,m,y,b)):t.push(m)}function cp(t,e,r){const s=[];let c,d,m;for(const y of t){const{x:b,y:E}=y;e(y),m?Ed(s,c,d,b,E,m,y,e,r):s.push(y),c=b,d=E,m=y}return s}const Td=Math.pow(2,14)-1,up=-Td-1;function Dd(t,e){const r=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=Pn(r,up,Td),t.y=Pn(s,up,Td),(r<t.x||r>t.x+1||s<t.y||s>t.y+1)&&Hn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function El(t,e,r){const s=t.loadGeometry(),c=t.extent,d=Wn/c;if(e&&r&&r.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:y,x:b,y:E,projection:I}=r,P=R=>{const j=wl((e.x+R.x/c)/m),H=ra((e.y+R.y/c)/m),Q=I.project(j,H);R.x=(Q.x*y-b)*c,R.y=(Q.y*y-E)*c};for(let R=0;R<s.length;R++)if(1!==t.type)s[R]=cp(s[R],P,1);else{const j=[];for(const H of s[R])H.x<0||H.x>=c||H.y<0||H.y>=c||(P(H),j.push(H));s[R]=j}}for(const m of s)for(const y of m)Dd(y,d);return s}function Sc(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?El(t):[]}}function eu(t,e,r,s,c){t.emplaceBack(2*e+(s+1)/2,2*r+(c+1)/2)}class Cd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Hc,this.indexArray=new vs,this.segments=new Li,this.programConfigurations=new ai(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,c){const d=this.layers[0],m=[];let y=null;"circle"===d.type&&(y=d.layout.get("circle-sort-key"));for(const{feature:b,id:E,index:I,sourceLayerIndex:P}of e){const R=this.layers[0]._featureFilter.needGeometry,j=Sc(b,R);if(!this.layers[0]._featureFilter.filter(new wn(this.zoom),j,s))continue;const H=y?y.evaluate(j,{},s):void 0,Q={id:E,properties:b.properties,type:b.type,sourceLayerIndex:P,index:I,geometry:R?j.geometry:El(b,s,c),patterns:{},sortKey:H};m.push(Q)}y&&m.sort((b,E)=>b.sortKey-E.sortKey);for(const b of m){const{geometry:E,index:I,sourceLayerIndex:P}=b,R=e[I].feature;this.addFeature(b,E,I,r.availableImages,s),r.featureIndex.insert(R,E,I,P,this.index)}}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Xm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,c,d){for(const m of r)for(const y of m){const b=y.x,E=y.y;if(b<0||b>=Wn||E<0||E>=Wn)continue;const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),P=I.vertexLength;eu(this.layoutVertexArray,b,E,-1,-1),eu(this.layoutVertexArray,b,E,1,-1),eu(this.layoutVertexArray,b,E,1,1),eu(this.layoutVertexArray,b,E,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+3,P+2),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},c,d)}}function hp(t,e){for(let r=0;r<t.length;r++)if(tu(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(tu(t,e[r]))return!0;return!!Sd(t,e)}function bh(t,e,r){return!!tu(t,e)||!!Md(e,t,r)}function dp(t,e){if(1===t.length)return fp(e,t[0]);for(let r=0;r<e.length;r++){const s=e[r];for(let c=0;c<s.length;c++)if(tu(t,s[c]))return!0}for(let r=0;r<t.length;r++)if(fp(e,t[r]))return!0;for(let r=0;r<e.length;r++)if(Sd(t,e[r]))return!0;return!1}function Ym(t,e,r){if(t.length>1){if(Sd(t,e))return!0;for(let s=0;s<e.length;s++)if(Md(e[s],t,r))return!0}for(let s=0;s<t.length;s++)if(Md(t[s],e,r))return!0;return!1}function Sd(t,e){if(0===t.length||0===e.length)return!1;for(let r=0;r<t.length-1;r++){const s=t[r],c=t[r+1];for(let d=0;d<e.length-1;d++)if(Km(s,c,e[d],e[d+1]))return!0}return!1}function Km(t,e,r,s){return po(t,r,s)!==po(e,r,s)&&po(t,e,r)!==po(t,e,s)}function Md(t,e,r){const s=r*r;if(1===e.length)return t.distSqr(e[0])<s;for(let c=1;c<e.length;c++)if(Id(t,e[c-1],e[c])<s)return!0;return!1}function Id(t,e,r){const s=e.distSqr(r);if(0===s)return t.distSqr(e);const c=((t.x-e.x)*(r.x-e.x)+(t.y-e.y)*(r.y-e.y))/s;return t.distSqr(c<0?e:c>1?r:r.sub(e)._mult(c)._add(e))}function fp(t,e){let r,s,c,d=!1;for(let m=0;m<t.length;m++){r=t[m];for(let y=0,b=r.length-1;y<r.length;b=y++)s=r[y],c=r[b],s.y>e.y!=c.y>e.y&&e.x<(c.x-s.x)*(e.y-s.y)/(c.y-s.y)+s.x&&(d=!d)}return d}function tu(t,e){let r=!1;for(let s=0,c=t.length-1;s<t.length;c=s++){const d=t[s],m=t[c];d.y>e.y!=m.y>e.y&&e.x<(m.x-d.x)*(e.y-d.y)/(m.y-d.y)+d.x&&(r=!r)}return r}function pp(t,e,r,s,c){for(const m of t)if(e<=m.x&&r<=m.y&&s>=m.x&&c>=m.y)return!0;const d=[new et(e,r),new et(e,c),new et(s,c),new et(s,r)];if(t.length>2)for(const m of d)if(tu(t,m))return!0;for(let m=0;m<t.length-1;m++)if(Qm(t[m],t[m+1],d))return!0;return!1}function Qm(t,e,r){const s=r[0],c=r[2];if(t.x<s.x&&e.x<s.x||t.x>c.x&&e.x>c.x||t.y<s.y&&e.y<s.y||t.y>c.y&&e.y>c.y)return!1;const d=po(t,e,r[0]);return d!==po(t,e,r[1])||d!==po(t,e,r[2])||d!==po(t,e,r[3])}function nu(t,e,r){const s=e.paint.get(t).value;return"constant"===s.kind?s.value:r.programConfigurations.get(e.id).getMaxValue(t)}function wh(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function mp(t,e,r,s,c){if(!e[0]&&!e[1])return t;const d=et.convert(e)._mult(c);"viewport"===r&&d._rotate(-s);const m=[];for(let y=0;y<t.length;y++)m.push(t[y].sub(d));return m}function gp(t,e,r,s){const c=et.convert(t)._mult(s);return"viewport"===e&&c._rotate(-r),c}jt("CircleBucket",Cd,{omit:["layers"]});const ru=new Ei({"circle-sort-key":new sn(We.layout_circle["circle-sort-key"])});var Xa={paint:new Ei({"circle-radius":new sn(We.paint_circle["circle-radius"]),"circle-color":new sn(We.paint_circle["circle-color"]),"circle-blur":new sn(We.paint_circle["circle-blur"]),"circle-opacity":new sn(We.paint_circle["circle-opacity"]),"circle-translate":new $t(We.paint_circle["circle-translate"]),"circle-translate-anchor":new $t(We.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new $t(We.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new $t(We.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new sn(We.paint_circle["circle-stroke-width"]),"circle-stroke-color":new sn(We.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new sn(We.paint_circle["circle-stroke-opacity"])}),layout:ru};class _p{constructor(e,r){this.points=e,this.planes=r}static fromInvProjectionMatrix(e,r,s,c){const d=Math.pow(2,s),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(b=>{const E=vi([],b,e),I=1/E[3]/r*d;return(P=E)[0]=(R=E)[0]*(j=[I,I,c?1/E[3]:I,I])[0],P[1]=R[1]*j[1],P[2]=R[2]*j[2],P[3]=R[3]*j[3],P;var P,R,j}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(b=>{const E=_t([],En([],$r([],m[b[0]],m[b[1]]),$r([],m[b[2]],m[b[1]]))),I=-Ve(E,m[b[1]]);return E.concat(I)});return new _p(m,y)}}class Ya{constructor(e,r){this.min=e,this.max=r,this.center=He([],tn([],this.min,this.max),.5)}quadrant(e){const r=[e%2==0,e<2],s=Dt(this.min),c=Dt(this.max);for(let d=0;d<r.length;d++)s[d]=r[d]?this.min[d]:this.center[d],c[d]=r[d]?this.center[d]:this.max[d];return c[2]=this.max[2],new Ya(s,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,r=this.max;return[[e[0],e[1],e[2]],[r[0],e[1],e[2]],[r[0],r[1],e[2]],[e[0],r[1],e[2]],[e[0],e[1],r[2]],[r[0],e[1],r[2]],[r[0],r[1],r[2]],[e[0],r[1],r[2]]]}intersects(e){const r=this.getCorners();let s=!0;for(let c=0;c<e.planes.length;c++){const d=e.planes[c];let m=0;for(let y=0;y<r.length;y++)m+=Ve(d,r[y])+d[3]>=0;if(0===m)return 0;m!==r.length&&(s=!1)}if(s)return 2;for(let c=0;c<3;c++){let d=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let y=0;y<e.points.length;y++){const b=e.points[y][c]-this.min[c];d=Math.min(d,b),m=Math.max(m,b)}if(m<0||d>this.max[c]-this.min[c])return 0}return 1}}function Ad(t,e,r,s,c,d,m,y,b){if(d&&t.queryGeometry.isAboveHorizon)return!1;d&&(b*=t.pixelToTileUnitsFactor);for(const E of e)for(const I of E){const P=I.add(y),R=c&&r.elevation?r.elevation.exaggeration()*c.getElevationAt(P.x,P.y,!0):0,j=d?P:N_(P,R,s),H=d?t.tilespaceRays.map(ne=>kd(ne,R)):t.queryGeometry.screenGeometry,Q=vi([],[I.x,I.y,R,1],s);if(!m&&d?b*=Q[3]/r.cameraToCenterDistance:m&&!d&&(b*=r.cameraToCenterDistance/Q[3]),bh(H,j,b))return!0}return!1}function N_(t,e,r){const s=vi([],[t.x,t.y,e,1],r);return new et(s[0]/s[3],s[1]/s[3])}const Ea=Wt(0,0,0),Pd=Wt(0,0,1);function kd(t,e){const r=ut();return Ea[2]=e,t.intersectsPlane(Ea,Pd,r),new et(r[0],r[1])}class yp extends Cd{}function Eh(t,{width:e,height:r},s,c){if(c){if(c instanceof Uint8ClampedArray)c=new Uint8Array(c.buffer);else if(c.length!==e*r*s)throw new RangeError("mismatched image size")}else c=new Uint8Array(e*r*s);return t.width=e,t.height=r,t.data=c,t}function iu(t,{width:e,height:r},s){if(e===t.width&&r===t.height)return;const c=Eh({},{width:e,height:r},s);Th(t,c,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,r)},s),t.width=e,t.height=r,t.data=c.data}function Th(t,e,r,s,c,d){if(0===c.width||0===c.height)return e;if(c.width>t.width||c.height>t.height||r.x>t.width-c.width||r.y>t.height-c.height)throw new RangeError("out of range source coordinates for image copy");if(c.width>e.width||c.height>e.height||s.x>e.width-c.width||s.y>e.height-c.height)throw new RangeError("out of range destination coordinates for image copy");const m=t.data,y=e.data;for(let b=0;b<c.height;b++){const E=((r.y+b)*t.width+r.x)*d,I=((s.y+b)*e.width+s.x)*d;for(let P=0;P<c.width*d;P++)y[I+P]=m[E+P]}return e}jt("HeatmapBucket",yp,{omit:["layers"]});class Tl{constructor(e,r){Eh(this,e,1,r)}resize(e){iu(this,e,1)}clone(){return new Tl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,d){Th(e,r,s,c,d,1)}}class ss{constructor(e,r){Eh(this,e,4,r)}resize(e){iu(this,e,4)}replace(e,r){r?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ss({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,r,s,c,d){Th(e,r,s,c,d,4)}}jt("AlphaImage",Tl),jt("RGBAImage",ss);var Rd={paint:new Ei({"heatmap-radius":new sn(We.paint_heatmap["heatmap-radius"]),"heatmap-weight":new sn(We.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new $t(We.paint_heatmap["heatmap-intensity"]),"heatmap-color":new is(We.paint_heatmap["heatmap-color"]),"heatmap-opacity":new $t(We.paint_heatmap["heatmap-opacity"])})};function Dh(t){const e={},r=t.resolution||256,s=t.clips?t.clips.length:1,c=t.image||new ss({width:r,height:s}),d=(m,y,b)=>{e[t.evaluationKey]=b;const E=t.expression.evaluate(e);c.data[m+y+0]=Math.floor(255*E.r/E.a),c.data[m+y+1]=Math.floor(255*E.g/E.a),c.data[m+y+2]=Math.floor(255*E.b/E.a),c.data[m+y+3]=Math.floor(255*E.a)};if(t.clips)for(let m=0,y=0;m<s;++m,y+=4*r)for(let b=0,E=0;b<r;b++,E+=4){const I=b/(r-1),{start:P,end:R}=t.clips[m];d(y,E,P*(1-I)+R*I)}else for(let m=0,y=0;m<r;m++,y+=4)d(0,y,m/(r-1));return c}var U_={paint:new Ei({"hillshade-illumination-direction":new $t(We.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new $t(We.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new $t(We.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new $t(We.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new $t(We.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new $t(We.paint_hillshade["hillshade-accent-color"])})};const ou=hi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ld}=ou;var Fu=su,Jm=su;function su(t,e,r){r=r||2;var s,c,d,m,y,b,E,I=e&&e.length,P=I?e[0]*r:t.length,R=vp(t,0,P,r,!0),j=[];if(!R||R.next===R.prev)return j;if(I&&(R=function(Q,ne,ce,ye){var De,Ae,ke,Re=[];for(De=0,Ae=ne.length;De<Ae;De++)(ke=vp(Q,ne[De]*ye,De<Ae-1?ne[De+1]*ye:Q.length,ye,!1))===ke.next&&(ke.steiner=!0),Re.push(rg(ke));for(Re.sort(Fd),De=0;De<Re.length;De++)ce=Kl(ce=bp(Re[De],ce),ce.next);return ce}(t,e,R,r)),t.length>80*r){s=d=t[0],c=m=t[1];for(var H=r;H<P;H+=r)(y=t[H])<s&&(s=y),(b=t[H+1])<c&&(c=b),y>d&&(d=y),b>m&&(m=b);E=0!==(E=Math.max(d-s,m-c))?1/E:0}return Ou(R,j,r,s,c,E),j}function vp(t,e,r,s,c){var d,m;if(c===Sh(t,e,r,s)>0)for(d=e;d<r;d+=s)m=Ud(d,t[d],t[d+1],m);else for(d=r-s;d>=e;d-=s)m=Ud(d,t[d],t[d+1],m);return m&&zu(m,m.next)&&(au(m),m=m.next),m}function Kl(t,e){if(!t)return t;e||(e=t);var r,s=t;do{if(r=!1,s.steiner||!zu(s,s.next)&&0!==jr(s.prev,s,s.next))s=s.next;else{if(au(s),(s=e=s.prev)===s.next)break;r=!0}}while(r||s!==e);return e}function Ou(t,e,r,s,c,d,m){if(t){!m&&d&&function(I,P,R,j){var H=I;do{null===H.z&&(H.z=zd(H.x,H.y,P,R,j)),H.prevZ=H.prev,H.nextZ=H.next,H=H.next}while(H!==I);H.prevZ.nextZ=null,H.prevZ=null,function(Q){var ne,ce,ye,De,Ae,ke,Re,rt,Je=1;do{for(ce=Q,Q=null,Ae=null,ke=0;ce;){for(ke++,ye=ce,Re=0,ne=0;ne<Je&&(Re++,ye=ye.nextZ);ne++);for(rt=Je;Re>0||rt>0&&ye;)0!==Re&&(0===rt||!ye||ce.z<=ye.z)?(De=ce,ce=ce.nextZ,Re--):(De=ye,ye=ye.nextZ,rt--),Ae?Ae.nextZ=De:Q=De,De.prevZ=Ae,Ae=De;ce=ye}Ae.nextZ=null,Je*=2}while(ke>1)}(H)}(t,s,c,d);for(var y,b,E=t;t.prev!==t.next;)if(y=t.prev,b=t.next,d?tg(t,s,c,d):eg(t))e.push(y.i/r),e.push(t.i/r),e.push(b.i/r),au(t),t=b.next,E=b.next;else if((t=b)===E){m?1===m?Ou(t=ng(Kl(t),e,r),e,r,s,c,d,2):2===m&&xp(t,e,r,s,c,d):Ou(Kl(t),e,r,s,c,d,1);break}}}function eg(t){var e=t.prev,r=t,s=t.next;if(jr(e,r,s)>=0)return!1;for(var c=t.next.next;c!==t.prev;){if(Mc(e.x,e.y,r.x,r.y,s.x,s.y,c.x,c.y)&&jr(c.prev,c,c.next)>=0)return!1;c=c.next}return!0}function tg(t,e,r,s){var c=t.prev,d=t,m=t.next;if(jr(c,d,m)>=0)return!1;for(var y=c.x>d.x?c.x>m.x?c.x:m.x:d.x>m.x?d.x:m.x,b=c.y>d.y?c.y>m.y?c.y:m.y:d.y>m.y?d.y:m.y,E=zd(c.x<d.x?c.x<m.x?c.x:m.x:d.x<m.x?d.x:m.x,c.y<d.y?c.y<m.y?c.y:m.y:d.y<m.y?d.y:m.y,e,r,s),I=zd(y,b,e,r,s),P=t.prevZ,R=t.nextZ;P&&P.z>=E&&R&&R.z<=I;){if(P!==t.prev&&P!==t.next&&Mc(c.x,c.y,d.x,d.y,m.x,m.y,P.x,P.y)&&jr(P.prev,P,P.next)>=0||(P=P.prevZ,R!==t.prev&&R!==t.next&&Mc(c.x,c.y,d.x,d.y,m.x,m.y,R.x,R.y)&&jr(R.prev,R,R.next)>=0))return!1;R=R.nextZ}for(;P&&P.z>=E;){if(P!==t.prev&&P!==t.next&&Mc(c.x,c.y,d.x,d.y,m.x,m.y,P.x,P.y)&&jr(P.prev,P,P.next)>=0)return!1;P=P.prevZ}for(;R&&R.z<=I;){if(R!==t.prev&&R!==t.next&&Mc(c.x,c.y,d.x,d.y,m.x,m.y,R.x,R.y)&&jr(R.prev,R,R.next)>=0)return!1;R=R.nextZ}return!0}function ng(t,e,r){var s=t;do{var c=s.prev,d=s.next.next;!zu(c,d)&&Bd(c,s,s.next,d)&&Bu(c,d)&&Bu(d,c)&&(e.push(c.i/r),e.push(s.i/r),e.push(d.i/r),au(s),au(s.next),s=t=d),s=s.next}while(s!==t);return Kl(s)}function xp(t,e,r,s,c,d){var m=t;do{for(var y=m.next.next;y!==m.prev;){if(m.i!==y.i&&wp(m,y)){var b=Nd(m,y);return m=Kl(m,m.next),b=Kl(b,b.next),Ou(m,e,r,s,c,d),void Ou(b,e,r,s,c,d)}y=y.next}m=m.next}while(m!==t)}function Fd(t,e){return t.x-e.x}function bp(t,e){var r=function(d,m){var y,b=m,E=d.x,I=d.y,P=-1/0;do{if(I<=b.y&&I>=b.next.y&&b.next.y!==b.y){var R=b.x+(I-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(R<=E&&R>P){if(P=R,R===E){if(I===b.y)return b;if(I===b.next.y)return b.next}y=b.x<b.next.x?b:b.next}}b=b.next}while(b!==m);if(!y)return null;if(E===P)return y;var j,H=y,Q=y.x,ne=y.y,ce=1/0;b=y;do{E>=b.x&&b.x>=Q&&E!==b.x&&Mc(I<ne?E:P,I,Q,ne,I<ne?P:E,I,b.x,b.y)&&(j=Math.abs(I-b.y)/(E-b.x),Bu(b,d)&&(j<ce||j===ce&&(b.x>y.x||b.x===y.x&&Od(y,b)))&&(y=b,ce=j)),b=b.next}while(b!==H);return y}(t,e);if(!r)return e;var s=Nd(r,t),c=Kl(r,r.next);return Kl(s,s.next),e===r?c:e}function Od(t,e){return jr(t.prev,t,e.prev)<0&&jr(e.next,t,t.next)<0}function zd(t,e,r,s,c){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*c)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*c)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function rg(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function Mc(t,e,r,s,c,d,m,y){return(c-m)*(e-y)-(t-m)*(d-y)>=0&&(t-m)*(s-y)-(r-m)*(e-y)>=0&&(r-m)*(d-y)-(c-m)*(s-y)>=0}function wp(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(r,s){var c=r;do{if(c.i!==r.i&&c.next.i!==r.i&&c.i!==s.i&&c.next.i!==s.i&&Bd(c,c.next,r,s))return!0;c=c.next}while(c!==r);return!1}(t,e)&&(Bu(t,e)&&Bu(e,t)&&function(r,s){var c=r,d=!1,m=(r.x+s.x)/2,y=(r.y+s.y)/2;do{c.y>y!=c.next.y>y&&c.next.y!==c.y&&m<(c.next.x-c.x)*(y-c.y)/(c.next.y-c.y)+c.x&&(d=!d),c=c.next}while(c!==r);return d}(t,e)&&(jr(t.prev,t,e.prev)||jr(t,e.prev,e))||zu(t,e)&&jr(t.prev,t,t.next)>0&&jr(e.prev,e,e.next)>0)}function jr(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function zu(t,e){return t.x===e.x&&t.y===e.y}function Bd(t,e,r,s){var c=Ic(jr(t,e,r)),d=Ic(jr(t,e,s)),m=Ic(jr(r,s,t)),y=Ic(jr(r,s,e));return c!==d&&m!==y||!(0!==c||!Ch(t,r,e))||!(0!==d||!Ch(t,s,e))||!(0!==m||!Ch(r,t,s))||!(0!==y||!Ch(r,e,s))}function Ch(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Ic(t){return t>0?1:t<0?-1:0}function Bu(t,e){return jr(t.prev,t,t.next)<0?jr(t,e,t.next)>=0&&jr(t,t.prev,e)>=0:jr(t,e,t.prev)<0||jr(t,t.next,e)<0}function Nd(t,e){var r=new Nu(t.i,t.x,t.y),s=new Nu(e.i,e.x,e.y),c=t.next,d=e.prev;return t.next=e,e.prev=t,r.next=c,c.prev=r,s.next=r,r.prev=s,d.next=s,s.prev=d,s}function Ud(t,e,r,s){var c=new Nu(t,e,r);return s?(c.next=s.next,c.prev=s,s.next.prev=c,s.next=c):(c.prev=c,c.next=c),c}function au(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Nu(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Sh(t,e,r,s){for(var c=0,d=e,m=r-s;d<r;d+=s)c+=(t[m]-t[d])*(t[d+1]+t[m+1]),m=d;return c}function Mh(t,e,r,s,c){Uu(t,e,r||0,s||t.length-1,c||Vd)}function Uu(t,e,r,s,c){for(;s>r;){if(s-r>600){var d=s-r+1,m=e-r+1,y=Math.log(d),b=.5*Math.exp(2*y/3),E=.5*Math.sqrt(y*b*(d-b)/d)*(m-d/2<0?-1:1);Uu(t,e,Math.max(r,Math.floor(e-m*b/d+E)),Math.min(s,Math.floor(e+(d-m)*b/d+E)),c)}var I=t[e],P=r,R=s;for(lu(t,r,e),c(t[s],I)>0&&lu(t,r,s);P<R;){for(lu(t,P,R),P++,R--;c(t[P],I)<0;)P++;for(;c(t[R],I)>0;)R--}0===c(t[r],I)?lu(t,r,R):lu(t,++R,s),R<=e&&(r=R+1),e<=R&&(s=R-1)}}function lu(t,e,r){var s=t[e];t[e]=t[r],t[r]=s}function Vd(t,e){return t<e?-1:t>e?1:0}function Ih(t,e){const r=t.length;if(r<=1)return[t];const s=[];let c,d;for(let m=0;m<r;m++){const y=Zn(t[m]);0!==y&&(t[m].area=Math.abs(y),void 0===d&&(d=y<0),d===y<0?(c&&s.push(c),c=[t[m]]):c.push(t[m]))}if(c&&s.push(c),e>1)for(let m=0;m<s.length;m++)s[m].length<=e||(Mh(s[m],e,1,s[m].length-1,jd),s[m]=s[m].slice(0,e));return s}function jd(t,e){return e.area-t.area}function Ac(t,e,r){const s=r.patternDependencies;let c=!1;for(const d of e){const m=d.paint.get(`${t}-pattern`);m.isConstant()||(c=!0);const y=m.constantOr(null);y&&(c=!0,s[y.to]=!0,s[y.from]=!0)}return c}function $d(t,e,r,s,c){const d=c.patternDependencies;for(const m of e){const y=m.paint.get(`${t}-pattern`).value;if("constant"!==y.kind){let b=y.evaluate({zoom:s-1},r,{},c.availableImages),E=y.evaluate({zoom:s},r,{},c.availableImages),I=y.evaluate({zoom:s+1},r,{},c.availableImages);b=b&&b.name?b.name:b,E=E&&E.name?E.name:E,I=I&&I.name?I.name:I,d[b]=!0,d[E]=!0,d[I]=!0,r.patterns[m.id]={min:b,mid:E,max:I}}}return r}su.deviation=function(t,e,r,s){var c=e&&e.length,d=Math.abs(Sh(t,0,c?e[0]*r:t.length,r));if(c)for(var m=0,y=e.length;m<y;m++)d-=Math.abs(Sh(t,e[m]*r,m<y-1?e[m+1]*r:t.length,r));var b=0;for(m=0;m<s.length;m+=3){var E=s[m]*r,I=s[m+1]*r,P=s[m+2]*r;b+=Math.abs((t[E]-t[P])*(t[I+1]-t[E+1])-(t[E]-t[I])*(t[P+1]-t[E+1]))}return 0===d&&0===b?0:Math.abs((b-d)/d)},su.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},s=0,c=0;c<t.length;c++){for(var d=0;d<t[c].length;d++)for(var m=0;m<e;m++)r.vertices.push(t[c][d][m]);c>0&&r.holes.push(s+=t[c-1].length)}return r},Fu.default=Jm;class Vu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Hc,this.indexArray=new vs,this.indexArray2=new os,this.programConfigurations=new ai(e.layers,e.zoom),this.segments=new Li,this.segments2=new Li,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,c){this.hasPattern=Ac("fill",this.layers,r);const d=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:y,id:b,index:E,sourceLayerIndex:I}of e){const P=this.layers[0]._featureFilter.needGeometry,R=Sc(y,P);if(!this.layers[0]._featureFilter.filter(new wn(this.zoom),R,s))continue;const j=d?d.evaluate(R,{},s,r.availableImages):void 0,H={id:b,properties:y.properties,type:y.type,sourceLayerIndex:I,index:E,geometry:P?R.geometry:El(y,s,c),patterns:{},sortKey:j};m.push(H)}d&&m.sort((y,b)=>y.sortKey-b.sortKey);for(const y of m){const{geometry:b,index:E,sourceLayerIndex:I}=y;if(this.hasPattern){const P=$d("fill",this.layers,y,this.zoom,r);this.patternFeatures.push(P)}else this.addFeature(y,b,E,s,{},r.availableImages);r.featureIndex.insert(e[E].feature,b,E,I,this.index)}}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}addFeatures(e,r,s,c){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ld),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,r,s,c,d,m=[]){for(const y of Ih(r,500)){let b=0;for(const H of y)b+=H.length;const E=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray),I=E.vertexLength,P=[],R=[];for(const H of y){if(0===H.length)continue;H!==y[0]&&R.push(P.length/2);const Q=this.segments2.prepareSegment(H.length,this.layoutVertexArray,this.indexArray2),ne=Q.vertexLength;this.layoutVertexArray.emplaceBack(H[0].x,H[0].y),this.indexArray2.emplaceBack(ne+H.length-1,ne),P.push(H[0].x),P.push(H[0].y);for(let ce=1;ce<H.length;ce++)this.layoutVertexArray.emplaceBack(H[ce].x,H[ce].y),this.indexArray2.emplaceBack(ne+ce-1,ne+ce),P.push(H[ce].x),P.push(H[ce].y);Q.vertexLength+=H.length,Q.primitiveLength+=H.length}const j=Fu(P,R);for(let H=0;H<j.length;H+=3)this.indexArray.emplaceBack(I+j[H],I+j[H+1],I+j[H+2]);E.vertexLength+=b,E.primitiveLength+=j.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,m,c)}}jt("FillBucket",Vu,{omit:["layers","patternFeatures"]});const ig=new Ei({"fill-sort-key":new sn(We.layout_fill["fill-sort-key"])});var og={paint:new Ei({"fill-antialias":new $t(We.paint_fill["fill-antialias"]),"fill-opacity":new sn(We.paint_fill["fill-opacity"]),"fill-color":new sn(We.paint_fill["fill-color"]),"fill-outline-color":new sn(We.paint_fill["fill-outline-color"]),"fill-translate":new $t(We.paint_fill["fill-translate"]),"fill-translate-anchor":new $t(We.paint_fill["fill-translate-anchor"]),"fill-pattern":new Yi(We.paint_fill["fill-pattern"])}),layout:ig};const Ep=hi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Gd=hi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),{members:Tp}=Ep;var sg=Pc;function Pc(t,e,r,s,c){this.properties={},this.extent=r,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=c,t.readFields(ag,this,e)}function ag(t,e,r){1==t?e.id=r.readVarint():2==t?function(s,c){for(var d=s.readVarint()+s.pos;s.pos<d;){var m=c._keys[s.readVarint()],y=c._values[s.readVarint()];c.properties[m]=y}}(r,e):3==t?e.type=r.readVarint():4==t&&(e._geometry=r.pos)}function Dp(t){for(var e,r,s=0,c=0,d=t.length,m=d-1;c<d;m=c++)s+=((r=t[m]).x-(e=t[c]).x)*(e.y+r.y);return s}Pc.types=["Unknown","Point","LineString","Polygon"],Pc.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,r=t.readVarint()+t.pos,s=1,c=0,d=0,m=0,y=[];t.pos<r;){if(c<=0){var b=t.readVarint();s=7&b,c=b>>3}if(c--,1===s||2===s)d+=t.readSVarint(),m+=t.readSVarint(),1===s&&(e&&y.push(e),e=[]),e.push(new et(d,m));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&y.push(e),y},Pc.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,r=1,s=0,c=0,d=0,m=1/0,y=-1/0,b=1/0,E=-1/0;t.pos<e;){if(s<=0){var I=t.readVarint();r=7&I,s=I>>3}if(s--,1===r||2===r)(c+=t.readSVarint())<m&&(m=c),c>y&&(y=c),(d+=t.readSVarint())<b&&(b=d),d>E&&(E=d);else if(7!==r)throw new Error("unknown command "+r)}return[m,b,y,E]},Pc.prototype.toGeoJSON=function(t,e,r){var s,c,d=this.extent*Math.pow(2,r),m=this.extent*t,y=this.extent*e,b=this.loadGeometry(),E=Pc.types[this.type];function I(j){for(var H=0;H<j.length;H++){var Q=j[H];j[H]=[360*(Q.x+m)/d-180,360/Math.PI*Math.atan(Math.exp((180-360*(Q.y+y)/d)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(s=0;s<b.length;s++)P[s]=b[s][0];I(b=P);break;case 2:for(s=0;s<b.length;s++)I(b[s]);break;case 3:for(b=function(j){var H=j.length;if(H<=1)return[j];for(var Q,ne,ce=[],ye=0;ye<H;ye++){var De=Dp(j[ye]);0!==De&&(void 0===ne&&(ne=De<0),ne===De<0?(Q&&ce.push(Q),Q=[j[ye]]):Q.push(j[ye]))}return Q&&ce.push(Q),ce}(b),s=0;s<b.length;s++)for(c=0;c<b[s].length;c++)I(b[s][c])}1===b.length?b=b[0]:E="Multi"+E;var R={type:"Feature",geometry:{type:E,coordinates:b},properties:this.properties};return"id"in this&&(R.id=this.id),R};var Cp=Sp;function Sp(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ta,this,e),this.length=this._features.length}function Ta(t,e,r){15===t?e.version=r.readVarint():1===t?e.name=r.readString():5===t?e.extent=r.readVarint():2===t?e._features.push(r.pos):3===t?e._keys.push(r.readString()):4===t&&e._values.push(function(s){for(var c=null,d=s.readVarint()+s.pos;s.pos<d;){var m=s.readVarint()>>3;c=1===m?s.readString():2===m?s.readFloat():3===m?s.readDouble():4===m?s.readVarint64():5===m?s.readVarint():6===m?s.readSVarint():7===m?s.readBoolean():null}return c}(r))}function lg(t,e,r){if(3===t){var s=new Cp(r,r.readVarint()+r.pos);s.length&&(e[s.name]=s)}}Sp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new sg(this._pbf,e,this.extent,this._keys,this._values)};var Ql={VectorTile:function(t,e){this.layers=t.readFields(lg,{},e)},VectorTileFeature:sg,VectorTileLayer:Cp};const cg=Ql.VectorTileFeature.types,ug=Math.pow(2,13);function ju(t,e,r,s,c,d,m,y){t.emplaceBack((e<<1)+m,(r<<1)+d,(Math.floor(s*ug)<<1)+c,Math.round(y))}class Mp{constructor(){this.acc=new et(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new et(e.x,e.y),this.max=new et(e.x,e.y))}append(e,r){this.currentPolyCount.edges++,this.acc._add(e);let s=!!this.borders;const c=this.min,d=this.max;e.x<c.x?(c.x=e.x,s=!0):e.x>d.x&&(d.x=e.x,s=!0),e.y<c.y?(c.y=e.y,s=!0):e.y>d.y&&(d.y=e.y,s=!0),((0===e.x||e.x===Wn)&&e.x===r.x)!=((0===e.y||e.y===Wn)&&e.y===r.y)&&this.processBorderOverlap(e,r),s&&this.checkBorderIntersection(e,r)}checkBorderIntersection(e,r){r.x<0!=e.x<0&&this.addBorderIntersection(0,or(r.y,e.y,(0-r.x)/(e.x-r.x))),r.x>Wn!=e.x>Wn&&this.addBorderIntersection(1,or(r.y,e.y,(Wn-r.x)/(e.x-r.x))),r.y<0!=e.y<0&&this.addBorderIntersection(2,or(r.x,e.x,(0-r.y)/(e.y-r.y))),r.y>Wn!=e.y>Wn&&this.addBorderIntersection(3,or(r.x,e.x,(Wn-r.y)/(e.y-r.y)))}addBorderIntersection(e,r){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];r<s[0]&&(s[0]=r),r>s[1]&&(s[1]=r)}processBorderOverlap(e,r){if(e.x===r.x){if(e.y===r.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,r.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,r.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((r,s)=>r+s.edges,0);return 0!==e?this.acc.div(e)._round():new et(0,0)}span(){return new et(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,r)=>e+ +(r[0]!==Number.MAX_VALUE),0)}}class Ah{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Zc,this.centroidVertexArray=new ku,this.indexArray=new vs,this.programConfigurations=new ai(e.layers,e.zoom),this.segments=new Li,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id),this.enableTerrain=e.enableTerrain}populate(e,r,s,c){this.features=[],this.hasPattern=Ac("fill-extrusion",this.layers,r),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(d){const m=Math.exp(Math.PI*(1-d.y/(1<<d.z)*2));return 80150034*m/(m*m+1)/Wn/(1<<d.z)}(s);for(const{feature:d,id:m,index:y,sourceLayerIndex:b}of e){const E=this.layers[0]._featureFilter.needGeometry,I=Sc(d,E);if(!this.layers[0]._featureFilter.filter(new wn(this.zoom),I,s))continue;const P={id:m,sourceLayerIndex:b,index:y,geometry:E?I.geometry:El(d,s,c),properties:d.properties,type:d.type,patterns:{}},R=this.layoutVertexArray.length;this.hasPattern?this.features.push($d("fill-extrusion",this.layers,P,this.zoom,r)):this.addFeature(P,P.geometry,y,s,{},r.availableImages),r.featureIndex.insert(d,P.geometry,y,b,this.index,R)}this.sortBorders()}addFeatures(e,r,s,c){for(const d of this.features){const{geometry:m}=d;this.addFeature(d,m,d.index,r,s,c)}this.sortBorders()}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Tp),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Gd.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,r,s,c,d,m){const y=this.enableTerrain?new Mp:null;for(const E of Ih(r,500)){let I=0,P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(0===E.length||(b=E[0]).every(ne=>ne.x<=0)||b.every(ne=>ne.x>=Wn)||b.every(ne=>ne.y<=0)||b.every(ne=>ne.y>=Wn))continue;for(let ne=0;ne<E.length;ne++){const ce=E[ne];if(0===ce.length)continue;I+=ce.length;let ye=0;y&&y.startRing(ce[0]);for(let De=0;De<ce.length;De++){const Ae=ce[De];if(De>=1){const ke=ce[De-1];if(!hg(Ae,ke)){y&&y.append(Ae,ke),P.vertexLength+4>Li.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Re=Ae.sub(ke)._perp(),rt=Re.x/(Math.abs(Re.x)+Math.abs(Re.y)),Je=Re.y>0?1:0,Tt=ke.dist(Ae);ye+Tt>32768&&(ye=0),ju(this.layoutVertexArray,Ae.x,Ae.y,rt,Je,0,0,ye),ju(this.layoutVertexArray,Ae.x,Ae.y,rt,Je,0,1,ye),ye+=Tt,ju(this.layoutVertexArray,ke.x,ke.y,rt,Je,0,0,ye),ju(this.layoutVertexArray,ke.x,ke.y,rt,Je,0,1,ye);const vt=P.vertexLength;this.indexArray.emplaceBack(vt,vt+2,vt+1),this.indexArray.emplaceBack(vt+1,vt+2,vt+3),P.vertexLength+=4,P.primitiveLength+=2}}}}if(P.vertexLength+I>Li.MAX_VERTEX_ARRAY_LENGTH&&(P=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),"Polygon"!==cg[e.type])continue;const R=[],j=[],H=P.vertexLength;for(let ne=0;ne<E.length;ne++){const ce=E[ne];if(0!==ce.length){ce!==E[0]&&j.push(R.length/2);for(let ye=0;ye<ce.length;ye++){const De=ce[ye];ju(this.layoutVertexArray,De.x,De.y,0,0,1,1,0),R.push(De.x),R.push(De.y),y&&y.currentPolyCount.top++}}}const Q=Fu(R,j);for(let ne=0;ne<Q.length;ne+=3)this.indexArray.emplaceBack(H+Q[ne],H+Q[ne+2],H+Q[ne+1]);P.primitiveLength+=Q.length/3,P.vertexLength+=I}var b;if(y&&y.polyCount.length>0){if(y.borders){y.vertexArrayOffset=this.centroidVertexArray.length;const E=y.borders,I=this.featuresOnBorder.push(y)-1;for(let P=0;P<4;P++)E[P][0]!==Number.MAX_VALUE&&this.borders[P].push(I)}this.encodeCentroid(y.borders?void 0:y.centroid(),y)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,m,c)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((r,s)=>this.featuresOnBorder[r].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,r,s=!0){let c,d;if(e)if(0!==e.y){const y=r.span()._mult(this.tileToMeter);c=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(y.x/10)),d=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(y.y/10))}else c=Math.ceil(7*(e.x+450)),d=0;else c=0,d=+s;let m=s?this.centroidVertexArray.length:r.vertexArrayOffset;for(const y of r.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*y.edges+y.top);for(let b=0;b<2*y.edges;b++)this.centroidVertexArray.emplace(m++,0,d),this.centroidVertexArray.emplace(m++,c,d);for(let b=0;b<y.top;b++)this.centroidVertexArray.emplace(m++,c,d)}}}function hg(t,e){return t.x===e.x&&(t.x<0||t.x>Wn)||t.y===e.y&&(t.y<0||t.y>Wn)}jt("FillExtrusionBucket",Ah,{omit:["layers","features"]}),jt("PartMetadata",Mp);var dg={paint:new Ei({"fill-extrusion-opacity":new $t(We["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new sn(We["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new $t(We["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new $t(We["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Yi(We["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new sn(We["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new sn(We["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new $t(We["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function $u(t,e){return t.x*e.x+t.y*e.y}function On(t,e){if(1===t.length){let r=0;const s=e[r++];let c;for(;!c||s.equals(c);)if(c=e[r++],!c)return 1/0;for(;r<e.length;r++){const d=e[r],m=t[0],y=c.sub(s),b=d.sub(s),E=m.sub(s),I=$u(y,y),P=$u(y,b),R=$u(b,b),j=$u(E,y),H=$u(E,b),Q=I*R-P*P,ne=(R*j-P*H)/Q,ce=(I*H-P*j)/Q,ye=s.z*(1-ne-ce)+c.z*ne+d.z*ce;if(isFinite(ye))return ye}return 1/0}{let r=1/0;for(const s of e)r=Math.min(r,s.z);return r}}function Hd(t){const e=new et(t[0],t[1]);return e.z=t[2],e}function Ip(t,e,r,s,c,d,m,y){const b=m*c.getElevationAt(t,e,!0,!0),E=0!==d[0],I=E?0===d[1]?m*(d[0]/7-450):m*function(P,R,j){const H=Math.floor(R[0]/8),Q=Math.floor(R[1]/8),ne=10*(R[0]-8*H),ce=10*(R[1]-8*Q),ye=P.getElevationAt(H,Q,!0,!0),De=P.getMeterToDEM(j),Ae=Math.floor(.5*(ne*De-1)),ke=Math.floor(.5*(ce*De-1)),Re=P.tileCoordToPixel(H,Q),rt=2*Ae+1,Je=2*ke+1,Tt=(Rr=rt,Jn=Je,[(Bt=P).getElevationAtPixel(Zt=Re.x-Ae,Xn=Re.y-ke,!0),Bt.getElevationAtPixel(Zt+Jn,Xn,!0),Bt.getElevationAtPixel(Zt,Xn+Jn,!0),Bt.getElevationAtPixel(Zt+Rr,Xn+Jn,!0)]),vt=Math.abs(Tt[0]-Tt[1]),tt=Math.abs(Tt[2]-Tt[3]),gt=Math.abs(Tt[0]-Tt[2])+Math.abs(Tt[1]-Tt[3]),St=Math.min(.25,.5*De*(vt+tt)/rt),at=Math.min(.25,.5*De*gt/Je);var Bt,Zt,Xn,Rr,Jn;return ye+Math.max(St*ne,at*ce)}(c,d,y):b;return{base:b+(0===r)?-1:r,top:E?Math.max(I+s,b+r+2):b+s}}const Ap=hi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Ph}=Ap,Da=hi([{name:"a_packed",components:3,type:"Float32"}]),{members:Pp}=Da,fg=Ql.VectorTileFeature.types,Zd=Math.cos(Math.PI/180*37.5);class ia{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(r=>r.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(r=>{this.gradients[r.id]={}}),this.layoutVertexArray=new qc,this.layoutVertexArray2=new Xl,this.indexArray=new vs,this.programConfigurations=new ai(e.layers,e.zoom),this.segments=new Li,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(r=>r.isStateDependent()).map(r=>r.id)}populate(e,r,s,c){this.hasPattern=Ac("line",this.layers,r);const d=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:I,id:P,index:R,sourceLayerIndex:j}of e){const H=this.layers[0]._featureFilter.needGeometry,Q=Sc(I,H);if(!this.layers[0]._featureFilter.filter(new wn(this.zoom),Q,s))continue;const ne=d?d.evaluate(Q,{},s):void 0,ce={id:P,properties:I.properties,type:I.type,sourceLayerIndex:j,index:R,geometry:H?Q.geometry:El(I,s,c),patterns:{},sortKey:ne};m.push(ce)}d&&m.sort((I,P)=>I.sortKey-P.sortKey);const{lineAtlas:y,featureIndex:b}=r,E=this.addConstantDashes(y);for(const I of m){const{geometry:P,index:R,sourceLayerIndex:j}=I;if(E&&this.addFeatureDashes(I,y),this.hasPattern){const H=$d("line",this.layers,I,this.zoom,r);this.patternFeatures.push(H)}else this.addFeature(I,P,R,s,y.positions,r.availableImages);b.insert(e[R].feature,P,R,j,this.index)}}addConstantDashes(e){let r=!1;for(const s of this.layers){const c=s.paint.get("line-dasharray").value,d=s.layout.get("line-cap").value;if("constant"!==c.kind||"constant"!==d.kind)r=!0;else{const m=d.value,y=c.value;if(!y)continue;e.addDash(y.from,m),e.addDash(y.to,m),y.other&&e.addDash(y.other,m)}}return r}addFeatureDashes(e,r){const s=this.zoom;for(const c of this.layers){const d=c.paint.get("line-dasharray").value,m=c.layout.get("line-cap").value;if("constant"===d.kind&&"constant"===m.kind)continue;let y,b,E,I,P,R;if("constant"===d.kind){const ne=d.value;if(!ne)continue;y=ne.other||ne.to,b=ne.to,E=ne.from}else y=d.evaluate({zoom:s-1},e),b=d.evaluate({zoom:s},e),E=d.evaluate({zoom:s+1},e);"constant"===m.kind?I=P=R=m.value:(I=m.evaluate({zoom:s-1},e),P=m.evaluate({zoom:s},e),R=m.evaluate({zoom:s+1},e)),r.addDash(y,I),r.addDash(b,P),r.addDash(E,R);const j=r.getKey(y,I),H=r.getKey(b,P),Q=r.getKey(E,R);e.patterns[c.id]={min:j,mid:H,max:Q}}}update(e,r,s,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,r,this.stateDependentLayers,s,c)}addFeatures(e,r,s,c){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,r,s,c)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Pp)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ph),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,r,s,c,d,m){const y=this.layers[0].layout,b=y.get("line-join").evaluate(e,{}),E=y.get("line-cap").evaluate(e,{}),I=y.get("line-miter-limit"),P=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const R of r)this.addLine(R,e,b,E,I,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,d,m,c)}addLine(e,r,s,c,d,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ce=0;ce<e.length-1;ce++)this.totalDistance+=e[ce].dist(e[ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y="Polygon"===fg[r.type];let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let E=0;for(;E<b-1&&e[E].equals(e[E+1]);)E++;if(b<(y?3:2))return;"bevel"===s&&(d=1.05);const I=this.overscaling<=16?122880/(512*this.overscaling):0,P=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let R,j,H,Q,ne;this.e1=this.e2=-1,y&&(R=e[b-2],ne=e[E].sub(R)._unit()._perp());for(let ce=E;ce<b;ce++){if(H=ce===b-1?y?e[E+1]:void 0:e[ce+1],H&&e[ce].equals(H))continue;ne&&(Q=ne),R&&(j=R),R=e[ce],ne=H?H.sub(R)._unit()._perp():Q,Q=Q||ne;let ye=Q.add(ne);0===ye.x&&0===ye.y||ye._unit();const De=Q.x*ne.x+Q.y*ne.y,Ae=ye.x*ne.x+ye.y*ne.y,ke=0!==Ae?1/Ae:1/0,Re=2*Math.sqrt(2-2*Ae),rt=Ae<Zd&&j&&H,Je=Q.x*ne.y-Q.y*ne.x>0;if(rt&&ce>E){const tt=R.dist(j);if(tt>2*I){const gt=R.sub(R.sub(j)._mult(I/tt)._round());this.updateDistance(j,gt),this.addCurrentVertex(gt,Q,0,0,P),j=gt}}const Tt=j&&H;let vt=Tt?s:y?"butt":c;if(Tt&&"round"===vt&&(ke<m?vt="miter":ke<=2&&(vt="fakeround")),"miter"===vt&&ke>d&&(vt="bevel"),"bevel"===vt&&(ke>2&&(vt="flipbevel"),ke<d&&(vt="miter")),j&&this.updateDistance(j,R),"miter"===vt)ye._mult(ke),this.addCurrentVertex(R,ye,0,0,P);else if("flipbevel"===vt){if(ke>100)ye=ne.mult(-1);else{const tt=ke*Q.add(ne).mag()/Q.sub(ne).mag();ye._perp()._mult(tt*(Je?-1:1))}this.addCurrentVertex(R,ye,0,0,P),this.addCurrentVertex(R,ye.mult(-1),0,0,P)}else if("bevel"===vt||"fakeround"===vt){const tt=-Math.sqrt(ke*ke-1),gt=Je?tt:0,St=Je?0:tt;if(j&&this.addCurrentVertex(R,Q,gt,St,P),"fakeround"===vt){const at=Math.round(180*Re/Math.PI/20);for(let Bt=1;Bt<at;Bt++){let Zt=Bt/at;if(.5!==Zt){const Rr=Zt-.5;Zt+=Zt*Rr*(Zt-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*Rr*Rr+(.848013+De*(.215638*De-1.06021)))}const Xn=ne.sub(Q)._mult(Zt)._add(Q)._unit()._mult(Je?-1:1);this.addHalfVertex(R,Xn.x,Xn.y,!1,Je,0,P)}}H&&this.addCurrentVertex(R,ne,-gt,-St,P)}else if("butt"===vt)this.addCurrentVertex(R,ye,0,0,P);else if("square"===vt){const tt=j?1:-1;j||this.addCurrentVertex(R,ye,tt,tt,P),this.addCurrentVertex(R,ye,0,0,P),j&&this.addCurrentVertex(R,ye,tt,tt,P)}else"round"===vt&&(j&&(this.addCurrentVertex(R,Q,0,0,P),this.addCurrentVertex(R,Q,1,1,P,!0)),H&&(this.addCurrentVertex(R,ne,-1,-1,P,!0),this.addCurrentVertex(R,ne,0,0,P)));if(rt&&ce<b-1){const tt=R.dist(H);if(tt>2*I){const gt=R.add(H.sub(R)._mult(I/tt)._round());this.updateDistance(R,gt),this.addCurrentVertex(gt,ne,0,0,P),R=gt}}}}addCurrentVertex(e,r,s,c,d,m=!1){const y=r.y*c-r.x,b=-r.y-r.x*c;this.addHalfVertex(e,r.x+r.y*s,r.y-r.x*s,m,!1,s,d),this.addHalfVertex(e,y,b,m,!0,-c,d)}addHalfVertex({x:e,y:r},s,c,d,m,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(d?1:0),(r<<1)+(m?1:0),Math.round(63*s)+128,Math.round(63*c)+128,1+(0===y?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const E=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),b.primitiveLength++),m?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,r){this.distance+=e.dist(r),this.updateScaledDistance()}}jt("LineBucket",ia,{omit:["layers","patternFeatures"]});const qd=new Ei({"line-cap":new sn(We.layout_line["line-cap"]),"line-join":new sn(We.layout_line["line-join"]),"line-miter-limit":new $t(We.layout_line["line-miter-limit"]),"line-round-limit":new $t(We.layout_line["line-round-limit"]),"line-sort-key":new sn(We.layout_line["line-sort-key"])});var Wd={paint:new Ei({"line-opacity":new sn(We.paint_line["line-opacity"]),"line-color":new sn(We.paint_line["line-color"]),"line-translate":new $t(We.paint_line["line-translate"]),"line-translate-anchor":new $t(We.paint_line["line-translate-anchor"]),"line-width":new sn(We.paint_line["line-width"]),"line-gap-width":new sn(We.paint_line["line-gap-width"]),"line-offset":new sn(We.paint_line["line-offset"]),"line-blur":new sn(We.paint_line["line-blur"]),"line-dasharray":new Yi(We.paint_line["line-dasharray"]),"line-pattern":new Yi(We.paint_line["line-pattern"]),"line-gradient":new is(We.paint_line["line-gradient"])}),layout:qd};const kh=new class extends sn{possiblyEvaluate(t,e){return e=new wn(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,r,s){return e=cr({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,r,s)}}(Wd.paint.properties["line-width"].specification);function pg(t,e){return e>0?e+2*t:t}kh.useIntegerZoom=!0;const kp=hi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),V_=hi([{name:"a_projected_pos",components:3,type:"Float32"}],4);hi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Rh=hi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Lh=hi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);hi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Fh=hi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Xd=hi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);hi([{name:"triangle",components:3,type:"Uint16"}]),hi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),hi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),hi([{type:"Float32",name:"offsetX"}]),hi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Dl=128;function Yd(t,e){const{expression:r}=e;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new wn(t+1))};if("source"===r.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:c}=r;let d=0;for(;d<s.length&&s[d]<=t;)d++;d=Math.max(0,d-1);let m=d;for(;m<s.length&&s[m]<t+1;)m++;m=Math.min(s.length-1,m);const y=s[d],b=s[m];return"composite"===r.kind?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:c}:{kind:"camera",minZoom:y,maxZoom:b,minSize:r.evaluate(new wn(y)),maxSize:r.evaluate(new wn(b)),interpolationType:c}}}function Oh(t,{uSize:e,uSizeT:r},{lowerSize:s,upperSize:c}){return"source"===t.kind?s/Dl:"composite"===t.kind?or(s/Dl,c/Dl,r):e}function cu(t,e){let r=0,s=0;if("constant"===t.kind)s=t.layoutSize;else if("source"!==t.kind){const{interpolationType:c,minZoom:d,maxZoom:m}=t,y=c?Pn(Mr.interpolationFactor(c,e,d,m),0,1):0;"camera"===t.kind?s=or(t.minSize,t.maxSize,y):r=y}return{uSizeT:r,uSize:s}}var mg=Object.freeze({__proto__:null,getSizeData:Yd,evaluateSizeForFeature:Oh,evaluateSizeForZoom:cu,SIZE_PACK_FACTOR:Dl});function Rp(t,e,r){return t.sections.forEach(s=>{s.text=function(c,d,m){const y=d.layout.get("text-transform").evaluate(m,{});return"uppercase"===y?c=c.toLocaleUpperCase():"lowercase"===y&&(c=c.toLocaleLowerCase()),nr.applyArabicShaping&&(c=nr.applyArabicShaping(c)),c}(s.text,e,r)}),t}const zh={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function gg(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function j_(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var Kd=function(t,e,r,s,c){var d,m,y=8*c-s-1,b=(1<<y)-1,E=b>>1,I=-7,P=r?c-1:0,R=r?-1:1,j=t[e+P];for(P+=R,d=j&(1<<-I)-1,j>>=-I,I+=y;I>0;d=256*d+t[e+P],P+=R,I-=8);for(m=d&(1<<-I)-1,d>>=-I,I+=s;I>0;m=256*m+t[e+P],P+=R,I-=8);if(0===d)d=1-E;else{if(d===b)return m?NaN:1/0*(j?-1:1);m+=Math.pow(2,s),d-=E}return(j?-1:1)*m*Math.pow(2,d-s)},Qd=function(t,e,r,s,c,d){var m,y,b,E=8*d-c-1,I=(1<<E)-1,P=I>>1,R=23===c?Math.pow(2,-24)-Math.pow(2,-77):0,j=s?0:d-1,H=s?1:-1,Q=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,m=I):(m=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-m))<1&&(m--,b*=2),(e+=m+P>=1?R/b:R*Math.pow(2,1-P))*b>=2&&(m++,b/=2),m+P>=I?(y=0,m=I):m+P>=1?(y=(e*b-1)*Math.pow(2,c),m+=P):(y=e*Math.pow(2,P-1)*Math.pow(2,c),m=0));c>=8;t[r+j]=255&y,j+=H,y/=256,c-=8);for(m=m<<c|y,E+=c;E>0;t[r+j]=255&m,j+=H,m/=256,E-=8);t[r+j-H]|=128*Q},Gu=xr;function xr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}xr.Varint=0,xr.Fixed64=1,xr.Bytes=2,xr.Fixed32=5;var Lp=4294967296,_g=1/Lp,yg="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Jl(t){return t.type===xr.Bytes?t.readVarint()+t.pos:t.pos+1}function vg(t,e,r){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(s);for(var c=r.pos-1;c>=t;c--)r.buf[c+s]=r.buf[c]}function $_(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function G_(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function H_(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function Z_(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function ec(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function Jd(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function xg(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function Fp(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function ef(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function Zu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function tc(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function Op(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function nc(t,e,r){e.glyphs=[],1===t&&r.readMessage(zp,e)}function zp(t,e,r){if(3===t){const{id:s,bitmap:c,width:d,height:m,left:y,top:b,advance:E}=r.readMessage(bg,{});e.glyphs.push({id:s,bitmap:new Tl({width:d+6,height:m+6},c),metrics:{width:d,height:m,left:y,top:b,advance:E}})}else 4===t?e.ascender=r.readSVarint():5===t&&(e.descender=r.readSVarint())}function bg(t,e,r){1===t?e.id=r.readVarint():2===t?e.bitmap=r.readBytes():3===t?e.width=r.readVarint():4===t?e.height=r.readVarint():5===t?e.left=r.readSVarint():6===t?e.top=r.readSVarint():7===t&&(e.advance=r.readVarint())}function qu(t){let e=0,r=0;for(const m of t)e+=m.w*m.h,r=Math.max(r,m.w);t.sort((m,y)=>y.h-m.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),r),h:1/0}];let c=0,d=0;for(const m of t)for(let y=s.length-1;y>=0;y--){const b=s[y];if(!(m.w>b.w||m.h>b.h)){if(m.x=b.x,m.y=b.y,d=Math.max(d,m.y+m.h),c=Math.max(c,m.x+m.w),m.w===b.w&&m.h===b.h){const E=s.pop();y<s.length&&(s[y]=E)}else m.h===b.h?(b.x+=m.w,b.w-=m.w):m.w===b.w?(b.y+=m.h,b.h-=m.h):(s.push({x:b.x+m.w,y:b.y,w:b.w-m.w,h:m.h}),b.y+=m.h,b.h-=m.h);break}}return{w:c,h:d,fill:e/(c*d)||0}}xr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var s=this.readVarint(),c=s>>3,d=this.pos;this.type=7&s,t(c,e,this),this.pos===d&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Zu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Op(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Zu(this.buf,this.pos)+Zu(this.buf,this.pos+4)*Lp;return this.pos+=8,t},readSFixed64:function(){var t=Zu(this.buf,this.pos)+Op(this.buf,this.pos+4)*Lp;return this.pos+=8,t},readFloat:function(){var t=Kd(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Kd(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,s=this.buf;return e=127&(r=s[this.pos++]),r<128?e:(e|=(127&(r=s[this.pos++]))<<7,r<128?e:(e|=(127&(r=s[this.pos++]))<<14,r<128?e:(e|=(127&(r=s[this.pos++]))<<21,r<128?e:function(c,d,m){var y,b,E=m.buf;if(y=(112&(b=E[m.pos++]))>>4,b<128||(y|=(127&(b=E[m.pos++]))<<3,b<128)||(y|=(127&(b=E[m.pos++]))<<10,b<128)||(y|=(127&(b=E[m.pos++]))<<17,b<128)||(y|=(127&(b=E[m.pos++]))<<24,b<128)||(y|=(1&(b=E[m.pos++]))<<31,b<128))return function Hu(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(c,y,d);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&yg?yg.decode(this.buf.subarray(e,t)):function(r,s,c){for(var d="",m=s;m<c;){var y,b,E,I=r[m],P=null,R=I>239?4:I>223?3:I>191?2:1;if(m+R>c)break;1===R?I<128&&(P=I):2===R?128==(192&(y=r[m+1]))&&(P=(31&I)<<6|63&y)<=127&&(P=null):3===R?(b=r[m+2],128==(192&(y=r[m+1]))&&128==(192&b)&&((P=(15&I)<<12|(63&y)<<6|63&b)<=2047||P>=55296&&P<=57343)&&(P=null)):4===R&&(b=r[m+2],E=r[m+3],128==(192&(y=r[m+1]))&&128==(192&b)&&128==(192&E)&&((P=(15&I)<<18|(63&y)<<12|(63&b)<<6|63&E)<=65535||P>=1114112)&&(P=null)),null===P?(P=65533,R=1):P>65535&&(P-=65536,d+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),d+=String.fromCharCode(P),m+=R}return d}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==xr.Bytes)return t.push(this.readVarint(e));var r=Jl(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==xr.Bytes)return t.push(this.readSVarint());var e=Jl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==xr.Bytes)return t.push(this.readBoolean());var e=Jl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==xr.Bytes)return t.push(this.readFloat());var e=Jl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==xr.Bytes)return t.push(this.readDouble());var e=Jl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==xr.Bytes)return t.push(this.readFixed32());var e=Jl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==xr.Bytes)return t.push(this.readSFixed32());var e=Jl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==xr.Bytes)return t.push(this.readFixed64());var e=Jl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==xr.Bytes)return t.push(this.readSFixed64());var e=Jl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===xr.Varint)for(;this.buf[this.pos++]>127;);else if(e===xr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===xr.Fixed32)this.pos+=4;else{if(e!==xr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),tc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),tc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),tc(this.buf,-1&t,this.pos),tc(this.buf,Math.floor(t*_g),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),tc(this.buf,-1&t,this.pos),tc(this.buf,Math.floor(t*_g),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,r){var s,c,d,y;if(e>=0?(s=e%4294967296|0,c=e/4294967296|0):(c=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,c=c+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),d=s,(y=r).buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,d>>>=7,y.buf[y.pos++]=127&d|128,y.buf[y.pos]=127&(d>>>=7),function(d,m){var y=(7&d)<<4;m.buf[m.pos++]|=y|((d>>>=3)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d|((d>>>=7)?128:0),d&&(m.buf[m.pos++]=127&d)))))}(c,r)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,c,d){for(var m,y,b=0;b<c.length;b++){if((m=c.charCodeAt(b))>55295&&m<57344){if(!y){m>56319||b+1===c.length?(s[d++]=239,s[d++]=191,s[d++]=189):y=m;continue}if(m<56320){s[d++]=239,s[d++]=191,s[d++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(s[d++]=239,s[d++]=191,s[d++]=189,y=null);m<128?s[d++]=m:(m<2048?s[d++]=m>>6|192:(m<65536?s[d++]=m>>12|224:(s[d++]=m>>18|240,s[d++]=m>>12&63|128),s[d++]=m>>6&63|128),s[d++]=63&m|128)}return d}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&vg(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),Qd(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Qd(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var s=this.pos-r;s>=128&&vg(r,s,this),this.pos=r-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,r){this.writeTag(t,xr.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,$_,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,G_,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,ec,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,H_,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Z_,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Jd,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,xg,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Fp,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,ef,e)},writeBytesField:function(t,e){this.writeTag(t,xr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,xr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,xr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,xr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,xr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,xr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,xr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,xr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,xr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,xr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class tf{constructor(e,{pixelRatio:r,version:s,stretchX:c,stretchY:d,content:m}){this.paddedRect=e,this.pixelRatio=r,this.stretchX=c,this.stretchY=d,this.content=m,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class nf{constructor(e,r){const s={},c={};this.haveRenderCallbacks=[];const d=[];this.addImages(e,s,d),this.addImages(r,c,d);const{w:m,h:y}=qu(d),b=new ss({width:m||1,height:y||1});for(const E in e){const I=e[E],P=s[E].paddedRect;ss.copy(I.data,b,{x:0,y:0},{x:P.x+1,y:P.y+1},I.data)}for(const E in r){const I=r[E],P=c[E].paddedRect,R=P.x+1,j=P.y+1,H=I.data.width,Q=I.data.height;ss.copy(I.data,b,{x:0,y:0},{x:R,y:j},I.data),ss.copy(I.data,b,{x:0,y:Q-1},{x:R,y:j-1},{width:H,height:1}),ss.copy(I.data,b,{x:0,y:0},{x:R,y:j+Q},{width:H,height:1}),ss.copy(I.data,b,{x:H-1,y:0},{x:R-1,y:j},{width:1,height:Q}),ss.copy(I.data,b,{x:0,y:0},{x:R+H,y:j},{width:1,height:Q})}this.image=b,this.iconPositions=s,this.patternPositions=c}addImages(e,r,s){for(const c in e){const d=e[c],m={x:0,y:0,w:d.data.width+2,h:d.data.height+2};s.push(m),r[c]=new tf(m,d),d.hasRenderCallback&&this.haveRenderCallbacks.push(c)}}patchUpdatedImages(e,r){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),r),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),r)}patchUpdatedImage(e,r,s){if(!e||!r||e.version===r.version)return;e.version=r.version;const[c,d]=e.tl;s.update(r.data,void 0,{x:c,y:d})}}jt("ImagePosition",tf),jt("ImageAtlas",nf);const Gs={horizontal:1,vertical:2,horizontalOnly:3};class Wu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,r){const s=new Wu;return s.scale=e||1,s.fontStack=r,s}static forImage(e){const r=new Wu;return r.imageName=e,r}}class Ka{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,r){const s=new Ka;for(let c=0;c<e.sections.length;c++){const d=e.sections[c];d.image?s.addImageSection(d):s.addTextSection(d,r)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(r,s){let c="";for(let d=0;d<r.length;d++){const m=r.charCodeAt(d+1)||null,y=r.charCodeAt(d-1)||null;c+=!s&&(m&&Yt(m)&&!zh[r[d+1]]||y&&Yt(y)&&!zh[r[d-1]])||!zh[r[d]]?r[d]:zh[r[d]]}return c}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&uu[this.text.charCodeAt(s)];s++)e++;let r=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&uu[this.text.charCodeAt(s)];s--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}substring(e,r){const s=new Ka;return s.text=this.text.substring(e,r),s.sectionIndex=this.sectionIndex.slice(e,r),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,r)=>Math.max(e,this.sections[r].scale),0)}addTextSection(e,r){this.text+=e.text,this.sections.push(Wu.forText(e.scale,e.fontStack||r));const s=this.sections.length-1;for(let c=0;c<e.text.length;++c)this.sectionIndex.push(s)}addImageSection(e){const r=e.image?e.image.name:"";if(0===r.length)return void Hn("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Wu.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Hn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function rc(t,e,r,s,c,d,m,y,b,E,I,P,R,j,H,Q){const ne=Ka.fromFeature(t,c);let ce;P===Gs.vertical&&ne.verticalizePunctuation(R);const{processBidirectionalText:ye,processStyledBidirectionalText:De}=nr;if(ye&&1===ne.sections.length){ce=[];const Re=ye(ne.toString(),Xu(ne,E,d,e,s,j,H));for(const rt of Re){const Je=new Ka;Je.text=rt,Je.sections=ne.sections;for(let Tt=0;Tt<rt.length;Tt++)Je.sectionIndex.push(0);ce.push(Je)}}else if(De){ce=[];const Re=De(ne.text,ne.sectionIndex,Xu(ne,E,d,e,s,j,H));for(const rt of Re){const Je=new Ka;Je.text=rt[0],Je.sectionIndex=rt[1],Je.sections=ne.sections,ce.push(Je)}}else ce=function(Re,rt){const Je=[],Tt=Re.text;let vt=0;for(const tt of rt)Je.push(Re.substring(vt,tt)),vt=tt;return vt<Tt.length&&Je.push(Re.substring(vt,Tt.length)),Je}(ne,Xu(ne,E,d,e,s,j,H));const Ae=[],ke={positionedLines:Ae,text:ne.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Re,rt,Je,Tt,vt,tt,gt,St,at,Bt,Zt,Xn){let Rr=0,Jn=0,jn=0;const pt="right"===St?1:"left"===St?0:.5;let ar=!1;for(const lr of vt){const Yn=lr.getSections();for(const Wr of Yn){if(Wr.imageName)continue;const _i=rt[Wr.fontStack];if(_i&&(ar=void 0!==_i.ascender&&void 0!==_i.descender,!ar))break}if(!ar)break}let ir=0;for(const lr of vt){lr.trim();const Yn=lr.getMaxScale(),Wr=24*(Yn-1),_i={positionedGlyphs:[],lineOffset:0};Re.positionedLines[ir]=_i;const li=_i.positionedGlyphs;let ji=0;if(!lr.length()){Jn+=tt,++ir;continue}let Ji=0,cs=0;for(let Ir=0;Ir<lr.length();Ir++){const $i=lr.getSection(Ir),ws=lr.getSectionIndex(Ir),Gi=lr.getCharCode(Ir);let Ar=$i.scale,Ci=null,Br=null,co=null,eo=24,Io=0;const bo=!(at===Gs.horizontal||!Zt&&!Qe(Gi)||Zt&&(uu[Gi]||(Di=Gi,n(Di)||l(Di)||p(Di)||be(Di)||ht(Di))));if($i.imageName){const wo=Tt[$i.imageName];if(!wo)continue;co=$i.imageName,Re.iconsInText=Re.iconsInText||!0,Br=wo.paddedRect;const Hi=wo.displaySize;Ar=24*Ar/Xn,Ci={width:Hi[0],height:Hi[1],left:1,top:-3,advance:bo?Hi[1]:Hi[0],localGlyph:!1},Io=ar?-Ci.height*Ar:24*Yn-17-Hi[1]*Ar,eo=Ci.advance;const la=(bo?Hi[0]:Hi[1])*Ar-24*Yn;la>0&&la>ji&&(ji=la)}else{const wo=Je[$i.fontStack];if(!wo)continue;wo[Gi]&&(Br=wo[Gi]);const Hi=rt[$i.fontStack];if(!Hi)continue;const la=Hi.glyphs[Gi];if(!la)continue;if(Ci=la.metrics,eo=8203!==Gi?24:0,ar){const ac=void 0!==Hi.ascender?Math.abs(Hi.ascender):0,Du=void 0!==Hi.descender?Math.abs(Hi.descender):0,Cu=(ac+Du)*Ar;Ji<Cu&&(Ji=Cu,cs=(ac-Du)/2*Ar),Io=-ac*Ar}else Io=24*(Yn-Ar)-17}bo?(Re.verticalizable=!0,li.push({glyph:Gi,imageName:co,x:Rr,y:Jn+Io,vertical:bo,scale:Ar,localGlyph:Ci.localGlyph,fontStack:$i.fontStack,sectionIndex:ws,metrics:Ci,rect:Br}),Rr+=eo*Ar+Bt):(li.push({glyph:Gi,imageName:co,x:Rr,y:Jn+Io,vertical:bo,scale:Ar,localGlyph:Ci.localGlyph,fontStack:$i.fontStack,sectionIndex:ws,metrics:Ci,rect:Br}),Rr+=Ci.advance*Ar+Bt)}0!==li.length&&(jn=Math.max(Rr-Bt,jn),ar?sf(li,pt,ji,cs,tt*Yn/2):sf(li,pt,ji,0,tt/2)),Rr=0;const bs=tt*Yn+ji;_i.lineOffset=Math.max(ji,Wr),Jn+=bs,++ir}var Di;const di=Jn,{horizontalAlign:Qi,verticalAlign:Mo}=Yu(gt);(function(lr,Yn,Wr,_i,li,ji){const Ji=(Yn-Wr)*li,cs=-ji*_i;for(const bs of lr)for(const Ir of bs.positionedGlyphs)Ir.x+=Ji,Ir.y+=cs})(Re.positionedLines,pt,Qi,Mo,jn,di),Re.top+=-Mo*di,Re.bottom=Re.top+di,Re.left+=-Qi*jn,Re.right=Re.left+jn,Re.hasBaseline=ar}(ke,e,r,s,ce,m,y,b,P,E,R,Q),!function(Re){for(const rt of Re)if(0!==rt.positionedGlyphs.length)return!1;return!0}(Ae)&&ke}const uu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},hu={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function du(t,e,r,s,c,d){if(e.imageName){const m=s[e.imageName];return m?m.displaySize[0]*e.scale*24/d+c:0}{const m=r[e.fontStack],y=m&&m.glyphs[t];return y?y.metrics.advance*e.scale+c:0}}function kc(t,e,r,s){const c=Math.pow(t-e,2);return s?t<e?c/2:2*c:c+Math.abs(r)*r}function wg(t,e,r){let s=0;return 10===t&&(s-=1e4),r&&(s+=150),40!==t&&65288!==t||(s+=50),41!==e&&65289!==e||(s+=50),s}function rf(t,e,r,s,c,d){let m=null,y=kc(e,r,c,d);for(const b of s){const E=kc(e-b.x,r,c,d)+b.badness;E<=y&&(m=b,y=E)}return{index:t,x:e,priorBreak:m,badness:y}}function of(t){return t?of(t.priorBreak).concat(t.index):[]}function Xu(t,e,r,s,c,d,m){if("point"!==d)return[];if(!t)return[];const y=[],b=function(R,j,H,Q,ne,ce){let ye=0;for(let De=0;De<R.length();De++){const Ae=R.getSection(De);ye+=du(R.getCharCode(De),Ae,Q,ne,j,ce)}return ye/Math.max(1,Math.ceil(ye/H))}(t,e,r,s,c,m),E=t.text.indexOf("\u200b")>=0;let I=0;for(let R=0;R<t.length();R++){const j=t.getSection(R),H=t.getCharCode(R);if(uu[H]||(I+=du(H,j,s,c,e,m)),R<t.length()-1){const Q=!((P=H)<11904||!($(P)||N(P)||Ge(P)||pe(P)||ie(P)||_(P)||K(P)||S(P)||xe(P)||ee(P)||te(P)||lt(P)||F(P)||w(P)||x(P)||re(P)||O(P)||ze(P)||me(P)||ge(P)));(hu[H]||Q||j.imageName)&&y.push(rf(R+1,I,b,y,wg(H,t.getCharCode(R+1),Q&&E),!1))}}var P;return of(rf(t.length(),I,b,y,0,!0))}function Yu(t){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:e,verticalAlign:r}}function sf(t,e,r,s,c){if(!(e||r||s||c))return;const d=t.length-1,m=t[d],y=(m.x+m.metrics.advance*m.scale)*e;for(let b=0;b<=d;b++)t[b].x-=y,t[b].y+=r+s+c}function Bh(t,e,r){const{horizontalAlign:s,verticalAlign:c}=Yu(r),d=e[0]-t.displaySize[0]*s,m=e[1]-t.displaySize[1]*c;return{image:t,top:m,bottom:m+t.displaySize[1],left:d,right:d+t.displaySize[0]}}function Bp(t,e,r,s,c,d){const m=t.image;let y;if(m.content){const ne=m.content,ce=m.pixelRatio||1;y=[ne[0]/ce,ne[1]/ce,m.displaySize[0]-ne[2]/ce,m.displaySize[1]-ne[3]/ce]}const b=e.left*d,E=e.right*d;let I,P,R,j;"width"===r||"both"===r?(j=c[0]+b-s[3],P=c[0]+E+s[1]):(j=c[0]+(b+E-m.displaySize[0])/2,P=j+m.displaySize[0]);const H=e.top*d,Q=e.bottom*d;return"height"===r||"both"===r?(I=c[1]+H-s[0],R=c[1]+Q+s[2]):(I=c[1]+(H+Q-m.displaySize[1])/2,R=I+m.displaySize[1]),{image:m,top:I,right:P,bottom:R,left:j,collisionPadding:y}}class Qa extends et{constructor(e,r,s,c,d){super(e,r),this.angle=c,this.z=s,void 0!==d&&(this.segment=d)}clone(){return new Qa(this.x,this.y,this.z,this.angle,this.segment)}}function Eg(t,e,r,s,c){if(void 0===e.segment)return!0;let d=e,m=e.segment+1,y=0;for(;y>-r/2;){if(m--,m<0)return!1;y-=t[m].dist(d),d=t[m]}y+=t[m].dist(t[m+1]),m++;const b=[];let E=0;for(;y<r/2;){const I=t[m],P=t[m+1];if(!P)return!1;let R=t[m-1].angleTo(I)-I.angleTo(P);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:R}),E+=R;y-b[0].distance>s;)E-=b.shift().angleDelta;if(E>c)return!1;m++,y+=I.dist(P)}return!0}function af(t){let e=0;for(let r=0;r<t.length-1;r++)e+=t[r].dist(t[r+1]);return e}function lf(t,e,r){return t?.6*e*r:0}function Np(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Up(t,e,r,s,c,d){const m=lf(r,c,d),y=Np(r,s)*d;let b=0;const E=af(t)/2;for(let I=0;I<t.length-1;I++){const P=t[I],R=t[I+1],j=P.dist(R);if(b+j>E){const H=(E-b)/j,Q=or(P.x,R.x,H),ne=or(P.y,R.y,H),ce=new Qa(Q,ne,0,R.angleTo(P),I);return!m||Eg(t,ce,y,m,e)?ce:void 0}b+=j}}function Tg(t,e,r,s,c,d,m,y,b){const E=lf(s,d,m),I=Np(s,c),P=I*m,R=0===t[0].x||t[0].x===b||0===t[0].y||t[0].y===b;return e-P<e/4&&(e=P+e/4),Vp(t,R?e/2*y%e:(I/2+2*d)*m*y%e,e,E,r,P,R,!1,b)}function Vp(t,e,r,s,c,d,m,y,b){const E=d/2,I=af(t);let P=0,R=e-r,j=[];for(let H=0;H<t.length-1;H++){const Q=t[H],ne=t[H+1],ce=Q.dist(ne),ye=ne.angleTo(Q);for(;R+r<P+ce;){R+=r;const De=(R-P)/ce,Ae=or(Q.x,ne.x,De),ke=or(Q.y,ne.y,De);if(Ae>=0&&Ae<b&&ke>=0&&ke<b&&R-E>=0&&R+E<=I){const Re=new Qa(Ae,ke,0,ye,H);Re._round(),s&&!Eg(t,Re,d,s,c)||j.push(Re)}}P+=ce}return y||j.length||m||(j=Vp(t,P/2,r,s,c,d,m,!0,b)),j}function xs(t,e,r,s,c){const d=[];for(let m=0;m<t.length;m++){const y=t[m];let b;for(let E=0;E<y.length-1;E++){let I=y[E],P=y[E+1];I.x<e&&P.x<e||(I.x<e?I=new et(e,I.y+(e-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x<e&&(P=new et(e,I.y+(e-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y<r&&P.y<r||(I.y<r?I=new et(I.x+(r-I.y)/(P.y-I.y)*(P.x-I.x),r)._round():P.y<r&&(P=new et(I.x+(r-I.y)/(P.y-I.y)*(P.x-I.x),r)._round()),I.x>=s&&P.x>=s||(I.x>=s?I=new et(s,I.y+(s-I.x)/(P.x-I.x)*(P.y-I.y))._round():P.x>=s&&(P=new et(s,I.y+(s-I.x)/(P.x-I.x)*(P.y-I.y))._round()),I.y>=c&&P.y>=c||(I.y>=c?I=new et(I.x+(c-I.y)/(P.y-I.y)*(P.x-I.x),c)._round():P.y>=c&&(P=new et(I.x+(c-I.y)/(P.y-I.y)*(P.x-I.x),c)._round()),b&&I.equals(b[b.length-1])||(b=[I],d.push(b)),b.push(P)))))}}return d}jt("Anchor",Qa);const Ku=1e20;function jp(t,e,r,s,c,d,m,y,b){for(let E=e;E<e+s;E++)Dg(t,r*d+E,d,c,m,y,b);for(let E=r;E<r+c;E++)Dg(t,E*d+e,1,s,m,y,b)}function Dg(t,e,r,s,c,d,m){d[0]=0,m[0]=-Ku,m[1]=Ku,c[0]=t[e];for(let y=1,b=0,E=0;y<s;y++){c[y]=t[e+y*r];const I=y*y;do{const P=d[b];E=(c[y]-c[P]+I-P*P)/(y-P)/2}while(E<=m[b]&&--b>-1);b++,d[b]=y,m[b]=E,m[b+1]=Ku}for(let y=0,b=0;y<s;y++){for(;m[b+1]<y;)b++;const E=d[b],I=y-E;t[e+y*r]=c[E]+I*I}}const $p={none:0,ideographs:1,all:2};class Rc{constructor(e,r,s){this.requestManager=e,this.localGlyphMode=r,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,r){const s=[];for(const c in e)for(const d of e[c])s.push({stack:c,id:d});ti(s,({stack:c,id:d},m)=>{let y=this.entries[c];y||(y=this.entries[c]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let b=y.glyphs[d];if(void 0!==b)return void m(null,{stack:c,id:d,glyph:b});if(b=this._tinySDF(y,c,d),b)return y.glyphs[d]=b,void m(null,{stack:c,id:d,glyph:b});const E=Math.floor(d/256);if(256*E>65535)return void m(new Error("glyphs > 65535 not supported"));if(y.ranges[E])return void m(null,{stack:c,id:d,glyph:b});let I=y.requests[E];I||(I=y.requests[E]=[],Rc.loadGlyphRange(c,E,this.url,this.requestManager,(P,R)=>{if(R){y.ascender=R.ascender,y.descender=R.descender;for(const j in R.glyphs)this._doesCharSupportLocalGlyph(+j)||(y.glyphs[+j]=R.glyphs[+j]);y.ranges[E]=!0}for(const j of I)j(P,R);delete y.requests[E]})),I.push((P,R)=>{P?m(P):R&&m(null,{stack:c,id:d,glyph:R.glyphs[d]||null})})},(c,d)=>{if(c)r(c);else if(d){const m={};for(const{stack:y,id:b,glyph:E}of d)void 0===m[y]&&(m[y]={}),void 0===m[y].glyphs&&(m[y].glyphs={}),m[y].glyphs[b]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},m[y].ascender=this.entries[y].ascender,m[y].descender=this.entries[y].descender;r(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==$p.none&&(this.localGlyphMode===$p.all?!!this.localFontFamily:!!this.localFontFamily&&(ee(e)||fe(e)||F(e)||O(e))||S(e))}_tinySDF(e,r,s){const c=this.localFontFamily;if(!c||!this._doesCharSupportLocalGlyph(s))return;let d=e.tinySDF;if(!d){let Q="400";/bold/i.test(r)?Q="900":/medium/i.test(r)?Q="500":/light/i.test(r)&&(Q="200"),d=e.tinySDF=new Rc.TinySDF({fontFamily:c,fontWeight:Q,fontSize:48,buffer:6,radius:16}),d.fontWeight=Q}if(this.localGlyphs[d.fontWeight][s])return this.localGlyphs[d.fontWeight][s];const m=String.fromCharCode(s),{data:y,width:b,height:E,glyphWidth:I,glyphHeight:P,glyphLeft:R,glyphTop:j,glyphAdvance:H}=d.draw(m);return this.localGlyphs[d.fontWeight][s]={id:s,bitmap:new Tl({width:b,height:E},y),metrics:{width:I/2,height:P/2,left:R/2,top:j/2-27,advance:H/2,localGlyph:!0}}}}function Cg(t,e,r,s){const c=[],d=t.image,m=d.pixelRatio,y=d.paddedRect.w-2,b=d.paddedRect.h-2,E=t.right-t.left,I=t.bottom-t.top,P=d.stretchX||[[0,y]],R=d.stretchY||[[0,b]],j=(tt,gt)=>tt+gt[1]-gt[0],H=P.reduce(j,0),Q=R.reduce(j,0),ne=y-H,ce=b-Q;let ye=0,De=H,Ae=0,ke=Q,Re=0,rt=ne,Je=0,Tt=ce;if(d.content&&s){const tt=d.content;ye=Nh(P,0,tt[0]),Ae=Nh(R,0,tt[1]),De=Nh(P,tt[0],tt[2]),ke=Nh(R,tt[1],tt[3]),Re=tt[0]-ye,Je=tt[1]-Ae,rt=tt[2]-tt[0]-De,Tt=tt[3]-tt[1]-ke}const vt=(tt,gt,St,at)=>{const Bt=Qu(tt.stretch-ye,De,E,t.left),Zt=Vh(tt.fixed-Re,rt,tt.stretch,H),Xn=Qu(gt.stretch-Ae,ke,I,t.top),Rr=Vh(gt.fixed-Je,Tt,gt.stretch,Q),Jn=Qu(St.stretch-ye,De,E,t.left),jn=Vh(St.fixed-Re,rt,St.stretch,H),pt=Qu(at.stretch-Ae,ke,I,t.top),ar=Vh(at.fixed-Je,Tt,at.stretch,Q),ir=new et(Bt,Xn),Di=new et(Jn,Xn),di=new et(Jn,pt),Qi=new et(Bt,pt),Mo=new et(Zt/m,Rr/m),lr=new et(jn/m,ar/m),Yn=e*Math.PI/180;if(Yn){const li=Math.sin(Yn),ji=Math.cos(Yn),Ji=[ji,-li,li,ji];ir._matMult(Ji),Di._matMult(Ji),Qi._matMult(Ji),di._matMult(Ji)}const Wr=tt.stretch+tt.fixed,_i=gt.stretch+gt.fixed;return{tl:ir,tr:Di,bl:Qi,br:di,tex:{x:d.paddedRect.x+1+Wr,y:d.paddedRect.y+1+_i,w:St.stretch+St.fixed-Wr,h:at.stretch+at.fixed-_i},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Mo,pixelOffsetBR:lr,minFontScaleX:rt/m/E,minFontScaleY:Tt/m/I,isSDF:r}};if(s&&(d.stretchX||d.stretchY)){const tt=Uh(P,ne,H),gt=Uh(R,ce,Q);for(let St=0;St<tt.length-1;St++){const at=tt[St],Bt=tt[St+1];for(let Zt=0;Zt<gt.length-1;Zt++)c.push(vt(at,gt[Zt],Bt,gt[Zt+1]))}}else c.push(vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return c}function Nh(t,e,r){let s=0;for(const c of t)s+=Math.max(e,Math.min(r,c[1]))-Math.max(e,Math.min(r,c[0]));return s}function Uh(t,e,r){const s=[{fixed:-1,stretch:0}];for(const[c,d]of t){const m=s[s.length-1];s.push({fixed:c-m.stretch,stretch:m.stretch}),s.push({fixed:c-m.stretch,stretch:m.stretch+(d-c)})}return s.push({fixed:e+1,stretch:r}),s}function Qu(t,e,r,s){return t/e*r+s}function Vh(t,e,r,s){return t-e*r/s}function Sg(t,e,r,s){const c=e+t.positionedLines[s].lineOffset;return 0===s?r+c/2:r+(c+(e+t.positionedLines[s-1].lineOffset))/2}Rc.loadGlyphRange=function(t,e,r,s,c){const d=256*e,m=d+255,y=s.transformRequest(s.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}",`${d}-${m}`),ci.Glyphs);Dr(y,(b,E)=>{if(b)c(b);else if(E){const I={},P=new Gu(E).readFields(nc,{});for(const R of P.glyphs)I[R.id]=R;c(null,{glyphs:I,ascender:P.ascender,descender:P.descender})}})},Rc.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:r=8,cutoff:s=.25,fontFamily:c="sans-serif",fontWeight:d="normal",fontStyle:m="normal"}){this.buffer=e,this.cutoff=s,this.radius=r;const y=this.size=t+4*e,b=this._createCanvas(y),E=this.ctx=b.getContext("2d",{willReadFrequently:!0});E.font=`${m} ${d} ${t}px ${c}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:r,actualBoundingBoxDescent:s,actualBoundingBoxLeft:c,actualBoundingBoxRight:d}=this.ctx.measureText(t),m=Math.floor(r),y=Math.min(this.size-this.buffer,Math.ceil(d-c)),b=Math.min(this.size-this.buffer,Math.ceil(r)+Math.ceil(s)),E=y+2*this.buffer,I=b+2*this.buffer,P=E*I,R=new Uint8ClampedArray(P),j={data:R,width:E,height:I,glyphWidth:y,glyphHeight:b,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(0===y||0===b)return j;const{ctx:H,buffer:Q,gridInner:ne,gridOuter:ce}=this;H.clearRect(Q,Q,y,b),H.fillText(t,Q,Q+m+1);const ye=H.getImageData(Q,Q,y,b);ce.fill(Ku,0,P),ne.fill(0,0,P);for(let De=0;De<b;De++)for(let Ae=0;Ae<y;Ae++){const ke=ye.data[4*(De*y+Ae)+3]/255;if(0===ke)continue;const Re=(De+Q)*E+Ae+Q;if(1===ke)ce[Re]=0,ne[Re]=Ku;else{const rt=.5-ke;ce[Re]=rt>0?rt*rt:0,ne[Re]=rt<0?rt*rt:0}}jp(ce,0,0,E,I,E,this.f,this.v,this.z),jp(ne,Q,Q,y,b,E,this.f,this.v,this.z);for(let De=0;De<P;De++){const Ae=Math.sqrt(ce[De])-Math.sqrt(ne[De]);R[De]=Math.round(255-255*(Ae/this.radius+this.cutoff))}return j}};class Mg{constructor(e=[],r=Gp){if(this.data=e,this.length=this.data.length,this.compare=r,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],r=this.data.pop();return this.length--,this.length>0&&(this.data[0]=r,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:r,compare:s}=this,c=r[e];for(;e>0;){const d=e-1>>1,m=r[d];if(s(c,m)>=0)break;r[e]=m,e=d}r[e]=c}_down(e){const{data:r,compare:s}=this,c=this.length>>1,d=r[e];for(;e<c;){let m=1+(e<<1),y=r[m];const b=m+1;if(b<this.length&&s(r[b],y)<0&&(m=b,y=r[b]),s(y,d)>=0)break;r[e]=y,e=m}r[e]=d}}function Gp(t,e){return t<e?-1:t>e?1:0}function Ig(t,e=1,r=!1){let s=1/0,c=1/0,d=-1/0,m=-1/0;const y=t[0];for(let j=0;j<y.length;j++){const H=y[j];(!j||H.x<s)&&(s=H.x),(!j||H.y<c)&&(c=H.y),(!j||H.x>d)&&(d=H.x),(!j||H.y>m)&&(m=H.y)}const b=Math.min(d-s,m-c);let E=b/2;const I=new Mg([],Hp);if(0===b)return new et(s,c);for(let j=s;j<d;j+=b)for(let H=c;H<m;H+=b)I.push(new fu(j+E,H+E,E,t));let P=function(j){let H=0,Q=0,ne=0;const ce=j[0];for(let ye=0,De=ce.length,Ae=De-1;ye<De;Ae=ye++){const ke=ce[ye],Re=ce[Ae],rt=ke.x*Re.y-Re.x*ke.y;Q+=(ke.x+Re.x)*rt,ne+=(ke.y+Re.y)*rt,H+=3*rt}return new fu(Q/H,ne/H,0,j)}(t),R=I.length;for(;I.length;){const j=I.pop();(j.d>P.d||!P.d)&&(P=j,r&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,R)),j.max-P.d<=e||(E=j.h/2,I.push(new fu(j.p.x-E,j.p.y-E,E,t)),I.push(new fu(j.p.x+E,j.p.y-E,E,t)),I.push(new fu(j.p.x-E,j.p.y+E,E,t)),I.push(new fu(j.p.x+E,j.p.y+E,E,t)),R+=4)}return r&&(console.log(`num probes: ${R}`),console.log(`best distance: ${P.d}`)),P.p}function Hp(t,e){return e.max-t.max}function fu(t,e,r,s){this.p=new et(t,e),this.h=r,this.d=function(c,d){let m=!1,y=1/0;for(let b=0;b<d.length;b++){const E=d[b];for(let I=0,P=E.length,R=P-1;I<P;R=I++){const j=E[I],H=E[R];j.y>c.y!=H.y>c.y&&c.x<(H.x-j.x)*(c.y-j.y)/(H.y-j.y)+j.x&&(m=!m),y=Math.min(y,Id(c,j,H))}}return(m?1:-1)*Math.sqrt(y)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const cf=Number.POSITIVE_INFINITY,Zp=Math.sqrt(2);function uf(t,e){return e[1]!==cf?function(r,s,c){let d=0,m=0;switch(s=Math.abs(s),c=Math.abs(c),r){case"top-right":case"top-left":case"top":m=c-7;break;case"bottom-right":case"bottom-left":case"bottom":m=7-c}switch(r){case"top-right":case"bottom-right":case"right":d=-s;break;case"top-left":case"bottom-left":case"left":d=s}return[d,m]}(t,e[0],e[1]):function(r,s){let c=0,d=0;s<0&&(s=0);const m=s/Zp;switch(r){case"top-right":case"top-left":d=m-7;break;case"bottom-right":case"bottom-left":d=7-m;break;case"bottom":d=7-s;break;case"top":d=s-7}switch(r){case"top-right":case"bottom-right":c=-m;break;case"top-left":case"bottom-left":c=m;break;case"left":c=s;break;case"right":c=-s}return[c,d]}(t,e[0])}function Ag(t,e,r,s,c,d,m,y,b,E){t.createArrays(),t.tilePixelRatio=Wn/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const I=t.layers[0].layout,P=t.layers[0]._unevaluatedLayout._values,R={};if("composite"===t.textSizeData.kind){const{minZoom:Q,maxZoom:ne}=t.textSizeData;R.compositeTextSizes=[P["text-size"].possiblyEvaluate(new wn(Q),y),P["text-size"].possiblyEvaluate(new wn(ne),y)]}if("composite"===t.iconSizeData.kind){const{minZoom:Q,maxZoom:ne}=t.iconSizeData;R.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new wn(Q),y),P["icon-size"].possiblyEvaluate(new wn(ne),y)]}R.layoutTextSize=P["text-size"].possiblyEvaluate(new wn(b+1),y),R.layoutIconSize=P["icon-size"].possiblyEvaluate(new wn(b+1),y),R.textMaxSize=P["text-size"].possiblyEvaluate(new wn(18),y);const j="map"===I.get("text-rotation-alignment")&&"point"!==I.get("symbol-placement"),H=I.get("text-size");for(const Q of t.features){const ne=I.get("text-font").evaluate(Q,{},y).join(","),ce=H.evaluate(Q,{},y),ye=R.layoutTextSize.evaluate(Q,{},y),De=(R.layoutIconSize.evaluate(Q,{},y),{horizontal:{},vertical:void 0}),Ae=Q.text;let ke,Re=[0,0];if(Ae){const Tt=Ae.toString(),vt=24*I.get("text-letter-spacing").evaluate(Q,{},y),tt=24*I.get("text-line-height").evaluate(Q,{},y),gt=Ue(Tt)?vt:0,St=I.get("text-anchor").evaluate(Q,{},y),at=I.get("text-variable-anchor");if(!at){const jn=I.get("text-radial-offset").evaluate(Q,{},y);Re=jn?uf(St,[24*jn,cf]):I.get("text-offset").evaluate(Q,{},y).map(pt=>24*pt)}let Bt=j?"center":I.get("text-justify").evaluate(Q,{},y);const Zt=I.get("symbol-placement"),Xn="point"===Zt,Rr="point"===Zt?24*I.get("text-max-width").evaluate(Q,{},y):0,Jn=jn=>{t.allowVerticalPlacement&&Ke(Tt)&&(De.vertical=rc(Ae,e,r,c,ne,Rr,tt,St,jn,gt,Re,Gs.vertical,!0,Zt,ye,ce))};if(!j&&at){const jn="auto"===Bt?at.map(ar=>oa(ar)):[Bt];let pt=!1;for(let ar=0;ar<jn.length;ar++){const ir=jn[ar];if(!De.horizontal[ir])if(pt)De.horizontal[ir]=De.horizontal[0];else{const Di=rc(Ae,e,r,c,ne,Rr,tt,"center",ir,gt,Re,Gs.horizontal,!1,Zt,ye,ce);Di&&(De.horizontal[ir]=Di,pt=1===Di.positionedLines.length)}}Jn("left")}else{if("auto"===Bt&&(Bt=oa(St)),Xn||I.get("text-writing-mode").indexOf("horizontal")>=0||!Ke(Tt)){const jn=rc(Ae,e,r,c,ne,Rr,tt,St,Bt,gt,Re,Gs.horizontal,!1,Zt,ye,ce);jn&&(De.horizontal[Bt]=jn)}Jn("point"===Zt?"left":Bt)}}let rt=!1;if(Q.icon&&Q.icon.name){const Tt=s[Q.icon.name];Tt&&(ke=Bh(c[Q.icon.name],I.get("icon-offset").evaluate(Q,{},y),I.get("icon-anchor").evaluate(Q,{},y)),rt=Tt.sdf,void 0===t.sdfIcons?t.sdfIcons=Tt.sdf:t.sdfIcons!==Tt.sdf&&Hn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Tt.pixelRatio!==t.pixelRatio||0!==I.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const Je=Pg(De.horizontal)||De.vertical;t.iconsInText||(t.iconsInText=!!Je&&Je.iconsInText),(Je||ke)&&hf(t,Q,De,ke,s,R,ye,0,Re,rt,m,y,E)}d&&t.generateCollisionDebugBuffers(b,t.collisionBoxArray)}function oa(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function hf(t,e,r,s,c,d,m,y,b,E,I,P,R){let j=d.textMaxSize.evaluate(e,{},P);void 0===j&&(j=m);const H=t.layers[0].layout,Q=H.get("icon-offset").evaluate(e,{},P),ne=Pg(r.horizontal)||r.vertical,ce=m/24,ye=t.tilePixelRatio*j/24,De=t.tilePixelRatio*H.get("symbol-spacing"),Ae=H.get("text-padding")*t.tilePixelRatio,ke=H.get("icon-padding")*t.tilePixelRatio,Re=Cn(H.get("text-max-angle")),rt="map"===H.get("text-rotation-alignment")&&"point"!==H.get("symbol-placement"),Je="map"===H.get("icon-rotation-alignment")&&"point"!==H.get("symbol-placement"),Tt=H.get("symbol-placement"),vt=De/2,tt=H.get("icon-text-fit");let gt;s&&"none"!==tt&&(t.allowVerticalPlacement&&r.vertical&&(gt=Bp(s,r.vertical,tt,H.get("icon-text-fit-padding"),Q,ce)),ne&&(s=Bp(s,ne,tt,H.get("icon-text-fit-padding"),Q,ce)));const St=(at,Bt,Zt)=>{if(Bt.x<0||Bt.x>=Wn||Bt.y<0||Bt.y>=Wn)return;const{x:Xn,y:Rr,z:Jn}=R.projectTilePoint(Bt.x,Bt.y,Zt),jn=new Qa(Xn,Rr,Jn,0,void 0);!function(pt,ar,ir,Di,di,Qi,Mo,lr,Yn,Wr,_i,li,ji,Ji,cs,bs,Ir,$i,ws,Gi,Ar,Ci,Br,co,eo){const Io=pt.addToLineVertexArray(ar,Di);let bo,wo,Hi,la,ac,Du,Cu,td=0,Af=0,ym=0,Pf=0,nd=-1,lh=-1;const Pa={};let vm=Kc(""),kf=0,Rf=0;if(void 0===Yn._unevaluatedLayout.getValue("text-radial-offset")?[kf,Rf]=Yn.layout.get("text-offset").evaluate(Ar,{},eo).map(us=>24*us):(kf=24*Yn.layout.get("text-radial-offset").evaluate(Ar,{},eo),Rf=cf),pt.allowVerticalPlacement&&di.vertical){const us=di.vertical;if(cs)Du=df(us),lr&&(Cu=df(lr));else{const hs=Yn.layout.get("text-rotate").evaluate(Ar,{},eo)+90;Hi=Ju(Wr,ir,ar,_i,li,ji,us,Ji,hs,bs),lr&&(la=Ju(Wr,ir,ar,_i,li,ji,lr,$i,hs))}}if(Qi){const us=Yn.layout.get("icon-rotate").evaluate(Ar,{},eo),hs="none"!==Yn.layout.get("icon-text-fit"),Su=Cg(Qi,us,Br,hs),rd=lr?Cg(lr,us,Br,hs):void 0;wo=Ju(Wr,ir,ar,_i,li,ji,Qi,$i,us),td=4*Su.length;const Lf=pt.iconSizeData;let lc=null;"source"===Lf.kind?(lc=[Dl*Yn.layout.get("icon-size").evaluate(Ar,{},eo)],lc[0]>ic&&Hn(`${pt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Lf.kind&&(lc=[Dl*Ci.compositeIconSizes[0].evaluate(Ar,{},eo),Dl*Ci.compositeIconSizes[1].evaluate(Ar,{},eo)],(lc[0]>ic||lc[1]>ic)&&Hn(`${pt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),pt.addSymbols(pt.icon,Su,lc,Gi,ws,Ar,!1,ir,ar,Io.lineStartIndex,Io.lineLength,-1,co,eo),nd=pt.icon.placedSymbolArray.length-1,rd&&(Af=4*rd.length,pt.addSymbols(pt.icon,rd,lc,Gi,ws,Ar,Gs.vertical,ir,ar,Io.lineStartIndex,Io.lineLength,-1,co,eo),lh=pt.icon.placedSymbolArray.length-1)}for(const us in di.horizontal){const hs=di.horizontal[us];bo||(vm=Kc(hs.text),cs?ac=df(hs):bo=Ju(Wr,ir,ar,_i,li,ji,hs,Ji,Yn.layout.get("text-rotate").evaluate(Ar,{},eo),bs));const Su=1===hs.positionedLines.length;if(ym+=qp(pt,ir,ar,hs,Mo,Yn,cs,Ar,bs,Io,di.vertical?Gs.horizontal:Gs.horizontalOnly,Su?Object.keys(di.horizontal):[us],Pa,nd,Ci,co,eo),Su)break}di.vertical&&(Pf+=qp(pt,ir,ar,di.vertical,Mo,Yn,cs,Ar,bs,Io,Gs.vertical,["vertical"],Pa,lh,Ci,co,eo));let Pl=-1;const ch=(us,hs)=>us?Math.max(us,hs):hs;Pl=ch(ac,Pl),Pl=ch(Du,Pl),Pl=ch(Cu,Pl);const xm=Pl>-1?1:0;pt.glyphOffsetArray.length>=Ja.MAX_GLYPHS&&Hn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Ar.sortKey&&pt.addToSortKeyRanges(pt.symbolInstances.length,Ar.sortKey),pt.symbolInstances.emplaceBack(ir.x,ir.y,ir.z,ar.x,ar.y,Pa.right>=0?Pa.right:-1,Pa.center>=0?Pa.center:-1,Pa.left>=0?Pa.left:-1,Pa.vertical>=0?Pa.vertical:-1,nd,lh,vm,void 0!==bo?bo:pt.collisionBoxArray.length,void 0!==bo?bo+1:pt.collisionBoxArray.length,void 0!==Hi?Hi:pt.collisionBoxArray.length,void 0!==Hi?Hi+1:pt.collisionBoxArray.length,void 0!==wo?wo:pt.collisionBoxArray.length,void 0!==wo?wo+1:pt.collisionBoxArray.length,la||pt.collisionBoxArray.length,la?la+1:pt.collisionBoxArray.length,_i,ym,Pf,td,Af,xm,0,kf,Rf,Pl)}(t,Bt,jn,at,r,s,c,gt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Ae,rt,b,0,ke,Je,Q,e,d,E,I,P)};if("line"===Tt)for(const at of xs(e.geometry,0,0,Wn,Wn)){const Bt=Tg(at,De,Re,r.vertical||ne,s,24,ye,t.overscaling,Wn);for(const Zt of Bt){const Xn=ne;Xn&&kg(t,Xn.text,vt,Zt)||St(at,Zt,P)}}else if("line-center"===Tt){for(const at of e.geometry)if(at.length>1){const Bt=Up(at,Re,r.vertical||ne,s,24,ye);Bt&&St(at,Bt,P)}}else if("Polygon"===e.type)for(const at of Ih(e.geometry,0)){const Bt=Ig(at,16);St(at[0],new Qa(Bt.x,Bt.y,0,0,void 0),P)}else if("LineString"===e.type)for(const at of e.geometry)St(at,new Qa(at[0].x,at[0].y,0,0,void 0),P);else if("Point"===e.type)for(const at of e.geometry)for(const Bt of at)St([Bt],new Qa(Bt.x,Bt.y,0,0,void 0),P)}const ic=32640;function qp(t,e,r,s,c,d,m,y,b,E,I,P,R,j,H,Q,ne){const ce=function(Ae,ke,Re,rt,Je,Tt,vt,tt){const gt=[];if(0===ke.positionedLines.length)return gt;const St=rt.layout.get("text-rotate").evaluate(Tt,{})*Math.PI/180,at=function(Jn){const jn=Jn[0],pt=Jn[1],ar=jn*pt;return ar>0?[jn,-pt]:ar<0?[-jn,pt]:0===jn?[pt,jn]:[pt,-jn]}(Re);let Bt=Math.abs(ke.top-ke.bottom);for(const Jn of ke.positionedLines)Bt-=Jn.lineOffset;const Zt=ke.positionedLines.length,Xn=Bt/Zt;let Rr=ke.top-Re[1];for(let Jn=0;Jn<Zt;++Jn){const jn=ke.positionedLines[Jn];Rr=Sg(ke,Xn,Rr,Jn);for(const pt of jn.positionedGlyphs){if(!pt.rect)continue;const ar=pt.rect||{};let ir=4,Di=!0,di=1,Qi=0;if(pt.imageName){const Br=vt[pt.imageName];if(!Br)continue;if(Br.sdf){Hn("SDF images are not supported in formatted text and will be ignored.");continue}Di=!1,di=Br.pixelRatio,ir=1/di}const Mo=(Je||tt)&&pt.vertical,lr=pt.metrics.advance*pt.scale/2,Yn=pt.metrics,Wr=pt.rect;if(null===Wr)continue;tt&&ke.verticalizable&&(Qi=pt.imageName?lr-pt.metrics.width*pt.scale/2:0);const _i=Je?[pt.x+lr,pt.y]:[0,0];let li=[0,0],ji=[0,0],Ji=!1;Je||(Mo?(ji=[pt.x+lr+at[0],pt.y+at[1]-Qi],Ji=!0):li=[pt.x+lr+Re[0],pt.y+Re[1]-Qi]);const cs=Wr.w*pt.scale/(di*(pt.localGlyph?2:1)),bs=Wr.h*pt.scale/(di*(pt.localGlyph?2:1));let Ir,$i,ws,Gi;if(Mo){const Br=pt.y-Rr,co=new et(-lr,lr-Br),eo=-Math.PI/2,Io=new et(...ji);Ir=new et(-lr+li[0],li[1]),Ir._rotateAround(eo,co)._add(Io),Ir.x+=-Br+lr,Ir.y-=(Yn.left-ir)*pt.scale;const bo=pt.imageName?Yn.advance*pt.scale:24*pt.scale,wo=String.fromCharCode(pt.glyph);gg(wo)?Ir.x+=(1-ir)*pt.scale:j_(wo)?Ir.x+=bo-Yn.height*pt.scale+(-ir-1)*pt.scale:Ir.x+=pt.imageName||Yn.width+2*ir===Wr.w&&Yn.height+2*ir===Wr.h?(bo-bs)/2:(bo-(Yn.height+2*ir)*pt.scale)/2,$i=new et(Ir.x,Ir.y-cs),ws=new et(Ir.x+bs,Ir.y),Gi=new et(Ir.x+bs,Ir.y-cs)}else{const Br=(Yn.left-ir)*pt.scale-lr+li[0],co=(-Yn.top-ir)*pt.scale+li[1],eo=Br+cs,Io=co+bs;Ir=new et(Br,co),$i=new et(eo,co),ws=new et(Br,Io),Gi=new et(eo,Io)}if(St){let Br;Br=Je?new et(0,0):Ji?new et(at[0],at[1]):new et(Re[0],Re[1]),Ir._rotateAround(St,Br),$i._rotateAround(St,Br),ws._rotateAround(St,Br),Gi._rotateAround(St,Br)}const Ar=new et(0,0),Ci=new et(0,0);gt.push({tl:Ir,tr:$i,bl:ws,br:Gi,tex:ar,writingMode:ke.writingMode,glyphOffset:_i,sectionIndex:pt.sectionIndex,isSDF:Di,pixelOffsetTL:Ar,pixelOffsetBR:Ci,minFontScaleX:0,minFontScaleY:0})}}return gt}(0,s,b,d,m,y,c,t.allowVerticalPlacement),ye=t.textSizeData;let De=null;"source"===ye.kind?(De=[Dl*d.layout.get("text-size").evaluate(y,{},ne)],De[0]>ic&&Hn(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ye.kind&&(De=[Dl*H.compositeTextSizes[0].evaluate(y,{},ne),Dl*H.compositeTextSizes[1].evaluate(y,{},ne)],(De[0]>ic||De[1]>ic)&&Hn(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,ce,De,b,m,y,I,e,r,E.lineStartIndex,E.lineLength,j,Q,ne);for(const Ae of P)R[Ae]=t.text.placedSymbolArray.length-1;return 4*ce.length}function Pg(t){for(const e in t)return t[e];return null}function Ju(t,e,r,s,c,d,m,y,b,E){let I=m.top,P=m.bottom,R=m.left,j=m.right;const H=m.collisionPadding;if(H&&(R-=H[0],I-=H[1],j+=H[2],P+=H[3]),b){const Q=new et(R,I),ne=new et(j,I),ce=new et(R,P),ye=new et(j,P),De=Cn(b);let Ae=new et(0,0);E&&(Ae=new et(E[0],E[1])),Q._rotateAround(De,Ae),ne._rotateAround(De,Ae),ce._rotateAround(De,Ae),ye._rotateAround(De,Ae),R=Math.min(Q.x,ne.x,ce.x,ye.x),j=Math.max(Q.x,ne.x,ce.x,ye.x),I=Math.min(Q.y,ne.y,ce.y,ye.y),P=Math.max(Q.y,ne.y,ce.y,ye.y)}return t.emplaceBack(e.x,e.y,e.z,r.x,r.y,R,I,j,P,y,s,c,d),t.length-1}function df(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function kg(t,e,r,s){const c=t.compareText;if(e in c){const d=c[e];for(let m=d.length-1;m>=0;m--)if(s.dist(d[m])<r)return!0}else c[e]=[];return c[e].push(s),!1}const Rg=Ql.VectorTileFeature.types,ff=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function jh(t,e,r,s,c,d,m,y,b,E,I,P,R,j,H,Q){const ne=I?Math.min(ic,Math.round(I[0])):0,ce=I?Math.min(ic,Math.round(I[1])):0;t.emplaceBack(e,r,Math.round(32*m),Math.round(32*y),b,E,(ne<<1)+(P?1:0),ce,16*R,16*j,256*H,256*Q,s,c,d,0)}function pf(t,e,r){t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r),t.emplaceBack(e.x,e.y,r)}function $h(t){for(const e of t.sections)if(xt(e.text))return!0;return!1}class eh{constructor(e){this.layoutVertexArray=new dd,this.indexArray=new vs,this.programConfigurations=e,this.segments=new Li,this.dynamicLayoutVertexArray=new Xl,this.opacityVertexArray=new Wf,this.placedSymbolArray=new Nm}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,r,s,c){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kp.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,r),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,V_.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ff,!0),this.opacityVertexBuffer.itemSize=1),(s||c)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}jt("SymbolBuffers",eh);class mf{constructor(e,r,s){this.layoutVertexArray=new e,this.layoutAttributes=r,this.indexArray=new s,this.segments=new Li,this.collisionVertexArray=new gh,this.collisionVertexArrayExt=new Xl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Rh.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Lh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}jt("CollisionBuffers",mf);class Ja{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ft([]),this.placementViewportMatrix=Ft([]);const r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Yd(this.zoom,r["text-size"]),this.iconSizeData=Yd(this.zoom,r["icon-size"]);const s=this.layers[0].layout,c=s.get("symbol-sort-key"),d=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==d&&void 0!==c.constantOr(1),this.sortFeaturesByY=("viewport-y"===d||"auto"===d&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(m=>Gs[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID}createArrays(){this.text=new eh(new ai(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new eh(new ai(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Qf,this.lineVertexArray=new Jf,this.symbolInstances=new Kf}calculateGlyphDependencies(e,r,s,c,d){for(let m=0;m<e.length;m++)if(r[e.charCodeAt(m)]=!0,c&&d){const y=zh[e.charAt(m)];y&&(r[y.charCodeAt(0)]=!0)}}populate(e,r,s,c){const d=this.layers[0],m=d.layout,y=m.get("text-font"),b=m.get("text-field"),E=m.get("icon-image"),I=("constant"!==b.value.kind||b.value.value instanceof bn&&!b.value.value.isEmpty()||b.value.value.toString().length>0)&&("constant"!==y.value.kind||y.value.value.length>0),P="constant"!==E.value.kind||!!E.value.value||Object.keys(E.parameters).length>0,R=m.get("symbol-sort-key");if(this.features=[],!I&&!P)return;const j=r.iconDependencies,H=r.glyphDependencies,Q=r.availableImages,ne=new wn(this.zoom);for(const{feature:ce,id:ye,index:De,sourceLayerIndex:Ae}of e){const ke=d._featureFilter.needGeometry,Re=Sc(ce,ke);if(!d._featureFilter.filter(ne,Re,s))continue;let rt,Je;if(ke||(Re.geometry=El(ce,s,c)),I){const vt=d.getValueAndResolveTokens("text-field",Re,s,Q),tt=bn.factory(vt);$h(tt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===jo()||this.hasRTLText&&nr.isParsed())&&(rt=Rp(tt,d,Re))}if(P){const vt=d.getValueAndResolveTokens("icon-image",Re,s,Q);Je=vt instanceof so?vt:so.fromString(vt)}if(!rt&&!Je)continue;const Tt=this.sortFeaturesByKey?R.evaluate(Re,{},s):void 0;if(this.features.push({id:ye,text:rt,icon:Je,index:De,sourceLayerIndex:Ae,geometry:Re.geometry,properties:ce.properties,type:Rg[ce.type],sortKey:Tt}),Je&&(j[Je.name]=!0),rt){const vt=y.evaluate(Re,{},s).join(","),tt="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Gs.vertical)>=0;for(const gt of rt.sections)if(gt.image)j[gt.image.name]=!0;else{const St=Ke(rt.toString()),at=gt.fontStack||vt,Bt=H[at]=H[at]||{};this.calculateGlyphDependencies(gt.text,Bt,tt,this.allowVerticalPlacement,St)}}}"line"===m.get("symbol-placement")&&(this.features=function(ce){const ye={},De={},Ae=[];let ke=0;function Re(vt){Ae.push(ce[vt]),ke++}function rt(vt,tt,gt){const St=De[vt];return delete De[vt],De[tt]=St,Ae[St].geometry[0].pop(),Ae[St].geometry[0]=Ae[St].geometry[0].concat(gt[0]),St}function Je(vt,tt,gt){const St=ye[tt];return delete ye[tt],ye[vt]=St,Ae[St].geometry[0].shift(),Ae[St].geometry[0]=gt[0].concat(Ae[St].geometry[0]),St}function Tt(vt,tt,gt){const St=gt?tt[0][tt[0].length-1]:tt[0][0];return`${vt}:${St.x}:${St.y}`}for(let vt=0;vt<ce.length;vt++){const tt=ce[vt],gt=tt.geometry,St=tt.text?tt.text.toString():null;if(!St){Re(vt);continue}const at=Tt(St,gt),Bt=Tt(St,gt,!0);if(at in De&&Bt in ye&&De[at]!==ye[Bt]){const Zt=Je(at,Bt,gt),Xn=rt(at,Bt,Ae[Zt].geometry);delete ye[at],delete De[Bt],De[Tt(St,Ae[Xn].geometry,!0)]=Xn,Ae[Zt].geometry=null}else at in De?rt(at,Bt,gt):Bt in ye?Je(at,Bt,gt):(Re(vt),ye[at]=ke-1,De[Bt]=ke-1)}return Ae.filter(vt=>vt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ce,ye)=>ce.sortKey-ye.sortKey)}update(e,r,s,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,r,this.layers,s,c),this.icon.programConfigurations.updatePaintArrays(e,r,this.layers,s,c))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,r){const s=this.lineVertexArray.length;if(void 0!==e.segment){let c=e.dist(r[e.segment+1]),d=e.dist(r[e.segment]);const m={};for(let y=e.segment+1;y<r.length;y++)m[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:c},y<r.length-1&&(c+=r[y+1].dist(r[y]));for(let y=e.segment||0;y>=0;y--)m[y]={x:r[y].x,y:r[y].y,tileUnitDistanceFromAnchor:d},y>0&&(d+=r[y-1].dist(r[y]));for(let y=0;y<r.length;y++){const b=m[y];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,r,s,c,d,m,y,b,E,I,P,R,j,H){const Q=e.indexArray,ne=e.layoutVertexArray,ce=e.segments.prepareSegment(4*r.length,ne,Q,this.canOverlap?m.sortKey:void 0),ye=this.glyphOffsetArray.length,De=ce.vertexLength,Ae=this.allowVerticalPlacement&&y===Gs.vertical?Math.PI/2:0,ke=m.text&&m.text.sections;for(let Re=0;Re<r.length;Re++){const{tl:rt,tr:Je,bl:Tt,br:vt,tex:tt,pixelOffsetTL:gt,pixelOffsetBR:St,minFontScaleX:at,minFontScaleY:Bt,glyphOffset:Zt,isSDF:Xn,sectionIndex:Rr}=r[Re],Jn=ce.vertexLength,jn=Zt[1];jh(ne,b.x,b.y,b.z,E.x,E.y,rt.x,jn+rt.y,tt.x,tt.y,s,Xn,gt.x,gt.y,at,Bt),jh(ne,b.x,b.y,b.z,E.x,E.y,Je.x,jn+Je.y,tt.x+tt.w,tt.y,s,Xn,St.x,gt.y,at,Bt),jh(ne,b.x,b.y,b.z,E.x,E.y,Tt.x,jn+Tt.y,tt.x,tt.y+tt.h,s,Xn,gt.x,St.y,at,Bt),jh(ne,b.x,b.y,b.z,E.x,E.y,vt.x,jn+vt.y,tt.x+tt.w,tt.y+tt.h,s,Xn,St.x,St.y,at,Bt),pf(e.dynamicLayoutVertexArray,b,Ae),Q.emplaceBack(Jn,Jn+1,Jn+2),Q.emplaceBack(Jn+1,Jn+2,Jn+3),ce.vertexLength+=4,ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Zt[0]),Re!==r.length-1&&Rr===r[Re+1].sectionIndex||e.programConfigurations.populatePaintArrays(ne.length,m,m.index,{},j,H,ke&&ke[Rr])}e.placedSymbolArray.emplaceBack(b.x,b.y,b.z,E.x,E.y,ye,this.glyphOffsetArray.length-ye,De,I,P,E.segment,s?s[0]:0,s?s[1]:0,c[0],c[1],y,0,!1,0,R,0)}_commitLayoutVertex(e,r,s,c,d,m,y){e.emplaceBack(r,s,c,d,m,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,r,s,c,d,m,y){const b=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),E=b.vertexLength,I=y.tileAnchorX,P=y.tileAnchorY;for(let j=0;j<4;j++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(r,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(r,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(r,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(r,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,c,d,m,I,P,new et(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,d,m,I,P,new et(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,c,d,m,I,P,new et(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,c,d,m,I,P,new et(e.x1,e.y2)),b.vertexLength+=4;const R=s.indexArray;R.emplaceBack(E,E+1),R.emplaceBack(E+1,E+2),R.emplaceBack(E+2,E+3),R.emplaceBack(E+3,E),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,r,s,c,d,m){for(let y=c;y<d;y++){const b=s.get(y),E=this.getSymbolInstanceTextSize(e,m,r,y);this._addCollisionDebugVertices(b,E,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,r,s,c,d,m){for(let y=c;y<d;y++){const b=s.get(y),E=this.getSymbolInstanceIconSize(e,r,y);this._addCollisionDebugVertices(b,E,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new mf(Xc,Fh.members,os),this.iconCollisionBox=new mf(Xc,Fh.members,os);const s=cu(this.iconSizeData,e),c=cu(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d);this._addTextDebugCollisionBoxes(c,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(c,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(s,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,r,s,c){const d=this.text.placedSymbolArray.get(r.rightJustifiedTextSymbolIndex>=0?r.rightJustifiedTextSymbolIndex:r.centerJustifiedTextSymbolIndex>=0?r.centerJustifiedTextSymbolIndex:r.leftJustifiedTextSymbolIndex>=0?r.leftJustifiedTextSymbolIndex:r.verticalPlacedTextSymbolIndex>=0?r.verticalPlacedTextSymbolIndex:c),m=Oh(this.textSizeData,e,d)/24;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,r,s){const c=this.icon.placedSymbolArray.get(s),d=Oh(this.iconSizeData,e,c);return this.tilePixelRatio*d}_commitDebugCollisionVertexUpdate(e,r,s){e.emplaceBack(r,-s,-s),e.emplaceBack(r,s,-s),e.emplaceBack(r,s,s),e.emplaceBack(r,-s,s)}_updateTextDebugCollisionBoxes(e,r,s,c,d,m){for(let y=c;y<d;y++){const b=s.get(y),E=this.getSymbolInstanceTextSize(e,m,r,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,b.padding)}}_updateIconDebugCollisionBoxes(e,r,s,c,d){for(let m=c;m<d;m++){const y=s.get(m),b=this.getSymbolInstanceIconSize(e,r,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,b,y.padding)}}updateCollisionDebugBuffers(e,r){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=cu(this.iconSizeData,e),c=cu(this.textSizeData,e);for(let d=0;d<this.symbolInstances.length;d++){const m=this.symbolInstances.get(d);this._updateTextDebugCollisionBoxes(c,e,r,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(c,e,r,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(s,e,r,m.iconBoxStartIndex,m.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(s,e,r,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,r,s,c,d,m,y,b,E){const I={};for(let P=r;P<s;P++){const R=e.get(P);I.textBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},I.textFeatureIndex=R.featureIndex;break}for(let P=c;P<d;P++){const R=e.get(P);I.verticalTextBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},I.verticalTextFeatureIndex=R.featureIndex;break}for(let P=m;P<y;P++){const R=e.get(P);I.iconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},I.iconFeatureIndex=R.featureIndex;break}for(let P=b;P<E;P++){const R=e.get(P);I.verticalIconBox={x1:R.x1,y1:R.y1,x2:R.x2,y2:R.y2,padding:R.padding,projectedAnchorX:R.projectedAnchorX,projectedAnchorY:R.projectedAnchorY,projectedAnchorZ:R.projectedAnchorZ,tileAnchorX:R.tileAnchorX,tileAnchorY:R.tileAnchorY},I.verticalIconFeatureIndex=R.featureIndex;break}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let r=0;r<this.symbolInstances.length;r++){const s=this.symbolInstances.get(r);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,r){const s=e.placedSymbolArray.get(r),c=s.vertexStartIndex+4*s.numGlyphs;for(let d=s.vertexStartIndex;d<c;d+=4)e.indexArray.emplaceBack(d,d+1,d+2),e.indexArray.emplaceBack(d+1,d+2,d+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const r=Math.sin(e),s=Math.cos(e),c=[],d=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const b=this.symbolInstances.get(y);c.push(0|Math.round(r*b.tileAnchorX+s*b.tileAnchorY)),d.push(b.featureIndex)}return m.sort((y,b)=>c[y]-c[b]||d[b]-d[y]),m}addToSortKeyRanges(e,r){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===r?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:r,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const r of this.symbolInstanceIndexes){const s=this.symbolInstances.get(r);this.featureSortOrder.push(s.featureIndex),[s.rightJustifiedTextSymbolIndex,s.centerJustifiedTextSymbolIndex,s.leftJustifiedTextSymbolIndex].forEach((c,d,m)=>{c>=0&&m.indexOf(c)===d&&this.addIndicesForPlacedSymbol(this.text,c)}),s.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,s.verticalPlacedTextSymbolIndex),s.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.placedIconSymbolIndex),s.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,s.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}jt("SymbolBucket",Ja,{omit:["layers","collisionBoxArray","features","compareText"]}),Ja.MAX_GLYPHS=65535,Ja.addDynamicAttributes=pf;const gf=new Ei({"symbol-placement":new $t(We.layout_symbol["symbol-placement"]),"symbol-spacing":new $t(We.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new $t(We.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new sn(We.layout_symbol["symbol-sort-key"]),"symbol-z-order":new $t(We.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new $t(We.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new $t(We.layout_symbol["icon-ignore-placement"]),"icon-optional":new $t(We.layout_symbol["icon-optional"]),"icon-rotation-alignment":new $t(We.layout_symbol["icon-rotation-alignment"]),"icon-size":new sn(We.layout_symbol["icon-size"]),"icon-text-fit":new $t(We.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $t(We.layout_symbol["icon-text-fit-padding"]),"icon-image":new sn(We.layout_symbol["icon-image"]),"icon-rotate":new sn(We.layout_symbol["icon-rotate"]),"icon-padding":new $t(We.layout_symbol["icon-padding"]),"icon-keep-upright":new $t(We.layout_symbol["icon-keep-upright"]),"icon-offset":new sn(We.layout_symbol["icon-offset"]),"icon-anchor":new sn(We.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new $t(We.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new $t(We.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new $t(We.layout_symbol["text-rotation-alignment"]),"text-field":new sn(We.layout_symbol["text-field"]),"text-font":new sn(We.layout_symbol["text-font"]),"text-size":new sn(We.layout_symbol["text-size"]),"text-max-width":new sn(We.layout_symbol["text-max-width"]),"text-line-height":new sn(We.layout_symbol["text-line-height"]),"text-letter-spacing":new sn(We.layout_symbol["text-letter-spacing"]),"text-justify":new sn(We.layout_symbol["text-justify"]),"text-radial-offset":new sn(We.layout_symbol["text-radial-offset"]),"text-variable-anchor":new $t(We.layout_symbol["text-variable-anchor"]),"text-anchor":new sn(We.layout_symbol["text-anchor"]),"text-max-angle":new $t(We.layout_symbol["text-max-angle"]),"text-writing-mode":new $t(We.layout_symbol["text-writing-mode"]),"text-rotate":new sn(We.layout_symbol["text-rotate"]),"text-padding":new $t(We.layout_symbol["text-padding"]),"text-keep-upright":new $t(We.layout_symbol["text-keep-upright"]),"text-transform":new sn(We.layout_symbol["text-transform"]),"text-offset":new sn(We.layout_symbol["text-offset"]),"text-allow-overlap":new $t(We.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new $t(We.layout_symbol["text-ignore-placement"]),"text-optional":new $t(We.layout_symbol["text-optional"])});var Gh={paint:new Ei({"icon-opacity":new sn(We.paint_symbol["icon-opacity"]),"icon-color":new sn(We.paint_symbol["icon-color"]),"icon-halo-color":new sn(We.paint_symbol["icon-halo-color"]),"icon-halo-width":new sn(We.paint_symbol["icon-halo-width"]),"icon-halo-blur":new sn(We.paint_symbol["icon-halo-blur"]),"icon-translate":new $t(We.paint_symbol["icon-translate"]),"icon-translate-anchor":new $t(We.paint_symbol["icon-translate-anchor"]),"text-opacity":new sn(We.paint_symbol["text-opacity"]),"text-color":new sn(We.paint_symbol["text-color"],{runtimeType:Yo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new sn(We.paint_symbol["text-halo-color"]),"text-halo-width":new sn(We.paint_symbol["text-halo-width"]),"text-halo-blur":new sn(We.paint_symbol["text-halo-blur"]),"text-translate":new $t(We.paint_symbol["text-translate"]),"text-translate-anchor":new $t(We.paint_symbol["text-translate-anchor"])}),layout:gf};class Wp{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Lo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const r=this.defaultValue.property.overrides;if(r&&r.hasOverride(e.formattedSection))return r.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}jt("FormatSectionOverride",Wp,{omit:["defaultValue"]});class Hh extends ba{constructor(e){super(e,Gh)}recalculate(e,r){super.recalculate(e,r),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const c=[];for(const d of s)c.indexOf(d)<0&&c.push(d);this.layout._values["text-writing-mode"]=c}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,r,s,c){const d=this.layout.get(e).evaluate(r,{},s,c),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Os(m.value)||!d?d:(y=r.properties,d.replace(/{([^{}]+)}/g,(E,I)=>I in y?String(y[I]):""));var y}createBucket(e){return new Ja(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Gh.paint.overridableProperties){if(!Hh.hasPaintOverride(this.layout,e))continue;const r=this.paint.get(e),s=new Wp(r),c=new Na(s,r.property.specification);let d=null;d="constant"===r.value.kind||"source"===r.value.kind?new Uo("source",c):new Gl("composite",c,r.value.zoomStops,r.value._interpolationType),this.paint._values[e]=new So(r.property,d,r.parameters)}}_handleOverridablePaintPropertyUpdate(e,r,s){return!(!this.layout||r.isDataDriven()||s.isDataDriven())&&Hh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,r){const s=e.get("text-field"),c=Gh.paint.properties[r];let d=!1;const m=y=>{for(const b of y)if(c.overrides&&c.overrides.hasOverride(b))return void(d=!0)};if("constant"===s.value.kind&&s.value.value instanceof bn)m(s.value.value.sections);else if("source"===s.value.kind){const y=E=>{d||(E instanceof As&&Ur(E.value)===Ds?m(E.value.sections):E instanceof Fo?m(E.sections):E.eachChild(y))},b=s.value;b._styleExpression&&y(b._styleExpression.expression)}return d}getProgramConfiguration(e){return new bl(this,e)}}var _f={paint:new Ei({"background-color":new $t(We.paint_background["background-color"]),"background-pattern":new xl(We.paint_background["background-pattern"]),"background-opacity":new $t(We.paint_background["background-opacity"])})},q_={paint:new Ei({"raster-opacity":new $t(We.paint_raster["raster-opacity"]),"raster-hue-rotate":new $t(We.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new $t(We.paint_raster["raster-brightness-min"]),"raster-brightness-max":new $t(We.paint_raster["raster-brightness-max"]),"raster-saturation":new $t(We.paint_raster["raster-saturation"]),"raster-contrast":new $t(We.paint_raster["raster-contrast"]),"raster-resampling":new $t(We.paint_raster["raster-resampling"]),"raster-fade-duration":new $t(We.paint_raster["raster-fade-duration"])})};class Lg extends ba{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Xp={paint:new Ei({"sky-type":new $t(We.paint_sky["sky-type"]),"sky-atmosphere-sun":new $t(We.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new $t(We.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new $t(We.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new $t(We.paint_sky["sky-gradient-radius"]),"sky-gradient":new is(We.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new $t(We.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new $t(We.paint_sky["sky-atmosphere-color"]),"sky-opacity":new $t(We.paint_sky["sky-opacity"])})};function Zh(t,e,r){const s=Wt(0,0,1),c=Eo(Fi());return function(d,m,y){y*=.5;var b=m[0],E=m[1],I=m[2],P=m[3],R=Math.sin(y),j=Math.cos(y);d[0]=b*j-I*R,d[1]=E*j+P*R,d[2]=I*j+b*R,d[3]=P*j-E*R}(c,c,r?-Cn(t)+Math.PI:Cn(t)),Zi(c,c,-Cn(e)),br(s,s,c),_t(s,s)}const Yp={circle:class extends ba{constructor(t){super(t,Xa)}createBucket(t){return new Cd(t)}queryRadius(t){const e=t;return nu("circle-radius",this,e)+nu("circle-stroke-width",this,e)+wh(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,r,s,c,d,m,y){const b=gp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(e,r)+this.paint.get("circle-stroke-width").evaluate(e,r);return Ad(t,s,d,m,y,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),b,E)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new bl(this,t)}},heatmap:class extends ba{createBucket(t){return new yp(t)}constructor(t){super(t,Rd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Dh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return nu("heatmap-radius",this,t)}queryIntersectsFeature(t,e,r,s,c,d,m,y){const b=this.paint.get("heatmap-radius").evaluate(e,r);return Ad(t,s,d,m,y,!0,!0,new et(0,0),b)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new bl(this,t)}},hillshade:class extends ba{constructor(t){super(t,U_)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getProgramConfiguration(t){return new bl(this,t)}},fill:class extends ba{constructor(t){super(t,og)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),r=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getProgramConfiguration(t){return new bl(this,t)}recalculate(t,e){super.recalculate(t,e);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Vu(t)}queryRadius(){return wh(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,r,s,c,d){return!t.queryGeometry.isAboveHorizon&&dp(mp(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends ba{constructor(t){super(t,dg)}createBucket(t){return new Ah(t)}queryRadius(){return wh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new bl(this,t)}queryIntersectsFeature(t,e,r,s,c,d,m,y,b){const E=gp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,r),P=this.paint.get("fill-extrusion-base").evaluate(e,r),R=[0,0],j=y&&d.elevation,H=d.elevation?d.elevation.exaggeration():1;if(j){const ce=t.tile.getBucket(this).centroidVertexArray,ye=b+1;if(ye<ce.length){const De=ce.get(ye);R[0]=De.a_centroid_pos0,R[1]=De.a_centroid_pos1}}if(0===R[0]&&1===R[1])return!1;const Q=(ce=s,ye=P,De=I,Ae=E,ke=m,(Re=j?y:null)?function(vt,tt,gt,St,at,Bt,Zt,Xn,Rr){const Jn=[],jn=[],pt=[0,0,0,1];for(const ar of vt){const ir=[],Di=[];for(const di of ar){const Qi=di.x+St.x,Mo=di.y+St.y,lr=Ip(Qi,Mo,tt,gt,Bt,Zt,Xn,Rr);pt[0]=Qi,pt[1]=Mo,pt[2]=lr.base,pt[3]=1,vi(pt,pt,at),pt[3]=Math.max(pt[3],1e-5);const Yn=Hd([pt[0]/pt[3],pt[1]/pt[3],pt[2]/pt[3]]);pt[0]=Qi,pt[1]=Mo,pt[2]=lr.top,pt[3]=1,vi(pt,pt,at),pt[3]=Math.max(pt[3],1e-5);const Wr=Hd([pt[0]/pt[3],pt[1]/pt[3],pt[2]/pt[3]]);ir.push(Yn),Di.push(Wr)}Jn.push(ir),jn.push(Di)}return[Jn,jn]}(ce,ye,De,Ae,ke,Re,R,H,d.center.lat):function(vt,tt,gt,St,at){const Bt=[],Zt=[],Xn=at[8]*tt,Rr=at[9]*tt,Jn=at[10]*tt,jn=at[11]*tt,pt=at[8]*gt,ar=at[9]*gt,ir=at[10]*gt,Di=at[11]*gt;for(const di of vt){const Qi=[],Mo=[];for(const lr of di){const Yn=lr.x+St.x,Wr=lr.y+St.y,_i=at[0]*Yn+at[4]*Wr+at[12],li=at[1]*Yn+at[5]*Wr+at[13],ji=at[2]*Yn+at[6]*Wr+at[14],Ji=at[3]*Yn+at[7]*Wr+at[15],cs=_i+Xn,bs=li+Rr,Ir=ji+Jn,$i=Math.max(Ji+jn,1e-5),ws=_i+pt,Gi=li+ar,Ar=ji+ir,Ci=Math.max(Ji+Di,1e-5),Br=new et(cs/$i,bs/$i);Br.z=Ir/$i,Qi.push(Br);const co=new et(ws/Ci,Gi/Ci);co.z=Ar/Ci,Mo.push(co)}Bt.push(Qi),Zt.push(Mo)}return[Bt,Zt]}(ce,ye,De,Ae,ke)),ne=t.queryGeometry;var ce,ye,De,Ae,ke,Re;return function(ce,ye,De){let Ae=1/0;dp(De,ye)&&(Ae=On(De,ye[0]));for(let ke=0;ke<ye.length;ke++){const Re=ye[ke],rt=ce[ke];for(let Je=0;Je<Re.length-1;Je++){const Tt=Re[Je],vt=[Tt,Re[Je+1],rt[Je+1],rt[Je],Tt];hp(De,vt)&&(Ae=Math.min(Ae,On(De,vt)))}}return Ae!==1/0&&Ae}(Q[0],Q[1],ne.isPointQuery()?ne.screenBounds:ne.screenGeometry)}},line:class extends ba{constructor(t){super(t,Wd),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof sl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=kh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new ia(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new bl(this,t)}queryRadius(t){const e=t,r=pg(nu("line-width",this,e),nu("line-gap-width",this,e)),s=nu("line-offset",this,e);return r/2+Math.abs(s)+wh(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,r,s,c,d){if(t.queryGeometry.isAboveHorizon)return!1;const m=mp(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),d.angle,t.pixelToTileUnitsFactor),y=t.pixelToTileUnitsFactor/2*pg(this.paint.get("line-width").evaluate(e,r),this.paint.get("line-gap-width").evaluate(e,r)),b=this.paint.get("line-offset").evaluate(e,r);return b&&(s=function(E,I){const P=[],R=new et(0,0);for(let j=0;j<E.length;j++){const H=E[j],Q=[];for(let ne=0;ne<H.length;ne++){const ce=H[ne-1],ye=H[ne],De=H[ne+1],Ae=0===ne?R:ye.sub(ce)._unit()._perp(),ke=ne===H.length-1?R:De.sub(ye)._unit()._perp(),Re=Ae._add(ke)._unit();Re._mult(1/(Re.x*ke.x+Re.y*ke.y)),Q.push(Re._mult(I)._add(ye))}P.push(Q)}return P}(s,b*t.pixelToTileUnitsFactor)),function(E,I,P){for(let R=0;R<I.length;R++){const j=I[R];if(E.length>=3)for(let H=0;H<j.length;H++)if(tu(E,j[H]))return!0;if(Ym(E,j,P))return!0}return!1}(m,s,y)}isTileClipped(){return!0}},symbol:Hh,background:class extends ba{constructor(t){super(t,_f)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ba{constructor(t){super(t,q_)}getProgramIds(){return["raster"]}},sky:class extends ba{constructor(t){super(t,Xp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Dh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}}getCenter(t,e){const r=this.paint.get("sky-type");if("atmosphere"===r){const s=this.paint.get("sky-atmosphere-sun"),c=!s,d=t.style.light,m=d.properties.get("position");return c&&"viewport"===d.properties.get("anchor")&&Hn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),c?Zh(m.azimuthal,90-m.polar,e):Zh(s[0],90-s[1],e)}if("gradient"===r){const s=this.paint.get("sky-gradient-center");return Zh(s[0],90-s[1],e)}}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}},{HTMLImageElement:yf,HTMLCanvasElement:vf,HTMLVideoElement:el,ImageData:th,ImageBitmap:qh}=Me;class Wh{constructor(e,r,s,c){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(r,c)}update(e,r,s){const{width:c,height:d}=e,{context:m}=this,{gl:y}=m;if(y.bindTexture(y.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!r||!1!==r.premultiply)),s||this.size&&this.size[0]===c&&this.size[1]===d){const{x:b,y:E}=s||{x:0,y:0};e instanceof yf||e instanceof vf||e instanceof el||e instanceof th||qh&&e instanceof qh?y.texSubImage2D(y.TEXTURE_2D,0,b,E,y.RGBA,y.UNSIGNED_BYTE,e):y.texSubImage2D(y.TEXTURE_2D,0,b,E,c,d,y.RGBA,y.UNSIGNED_BYTE,e.data)}else this.size=[c,d],e instanceof yf||e instanceof vf||e instanceof el||e instanceof th||qh&&e instanceof qh?y.texImage2D(y.TEXTURE_2D,0,this.format,this.format,y.UNSIGNED_BYTE,e):y.texImage2D(y.TEXTURE_2D,0,this.format,c,d,0,this.format,y.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(r&&r.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,r){const{context:s}=this,{gl:c}=s;c.bindTexture(c.TEXTURE_2D,this.texture),e!==this.filter&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,e),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,this.useMipmap?e===c.NEAREST?c.NEAREST_MIPMAP_NEAREST:c.LINEAR_MIPMAP_NEAREST:e),this.filter=e),r!==this.wrap&&(c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,r),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,r),this.wrap=r)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Kp{constructor(e,r){this.width=e,this.height=r,this.nextRow=0,this.image=new Tl({width:e,height:r}),this.positions={},this.uploaded=!1}getDash(e,r){const s=this.getKey(e,r);return this.positions[s]}trim(){const e=this.width,r=this.height=Jt(this.nextRow);this.image.resize({width:e,height:r})}getKey(e,r){return e.join(",")+r}getDashRanges(e,r,s){const c=[];let d=e.length%2==1?-e[e.length-1]*s:0,m=e[0]*s,y=!0;c.push({left:d,right:m,isDash:y,zeroLength:0===e[0]});let b=e[0];for(let E=1;E<e.length;E++){y=!y;const I=e[E];d=b*s,b+=I,m=b*s,c.push({left:d,right:m,isDash:y,zeroLength:0===I})}return c}addRoundDash(e,r,s){const c=r/2;for(let d=-s;d<=s;d++){const m=this.width*(this.nextRow+s+d);let y=0,b=e[y];for(let E=0;E<this.width;E++){E/b.right>1&&(b=e[++y]);const I=Math.abs(E-b.left),P=Math.abs(E-b.right),R=Math.min(I,P);let j;const H=d/s*(c+1);if(b.isDash){const Q=c-Math.abs(H);j=Math.sqrt(R*R+Q*Q)}else j=c-Math.sqrt(R*R+H*H);this.image.data[m+E]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(e,r){for(let b=e.length-1;b>=0;--b){const E=e[b],I=e[b+1];E.zeroLength?e.splice(b,1):I&&I.isDash===E.isDash&&(I.left=E.left,e.splice(b,1))}const s=e[0],c=e[e.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const d=this.width*this.nextRow;let m=0,y=e[m];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++m]);const E=Math.abs(b-y.left),I=Math.abs(b-y.right),P=Math.min(E,I);this.image.data[d+b]=Math.max(0,Math.min(255,(y.isDash?P:-P)+r+128))}}addDash(e,r){const s=this.getKey(e,r);if(this.positions[s])return this.positions[s];const c="round"===r,d=c?7:0,m=2*d+1;if(this.nextRow+m>this.height)return Hn("LineAtlas out of space"),null;0===e.length&&e.push(1);let y=0;for(let I=0;I<e.length;I++)e[I]<0&&(Hn("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),y+=e[I];if(0!==y){const I=this.width/y,P=this.getDashRanges(e,this.width,I);c?this.addRoundDash(P,I,d):this.addRegularDash(P,"square"===r?.5*I:0)}const b=this.nextRow+d;this.nextRow+=m;const E={tl:[b,d],br:[y,0]};return this.positions[s]=E,E}}jt("LineAtlas",Kp);class xf{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Qp=Me.performance;function Xh(t){const e=t?t.url.toString():void 0;return Qp.getEntriesByName(e)}class nh{constructor(){this.tasks={},this.taskQueue=[],un(["process"],this),this.invoker=new xf(this.process),this.nextId=0}add(e,r){const s=this.nextId++,c=function({type:d,isSymbolTile:m,zoom:y}){return y=y||0,"message"===d?0:"maybePrepare"!==d||m?"parseTile"!==d||m?"parseTile"===d&&m?300-y:"maybePrepare"===d&&m?400-y:500:200-y:100-y}(r);if(0===c){mo();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:r,priority:c,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){mo();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const r=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}pick(){let e=null,r=1/0;for(let c=0;c<this.taskQueue.length;c++){const d=this.tasks[this.taskQueue[c]];d.priority<r&&(r=d.priority,e=c)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}function Jp(t,e,r){var s=2*Math.PI*6378137/256/Math.pow(2,r);return[t*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class pu{constructor(e,r,s){this.z=e,this.x=r,this.y=s,this.key=mu(0,e,e,r,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,r){const s=(m=this.y,y=this.z,b=Jp(256*(d=this.x),256*(m=Math.pow(2,y)-m-1),y),E=Jp(256*(d+1),256*(m+1),y),b[0]+","+b[1]+","+E[0]+","+E[1]),c=function(d,m,y){let b,E="";for(let I=d;I>0;I--)b=1<<I-1,E+=(m&b?1:0)+(y&b?2:0);return E}(this.z,this.x,this.y);var d,m,y,b,E;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===r?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",c).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Yh{constructor(e,r){this.wrap=e,this.canonical=r,this.key=mu(e,r.z,r.z,r.x,r.y)}}class Go{constructor(e,r,s,c,d){this.overscaledZ=e,this.wrap=r,this.canonical=new pu(s,+c,+d),this.key=0===r&&e===s?this.canonical.key:mu(r,e,s,c,d)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const r=this.canonical.z-e;return e>this.canonical.z?new Go(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Go(e,this.wrap,e,this.canonical.x>>r,this.canonical.y>>r)}calculateScaledKey(e,r=!0){if(this.overscaledZ===e&&r)return this.key;if(e>this.canonical.z)return mu(this.wrap*+r,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return mu(this.wrap*+r,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const r=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>r&&e.canonical.y===this.canonical.y>>r}children(e){if(this.overscaledZ>=e)return[new Go(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const r=this.canonical.z+1,s=2*this.canonical.x,c=2*this.canonical.y;return[new Go(r,this.wrap,r,s,c),new Go(r,this.wrap,r,s+1,c),new Go(r,this.wrap,r,s,c+1),new Go(r,this.wrap,r,s+1,c+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Go(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Go(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Yh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function mu(t,e,r,s,c){const d=1<<Math.min(r,22);let m=d*(c%d)+s%d;return t&&r<22&&(m+=d*d*((t<0?-2*t-1:2*t)%(1<<2*(22-r)))),16*(32*m+r)+(e-r)}jt("CanonicalTileID",pu),jt("OverscaledTileID",Go,{omit:["projMatrix"]});class gu{constructor(e,r,s){this.func=e,this.mask=r,this.range=s}}gu.ReadOnly=!1,gu.ReadWrite=!0,gu.disabled=new gu(519,gu.ReadOnly,[0,1]);class bf{constructor(e,r,s,c,d,m){this.test=e,this.ref=r,this.mask=s,this.fail=c,this.depthFail=d,this.pass=m}}bf.disabled=new bf({func:519,mask:0},0,0,7680,7680,7680);class tl{constructor(e,r,s){this.blendFunction=e,this.blendColor=r,this.mask=s}}tl.Replace=[1,0],tl.disabled=new tl(tl.Replace,Un.transparent,[!1,!1,!1,!1]),tl.unblended=new tl(tl.Replace,Un.transparent,[!0,!0,!0,!0]),tl.alphaBlended=new tl([1,771],Un.transparent,[!0,!0,!0,!0]);class sa{constructor(e,r,s){this.enable=e,this.mode=r,this.frontFace=s}}sa.disabled=new sa(!1,1029,2305),sa.backCCW=new sa(!0,1029,2305),sa.backCW=new sa(!0,1029,2304),sa.frontCW=new sa(!0,1028,2304),sa.frontCCW=new sa(!0,1028,2305);class em{constructor(e){this._stringToNumber={},this._numberToString=[];for(let r=0;r<e.length;r++){const s=e[r];this._stringToNumber[s]=r,this._numberToString[r]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class tm{constructor(e,r,s,c,d){this.type="Feature",this._vectorTileFeature=e,e._z=r,e._x=s,e._y=c,this.properties=e.properties,this.id=d}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const r in this)"_geometry"!==r&&"_vectorTileFeature"!==r&&(e[r]=this[r]);return e}}class _u{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,r,s){const c=String(r);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},cr(this.stateChanges[e][c],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const d in this.state[e])d!==c&&(this.deletedStates[e][d]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][c]){this.deletedStates[e][c]={};for(const d in this.state[e][c])s[d]||(this.deletedStates[e][c][d]=null)}else for(const d in s)this.deletedStates[e]&&this.deletedStates[e][c]&&null===this.deletedStates[e][c][d]&&delete this.deletedStates[e][c][d]}removeFeatureState(e,r,s){if(null===this.deletedStates[e])return;const c=String(r);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==r)null!==this.deletedStates[e][c]&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][s]=null);else if(void 0!==r)if(this.stateChanges[e]&&this.stateChanges[e][c])for(s in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][s]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,r){const s=String(r),c=cr({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const d=this.deletedStates[e][r];if(null===d)return{};for(const m in d)delete c[m]}return c}initializeTileState(e,r){e.setFeatureState(this.state,r)}coalesceChanges(e,r){const s={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const d={};for(const m in this.stateChanges[c])this.state[c][m]||(this.state[c][m]={}),cr(this.state[c][m],this.stateChanges[c][m]),d[m]=this.state[c][m];s[c]=d}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const d={};if(null===this.deletedStates[c])for(const m in this.state[c])d[m]={},this.state[c][m]={};else for(const m in this.deletedStates[c]){if(null===this.deletedStates[c][m])this.state[c][m]={};else for(const y of Object.keys(this.deletedStates[c][m]))delete this.state[c][m][y];d[m]=this.state[c][m]}s[c]=s[c]||{},cr(s[c],d)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const c in e)e[c].setFeatureState(s,r)}}class nm{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,r){const s=this.toIdx(e,r);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,r){return this.leaves[this.toIdx(e,r)]}toIdx(e,r){return r*this.size+e}}function rm(t,e,r,s){let c=0,d=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(s[m])<1e-15){if(r[m]<t[m]||r[m]>e[m])return null}else{const y=1/s[m];let b=(t[m]-r[m])*y,E=(e[m]-r[m])*y;if(b>E){const I=b;b=E,E=I}if(b>c&&(c=b),E<d&&(d=E),c>d)return null}return c}function im(t,e,r,s,c,d,m,y,b,E,I){const P=s-t,R=c-e,j=d-r,H=m-t,Q=y-e,ne=b-r,ce=I[1]*ne-I[2]*Q,ye=I[2]*H-I[0]*ne,De=I[0]*Q-I[1]*H,Ae=P*ce+R*ye+j*De;if(Math.abs(Ae)<1e-15)return null;const ke=1/Ae,Re=E[0]-t,rt=E[1]-e,Je=E[2]-r,Tt=(Re*ce+rt*ye+Je*De)*ke;if(Tt<0||Tt>1)return null;const vt=rt*j-Je*R,tt=Je*P-Re*j,gt=Re*R-rt*P,St=(I[0]*vt+I[1]*tt+I[2]*gt)*ke;return St<0||Tt+St>1?null:(H*vt+Q*tt+ne*gt)*ke}function om(t,e,r){return(t-e)/(r-e)}function aa(t,e,r,s,c,d,m,y,b){const E=1<<r,I=d-s,P=m-c,R=(t+1)/E*I+s,j=(e+0)/E*P+c,H=(e+1)/E*P+c;y[0]=(t+0)/E*I+s,y[1]=j,b[0]=R,b[1]=H}class Qh{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const r=function(d){const m=Math.ceil(Math.log2(d.dim/8)),y=[];let b=Math.ceil(Math.pow(2,m));const E=1/b,I=(j,H,Q,ne,ce)=>{const ye=ne?1:0,De=(j+1)*Q-ye,Ae=H*Q,ke=(H+1)*Q-ye;ce[0]=j*Q,ce[1]=Ae,ce[2]=De,ce[3]=ke};let P=new nm(b);const R=[];for(let j=0;j<b*b;j++){I(j%b,Math.floor(j/b),E,!1,R);const H=Cl(R[0],R[1],d),Q=Cl(R[2],R[1],d),ne=Cl(R[2],R[3],d),ce=Cl(R[0],R[3],d);P.minimums.push(Math.min(H,Q,ne,ce)),P.maximums.push(Math.max(H,Q,ne,ce)),P.leaves.push(1)}for(y.push(P),b/=2;b>=1;b/=2){const j=y[y.length-1];P=new nm(b);for(let H=0;H<b*b;H++){I(H%b,Math.floor(H/b),2,!0,R);const Q=j.getElevation(R[0],R[1]),ne=j.getElevation(R[2],R[1]),ce=j.getElevation(R[2],R[3]),ye=j.getElevation(R[0],R[3]),De=j.isLeaf(R[0],R[1]),Ae=j.isLeaf(R[2],R[1]),ke=j.isLeaf(R[2],R[3]),Re=j.isLeaf(R[0],R[3]),rt=Math.min(Q.min,ne.min,ce.min,ye.min),Je=Math.max(Q.max,ne.max,ce.max,ye.max),Tt=De&&Ae&&ke&&Re;P.maximums.push(Je),P.minimums.push(rt),P.leaves.push(Je-rt<=5&&Tt?1:0)}y.push(P)}return y}(this.dem),s=r.length-1,c=r[s];this._addNode(c.minimums[0],c.maximums[0],c.leaves[0]),this._construct(r,0,0,s,0)}raycastRoot(e,r,s,c,d,m,y=1){return rm([e,r,-100],[s,c,this.maximums[0]*y],d,m)}raycast(e,r,s,c,d,m,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,r,s,c,d,m,y);if(null==b)return null;const E=[],I=[],P=[],R=[],j=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;j.length>0;){const{idx:H,t:Q,nodex:ne,nodey:ce,depth:ye}=j.pop();if(this.leaves[H]){aa(ne,ce,ye,e,r,s,c,P,R);const Ae=1<<ye,ke=(ne+0)/Ae,Re=(ne+1)/Ae,rt=(ce+0)/Ae,Je=(ce+1)/Ae,Tt=Cl(ke,rt,this.dem)*y,vt=Cl(Re,rt,this.dem)*y,tt=Cl(Re,Je,this.dem)*y,gt=Cl(ke,Je,this.dem)*y,St=im(P[0],P[1],Tt,R[0],P[1],vt,R[0],R[1],tt,d,m),at=im(R[0],R[1],tt,P[0],R[1],gt,P[0],P[1],Tt,d,m),Bt=Math.min(null!==St?St:Number.MAX_VALUE,null!==at?at:Number.MAX_VALUE);if(Bt!==Number.MAX_VALUE)return Bt;{const Zt=qe([],d,m,Q);if(wf(Tt,vt,gt,tt,om(Zt[0],P[0],R[0]),om(Zt[1],P[1],R[1]))>=Zt[2])return Q}continue}let De=0;for(let Ae=0;Ae<this._siblingOffset.length;Ae++){aa((ne<<1)+this._siblingOffset[Ae][0],(ce<<1)+this._siblingOffset[Ae][1],ye+1,e,r,s,c,P,R),P[2]=-100,R[2]=this.maximums[this.childOffsets[H]+Ae]*y;const ke=rm(P,R,d,m);if(null!=ke){const Re=ke;E[Ae]=Re;let rt=!1;for(let Je=0;Je<De&&!rt;Je++)Re>=E[I[Je]]&&(I.splice(Je,0,Ae),rt=!0);rt||(I[De]=Ae),De++}}for(let Ae=0;Ae<De;Ae++){const ke=I[Ae];j.push({idx:this.childOffsets[H]+ke,t:E[ke],nodex:(ne<<1)+this._siblingOffset[ke][0],nodey:(ce<<1)+this._siblingOffset[ke][1],depth:ye+1})}}return null}_addNode(e,r,s){return this.minimums.push(e),this.maximums.push(r),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,r,s,c,d){if(1===e[c].isLeaf(r,s))return;this.childOffsets[d]||(this.childOffsets[d]=this.nodeCount);const m=c-1,y=e[m];let b,E=0;for(let I=0;I<this._siblingOffset.length;I++){const P=2*r+this._siblingOffset[I][0],R=2*s+this._siblingOffset[I][1],j=y.getElevation(P,R),H=y.isLeaf(P,R),Q=this._addNode(j.min,j.max,H);H&&(E|=1<<I),b||(b=Q)}for(let I=0;I<this._siblingOffset.length;I++)E&1<<I||this._construct(e,2*r+this._siblingOffset[I][0],2*s+this._siblingOffset[I][1],m,b+I)}}function wf(t,e,r,s,c,d){return or(or(t,r,d),or(e,s,d),c)}function Cl(t,e,r){const s=r.dim,c=Pn(t*s-.5,0,s-1),d=Pn(e*s-.5,0,s-1),m=Math.floor(c),y=Math.floor(d),b=Math.min(m+1,s-1),E=Math.min(y+1,s-1);return wf(r.get(m,y),r.get(b,y),r.get(m,E),r.get(b,E),c-m,d-y)}const Ef={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class ih{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,r,s,c=!1,d=!1){if(this.uid=e,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return Hn(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=r.height;const m=this.dim=r.height-2;if(this.data=new Uint32Array(r.data.buffer),this.encoding=s||"mapbox",this.borderReady=c,!c){for(let y=0;y<m;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(m,y)]=this.data[this._idx(m-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,m)]=this.data[this._idx(y,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)],d&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Qh(this)}get(e,r,s=!1){const c=new Uint8Array(this.data.buffer);s&&(e=Pn(e,-1,this.dim),r=Pn(r,-1,this.dim));const d=4*this._idx(e,r);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(c[d],c[d+1],c[d+2])}static getUnpackVector(e){return Ef[e]}get unpackVector(){return Ef[this.encoding]}_idx(e,r){if(e<-1||e>=this.dim+1||r<-1||r>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(r+1)*this.stride+(e+1)}_unpackMapbox(e,r,s){return(256*e*256+256*r+s)/10-1e4}_unpackTerrarium(e,r,s){return 256*e+r+s/256-32768}static pack(e,r){const s=[0,0,0,0],c=ih.getUnpackVector(r);let d=Math.floor((e+c[3])/c[2]);return s[2]=d%256,d=Math.floor(d/256),s[1]=d%256,d=Math.floor(d/256),s[0]=d,s}getPixels(){return new ss({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,r,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let c=r*this.dim,d=r*this.dim+this.dim,m=s*this.dim,y=s*this.dim+this.dim;switch(r){case-1:c=d-1;break;case 1:d=c+1}switch(s){case-1:m=y-1;break;case 1:y=m+1}const b=-r*this.dim,E=-s*this.dim;for(let I=m;I<y;I++)for(let P=c;P<d;P++)this.data[this._idx(P,I)]=e.data[this._idx(P+b,I+E)]}onDeserialize(){this._tree&&(this._tree.dem=this)}}jt("DEMData",ih),jt("DemMinMaxQuadTree",Qh,{omit:["dem"]});class Fg{constructor(e,r){this.max=e,this.onRemove=r,this.reset()}reset(){for(const e in this.data)for(const r of this.data[e])r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value);return this.data={},this.order=[],this}add(e,r,s){const c=e.wrapped().key;void 0===this.data[c]&&(this.data[c]=[]);const d={value:r,timeout:void 0};if(void 0!==s&&(d.timeout=setTimeout(()=>{this.remove(e,d)},s)),this.data[c].push(d),this.order.push(c),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const r=this.data[e].shift();return r.timeout&&clearTimeout(r.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),r.value}getByKey(e){const r=this.data[e];return r?r[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,r){if(!this.has(e))return this;const s=e.wrapped().key,c=void 0===r?0:this.data[s].indexOf(r),d=this.data[s][c];return this.data[s].splice(c,1),d.timeout&&clearTimeout(d.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(d.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const r=this._getAndRemoveByKey(this.order[0]);r&&this.onRemove(r)}return this}filter(e){const r=[];for(const s in this.data)for(const c of this.data[s])e(c.value)||r.push(c);for(const s of r)this.remove(s.value.tileID,s)}}class Lc extends Rn{constructor(e,r,s){super(),this.id=e,this._onlySymbols=s,r.on("data",c=>{"source"===c.dataType&&"metadata"===c.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===c.dataType&&"content"===c.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),r.on("error",()=>{this._sourceErrored=!0}),this._source=r,this._tiles={},this._cache=new Fg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=null,this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _u}onAdd(e){this.map=e,this._minTileCacheSize=e?e._minTileCacheSize:null,this._maxTileCacheSize=e?e._maxTileCacheSize:null}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const r=this._tiles[e];if("loaded"!==r.state&&"errored"!==r.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,r){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,r)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const r in this._tiles){const s=this._tiles[r];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return xi(this._tiles).map(e=>e.tileID).sort(sm).map(e=>e.key)}getRenderableIds(e){const r=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&r.push(this._tiles[s]);return e?r.sort((s,c)=>{const d=s.tileID,m=c.tileID,y=new et(d.canonical.x,d.canonical.y)._rotate(this.transform.angle),b=new et(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return d.overscaledZ-m.overscaledZ||b.y-y.y||b.x-y.x}).map(s=>s.tileID.key):r.map(s=>s.tileID).sort(sm).map(s=>s.key)}hasRenderableParent(e){const r=this.findLoadedParent(e,0);return!!r&&this._isIdRenderable(r.tileID.key)}_isIdRenderable(e,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(r||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,r){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=r),this._loadTile(s,this._tileLoaded.bind(this,s,e,r)))}_tileLoaded(e,r,s,c){if(c)if(e.state="errored",404!==c.status)this._source.fire(new Hr(c,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const d=this.map.painter.terrain;this.update(this.transform,d.getScaledDemTileSize(),!0),d.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Sn.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(r,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ai("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const r=this.getRenderableIds();for(let c=0;c<r.length;c++){const d=r[c];if(e.neighboringTiles&&e.neighboringTiles[d]){const m=this.getTileByID(d);s(e,m),s(m,e)}}function s(c,d){if(!c.dem||c.dem.borderReady)return;c.needsHillshadePrepare=!0,c.needsDEMTextureUpload=!0;let m=d.tileID.canonical.x-c.tileID.canonical.x;const y=d.tileID.canonical.y-c.tileID.canonical.y,b=Math.pow(2,c.tileID.canonical.z),E=d.tileID.key;0===m&&0===y||Math.abs(y)>1||(Math.abs(m)>1&&(1===Math.abs(m+b)?m+=b:1===Math.abs(m-b)&&(m-=b)),d.dem&&c.dem&&(c.dem.backfillBorder(d.dem,m,y),c.neighboringTiles&&c.neighboringTiles[E]&&(c.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,r,s,c){for(const d in this._tiles){let m=this._tiles[d];if(c[d]||!m.hasData()||m.tileID.overscaledZ<=r||m.tileID.overscaledZ>s)continue;let y=m.tileID;for(;m&&m.tileID.overscaledZ>r+1;){const E=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[E.key],m&&m.hasData()&&(y=E)}let b=y;for(;b.overscaledZ>r;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){c[y.key]=y;break}}}findLoadedParent(e,r){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=r?s:null}for(let s=e.overscaledZ-1;s>=r;s--){const c=e.scaledTo(s),d=this._getLoadedTile(c);if(d)return d}}_getLoadedTile(e){const r=this._tiles[e.key];return r&&r.hasData()?r:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,r){r=r||this._source.tileSize;const s=Math.ceil(e.width/r)+1,c=Math.ceil(e.height/r)+1,d=Math.floor(s*c*5),m="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,d):d,y="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(e){const r=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,r){const s={};for(const c in this._tiles){const d=this._tiles[c];d.tileID=d.tileID.unwrapTo(d.tileID.wrap+r),s[d.tileID.key]=d}this._tiles=s;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(+c,this._tiles[c])}}update(e,r,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let c;this.updateCacheSize(e,r),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(y=>new Go(y.canonical.z,y.wrap,y.canonical.z,y.canonical.x,y.canonical.y)):(c=e.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(c=c.filter(y=>this._source.hasTile(y)))):c=[];const d=this._updateRetainedTiles(c);if(am(this._source.type)&&0!==c.length){const y={},b={},E=Object.keys(d);for(const P of E){const R=d[P],j=this._tiles[P];if(!j||j.fadeEndTime&&j.fadeEndTime<=Sn.now())continue;const H=this.findLoadedParent(R,Math.max(R.overscaledZ-Lc.maxOverzooming,this._source.minzoom));H&&(this._addTile(H.tileID),y[H.tileID.key]=H.tileID),b[P]=R}const I=c[c.length-1].overscaledZ;for(const P in this._tiles){const R=this._tiles[P];if(d[P]||!R.hasData())continue;let j=R.tileID;for(;j.overscaledZ>I;){j=j.scaledTo(j.overscaledZ-1);const H=this._tiles[j.key];if(H&&H.hasData()&&b[j.key]){d[P]=R.tileID;break}}}for(const P in y)d[P]||(this._coveredTiles[P]=!0,d[P]=y[P])}for(const y in d)this._tiles[y].clearFadeHold();const m=function(y,b){const E=[];for(const I in y)I in b||E.push(I);return E}(this._tiles,d);for(const y of m){const b=this._tiles[y];b.hasSymbolBuckets&&!b.holdingForFade()?b.setHoldDuration(this.map._fadeDuration):b.hasSymbolBuckets&&!b.symbolFadeFinished()||this._removeTile(+y)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const r={};if(0===e.length)return r;const s={},c=e.reduce((E,I)=>Math.min(E,I.overscaledZ),1/0),d=e[0].overscaledZ,m=Math.max(d-Lc.maxOverzooming,this._source.minzoom),y=Math.max(d+Lc.maxUnderzooming,this._source.minzoom),b={};for(const E of e){const I=this._addTile(E);r[E.key]=E,I.hasData()||c<this._source.maxzoom&&(b[E.key]=E)}this._retainLoadedChildren(b,c,y,r);for(const E of e){let I=this._tiles[E.key];if(I.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const R=E.children(this._source.maxzoom)[0],j=this.getTile(R);if(j&&j.hasData()){r[R.key]=R;continue}}else{const R=E.children(this._source.maxzoom);if(r[R[0].key]&&r[R[1].key]&&r[R[2].key]&&r[R[3].key])continue}let P=I.wasRequested();for(let R=E.overscaledZ-1;R>=m;--R){const j=E.scaledTo(R);if(s[j.key]||(s[j.key]=!0,I=this.getTile(j),!I&&P&&(I=this._addTile(j)),I&&(r[j.key]=j,P=I.wasRequested(),I.hasData())))break}}return r}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const r=[];let s,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){s=this._loadedParentTiles[c.key];break}r.push(c.key);const d=c.scaledTo(c.overscaledZ-1);if(s=this._getLoadedTile(d),s)break;c=d}for(const d of r)this._loadedParentTiles[d]=s}}_addTile(e){let r=this._tiles[e.key];if(r)return r;r=this._cache.getAndRemove(e),r&&(this._setTileReloadTimer(e.key,r),r.tileID=e,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,r)));const s=Boolean(r);if(!s){const c=this.map?this.map.painter:null,d="raster"===this._source.type||"raster-dem"===this._source.type;r=new lm(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,c,d),this._loadTile(r,this._tileLoaded.bind(this,r,e.key,r.state))}return r?(r.uses++,this._tiles[e.key]=r,s||this._source.fire(new Ai("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r):null}_setTileReloadTimer(e,r){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=r.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const r=this._tiles[e];r&&(r.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),r.uses>0||(r.hasData()&&"reloading"!==r.state?this._cache.add(r.tileID,r,r.getExpiryTimeout()):(r.aborted=!0,this._abortTile(r),this._unloadTile(r))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset()}tilesIn(e,r,s){const c=[],d=this.transform;if(!d)return c;for(const m in this._tiles){const y=this._tiles[m];if(s&&y.clearQueryDebugViz(),y.holdingForFade())continue;const b=e.containsTile(y,d,r);b&&c.push(b)}return c}getVisibleCoordinates(e){const r=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of r)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return r}hasTransition(){if(this._source.hasTransition())return!0;if(am(this._source.type))for(const e in this._tiles){const r=this._tiles[e];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=Sn.now())return!0}return!1}setFeatureState(e,r,s){this._state.updateState(e=e||"_geojsonTileLayer",r,s)}removeFeatureState(e,r,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",r,s)}getFeatureState(e,r){return this._state.getState(e=e||"_geojsonTileLayer",r)}setDependencies(e,r,s){const c=this._tiles[e];c&&c.setDependencies(r,s)}reloadTilesForDependencies(e,r){for(const s in this._tiles)this._tiles[s].hasDependency(e,r)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,r))}_preloadTiles(e,r){const s=new Map,c=Array.isArray(e)?e:[e],d=this.map.painter.terrain,m=this.usedForTerrain&&d?d.getScaledDemTileSize():this._source.tileSize;for(const E of c){const I=E.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const P of I)s.set(P.key,P);this.usedForTerrain&&E.updateElevation(!1)}const y=Array.from(s.values()),b="raster"===this._source.type||"raster-dem"===this._source.type;ti(y,(E,I)=>{const P=new lm(E,this._source.tileSize*E.overscaleFactor(),this.transform.tileZoom,this.map.painter,b);this._loadTile(P,R=>{"raster-dem"===this._source.type&&P.dem&&this._backfillDEM(P),I(R,P)})},r)}}function sm(t,e){const r=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-r||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function am(t){return"raster"===t||"image"===t||"video"===t}Lc.maxOverzooming=10,Lc.maxUnderzooming=3;class oh{constructor(e,r,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=r,this._offset=s}static create(e,r,s){const c=s||e.findDEMTileFor(r);if(!c||!c.dem)return;const d=c.dem,m=c.tileID,y=1<<r.canonical.z-m.canonical.z;return new oh(c,c.tileSize/Wn/y,[(r.canonical.x/y-m.canonical.x)*d.dim,(r.canonical.y/y-m.canonical.y)*d.dim])}tileCoordToPixel(e,r){const s=r*this._scale+this._offset[1],c=Math.floor(e*this._scale+this._offset[0]),d=Math.floor(s);return new et(c,d)}getElevationAt(e,r,s,c){const d=e*this._scale+this._offset[0],m=r*this._scale+this._offset[1],y=Math.floor(d),b=Math.floor(m),E=this._dem;return c=!!c,s?or(or(E.get(y,b,c),E.get(y,b+1,c),m-b),or(E.get(y+1,b,c),E.get(y+1,b+1,c),m-b),d-y):E.get(y,b,c)}getElevationAtPixel(e,r,s){return this._dem.get(e,r,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*$s(1,e)*this._dem.stride}}class Og{constructor(e,r){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new bc(Wn,16,0),this.featureIndexArray=new Um,this.promoteId=r}insert(e,r,s,c,d,m=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,c,d,m);const b=this.grid;for(let E=0;E<r.length;E++){const I=r[E],P=[1/0,1/0,-1/0,-1/0];for(let R=0;R<I.length;R++){const j=I[R];P[0]=Math.min(P[0],j.x),P[1]=Math.min(P[1],j.y),P[2]=Math.max(P[2],j.x),P[3]=Math.max(P[3],j.y)}P[0]<Wn&&P[1]<Wn&&P[2]>=0&&P[3]>=0&&b.insert(y,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ql.VectorTile(new Gu(this.rawTileData)).layers,this.sourceLayerCoder=new em(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,r,s,c){this.loadVTLayers();const d=e.params||{},m=Bs(d.filter),y=e.tileResult,b=e.transform,E=y.bufferedTilespaceBounds,I=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(H,Q,ne,ce)=>pp(y.bufferedTilespaceGeometry,H,Q,ne,ce));I.sort(zg);let P=null;b.elevation&&I.length>0&&(P=oh.create(b.elevation,this.tileID));const R={};let j;for(let H=0;H<I.length;H++){const Q=I[H];if(Q===j)continue;j=Q;const ne=this.featureIndexArray.get(Q);let ce=null;this.loadMatchingFeature(R,ne,m,d.layers,d.availableImages,r,s,c,(ye,De,Ae,ke=0)=>(ce||(ce=El(ye,this.tileID.canonical,e.tileTransform)),De.queryIntersectsFeature(y,ye,Ae,ce,this.z,e.transform,e.pixelPosMatrix,P,ke)))}return R}loadMatchingFeature(e,r,s,c,d,m,y,b,E){const{featureIndex:I,bucketIndex:P,sourceLayerIndex:R,layoutVertexArrayOffset:j}=r,H=this.bucketLayerIDs[P];if(c&&!function(ye,De){for(let Ae=0;Ae<ye.length;Ae++)if(De.indexOf(ye[Ae])>=0)return!0;return!1}(c,H))return;const Q=this.sourceLayerCoder.decode(R),ne=this.vtLayers[Q].feature(I);if(s.needGeometry){const ye=Sc(ne,!0);if(!s.filter(new wn(this.tileID.overscaledZ),ye,this.tileID.canonical))return}else if(!s.filter(new wn(this.tileID.overscaledZ),ne))return;const ce=this.getId(ne,Q);for(let ye=0;ye<H.length;ye++){const De=H[ye];if(c&&c.indexOf(De)<0)continue;const Ae=m[De];if(!Ae)continue;let ke={};void 0!==ce&&b&&(ke=b.getState(Ae.sourceLayer||"_geojsonTileLayer",ce));const Re=cr({},y[De]);Re.paint=Tf(Re.paint,Ae.paint,ne,ke,d),Re.layout=Tf(Re.layout,Ae.layout,ne,ke,d);const rt=!E||E(ne,Ae,ke,j);if(!rt)continue;const Je=new tm(ne,this.z,this.x,this.y,ce);Je.layer=Re;let Tt=e[De];void 0===Tt&&(Tt=e[De]=[]),Tt.push({featureIndex:I,feature:Je,intersectionZ:rt})}}lookupSymbolFeatures(e,r,s,c,d,m,y,b){const E={};this.loadVTLayers();const I=Bs(d);for(const P of e)this.loadMatchingFeature(E,{bucketIndex:s,sourceLayerIndex:c,featureIndex:P,layoutVertexArrayOffset:0},I,m,y,b,r);return E}loadFeature(e){const{featureIndex:r,sourceLayerIndex:s}=e;this.loadVTLayers();const c=this.sourceLayerCoder.decode(s),d=this.vtFeatures[c];if(d[r])return d[r];const m=this.vtLayers[c].feature(r);return d[r]=m,m}hasLayer(e){for(const r of this.bucketLayerIDs)for(const s of r)if(e===s)return!0;return!1}getId(e,r){let s=e.id;return this.promoteId&&(s=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[r]],"boolean"==typeof s&&(s=Number(s))),s}}function Tf(t,e,r,s,c){return fo(t,(d,m)=>{const y=e instanceof ya?e.get(m):null;return y&&y.evaluate?y.evaluate(r,s,c):y})}function zg(t,e){return e-t}jt("FeatureIndex",Og,{omit:["rawTileData","sourceLayerCoder"]});var Bg=hi([{name:"a_pos",type:"Int16",components:2}]);const nl=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,r=0,s=0,c=0,d=0,m=0,y=0;for(1&e?c=d=m=32:r=s=y=32;(e>>=1)>1;){const E=r+c>>1,I=s+d>>1;1&e?(c=r,d=s,r=m,s=y):(r=c,s=d,c=m,d=y),m=E,y=I}const b=4*t;nl[b+0]=r,nl[b+1]=s,nl[b+2]=c,nl[b+3]=d}const rl=new Uint16Array(2178),Ml=new Uint8Array(1089),sh=new Uint16Array(1089);function Ng(t){return 0===t?-.03125:32===t?.03125:0}var Hs=hi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Ug={type:2,extent:Wn,loadGeometry:()=>[[new et(0,0),new et(8193,0),new et(8193,8193),new et(0,8193),new et(0,0)]]};class lm{constructor(e,r,s,c,d){this.tileID=e,this.uid=fs(),this.uses=0,this.tileSize=r,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=d,this.expiredRequestCount=0,this.state="loading",c&&c.transform&&(this.projection=c.transform.projection)}registerFadeDuration(e){const r=e+this.timeAdded;r<Sn.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Sa(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,r,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,d){const m={};if(!d)return m;for(const y of c){const b=y.layerIds.map(E=>d.getLayer(E)).filter(Boolean);if(0!==b.length){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(E=>b.filter(I=>I.id===E)[0]));for(const E of b)m[E.id]=y}}return m}(e.buckets,r.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const d=this.buckets[c];if(d instanceof Ja){if(this.hasSymbolBuckets=!0,!s)break;d.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const d=this.buckets[c];if(d instanceof Ja&&d.hasRTLText){this.hasRTLText=!0,nr.isLoading()||nr.isLoaded()||"deferred"!==jo()||Co();break}}this.queryPadding=0;for(const c in this.buckets){const d=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,r.style.getLayer(c).queryRadius(d))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Yf}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this.globeGridBuffer&&(this.globeGridBuffer.destroy(),this.globeGridBuffer=null),this.globePoleBuffer&&(this.globePoleBuffer.destroy(),this.globePoleBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const c=this.buckets[s];c.uploadPending()&&c.upload(e)}const r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Wh(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Wh(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Wh(e,this.lineAtlas.image,r.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,r,s,c,d,m,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:c,pixelPosMatrix:y,transform:m,params:d,tileTransform:this.tileTransform},e,r,s):{}}querySourceFeatures(e,r){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const c=s.loadVTLayers(),d=r?r.sourceLayer:"",m=c._geojsonTileLayer||c[d];if(!m)return;const y=Bs(r&&r.filter),{z:b,x:E,y:I}=this.tileID.canonical,P={z:b,x:E,y:I};for(let R=0;R<m.length;R++){const j=m.feature(R);if(y.needGeometry){const ne=Sc(j,!0);if(!y.filter(new wn(this.tileID.overscaledZ),ne,this.tileID.canonical))continue}else if(!y.filter(new wn(this.tileID.overscaledZ),j))continue;const H=s.getId(j,d),Q=new tm(j,b,E,I,H);Q.tile=P,e.push(Q)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const r=this.expirationTime;if(e.cacheControl){const s=qt(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let c=!1;if(this.expirationTime>s)c=!1;else if(r)if(this.expirationTime<r)c=!0;else{const d=this.expirationTime-r;d?this.expirationTime=s+Math.max(d,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,r){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!r)return;const s=this.latestFeatureIndex.loadVTLayers(),c=r.style.listImages();for(const d in this.buckets){if(!r.style.hasLayer(d))continue;const m=this.buckets[d],y=m.layers[0].sourceLayer||"_geojsonTileLayer",b=s[y],E=e[y];if(!b||!E||0===Object.keys(E).length)continue;if(m.update(E,b,c,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof ia||m instanceof Vu){const P=r.style._getSourceCache(m.layers[0].source);r._terrain&&r._terrain.enabled&&P&&m.programConfigurations.needsUpload&&r._terrain._clearRenderCacheForTile(P.id,this.tileID)}const I=r&&r.style&&r.style.getLayer(d);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(m)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Sn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Sn.now()+e}setDependencies(e,r){const s={};for(const c of r)s[c]=!0;this.dependencies[e]=s}hasDependency(e,r){for(const s of e){const c=this.dependencies[s];if(c)for(const d of r)if(c[d])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,r){if(!r||"mercator"===r.name||this._tileDebugBuffer)return;const s=El(Ug,this.tileID.canonical,this.tileTransform)[0],c=new Hc,d=new Yl;for(let m=0;m<s.length;m++){const{x:y,y:b}=s[m];c.emplaceBack(y,b),d.emplaceBack(m)}d.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(d),this._tileDebugBuffer=e.createVertexBuffer(c,Hs.members),this._tileDebugSegments=Li.simpleSegment(0,0,c.length,d.length)}_makeTileBoundsBuffers(e,r){if(this._tileBoundsBuffer||!r||"mercator"===r.name)return;const s=El(Ug,this.tileID.canonical,this.tileTransform)[0];let c,d;if(this.isRaster){const m=function(y,b){const E=Sa(y,b),I=Math.pow(2,y.z);for(let ne=0;ne<33;ne++)for(let ce=0;ce<33;ce++){const ye=wl((y.x+(ce+Ng(ce))/32)/I),De=ra((y.y+(ne+Ng(ne))/32)/I),Ae=b.project(ye,De),ke=33*ne+ce;rl[2*ke+0]=Math.round((Ae.x*E.scale-E.x)*Wn),rl[2*ke+1]=Math.round((Ae.y*E.scale-E.y)*Wn)}Ml.fill(0),sh.fill(0);for(let ne=2045;ne>=0;ne--){const ce=4*ne,ye=nl[ce+0],De=nl[ce+1],Ae=nl[ce+2],ke=nl[ce+3],Re=ye+Ae>>1,rt=De+ke>>1,Je=Re+rt-De,Tt=rt+ye-Re,vt=33*De+ye,tt=33*ke+Ae,gt=33*rt+Re,St=Math.hypot((rl[2*vt+0]+rl[2*tt+0])/2-rl[2*gt+0],(rl[2*vt+1]+rl[2*tt+1])/2-rl[2*gt+1])>=16;if(Ml[gt]=Ml[gt]||(St?1:0),ne<1022){const at=33*(De+Tt>>1)+(ye+Je>>1),Bt=33*(ke+Tt>>1)+(Ae+Je>>1);Ml[gt]=Ml[gt]||Ml[at]||Ml[Bt]}}const P=new Zc,R=new vs;let j=0;function H(ne,ce){const ye=33*ce+ne;return 0===sh[ye]&&(P.emplaceBack(rl[2*ye+0],rl[2*ye+1],ne*Wn/32,ce*Wn/32),sh[ye]=++j),sh[ye]-1}function Q(ne,ce,ye,De,Ae,ke){const Re=ne+ye>>1,rt=ce+De>>1;if(Math.abs(ne-Ae)+Math.abs(ce-ke)>1&&Ml[33*rt+Re])Q(Ae,ke,ne,ce,Re,rt),Q(ye,De,Ae,ke,Re,rt);else{const Je=H(ne,ce),Tt=H(ye,De),vt=H(Ae,ke);R.emplaceBack(Je,Tt,vt)}}return Q(0,0,32,32,32,0),Q(32,32,0,0,0,32),{vertices:P,indices:R}}(this.tileID.canonical,r);c=m.vertices,d=m.indices}else{c=new Zc,d=new vs;for(const{x:y,y:b}of s)c.emplaceBack(y,b,0,0);const m=Fu(c.int16,void 0,4);for(let y=0;y<m.length;y+=3)d.emplaceBack(m[y],m[y+1],m[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(c,Hs.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(d),this._tileBoundsSegments=Li.simpleSegment(0,0,c.length,d.length)}}const cm=hi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),um=hi([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Df}=cm;function Fc(t,e){const r=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,c=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),d=Math.sin(r)*c/Math.sin(Math.max(Math.PI/2-t._pitch-r,.01)),m=Math.sin(t._pitch)*d+c;return Math.min(1.01*m,c*(1/t._horizonShift))}const hm=Wn/Math.PI/2,as=-hm,ls=hm,Vg=[new Ya([as,as,as],[ls,ls,ls]),new Ya([as,as,as],[0,0,ls]),new Ya([0,as,as],[ls,0,ls]),new Ya([as,0,as],[0,ls,ls]),new Ya([0,0,as],[ls,ls,ls])];function yu(t){if(t.z<=1)return Vg[t.z+2*t.y+t.x];const[e,r]=dm(t),s=[Jh(e[0],e[1]),Jh(e[0],r[1]),Jh(r[0],e[1]),Jh(r[0],r[1])],c=[ls,ls,ls],d=[as,as,as];for(const m of s)c[0]=Math.min(c[0],m[0]),c[1]=Math.min(c[1],m[1]),c[2]=Math.min(c[2],m[2]),d[0]=Math.max(d[0],m[0]),d[1]=Math.max(d[1],m[1]),d[2]=Math.max(d[2],m[2]);return new Ya(c,d)}function dm(t){const e=Math.pow(2,t.z),r=t.x/e,s=(t.x+1)/e,c=(t.y+1)/e;return[[ra(t.y/e),wl(r)],[ra(c),wl(s)]]}function Cf(t,e,r,s){return r=Cn(r),s||(s=hm),[t*Math.sin(r)*s,-e*s,t*Math.cos(r)*s]}function Jh(t,e,r){return Cf(Math.cos(Cn(t)),Math.sin(Cn(t)),e,r)}function fm(t){return 16383/Math.max(...$r([],t.max,t.min))}function pm(t){const e=Ft(new Float64Array(16)),r=1/fm(t);return an(e,e,t.min),It(e,e,[r,r,r]),e}function mm(t,e,r){const s=e/(2*Math.PI),c=function(m){const y=Wn/(2*Math.PI);return m/(2*Math.PI)/y}(e);if(!r){const m=Pn(t.center.lat,-85.051129,Wa);r=[Vi(t.center.lng)*e,qa(m)*e]}const d=Ft(new Float64Array(16));return an(d,d,[r[0],r[1],-s]),It(d,d,[c,c,c]),Nn(d,d,Cn(-t._center.lat)),zn(d,d,Cn(-t._center.lng)),d}class vu{constructor(e){const r=this._createGridIndices();this.gridIndexBuffer=e.createIndexBuffer(r,!0),this.gridSegments=Li.simpleSegment(0,0,4225,8192);const s=this._createPoleTriangleIndices();this.poleIndexBuffer=e.createIndexBuffer(s,!0),this.poleSegments=Li.simpleSegment(0,0,66,64);const c=new Pu;c.emplaceBack(-1,1,1,0,0,0,0),c.emplaceBack(1,1,1,0,0,1,0),c.emplaceBack(1,-1,1,0,0,1,1),c.emplaceBack(-1,-1,1,0,0,0,1);const d=new vs;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.atmosphereVertexBuffer=e.createVertexBuffer(c,um.members),this.atmosphereIndexBuffer=e.createIndexBuffer(d),this.atmosphereSegments=Li.simpleSegment(0,0,4,2)}destroy(){this.poleIndexBuffer.destroy(),this.gridIndexBuffer.destroy(),this.poleSegments.destroy(),this.gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this.wireframeIndexBuffer&&(this.wireframeIndexBuffer.destroy(),this.wireframeSegments.destroy())}static createPoleTriangleVertices(e,r,s){const c=new Pu,d=r/Math.PI/2;c.emplaceBack(0,-d,0,0,0,.5,s?0:1);const m=360/e,y=Math.cos(Cn(85)),b=Math.sin(Cn(85));for(let I=0;I<=64;I++){const P=I/64,R=Cf(y,b,0*(1-(E=P))+m*E,d);c.emplaceBack(R[0],R[1],R[2],0,0,P,s?0:1)}var E;return c}_createPoleTriangleIndices(){const e=new vs;for(let r=0;r<=64;r++)e.emplaceBack(0,r+1,r+2);return e}static createGridVertices(e){const r=Math.pow(2,e.z),s=(b,E,I)=>b*(1-I)+E*I,[c,d]=dm(e),m=new Pu,y=function(b){const E=Ft(new Float64Array(16)),I=fm(b);var P,R;return It(E,E,[I,I,I]),an(E,E,((P=[])[0]=-(R=b.min)[0],P[1]=-R[1],P[2]=-R[2],P)),E}(yu(e));m.reserve(4096);for(let b=0;b<65;b++){const E=s(c[0],d[0],b/64),I=qa(E),P=I*r-e.y,R=Math.sin(Cn(E)),j=Math.cos(Cn(E));for(let H=0;H<65;H++){const Q=H/64,ne=s(c[1],d[1],Q),ce=Cf(j,R,ne);Qt(ce,ce,y);const ye=Vi(ne);m.emplaceBack(ce[0],ce[1],ce[2],ye,I,Q,P)}}return m}_createGridIndices(){const e=new vs,r=(s,c)=>{const d=65*c+s;e.emplaceBack(d+1,d,d+65),e.emplaceBack(d+65,d+65+1,d+1)};for(let s=0;s<64;s++)for(let c=0;c<64;c++)r(c,s);return e}getWirefameBuffer(e){if(!this.wireframeSegments){const r=this._createWireframeGrid();this.wireframeIndexBuffer=e.createIndexBuffer(r),this.wireframeSegments=Li.simpleSegment(0,0,4096,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}_createWireframeGrid(){const e=new os,r=(s,c)=>{const d=65*c+s;e.emplaceBack(d,d+1),e.emplaceBack(d,d+65),e.emplaceBack(d,d+65+1)};for(let s=0;s<64;s++)for(let c=0;c<64;c++)r(c,s);return e}}function Sa(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const r=Math.pow(2,-t.z),s=t.x*r,c=(t.x+1)*r,d=t.y*r,m=(t.y+1)*r,y=wl(s),b=wl(c),E=ra(d),I=ra(m),P=e.project(y,E),R=e.project(b,E),j=e.project(b,I),H=e.project(y,I);let Q=Math.min(P.x,R.x,j.x,H.x),ne=Math.min(P.y,R.y,j.y,H.y),ce=Math.max(P.x,R.x,j.x,H.x),ye=Math.max(P.y,R.y,j.y,H.y);const De=r/16;function Ae(Re,rt,Je,Tt,vt,tt){const gt=(Je+vt)/2,St=(Tt+tt)/2,at=e.project(wl(gt),ra(St)),Bt=Math.max(0,Q-at.x,ne-at.y,at.x-ce,at.y-ye);Q=Math.min(Q,at.x),ce=Math.max(ce,at.x),ne=Math.min(ne,at.y),ye=Math.max(ye,at.y),Bt>De&&(Ae(Re,at,Je,Tt,gt,St),Ae(at,rt,gt,St,vt,tt))}Ae(P,R,s,d,c,d),Ae(R,j,c,d,c,m),Ae(j,H,c,m,s,m),Ae(H,P,s,m,s,d),Q-=De,ne-=De,ce+=De,ye+=De;const ke=1/Math.max(ce-Q,ye-ne);return{scale:ke,x:Q*ke,y:ne*ke,x2:ce*ke,y2:ye*ke,projection:e}}class gm{constructor(e){const r={},s=[];for(const y in e){const b=e[y],E=r[y]={};for(const I in b.glyphs){const P=b.glyphs[+I];if(!P||0===P.bitmap.width||0===P.bitmap.height)continue;const R=P.metrics.localGlyph?2:1,j={x:0,y:0,w:P.bitmap.width+2*R,h:P.bitmap.height+2*R};s.push(j),E[I]=j}}const{w:c,h:d}=qu(s),m=new Tl({width:c||1,height:d||1});for(const y in e){const b=e[y];for(const E in b.glyphs){const I=b.glyphs[+E];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const P=r[y][E],R=I.metrics.localGlyph?2:1;Tl.copy(I.bitmap,m,{x:0,y:0},{x:P.x+R,y:P.y+R},I.bitmap)}}this.image=m,this.positions=r}}jt("GlyphAtlas",gm);class ah{constructor(e){this.tileID=new Go(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Sa(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,r,s,c,d){this.status="parsing",this.data=e,this.collisionBoxArray=new Yf;const m=new em(Object.keys(e.layers).sort()),y=new Og(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},E=new Kp(256,256),I={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:s},P=r.familiesBySource[this.source];for(const ke in P){const Re=e.layers[ke];if(!Re)continue;let rt=!1,Je=!1;for(const tt of P[ke])"symbol"===tt[0].type?rt=!0:Je=!0;if(!0===this.isSymbolTile&&!rt||!1===this.isSymbolTile&&!Je)continue;1===Re.version&&Hn(`Vector tile source "${this.source}" layer "${ke}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Tt=m.encode(ke),vt=[];for(let tt=0;tt<Re.length;tt++){const gt=Re.feature(tt),St=y.getId(gt,ke);vt.push({feature:gt,id:St,index:tt,sourceLayerIndex:Tt})}for(const tt of P[ke]){const gt=tt[0];void 0!==this.isSymbolTile&&"symbol"===gt.type!==this.isSymbolTile||gt.minzoom&&this.zoom<Math.floor(gt.minzoom)||gt.maxzoom&&this.zoom>=gt.maxzoom||"none"!==gt.visibility&&(Sf(tt,this.zoom,s),(b[gt.id]=gt.createBucket({index:y.bucketLayerIDs.length,layers:tt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Tt,sourceID:this.source,enableTerrain:this.enableTerrain,availableImages:s})).populate(vt,I,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(tt.map(St=>St.id)))}}let R,j,H,Q;E.trim();const ne={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ce=fo(I.glyphDependencies,ke=>Object.keys(ke).map(Number));Object.keys(ce).length?c.send("getGlyphs",{uid:this.uid,stacks:ce},(ke,Re)=>{R||(R=ke,j=Re,Ae.call(this))},void 0,!1,ne):j={};const ye=Object.keys(I.iconDependencies);ye.length?c.send("getImages",{icons:ye,source:this.source,tileID:this.tileID,type:"icons"},(ke,Re)=>{R||(R=ke,H=Re,Ae.call(this))},void 0,!1,ne):H={};const De=Object.keys(I.patternDependencies);function Ae(){if(R)return d(R);if(j&&H&&Q){const ke=new gm(j),Re=new nf(H,Q);for(const rt in b){const Je=b[rt];Je instanceof Ja?(Sf(Je.layers,this.zoom,s),Ag(Je,j,ke.positions,H,Re.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection),Je.projection=this.projection.name):Je.hasPattern&&(Je instanceof ia||Je instanceof Vu||Je instanceof Ah)&&(Sf(Je.layers,this.zoom,s),Je.addFeatures(I,this.tileID.canonical,Re.patternPositions,s))}this.status="done",d(null,{buckets:xi(b).filter(rt=>!rt.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ke.image,lineAtlas:E,imageAtlas:Re,glyphMap:this.returnDependencies?j:null,iconMap:this.returnDependencies?H:null,glyphPositions:this.returnDependencies?ke.positions:null})}}De.length?c.send("getImages",{icons:De,source:this.source,tileID:this.tileID,type:"patterns"},(ke,Re)=>{R||(R=ke,Q=Re,Ae.call(this))},void 0,!1,ne):Q={},Ae.call(this)}}function Sf(t,e,r){const s=new wn(e);for(const c of t)c.recalculate(s,r)}class _m{constructor(e){this.entries={},this.scheduler=e}request(e,r,s,c){const d=this.entries[e]=this.entries[e]||{callbacks:[]};if(d.result){const[m,y]=d.result;return this.scheduler?this.scheduler.add(()=>{c(m,y)},r):c(m,y),()=>{}}return d.callbacks.push(c),d.cancel||(d.cancel=s((m,y)=>{d.result=[m,y];for(const b of d.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,y)},r):b(m,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{d.result||(d.callbacks=d.callbacks.filter(m=>m!==c),d.callbacks.length||(d.cancel(),delete this.entries[e]))}}}function ed(t,e,r){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},c=>{const d=Dr(t.request,(m,y,b,E)=>{m?c(m):y&&c(null,{vectorTile:r?void 0:new Ql.VectorTile(new Gu(y)),rawData:y,cacheControl:b,expires:E})});return()=>{d.cancel(),c()}},e)}const il=Ft(new Float64Array(16));class Ma{constructor(e,r){this._tr=e,this._worldSize=r}createInversionMatrix(){return il}createTileMatrix(e){let r,s,c;const d=e.canonical,m=Ft(new Float64Array(16)),y=this._tr.projection;if(y.isReprojectedInTileSpace){const b=Sa(d,y);r=1,s=b.x+e.wrap*b.scale,c=b.y,It(m,m,[r/b.scale,r/b.scale,this._tr.pixelsPerMeter/this._worldSize])}else r=this._worldSize/this._tr.zoomScale(d.z),s=(d.x+Math.pow(2,d.z)*e.wrap)*r,c=d.y*r;return an(m,m,[s,c,0]),It(m,m,[r/Wn,r/Wn,1]),m}pointCoordinate(e,r,s){const c=this._tr.horizonLineFromTop(!1),d=new et(e,Math.max(c,r));return this._tr.rayIntersectionCoordinate(this._tr.pointRayIntersection(d,s))}upVector(){return[0,0,1]}upVectorScale(){return 1}}var Ho={name:"albers",range:[4,7],center:[-96,37.5],parallels:[29.5,45.5],zAxisUnit:"meters",conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Lr(this.parallels,this.constants.parallels))return;const t=Math.sin(Cn(this.parallels[0])),e=(t+Math.sin(Cn(this.parallels[1])))/2,r=1+t*(2*e-t),s=Math.sqrt(r)/e;this.constants={n:e,c:r,r0:s,parallels:this.parallels}},project(t,e){this.initializeConstants();const r=Cn(t-this.center[0]),s=Cn(e),{n:c,c:d,r0:m}=this.constants,y=Math.sqrt(d-2*c*Math.sin(s))/c;return{x:y*Math.sin(r*c),y:y*Math.cos(r*c)-m,z:0}},unproject(t,e){this.initializeConstants();const{n:r,c:s,r0:c}=this.constants,d=c+e;let m=Math.atan2(t,Math.abs(d))*Math.sign(d);d*r<0&&(m-=Math.PI*Math.sign(t)*Math.sign(d));const y=Cn(this.center[0])*r;m=Kr(m,-Math.PI-y,Math.PI-y);const b=qi(m/r)+this.center[0],E=Math.asin(Pn((s-(t*t+d*d)*r*r)/(2*r),-1,1)),I=Pn(qi(E),-85.051129,Wa);return new vr(b,I)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>$s(1,t)*e,farthestPixelDistance(t){return Fc(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ma(t,e)};const Ia=1.340264,sc=-.081106,Zo=893e-6,Oc=.003796,Il=Math.sqrt(3)/2;var xu={name:"equalEarth",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const r=Math.asin(Il*Math.sin(e)),s=r*r,c=s*s*s;return{x:.5*(t*Math.cos(r)/(Il*(Ia+3*sc*s+c*(7*Zo+9*Oc*s)))/Math.PI+.5),y:1-.5*(r*(Ia+sc*s+c*(Zo+Oc*s))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,s=r*r,c=s*s*s;for(let E,I,P,R=0;R<12&&(I=r*(Ia+sc*s+c*(Zo+Oc*s))-e,P=Ia+3*sc*s+c*(7*Zo+9*Oc*s),E=I/P,r=Pn(r-E,-Math.PI/3,Math.PI/3),s=r*r,c=s*s*s,!(Math.abs(E)<1e-12));++R);const d=Il*t*(Ia+3*sc*s+c*(7*Zo+9*Oc*s))/Math.cos(r),m=Math.asin(Math.sin(r)/Il),y=Pn(180*d/Math.PI,-180,180),b=Pn(180*m/Math.PI,-85.051129,Wa);return new vr(y,b)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>$s(1,t)*e,farthestPixelDistance(t){return Fc(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ma(t,e)},bu={name:"equirectangular",supportsWorldCopies:!0,center:[0,0],range:[3.5,7],zAxisUnit:"meters",wrap:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project:(t,e)=>({x:.5+t/360,y:.5-e/360,z:0}),unproject(t,e){const r=360*(t-.5),s=Pn(360*(.5-e),-85.051129,Wa);return new vr(r,s)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>$s(1,t)*e,farthestPixelDistance(t){return Fc(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ma(t,e)};const Aa=Math.PI/2;function Al(t){return Math.tan((Aa+t)/2)}var wu={name:"lambertConformalConic",range:[3.5,7],zAxisUnit:"meters",center:[0,30],parallels:[30,30],conic:!0,isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],initializeConstants(){if(this.constants&&Lr(this.parallels,this.constants.parallels))return;const t=Cn(this.parallels[0]),e=Cn(this.parallels[1]),r=Math.cos(t),s=t===e?Math.sin(t):Math.log(r/Math.cos(e))/Math.log(Al(e)/Al(t)),c=r*Math.pow(Al(t),s)/s;this.constants={n:s,f:c,parallels:this.parallels}},project(t,e){this.initializeConstants(),e=Cn(e),t=Cn(t-this.center[0]);const r=1e-6,{n:s,f:c}=this.constants;c>0?e<-Aa+r&&(e=-Aa+r):e>Aa-r&&(e=Aa-r);const d=c/Math.pow(Al(e),s),m=d*Math.sin(s*t),y=c-d*Math.cos(s*t);return{x:.5*(m/Math.PI+.5),y:1-.5*(y/Math.PI+.5),z:0}},unproject(t,e){this.initializeConstants(),t=(2*t-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:r,f:s}=this.constants,c=s-e,d=Math.sign(c),m=Math.sign(r)*Math.sqrt(t*t+c*c);let y=Math.atan2(t,Math.abs(c))*d;c*r<0&&(y-=Math.PI*Math.sign(t)*d);const b=Pn(qi(y/r)+this.center[0],-180,180),E=Pn(qi(2*Math.atan(Math.pow(s/m,1/r))-Aa),-85.051129,Wa);return new vr(b,E)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>$s(1,t)*e,farthestPixelDistance(t){return Fc(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ma(t,e)},Eu={name:"mercator",wrap:!0,requiresDraping:!1,supportsWorldCopies:!0,supportsTerrain:!0,supportsFog:!0,supportsFreeCamera:!0,zAxisUnit:"meters",center:[0,0],project:(t,e)=>({x:Vi(t),y:qa(e),z:0}),unproject(t,e){const r=wl(t),s=ra(e);return new vr(r,s)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>$s(1,t)*e,farthestPixelDistance(t){return Fc(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ma(t,e)};const zc=Cn(Wa);var Tu={name:"naturalEarth",center:[0,0],range:[3.5,7],isReprojectedInTileSpace:!0,zAxisUnit:"meters",unsupportedLayers:["custom"],project(t,e){const r=(e=Cn(e))*e,s=r*r;return{x:.5*((t=Cn(t))*(.8707-.131979*r+s*(s*(.003971*r-.001529*s)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+r*(.015085+s*(.028874*r-.044475-.005916*s)))/Math.PI+1),z:0}},unproject(t,e){t=(2*t-.5)*Math.PI;let r=e=(2*(1-e)-1)*Math.PI,s=25,c=0,d=r*r;do{d=r*r;const b=d*d;c=(r*(1.007226+d*(.015085+b*(.028874*d-.044475-.005916*b)))-e)/(1.007226+d*(.045255+b*(.259866*d-.311325-.005916*11*b))),r=Pn(r-c,-zc,zc)}while(Math.abs(c)>1e-6&&--s>0);d=r*r;const m=Pn(qi(t/(.8707+d*(d*(d*d*d*(.003971-.001529*d)-.013791)-.131979))),-180,180),y=qi(r);return new vr(m,y)},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>$s(1,t)*e,farthestPixelDistance(t){return Fc(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ma(t,e)};const Mf=Cn(Wa),If={albers:Ho,equalEarth:xu,equirectangular:bu,lambertConformalConic:wu,mercator:Eu,naturalEarth:Tu,winkelTripel:{name:"winkelTripel",center:[0,0],range:[3.5,7],zAxisUnit:"meters",isReprojectedInTileSpace:!0,unsupportedLayers:["custom"],project(t,e){e=Cn(e),t=Cn(t);const r=Math.cos(e),s=2/Math.PI,c=Math.acos(r*Math.cos(t/2)),d=Math.sin(c)/c,m=.5*(t*s+2*r*Math.sin(t/2)/d)||0,y=.5*(e+Math.sin(e)/d)||0;return{x:.5*(m/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}},unproject(t,e){let r=t=(2*t-.5)*Math.PI,s=e=(2*(1-e)-1)*Math.PI,c=25;const d=1e-6;let m=0,y=0;do{const b=Math.cos(s),E=Math.sin(s),I=2*E*b,P=E*E,R=b*b,j=Math.cos(r/2),H=Math.sin(r/2),Q=2*j*H,ne=H*H,ce=1-R*j*j,ye=ce?1/ce:0,De=ce?Math.acos(b*j)*Math.sqrt(1/ce):0,Ae=.5*(2*De*b*H+2*r/Math.PI)-t,ke=.5*(De*E+s)-e,Re=.5*ye*(R*ne+De*b*j*P)+1/Math.PI,rt=ye*(Q*I/4-De*E*H),Je=.125*ye*(I*H-De*E*R*Q),Tt=.5*ye*(P*j+De*ne*b)+.5,vt=rt*Je-Tt*Re;m=(ke*rt-Ae*Tt)/vt,y=(Ae*Je-ke*Re)/vt,r=Pn(r-m,-Math.PI,Math.PI),s=Pn(s-y,-Mf,Mf)}while((Math.abs(m)>d||Math.abs(y)>d)&&--c>0);return new vr(qi(r),qi(s))},projectTilePoint:(t,e)=>({x:t,y:e,z:0}),locationPoint:(t,e)=>t._coordinatePoint(t.locationCoordinate(e),!1),pixelsPerMeter:(t,e)=>$s(1,t)*e,farthestPixelDistance(t){return Fc(t,this.pixelsPerMeter(t.center.lat,t.worldSize))},createTileTransform:(t,e)=>new Ma(t,e)}};u.ARRAY_TYPE=Ot,u.AUTH_ERR_MSG=Fe,u.Aabb=Ya,u.Actor=class{constructor(t,e,r){this.target=t,this.parent=e,this.mapId=r,this.callbacks={},this.cancelCallbacks={},un(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=mo()?t:Me,this.scheduler=new nh}send(t,e,r,s,c=!1,d){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=d,this.callbacks[m]=r);const y=ko(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:t,hasCallback:!!r,targetMapId:s,mustQueue:c,sourceMapId:this.mapId,data:$c(e,y)},y),{cancel:()=>{r&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(t){const e=t.data,r=e.id;if(r&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[r];delete this.cancelCallbacks[r],s&&s.cancel()}else if(e.mustQueue||mo()){const s=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add(()=>this.processTask(r,e),s&&s.metadata||{type:"message"})}else this.processTask(r,e)}processTask(t,e){if("<response>"===e.type){const r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(ys(e.error)):r(null,ys(e.data)))}else{const r=ko(this.globalScope)?void 0:[],s=e.hasCallback?(d,m)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:d?$c(d):null,data:$c(m,r)},r)}:d=>{},c=ys(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,c,s);else if(this.parent.getWorkerSource){const d=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,d[0],c.source)[d[1]](c,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.CanonicalTileID=pu,u.Color=Un,u.ColorMode=tl,u.CullFaceMode=sa,u.DEMData=ih,u.DataConstantProperty=$t,u.DedupedRequest=_m,u.DepthMode=gu,u.EXTENT=Wn,u.Elevation=class{getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,r=!0){null==e&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const c=s.getSource().maxzoom,d=1<<c,m=Math.floor(t.x),y=t.x-m,b=new Go(c,m,c,Math.floor(y*d),Math.floor(t.y*d)),E=this.findDEMTileFor(b);if(!E||!E.dem)return e;const I=E.dem,P=1<<E.tileID.canonical.z,R=(y*P-E.tileID.canonical.x)*I.dim,j=(t.y*P-E.tileID.canonical.y)*I.dim,H=Math.floor(R),Q=Math.floor(j);return(r?this.exaggeration():1)*or(or(I.get(H,Q),I.get(H,Q+1),j-Q),or(I.get(H+1,Q),I.get(H+1,Q+1),j-Q),R-H)}getAtTileOffset(t,e,r){const s=1<<t.canonical.z;return this.getAtPointOrZero(new Lu(t.wrap+(t.canonical.x+e/Wn)/s,(t.canonical.y+r/Wn)/s))}getAtTileOffsetFunc(t,e){return r=>{const s=this.getAtTileOffset(t,r.x,r.y),c=e.upVector(t.canonical,r.x,r.y);return He(c,c,s*e.upVectorScale(t.canonical)),c}}getForTilePoints(t,e,r,s){const c=oh.create(this,t,s);return!!c&&(e.forEach(d=>{d[2]=this.exaggeration()*c.getElevationAt(d[0],d[1],r)}),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const r=e.dem.tree,s=e.tileID,c=1<<t.canonical.z-s.canonical.z;let d=t.canonical.x/c-s.canonical.x,m=t.canonical.y/c-s.canonical.y,y=0;for(let b=0;b<t.canonical.z-s.canonical.z&&!r.leaves[y];b++){d*=2,m*=2;const E=2*Math.floor(m)+Math.floor(d);y=r.childOffsets[y]+E,d%=1,m%=1}return{min:this.exaggeration()*r.minimums[y],max:this.exaggeration()*r.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,r){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},u.ErrorEvent=Hr,u.EvaluationParameters=wn,u.Event=Ai,u.Evented=Rn,u.Frustum=_p,u.GLOBE_ZOOM_THRESHOLD_MAX=6,u.GlobeSharedBuffers=vu,u.GlyphManager=Rc,u.ImagePosition=tf,u.LineAtlas=Kp,u.LngLat=vr,u.LngLatBounds=wa,u.LocalGlyphMode=$p,u.MAX_MERCATOR_LATITUDE=Wa,u.MercatorCoordinate=Lu,u.ONE_EM=24,u.OverscaledTileID=Go,u.Properties=Ei,u.RGBAImage=ss,u.Ray=class{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,r){const s=Ve(e,this.dir);if(Math.abs(s)<1e-6)return!1;const c=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/s;return r[0]=this.pos[0]+this.dir[0]*c,r[1]=this.pos[1]+this.dir[1]*c,r[2]=this.pos[2]+this.dir[2]*c,!0}closestPointOnSphere(t,e,r){if(H=(R=this.pos)[0],Q=R[1],ne=R[2],ce=(j=t)[0],ye=j[1],De=j[2],Math.abs(H-ce)<=st*Math.max(1,Math.abs(H),Math.abs(ce))&&Math.abs(Q-ye)<=st*Math.max(1,Math.abs(Q),Math.abs(ye))&&Math.abs(ne-De)<=st*Math.max(1,Math.abs(ne),Math.abs(De))||0===e)return r[0]=r[1]=r[2]=0,!1;var R,j,H,Q,ne,ce,ye,De;const[s,c,d]=this.dir,m=this.pos[0]-t[0],y=this.pos[1]-t[1],b=this.pos[2]-t[2],E=s*s+c*c+d*d,I=2*(m*s+y*c+b*d),P=I*I-4*E*(m*m+y*y+b*b-e*e);if(P<0){const R=Math.max(-I/2,0),j=m+s*R,H=y+c*R,Q=b+d*R,ne=Math.hypot(j,H,Q);return r[0]=j*e/ne,r[1]=H*e/ne,r[2]=Q*e/ne,!1}{const R=(-I-Math.sqrt(P))/(2*E);if(R<0){const j=Math.hypot(m,y,b);return r[0]=m*e/j,r[1]=y*e/j,r[2]=b*e/j,!1}return r[0]=m+s*R,r[1]=y+c*R,r[2]=b+d*R,!0}}},u.RequestManager=class{constructor(t,e,r){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let r=0;r<10;r++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ee,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Xe(t))return t;const r=Ht(t);return r.path=`/styles/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Xe(t))return t;const r=Ht(t);return r.path=`/fonts/v1${r.path}`,this._makeAPIURL(r,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!Xe(t))return t;const r=Ht(t);return r.path=`/v4/${r.authority}.json`,r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||e)}normalizeSpriteURL(t,e,r,s){const c=Ht(t);return Xe(t)?(c.path=`/styles/v1${c.path}/sprite${e}${r}`,this._makeAPIURL(c,this._customAccessToken||s)):(c.path+=`${e}${r}`,Kt(c))}normalizeTileURL(t,e,r){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Xe(t))return t;const s=Ht(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||r&&"raster"!==s.authority&&512===r?"@2x":""}${Z.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${V.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${V.TILE_URL_VERSION}${s.path}`);const c=this._customAccessToken||function(d){for(const m of d){const y=m.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(s.params)||V.ACCESS_TOKEN;return V.REQUIRE_ACCESS_TOKEN&&c&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,c)}canonicalizeTileURL(t,e){const r=Ht(t);if(!r.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!r.path.match(/\.[\w]+$/))return t;let s="mapbox://";r.path.match(/^\/raster\/v1\//)?s+=`raster/${r.path.replace(`/${V.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${r.path.replace(`/${V.TILE_URL_VERSION}/`,"")}`;let c=r.params;return e&&(c=c.filter(d=>!d.match(/^access_token=/))),c.length&&(s+=`?${c.join("&")}`),s}canonicalizeTileset(t,e){const r=!!e&&Xe(e),s=[];for(const c of t.tiles||[])nt(c)?s.push(this.canonicalizeTileURL(c,r)):s.push(c);return s}_makeAPIURL(t,e){const r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",s=Ht(V.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,"http"===t.protocol){const c=t.params.indexOf("secure");c>=0&&t.params.splice(c,1)}if("/"!==s.path&&(t.path=`${s.path}${t.path}`),!V.REQUIRE_ACCESS_TOKEN)return Kt(t);if(e=e||V.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${r}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${r}`)}return t.params=t.params.filter(c=>-1===c.indexOf("access_token")),t.params.push(`access_token=${e||""}`),Kt(t)}},u.ResourceType=ci,u.SegmentVector=Li,u.SourceCache=Lc,u.StencilMode=bf,u.StructArrayLayout1ui2=Yl,u.StructArrayLayout2f1f2i16=mh,u.StructArrayLayout2i4=Hc,u.StructArrayLayout2ui4=os,u.StructArrayLayout3f12=Xl,u.StructArrayLayout3ui6=vs,u.StructArrayLayout4i8=Zc,u.Texture=Wh,u.Tile=lm,u.Transitionable=ao,u.Uniform1f=Jc,u.Uniform1i=class extends va{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},u.Uniform2f=class extends va{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},u.Uniform3f=class extends va{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},u.Uniform4f=jm,u.UniformColor=$m,u.UniformMatrix2f=class extends va{constructor(t,e){super(t,e),this.current=Hm}set(t){for(let e=0;e<4;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},u.UniformMatrix3f=class extends va{constructor(t,e){super(t,e),this.current=Gm}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},u.UniformMatrix4f=class extends va{constructor(t,e){super(t,e),this.current=sp}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},u.UnwrappedTileID=Yh,u.ValidationError=kt,u.VectorTileWorkerSource=class extends Rn{constructor(t,e,r,s,c){super(),this.actor=t,this.layerIndex=e,this.availableImages=r,this.loadVectorData=c||ed,this.loading={},this.loaded={},this.deduped=new _m(t.scheduler),this.isSpriteLoaded=s,this.scheduler=t.scheduler}loadTile(t,e){const r=t.uid,s=t&&t.request,c=s&&s.collectResourceTiming,d=this.loading[r]=new ah(t);d.abort=this.loadVectorData(t,(m,y)=>{const b=!this.loading[r];if(delete this.loading[r],b||m||!y)return d.status="done",b||(this.loaded[r]=d),e(m);const E=y.rawData,I={};y.expires&&(I.expires=y.expires),y.cacheControl&&(I.cacheControl=y.cacheControl),d.vectorTile=y.vectorTile||new Ql.VectorTile(new Gu(E));const P=()=>{d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,(R,j)=>{if(R||!j)return e(R);const H={};if(c){const Q=Xh(s);Q.length>0&&(H.resourceTiming=JSON.parse(JSON.stringify(Q)))}e(null,cr({rawTileData:E.slice(0)},j,I,H))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[r]=d})}reloadTile(t,e){const r=this.loaded,s=t.uid,c=this;if(r&&r[s]){const d=r[s];d.showCollisionBoxes=t.showCollisionBoxes,d.enableTerrain=!!t.enableTerrain,d.projection=t.projection;const m=(y,b)=>{const E=d.reloadCallback;E&&(delete d.reloadCallback,d.parse(d.vectorTile,c.layerIndex,this.availableImages,c.actor,E)),e(y,b)};"parsing"===d.status?d.reloadCallback=m:"done"===d.status&&(d.vectorTile?d.parse(d.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(t,e){const r=t.uid,s=this.loading[r];s&&(s.abort&&s.abort(),delete this.loading[r]),e()}removeTile(t,e){const r=this.loaded,s=t.uid;r&&r[s]&&delete r[s],e()}},u.WritingMode=Gs,u.ZoomHistory=f,u.add=tn,u.addDynamicAttributes=pf,u.adjoint=function(t,e){var r=e[0],s=e[1],c=e[2],d=e[3],m=e[4],y=e[5],b=e[6],E=e[7],I=e[8];return t[0]=m*I-y*E,t[1]=c*E-s*I,t[2]=s*y-c*m,t[3]=y*b-d*I,t[4]=r*I-c*b,t[5]=c*d-r*y,t[6]=d*E-m*b,t[7]=s*b-r*E,t[8]=r*m-s*d,t},u.asyncAll=ti,u.bezier=Es,u.bindAll=un,u.boundsAttributes=Hs,u.bufferConvexPolygon=function(t,e){const r=[];for(let s=0;s<t.length;s++){const c=Kr(s-1,-1,t.length-1),d=Kr(s+1,-1,t.length-1),m=t[s],y=t[d],b=t[c].sub(m).unit(),E=y.sub(m).unit(),I=E.angleWithSep(b.x,b.y),P=b.add(E).unit().mult(-1*e/Math.sin(I/2));r.push(m.add(P))}return r},u.cacheEntryPossiblyAdded=function(t){dr++,dr>Mi&&(t.getActor().send("enforceCacheSizeLimit",ms),dr=0)},u.calculateGlobeMatrix=mm,u.calculateGlobeMercatorMatrix=function(t){const e=t.worldSize,r=Pn(t.center.lat,-85.051129,Wa),s=new et(Vi(t.center.lng)*e,qa(r)*e),c=$s(1,t.center.lat)*e,d=t.pixelsPerMeter,m=e/(c/t.pixelsPerMeter),y=Ft(new Float64Array(16));return an(y,y,[s.x,s.y,0]),It(y,y,[m,m,d]),y},u.clamp=Pn,u.clearTileCache=function(t){const e=Me.caches.delete(Fr);t&&e.catch(t).then(()=>t())},u.clipLine=xs,u.clone=function(t){var e=new Ot(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},u.clone$1=hr,u.collisionCircleLayout=Xd,u.config=V,u.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},u.create=function(){var t=new Ot(16);return Ot!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},u.create$1=Bn,u.createExpression=ns,u.createLayout=hi,u.createStyleLayer=function(t){return"custom"===t.type?new Lg(t):new Yp[t.type](t)},u.cross=En,u.degToRad=Cn,u.div=function(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t},u.dot=Ve,u.ease=To,u.easeCubicInOut=Gr,u.emitValidationErrors=Au,u.endsWith=cn,u.enforceCacheSizeLimit=function(t){Ut(),Si&&Si.then(e=>{e.keys().then(r=>{for(let s=0;s<r.length-t;s++)e.delete(r[s])})})},u.evaluateSizeForFeature=Oh,u.evaluateSizeForZoom=cu,u.evaluateVariableOffset=uf,u.evented=Vo,u.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},u.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},u.exported=Sn,u.exported$1=Z,u.extend=cr,u.extend$1=Nr,u.filterObject=Po,u.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},u.fromQuat=function(t,e){var r=e[0],s=e[1],c=e[2],d=e[3],m=r+r,y=s+s,b=c+c,E=r*m,I=s*m,P=s*y,R=c*m,j=c*y,H=c*b,Q=d*m,ne=d*y,ce=d*b;return t[0]=1-P-H,t[1]=I+ce,t[2]=R-ne,t[3]=0,t[4]=I-ce,t[5]=1-E-H,t[6]=j+Q,t[7]=0,t[8]=R+ne,t[9]=j-Q,t[10]=1-E-P,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},u.fromRotation=function(t,e){var r=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=r,t[2]=0,t[3]=-r,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},u.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},u.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return ds[e]},u.getAABBPointSquareDist=function(t,e,r){let s=0;for(let c=0;c<2;++c){const d=r?r[c]:0;t[c]>d&&(s+=(t[c]-d)*(t[c]-d)),e[c]<d&&(s+=(d-e[c])*(d-e[c]))}return s},u.getAnchorAlignment=Yu,u.getAnchorJustification=oa,u.getBounds=function(t){let e=1/0,r=1/0,s=-1/0,c=-1/0;for(const d of t)e=Math.min(e,d.x),r=Math.min(r,d.y),s=Math.max(s,d.x),c=Math.max(c,d.y);return{min:new et(e,r),max:new et(s,c)}},u.getColumn=function(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]},u.getImage=Ts,u.getJSON=function(t,e){return mi(cr(t,{type:"json"}),e)},u.getMapSessionAPI=Er,u.getPerformanceMeasurement=Xh,u.getProjection=function(t){const e=If[t.name];if(!e)throw new Error(`Invalid projection name: ${t.name}`);return e.conic?function(r,s){if(s.parallels&&Math.abs(s.parallels[0]+s.parallels[1])<.01){let c=function(d){const m=Math.max(.01,Math.cos(Cn(d))),y=1/(2*Math.max(Math.PI*m,1/m));return{wrap:!0,supportsWorldCopies:!0,unsupportedLayers:["custom"],project(b,E){const I=Cn(b)*m,P=Math.sin(Cn(E))/m;return{x:I*y+.5,y:-P*y+.5,z:0}},unproject(b,E){const I=-(E-.5)/y,P=Pn(qi((b-.5)/y)/m,-180,180),R=Math.asin(Pn(I*m,-1,1)),j=Pn(qi(R),-85.051129,Wa);return new vr(P,j)}}}(s.parallels[0]);if("lambertConformalConic"===s.name){const{project:d,unproject:m}=If.mercator;c={wrap:!0,supportsWorldCopies:!0,project:d,unproject:m}}return cr({},r,s,c)}return cr({},r,s)}(e,t):e},u.getRTLTextPluginStatus=jo,u.getReferrer=Qr,u.getTilePoint=function(t,{x:e,y:r},s=0){return new et(((e-s)*t.scale-t.x)*Wn,(r*t.scale-t.y)*Wn)},u.getTileVec3=function(t,e,r=0){return Wt(((e.x-r)*t.scale-t.x)*Wn,(e.y*t.scale-t.y)*Wn,wd(e.z,e.y))},u.getVideo=function(t,e){const r=Me.document.createElement("video");r.muted=!0,r.onloadstart=function(){e(null,r)};for(let s=0;s<t.length;s++){const c=Me.document.createElement("source");Mn(t[s])||(r.crossOrigin="Anonymous"),c.src=t[s],r.appendChild(c)}return{cancel:()=>{}}},u.globeBuffersForTileMesh=function(t,e,r,s){const c=t.context,d=t.transform;let m=e.globeGridBuffer,y=e.globePoleBuffer;if(!m){const b=vu.createGridVertices(r.canonical);m=e.globeGridBuffer=c.createVertexBuffer(b,Df,!1)}if(!y){const b=vu.createPoleTriangleVertices(s,d.tileSize*s,0===r.canonical.y);y=e.globePoleBuffer=c.createVertexBuffer(b,Df,!1)}return[m,y]},u.globeDenormalizeECEF=pm,u.globeMatrixForTile=function(t,e){const r=pm(yu(t)),s=((c=new Float64Array(16))[0]=(d=e)[0],c[1]=d[1],c[2]=d[2],c[3]=d[3],c[4]=d[4],c[5]=d[5],c[6]=d[6],c[7]=d[7],c[8]=d[8],c[9]=d[9],c[10]=d[10],c[11]=d[11],c[12]=d[12],c[13]=d[13],c[14]=d[14],c[15]=d[15],c);var c,d;return xn(s,s,r),s},u.globePoleMatrixForTile=function(t,e,r){const s=Ft(new Float64Array(16)),c=Math.pow(2,t.z),d=(t.x-c/2)/c*Math.PI*2,m=r.point,y=r.worldSize/(r.tileSize*c);return an(s,s,[m.x,m.y,-r.worldSize/Math.PI/2]),It(s,s,[y,y,y]),Nn(s,s,Cn(-r._center.lat)),zn(s,s,Cn(-r._center.lng)),zn(s,s,d),e&&It(s,s,[1,-1,1]),s},u.globeTileBounds=yu,u.globeToMercatorTransition=function(t){return Yr(5,6,t)},u.identity=Ft,u.identity$1=Eo,u.invert=function(t,e){var r=e[0],s=e[1],c=e[2],d=e[3],m=e[4],y=e[5],b=e[6],E=e[7],I=e[8],P=e[9],R=e[10],j=e[11],H=e[12],Q=e[13],ne=e[14],ce=e[15],ye=r*y-s*m,De=r*b-c*m,Ae=r*E-d*m,ke=s*b-c*y,Re=s*E-d*y,rt=c*E-d*b,Je=I*Q-P*H,Tt=I*ne-R*H,vt=I*ce-j*H,tt=P*ne-R*Q,gt=P*ce-j*Q,St=R*ce-j*ne,at=ye*St-De*gt+Ae*tt+ke*vt-Re*Tt+rt*Je;return at?(t[0]=(y*St-b*gt+E*tt)*(at=1/at),t[1]=(c*gt-s*St-d*tt)*at,t[2]=(Q*rt-ne*Re+ce*ke)*at,t[3]=(R*Re-P*rt-j*ke)*at,t[4]=(b*vt-m*St-E*Tt)*at,t[5]=(r*St-c*vt+d*Tt)*at,t[6]=(ne*Ae-H*rt-ce*De)*at,t[7]=(I*rt-R*Ae+j*De)*at,t[8]=(m*gt-y*vt+E*Je)*at,t[9]=(s*vt-r*gt-d*Je)*at,t[10]=(H*Re-Q*Ae+ce*ye)*at,t[11]=(P*Ae-I*Re-j*ye)*at,t[12]=(y*Tt-m*tt-b*Je)*at,t[13]=(r*tt-s*Tt+c*Je)*at,t[14]=(Q*De-H*ke-ne*ye)*at,t[15]=(I*ke-P*De+R*ye)*at,t):null},u.isMapAuthenticated=function(t){return Tr.has(t)},u.isMapboxURL=Xe,u.latFromMercatorY=ra,u.len=ur,u.length=fn,u.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},u.loadVectorTile=ed,u.makeRequest=mi,u.mercatorXfromLng=Vi,u.mercatorYfromLat=qa,u.mercatorZfromAltitude=$s,u.mul=xn,u.mul$1=yi,u.multiply=function(t,e,r){var s=e[0],c=e[1],d=e[2],m=e[3],y=e[4],b=e[5],E=e[6],I=e[7],P=e[8],R=r[0],j=r[1],H=r[2],Q=r[3],ne=r[4],ce=r[5],ye=r[6],De=r[7],Ae=r[8];return t[0]=R*s+j*m+H*E,t[1]=R*c+j*y+H*I,t[2]=R*d+j*b+H*P,t[3]=Q*s+ne*m+ce*E,t[4]=Q*c+ne*y+ce*I,t[5]=Q*d+ne*b+ce*P,t[6]=ye*s+De*m+Ae*E,t[7]=ye*c+De*y+Ae*I,t[8]=ye*d+De*b+Ae*P,t},u.multiply$1=Rt,u.multiply$2=Ne,u.nextPowerOfTwo=Jt,u.normalize=_t,u.normalize$1=function(t,e){var r=e[0],s=e[1],c=e[2],d=e[3],m=r*r+s*s+c*c+d*d;return m>0&&(m=1/Math.sqrt(m)),t[0]=r*m,t[1]=s*m,t[2]=c*m,t[3]=d*m,t},u.number=or,u.ortho=function(t,e,r,s,c,d,m){var y=1/(e-r),b=1/(s-c),E=1/(d-m);return t[0]=-2*y,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*b,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*E,t[11]=0,t[12]=(e+r)*y,t[13]=(c+s)*b,t[14]=(m+d)*E,t[15]=1,t},u.pbf=Gu,u.perspective=function(t,e,r,s,c){var d,m=1/Math.tan(e/2);return t[0]=m/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=c&&c!==1/0?(t[10]=(c+s)*(d=1/(s-c)),t[14]=2*c*s*d):(t[10]=-1,t[14]=-2*s),t},u.pick=function(t,e){const r={};for(let s=0;s<e.length;s++){const c=e[s];c in t&&(r[c]=t[c])}return r},u.plugin=nr,u.pointGeometry=et,u.polygonIntersectsBox=pp,u.polygonIntersectsPolygon=hp,u.polygonizeBounds=function(t,e,r=0,s=!0){const c=new et(r,r),d=t.sub(c),m=e.add(c),y=[d,new et(m.x,d.y),m,new et(d.x,m.y)];return s&&y.push(d),y},u.posAttributes=Bg,u.postMapLoadEvent=At,u.postTurnstileEvent=Se,u.potpack=qu,u.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},u.radToDeg=qi,u.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],u.registerForPluginStateChange=function(t){return t({pluginStatus:mn,pluginURL:Vn}),Vo.on("pluginStateChange",t),t},u.removeAuthState=function(t){Tr.delete(t)},u.renderColorRamp=Dh,u.rotateX=Nn,u.rotateX$1=Zi,u.rotateY=zn,u.rotateZ=function(t,e,r){var s=Math.sin(r),c=Math.cos(r),d=e[0],m=e[1],y=e[2],b=e[3],E=e[4],I=e[5],P=e[6],R=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=d*c+E*s,t[1]=m*c+I*s,t[2]=y*c+P*s,t[3]=b*c+R*s,t[4]=E*c-d*s,t[5]=I*c-m*s,t[6]=P*c-y*s,t[7]=R*c-b*s,t},u.rotateZ$1=function(t,e,r){r*=.5;var s=e[0],c=e[1],d=e[2],m=e[3],y=Math.sin(r),b=Math.cos(r);return t[0]=s*b+c*y,t[1]=c*b-s*y,t[2]=d*b+m*y,t[3]=m*b-d*y,t},u.scale=It,u.scale$1=function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},u.scale$2=He,u.scaleAndAdd=qe,u.setCacheLimits=function(t,e){ms=t,Mi=e},u.setColumn=function(t,e,r){t[4*e+0]=r[0],t[4*e+1]=r[1],t[4*e+2]=r[2],t[4*e+3]=r[3]},u.setRTLTextPlugin=function(t,e,r=!1){if(mn===ln||mn===yn||mn===yr)throw new Error("setRTLTextPlugin cannot be called multiple times.");Vn=Sn.resolveURL(t),mn=ln,mr=e,wi(),r||Co()},u.smoothstep=Yr,u.spec=We,u.storeAuthState=function(t,e){e?Tr.add(t):Tr.delete(t)},u.sub=$r,u.subtract=ft,u.symbolSize=mg,u.tileAABB=function(t,e,r,s,c,d,m,y,b){if("globe"===b.name){const j=yu(new Yh(d,new pu(r,s,c)).canonical).getCorners(),H=Number.MAX_VALUE,Q=[-H,-H,-H],ne=[H,H,H],ce=mm(t,e);for(let ye=0;ye<j.length;ye++)Qt(j[ye],j[ye],ce),I=ne,P=j[ye],(E=ne)[0]=Math.min(I[0],P[0]),E[1]=Math.min(I[1],P[1]),E[2]=Math.min(I[2],P[2]),$e(Q,Q,j[ye]);return new Ya(ne,Q)}var E,I,P;const R=Sa({z:r,x:s,y:c},b);return new Ya([(d+R.x/R.scale)*e,e*(R.y/R.scale),m],[(d+R.x2/R.scale)*e,e*(R.y2/R.scale),y])},u.tileTransform=Sa,u.transformMat3=function(t,e,r){var s=e[0],c=e[1],d=e[2];return t[0]=s*r[0]+c*r[3]+d*r[6],t[1]=s*r[1]+c*r[4]+d*r[7],t[2]=s*r[2]+c*r[5]+d*r[8],t},u.transformMat4=Qt,u.transformMat4$1=vi,u.transformQuat=br,u.translate=an,u.transpose=function(t,e){if(t===e){var r=e[1],s=e[2],c=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=s,t[7]=c}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},u.triggerPluginCompletionEvent=Fn,u.uniqueId=fs,u.validateCustomStyleLayer=function(t){const e=[],r=t.id;return void 0===r&&e.push({message:`layers.${r}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${r}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${r}: property "renderingMode" must be either "2d" or "3d"`}),e},u.validateFog=ta,u.validateLight=Ui,u.validateStyle=Ni,u.values=xi,u.vectorTile=Ql,u.version="2.7.0",u.warnOnce=Hn,u.window=Me,u.wrap=Kr}),Oe(0,function(u){function wt(oe){const V=typeof oe;if("number"===V||"boolean"===V||"string"===V||null==oe)return JSON.stringify(oe);if(Array.isArray(oe)){let le="[";for(const _e of oe)le+=`${wt(_e)},`;return`${le}]`}const Z=Object.keys(oe).sort();let se="{";for(let le=0;le<Z.length;le++)se+=`${JSON.stringify(Z[le])}:${wt(oe[Z[le]])},`;return`${se}}`}function en(oe){let V="";for(const Z of u.refProperties)V+=`/${wt(oe[Z])}`;return V}class Nt{constructor(V){this.keyCache={},V&&this.replace(V)}replace(V){this._layerConfigs={},this._layers={},this.update(V,[])}update(V,Z){for(const le of V)this._layerConfigs[le.id]=le,(this._layers[le.id]=u.createStyleLayer(le)).compileFilter(),this.keyCache[le.id]&&delete this.keyCache[le.id];for(const le of Z)delete this.keyCache[le],delete this._layerConfigs[le],delete this._layers[le];this.familiesBySource={};const se=function(le,_e){const Ie={};for(let Ee=0;Ee<le.length;Ee++){const Fe=_e&&_e[le[Ee].id]||en(le[Ee]);_e&&(_e[le[Ee].id]=Fe);let Xe=Ie[Fe];Xe||(Xe=Ie[Fe]=[]),Xe.push(le[Ee])}const Pe=[];for(const Ee in Ie)Pe.push(Ie[Ee]);return Pe}(u.values(this._layerConfigs),this.keyCache);for(const le of se){const _e=le.map(nt=>this._layers[nt.id]),Ie=_e[0];if("none"===Ie.visibility)continue;const Pe=Ie.source||"";let Ee=this.familiesBySource[Pe];Ee||(Ee=this.familiesBySource[Pe]={});const Fe=Ie.sourceLayer||"_geojsonTileLayer";let Xe=Ee[Fe];Xe||(Xe=Ee[Fe]=[]),Xe.push(_e)}}}const{ImageBitmap:et}=u.window;class Et{loadTile(V,Z){const{uid:se,encoding:le,rawImageData:_e,padding:Ie,buildQuadTree:Pe}=V,Ee=et&&_e instanceof et?this.getImageData(_e,Ie):_e;Z(null,new u.DEMData(se,Ee,le,Ie<1,Pe))}getImageData(V,Z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);const se=this.offscreenCanvasContext.getImageData(-Z,-Z,V.width+2*Z,V.height+2*Z);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new u.RGBAImage({width:se.width,height:se.height},se.data)}}var Me=function oe(V,Z){var se,le=V&&V.type;if("FeatureCollection"===le)for(se=0;se<V.features.length;se++)oe(V.features[se],Z);else if("GeometryCollection"===le)for(se=0;se<V.geometries.length;se++)oe(V.geometries[se],Z);else if("Feature"===le)oe(V.geometry,Z);else if("Polygon"===le)st(V.coordinates,Z);else if("MultiPolygon"===le)for(se=0;se<V.coordinates.length;se++)st(V.coordinates[se],Z);return V};function st(oe,V){if(0!==oe.length){Ot(oe[0],V);for(var Z=1;Z<oe.length;Z++)Ot(oe[Z],!V)}}function Ot(oe,V){for(var Z=0,se=0,le=0,_e=oe.length,Ie=_e-1;le<_e;Ie=le++){var Pe=(oe[le][0]-oe[Ie][0])*(oe[Ie][1]+oe[le][1]),Ee=Z+Pe;se+=Math.abs(Z)>=Math.abs(Pe)?Z-Ee+Pe:Pe-Ee+Z,Z=Ee}Z+se>=0!=!!V&&oe.reverse()}const Bn=u.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Ft{constructor(V){this._feature=V,this.extent=u.EXTENT,this.type=V.type,this.properties=V.tags,"id"in V&&!isNaN(V.id)&&(this.id=parseInt(V.id,10))}loadGeometry(){if(1===this._feature.type){const V=[];for(const Z of this._feature.geometry)V.push([new u.pointGeometry(Z[0],Z[1])]);return V}{const V=[];for(const Z of this._feature.geometry){const se=[];for(const le of Z)se.push(new u.pointGeometry(le[0],le[1]));V.push(se)}return V}}toGeoJSON(V,Z,se){return Bn.call(this,V,Z,se)}}class Rt{constructor(V){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=V.length,this._features=V}feature(V){return new Ft(this._features[V])}}var an=u.vectorTile.VectorTileFeature,It=Nn;function Nn(oe,V){this.options=V||{},this.features=oe,this.length=oe.length}function zn(oe,V){this.id="number"==typeof oe.id?oe.id:void 0,this.type=oe.type,this.rawGeometry=1===oe.type?[oe.geometry]:oe.geometry,this.properties=oe.tags,this.extent=V||4096}Nn.prototype.feature=function(oe){return new zn(this.features[oe],this.options.extent)},zn.prototype.loadGeometry=function(){var oe=this.rawGeometry;this.geometry=[];for(var V=0;V<oe.length;V++){for(var Z=oe[V],se=[],le=0;le<Z.length;le++)se.push(new u.pointGeometry(Z[le][0],Z[le][1]));this.geometry.push(se)}return this.geometry},zn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var oe=this.geometry,V=1/0,Z=-1/0,se=1/0,le=-1/0,_e=0;_e<oe.length;_e++)for(var Ie=oe[_e],Pe=0;Pe<Ie.length;Pe++){var Ee=Ie[Pe];V=Math.min(V,Ee.x),Z=Math.max(Z,Ee.x),se=Math.min(se,Ee.y),le=Math.max(le,Ee.y)}return[V,se,Z,le]},zn.prototype.toGeoJSON=an.prototype.toGeoJSON;var xn=Dt,ut=It;function Dt(oe){var V=new u.pbf;return function(Z,se){for(var le in Z.layers)se.writeMessage(3,fn,Z.layers[le])}(oe,V),V.finish()}function fn(oe,V){var Z;V.writeVarintField(15,oe.version||1),V.writeStringField(1,oe.name||""),V.writeVarintField(5,oe.extent||4096);var se={keys:[],values:[],keycache:{},valuecache:{}};for(Z=0;Z<oe.length;Z++)se.feature=oe.feature(Z),V.writeMessage(2,Wt,se);var le=se.keys;for(Z=0;Z<le.length;Z++)V.writeStringField(3,le[Z]);var _e=se.values;for(Z=0;Z<_e.length;Z++)V.writeMessage(4,He,_e[Z])}function Wt(oe,V){var Z=oe.feature;void 0!==Z.id&&V.writeVarintField(1,Z.id),V.writeMessage(2,tn,oe),V.writeVarintField(3,Z.type),V.writeMessage(4,$e,Z)}function tn(oe,V){var Z=oe.feature,se=oe.keys,le=oe.values,_e=oe.keycache,Ie=oe.valuecache;for(var Pe in Z.properties){var Ee=Z.properties[Pe],Fe=_e[Pe];if(null!==Ee){void 0===Fe&&(se.push(Pe),_e[Pe]=Fe=se.length-1),V.writeVarint(Fe);var Xe=typeof Ee;"string"!==Xe&&"boolean"!==Xe&&"number"!==Xe&&(Ee=JSON.stringify(Ee));var nt=Xe+":"+Ee,it=Ie[nt];void 0===it&&(le.push(Ee),Ie[nt]=it=le.length-1),V.writeVarint(it)}}}function ft(oe,V){return(V<<3)+(7&oe)}function Ne(oe){return oe<<1^oe>>31}function $e(oe,V){for(var Z=oe.loadGeometry(),se=oe.type,le=0,_e=0,Ie=Z.length,Pe=0;Pe<Ie;Pe++){var Ee=Z[Pe],Fe=1;1===se&&(Fe=Ee.length),V.writeVarint(ft(1,Fe));for(var Xe=3===se?Ee.length-1:Ee.length,nt=0;nt<Xe;nt++){1===nt&&1!==se&&V.writeVarint(ft(2,Xe-1));var it=Ee[nt].x-le,Ht=Ee[nt].y-_e;V.writeVarint(Ne(it)),V.writeVarint(Ne(Ht)),le+=it,_e+=Ht}3===se&&V.writeVarint(ft(7,1))}}function He(oe,V){var Z=typeof oe;"string"===Z?V.writeStringField(1,oe):"boolean"===Z?V.writeBooleanField(7,oe):"number"===Z&&(oe%1!=0?V.writeDoubleField(3,oe):oe<0?V.writeSVarintField(6,oe):V.writeVarintField(5,oe))}function qe(oe,V,Z,se,le,_e){if(le-se<=Z)return;const Ie=se+le>>1;_t(oe,V,Ie,se,le,_e%2),qe(oe,V,Z,se,Ie-1,_e+1),qe(oe,V,Z,Ie+1,le,_e+1)}function _t(oe,V,Z,se,le,_e){for(;le>se;){if(le-se>600){const Fe=le-se+1,Xe=Z-se+1,nt=Math.log(Fe),it=.5*Math.exp(2*nt/3),Ht=.5*Math.sqrt(nt*it*(Fe-it)/Fe)*(Xe-Fe/2<0?-1:1);_t(oe,V,Z,Math.max(se,Math.floor(Z-Xe*it/Fe+Ht)),Math.min(le,Math.floor(Z+(Fe-Xe)*it/Fe+Ht)),_e)}const Ie=V[2*Z+_e];let Pe=se,Ee=le;for(Ve(oe,V,se,Z),V[2*le+_e]>Ie&&Ve(oe,V,se,le);Pe<Ee;){for(Ve(oe,V,Pe,Ee),Pe++,Ee--;V[2*Pe+_e]<Ie;)Pe++;for(;V[2*Ee+_e]>Ie;)Ee--}V[2*se+_e]===Ie?Ve(oe,V,se,Ee):(Ee++,Ve(oe,V,Ee,le)),Ee<=Z&&(se=Ee+1),Z<=Ee&&(le=Ee-1)}}function Ve(oe,V,Z,se){En(oe,Z,se),En(V,2*Z,2*se),En(V,2*Z+1,2*se+1)}function En(oe,V,Z){const se=oe[V];oe[V]=oe[Z],oe[Z]=se}function Qt(oe,V,Z,se){const le=oe-Z,_e=V-se;return le*le+_e*_e}xn.fromVectorTileJs=Dt,xn.fromGeojsonVt=function(oe,V){V=V||{};var Z={};for(var se in oe)Z[se]=new It(oe[se].features,V),Z[se].name=se,Z[se].version=V.version,Z[se].extent=V.extent;return Dt({layers:Z})},xn.GeoJSONWrapper=ut;const br=oe=>oe[0],hn=oe=>oe[1];class $r{constructor(V,Z=br,se=hn,le=64,_e=Float64Array){this.nodeSize=le,this.points=V;const Ie=V.length<65536?Uint16Array:Uint32Array,Pe=this.ids=new Ie(V.length),Ee=this.coords=new _e(2*V.length);for(let Fe=0;Fe<V.length;Fe++)Pe[Fe]=Fe,Ee[2*Fe]=Z(V[Fe]),Ee[2*Fe+1]=se(V[Fe]);qe(Pe,Ee,le,0,Pe.length-1,0)}range(V,Z,se,le){return function(_e,Ie,Pe,Ee,Fe,Xe,nt){const it=[0,_e.length-1,0],Ht=[];let Kt,ve;for(;it.length;){const de=it.pop(),ae=it.pop(),Se=it.pop();if(ae-Se<=nt){for(let Xt=Se;Xt<=ae;Xt++)Kt=Ie[2*Xt],ve=Ie[2*Xt+1],Kt>=Pe&&Kt<=Fe&&ve>=Ee&&ve<=Xe&&Ht.push(_e[Xt]);continue}const Ze=Math.floor((Se+ae)/2);Kt=Ie[2*Ze],ve=Ie[2*Ze+1],Kt>=Pe&&Kt<=Fe&&ve>=Ee&&ve<=Xe&&Ht.push(_e[Ze]);const At=(de+1)%2;(0===de?Pe<=Kt:Ee<=ve)&&(it.push(Se),it.push(Ze-1),it.push(At)),(0===de?Fe>=Kt:Xe>=ve)&&(it.push(Ze+1),it.push(ae),it.push(At))}return Ht}(this.ids,this.coords,V,Z,se,le,this.nodeSize)}within(V,Z,se){return function(le,_e,Ie,Pe,Ee,Fe){const Xe=[0,le.length-1,0],nt=[],it=Ee*Ee;for(;Xe.length;){const Ht=Xe.pop(),Kt=Xe.pop(),ve=Xe.pop();if(Kt-ve<=Fe){for(let At=ve;At<=Kt;At++)Qt(_e[2*At],_e[2*At+1],Ie,Pe)<=it&&nt.push(le[At]);continue}const de=Math.floor((ve+Kt)/2),ae=_e[2*de],Se=_e[2*de+1];Qt(ae,Se,Ie,Pe)<=it&&nt.push(le[de]);const Ze=(Ht+1)%2;(0===Ht?Ie-Ee<=ae:Pe-Ee<=Se)&&(Xe.push(ve),Xe.push(de-1),Xe.push(Ze)),(0===Ht?Ie+Ee>=ae:Pe+Ee>=Se)&&(Xe.push(de+1),Xe.push(Kt),Xe.push(Ze))}return nt}(this.ids,this.coords,V,Z,se,this.nodeSize)}}const yi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:oe=>oe},ur=Math.fround||(vi=new Float32Array(1),oe=>(vi[0]=+oe,vi[0]));var vi;class Fi{constructor(V){this.options=ds(Object.create(yi),V),this.trees=new Array(this.options.maxZoom+1)}load(V){const{log:Z,minZoom:se,maxZoom:le,nodeSize:_e}=this.options;Z&&console.time("total time");const Ie=`prepare ${V.length} points`;Z&&console.time(Ie),this.points=V;let Pe=[];for(let Ee=0;Ee<V.length;Ee++)V[Ee].geometry&&Pe.push(Zi(V[Ee],Ee));this.trees[le+1]=new $r(Pe,Gr,Es,_e,Float32Array),Z&&console.timeEnd(Ie);for(let Ee=le;Ee>=se;Ee--){const Fe=+Date.now();Pe=this._cluster(Pe,Ee),this.trees[Ee]=new $r(Pe,Gr,Es,_e,Float32Array),Z&&console.log("z%d: %d clusters in %dms",Ee,Pe.length,+Date.now()-Fe)}return Z&&console.timeEnd("total time"),this}getClusters(V,Z){let se=((V[0]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,V[1]));let _e=180===V[2]?180:((V[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)se=-180,_e=180;else if(se>_e){const Xe=this.getClusters([se,le,180,Ie],Z),nt=this.getClusters([-180,le,_e,Ie],Z);return Xe.concat(nt)}const Pe=this.trees[this._limitZoom(Z)],Ee=Pe.range(Gn(se),Cn(Ie),Gn(_e),Cn(le)),Fe=[];for(const Xe of Ee){const nt=Pe.points[Xe];Fe.push(nt.numPoints?Lr(nt):this.points[nt.index])}return Fe}getChildren(V){const Z=this._getOriginId(V),se=this._getOriginZoom(V),le="No cluster with the specified id.",_e=this.trees[se];if(!_e)throw new Error(le);const Ie=_e.points[Z];if(!Ie)throw new Error(le);const Pe=this.options.radius/(this.options.extent*Math.pow(2,se-1)),Ee=_e.within(Ie.x,Ie.y,Pe),Fe=[];for(const Xe of Ee){const nt=_e.points[Xe];nt.parentId===V&&Fe.push(nt.numPoints?Lr(nt):this.points[nt.index])}if(0===Fe.length)throw new Error(le);return Fe}getLeaves(V,Z,se){const le=[];return this._appendLeaves(le,V,Z=Z||10,se=se||0,0),le}getTile(V,Z,se){const le=this.trees[this._limitZoom(V)],_e=Math.pow(2,V),{extent:Ie,radius:Pe}=this.options,Ee=Pe/Ie,Fe=(se-Ee)/_e,Xe=(se+1+Ee)/_e,nt={features:[]};return this._addTileFeatures(le.range((Z-Ee)/_e,Fe,(Z+1+Ee)/_e,Xe),le.points,Z,se,_e,nt),0===Z&&this._addTileFeatures(le.range(1-Ee/_e,Fe,1,Xe),le.points,_e,se,_e,nt),Z===_e-1&&this._addTileFeatures(le.range(0,Fe,Ee/_e,Xe),le.points,-1,se,_e,nt),nt.features.length?nt:null}getClusterExpansionZoom(V){let Z=this._getOriginZoom(V)-1;for(;Z<=this.options.maxZoom;){const se=this.getChildren(V);if(Z++,1!==se.length)break;V=se[0].properties.cluster_id}return Z}_appendLeaves(V,Z,se,le,_e){const Ie=this.getChildren(Z);for(const Pe of Ie){const Ee=Pe.properties;if(Ee&&Ee.cluster?_e+Ee.point_count<=le?_e+=Ee.point_count:_e=this._appendLeaves(V,Ee.cluster_id,se,le,_e):_e<le?_e++:V.push(Pe),V.length===se)break}return _e}_addTileFeatures(V,Z,se,le,_e,Ie){for(const Pe of V){const Ee=Z[Pe],Fe=Ee.numPoints;let Xe,nt,it;if(Fe)Xe=$n(Ee),nt=Ee.x,it=Ee.y;else{const ve=this.points[Ee.index];Xe=ve.properties,nt=Gn(ve.geometry.coordinates[0]),it=Cn(ve.geometry.coordinates[1])}const Ht={type:1,geometry:[[Math.round(this.options.extent*(nt*_e-se)),Math.round(this.options.extent*(it*_e-le))]],tags:Xe};let Kt;Fe?Kt=Ee.id:this.options.generateId?Kt=Ee.index:this.points[Ee.index].id&&(Kt=this.points[Ee.index].id),void 0!==Kt&&(Ht.id=Kt),Ie.features.push(Ht)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(+V,this.options.maxZoom+1))}_cluster(V,Z){const se=[],{radius:le,extent:_e,reduce:Ie,minPoints:Pe}=this.options,Ee=le/(_e*Math.pow(2,Z));for(let Fe=0;Fe<V.length;Fe++){const Xe=V[Fe];if(Xe.zoom<=Z)continue;Xe.zoom=Z;const nt=this.trees[Z+1],it=nt.within(Xe.x,Xe.y,Ee),Ht=Xe.numPoints||1;let Kt=Ht;for(const ve of it){const de=nt.points[ve];de.zoom>Z&&(Kt+=de.numPoints||1)}if(Kt>Ht&&Kt>=Pe){let ve=Xe.x*Ht,de=Xe.y*Ht,ae=Ie&&Ht>1?this._map(Xe,!0):null;const Se=(Fe<<5)+(Z+1)+this.points.length;for(const Ze of it){const At=nt.points[Ze];if(At.zoom<=Z)continue;At.zoom=Z;const Xt=At.numPoints||1;ve+=At.x*Xt,de+=At.y*Xt,At.parentId=Se,Ie&&(ae||(ae=this._map(Xe,!0)),Ie(ae,this._map(At)))}Xe.parentId=Se,se.push(Eo(ve/Kt,de/Kt,Se,Kt,ae))}else if(se.push(Xe),Kt>1)for(const ve of it){const de=nt.points[ve];de.zoom<=Z||(de.zoom=Z,se.push(de))}}return se}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,Z){if(V.numPoints)return Z?ds({},V.properties):V.properties;const se=this.points[V.index].properties,le=this.options.map(se);return Z&&le===se?ds({},le):le}}function Eo(oe,V,Z,se,le){return{x:ur(oe),y:ur(V),zoom:1/0,id:Z,parentId:-1,numPoints:se,properties:le}}function Zi(oe,V){const[Z,se]=oe.geometry.coordinates;return{x:ur(Gn(Z)),y:ur(Cn(se)),zoom:1/0,index:V,parentId:-1}}function Lr(oe){return{type:"Feature",id:oe.id,properties:$n(oe),geometry:{type:"Point",coordinates:[(V=oe.x,360*(V-.5)),qi(oe.y)]}};var V}function $n(oe){const V=oe.numPoints,Z=V>=1e4?`${Math.round(V/1e3)}k`:V>=1e3?Math.round(V/100)/10+"k":V;return ds(ds({},oe.properties),{cluster:!0,cluster_id:oe.id,point_count:V,point_count_abbreviated:Z})}function Gn(oe){return oe/360+.5}function Cn(oe){const V=Math.sin(oe*Math.PI/180),Z=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return Z<0?0:Z>1?1:Z}function qi(oe){const V=(180-360*oe)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}function ds(oe,V){for(const Z in V)oe[Z]=V[Z];return oe}function Gr(oe){return oe.x}function Es(oe){return oe.y}function To(oe,V,Z,se){for(var le,_e=se,Ie=Z-V>>1,Pe=Z-V,Ee=oe[V],Fe=oe[V+1],Xe=oe[Z],nt=oe[Z+1],it=V+3;it<Z;it+=3){var Ht=Pn(oe[it],oe[it+1],Ee,Fe,Xe,nt);if(Ht>_e)le=it,_e=Ht;else if(Ht===_e){var Kt=Math.abs(it-Ie);Kt<Pe&&(le=it,Pe=Kt)}}_e>se&&(le-V>3&&To(oe,V,le,se),oe[le+2]=_e,Z-le>3&&To(oe,le,Z,se))}function Pn(oe,V,Z,se,le,_e){var Ie=le-Z,Pe=_e-se;if(0!==Ie||0!==Pe){var Ee=((oe-Z)*Ie+(V-se)*Pe)/(Ie*Ie+Pe*Pe);Ee>1?(Z=le,se=_e):Ee>0&&(Z+=Ie*Ee,se+=Pe*Ee)}return(Ie=oe-Z)*Ie+(Pe=V-se)*Pe}function Yr(oe,V,Z,se){var le={id:void 0===oe?null:oe,type:V,geometry:Z,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(_e){var Ie=_e.geometry,Pe=_e.type;if("Point"===Pe||"MultiPoint"===Pe||"LineString"===Pe)Kr(_e,Ie);else if("Polygon"===Pe||"MultiLineString"===Pe)for(var Ee=0;Ee<Ie.length;Ee++)Kr(_e,Ie[Ee]);else if("MultiPolygon"===Pe)for(Ee=0;Ee<Ie.length;Ee++)for(var Fe=0;Fe<Ie[Ee].length;Fe++)Kr(_e,Ie[Ee][Fe])}(le),le}function Kr(oe,V){for(var Z=0;Z<V.length;Z+=3)oe.minX=Math.min(oe.minX,V[Z]),oe.minY=Math.min(oe.minY,V[Z+1]),oe.maxX=Math.max(oe.maxX,V[Z]),oe.maxY=Math.max(oe.maxY,V[Z+1])}function ti(oe,V,Z,se){if(V.geometry){var le=V.geometry.coordinates,_e=V.geometry.type,Ie=Math.pow(Z.tolerance/((1<<Z.maxZoom)*Z.extent),2),Pe=[],Ee=V.id;if(Z.promoteId?Ee=V.properties[Z.promoteId]:Z.generateId&&(Ee=se||0),"Point"===_e)xi(le,Pe);else if("MultiPoint"===_e)for(var Fe=0;Fe<le.length;Fe++)xi(le[Fe],Pe);else if("LineString"===_e)cr(le,Pe,Ie,!1);else if("MultiLineString"===_e){if(Z.lineMetrics){for(Fe=0;Fe<le.length;Fe++)cr(le[Fe],Pe=[],Ie,!1),oe.push(Yr(Ee,"LineString",Pe,V.properties));return}uo(le,Pe,Ie,!1)}else if("Polygon"===_e)uo(le,Pe,Ie,!0);else{if("MultiPolygon"!==_e){if("GeometryCollection"===_e){for(Fe=0;Fe<V.geometry.geometries.length;Fe++)ti(oe,{id:Ee,geometry:V.geometry.geometries[Fe],properties:V.properties},Z,se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Fe=0;Fe<le.length;Fe++){var Xe=[];uo(le[Fe],Xe,Ie,!0),Pe.push(Xe)}}oe.push(Yr(Ee,_e,Pe,V.properties))}}function xi(oe,V){V.push(fs(oe[0])),V.push(ho(oe[1])),V.push(0)}function cr(oe,V,Z,se){for(var le,_e,Ie=0,Pe=0;Pe<oe.length;Pe++){var Ee=fs(oe[Pe][0]),Fe=ho(oe[Pe][1]);V.push(Ee),V.push(Fe),V.push(0),Pe>0&&(Ie+=se?(le*Fe-Ee*_e)/2:Math.sqrt(Math.pow(Ee-le,2)+Math.pow(Fe-_e,2))),le=Ee,_e=Fe}var Xe=V.length-3;V[2]=1,To(V,0,Xe,Z),V[Xe+2]=1,V.size=Math.abs(Ie),V.start=0,V.end=V.size}function uo(oe,V,Z,se){for(var le=0;le<oe.length;le++){var _e=[];cr(oe[le],_e,Z,se),V.push(_e)}}function fs(oe){return oe/360+.5}function ho(oe){var V=Math.sin(oe*Math.PI/180),Z=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return Z<0?0:Z>1?1:Z}function Jt(oe,V,Z,se,le,_e,Ie,Pe){if(se/=V,_e>=(Z/=V)&&Ie<se)return oe;if(Ie<Z||_e>=se)return null;for(var Ee=[],Fe=0;Fe<oe.length;Fe++){var Xe=oe[Fe],nt=Xe.geometry,it=Xe.type,Ht=0===le?Xe.minX:Xe.minY,Kt=0===le?Xe.maxX:Xe.maxY;if(Ht>=Z&&Kt<se)Ee.push(Xe);else if(!(Kt<Z||Ht>=se)){var ve=[];if("Point"===it||"MultiPoint"===it)wr(nt,ve,Z,se,le);else if("LineString"===it)un(nt,ve,Z,se,le,!1,Pe.lineMetrics);else if("MultiLineString"===it)fo(nt,ve,Z,se,le,!1);else if("Polygon"===it)fo(nt,ve,Z,se,le,!0);else if("MultiPolygon"===it)for(var de=0;de<nt.length;de++){var ae=[];fo(nt[de],ae,Z,se,le,!0),ae.length&&ve.push(ae)}if(ve.length){if(Pe.lineMetrics&&"LineString"===it){for(de=0;de<ve.length;de++)Ee.push(Yr(Xe.id,it,ve[de],Xe.tags));continue}"LineString"!==it&&"MultiLineString"!==it||(1===ve.length?(it="LineString",ve=ve[0]):it="MultiLineString"),"Point"!==it&&"MultiPoint"!==it||(it=3===ve.length?"Point":"MultiPoint"),Ee.push(Yr(Xe.id,it,ve,Xe.tags))}}}return Ee.length?Ee:null}function wr(oe,V,Z,se,le){for(var _e=0;_e<oe.length;_e+=3){var Ie=oe[_e+le];Ie>=Z&&Ie<=se&&(V.push(oe[_e]),V.push(oe[_e+1]),V.push(oe[_e+2]))}}function un(oe,V,Z,se,le,_e,Ie){for(var Pe,Ee,Fe=cn(oe),Xe=0===le?hr:fi,nt=oe.start,it=0;it<oe.length-3;it+=3){var Ht=oe[it],Kt=oe[it+1],ve=oe[it+2],de=oe[it+3],ae=oe[it+4],Se=0===le?Ht:Kt,Ze=0===le?de:ae,At=!1;Ie&&(Pe=Math.sqrt(Math.pow(Ht-de,2)+Math.pow(Kt-ae,2))),Se<Z?Ze>Z&&(Ee=Xe(Fe,Ht,Kt,de,ae,Z),Ie&&(Fe.start=nt+Pe*Ee)):Se>se?Ze<se&&(Ee=Xe(Fe,Ht,Kt,de,ae,se),Ie&&(Fe.start=nt+Pe*Ee)):Po(Fe,Ht,Kt,ve),Ze<Z&&Se>=Z&&(Ee=Xe(Fe,Ht,Kt,de,ae,Z),At=!0),Ze>se&&Se<=se&&(Ee=Xe(Fe,Ht,Kt,de,ae,se),At=!0),!_e&&At&&(Ie&&(Fe.end=nt+Pe*Ee),V.push(Fe),Fe=cn(oe)),Ie&&(nt+=Pe)}var Xt=oe.length-3;Ht=oe[Xt],Kt=oe[Xt+1],ve=oe[Xt+2],(Se=0===le?Ht:Kt)>=Z&&Se<=se&&Po(Fe,Ht,Kt,ve),Xt=Fe.length-3,_e&&Xt>=3&&(Fe[Xt]!==Fe[0]||Fe[Xt+1]!==Fe[1])&&Po(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&V.push(Fe)}function cn(oe){var V=[];return V.size=oe.size,V.start=oe.start,V.end=oe.end,V}function fo(oe,V,Z,se,le,_e){for(var Ie=0;Ie<oe.length;Ie++)un(oe[Ie],V,Z,se,le,_e,!1)}function Po(oe,V,Z,se){oe.push(V),oe.push(Z),oe.push(se)}function hr(oe,V,Z,se,le,_e){var Ie=(_e-V)/(se-V);return oe.push(_e),oe.push(Z+(le-Z)*Ie),oe.push(1),Ie}function fi(oe,V,Z,se,le,_e){var Ie=(_e-Z)/(le-Z);return oe.push(V+(se-V)*Ie),oe.push(_e),oe.push(1),Ie}function Hn(oe,V){for(var Z=[],se=0;se<oe.length;se++){var le,_e=oe[se],Ie=_e.type;if("Point"===Ie||"MultiPoint"===Ie||"LineString"===Ie)le=po(_e.geometry,V);else if("MultiLineString"===Ie||"Polygon"===Ie){le=[];for(var Pe=0;Pe<_e.geometry.length;Pe++)le.push(po(_e.geometry[Pe],V))}else if("MultiPolygon"===Ie)for(le=[],Pe=0;Pe<_e.geometry.length;Pe++){for(var Ee=[],Fe=0;Fe<_e.geometry[Pe].length;Fe++)Ee.push(po(_e.geometry[Pe][Fe],V));le.push(Ee)}Z.push(Yr(_e.id,Ie,le,_e.tags))}return Z}function po(oe,V){var Z=[];Z.size=oe.size,void 0!==oe.start&&(Z.start=oe.start,Z.end=oe.end);for(var se=0;se<oe.length;se+=3)Z.push(oe[se]+V,oe[se+1],oe[se+2]);return Z}function Zn(oe,V){if(oe.transformed)return oe;var Z,se,le,_e=1<<oe.z,Ie=oe.x,Pe=oe.y;for(Z=0;Z<oe.features.length;Z++){var Ee=oe.features[Z],Fe=Ee.geometry,Xe=Ee.type;if(Ee.geometry=[],1===Xe)for(se=0;se<Fe.length;se+=2)Ee.geometry.push(mo(Fe[se],Fe[se+1],V,_e,Ie,Pe));else for(se=0;se<Fe.length;se++){var nt=[];for(le=0;le<Fe[se].length;le+=2)nt.push(mo(Fe[se][le],Fe[se][le+1],V,_e,Ie,Pe));Ee.geometry.push(nt)}}return oe.transformed=!0,oe}function mo(oe,V,Z,se,le,_e){return[Math.round(Z*(oe*se-le)),Math.round(Z*(V*se-_e))]}function qt(oe,V,Z,se,le){for(var _e=V===le.maxZoom?0:le.tolerance/((1<<V)*le.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Z,y:se,z:V,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Pe=0;Pe<oe.length;Pe++){Ie.numFeatures++,ps(Ie,oe[Pe],_e,le);var Ee=oe[Pe].minX,Fe=oe[Pe].minY,Xe=oe[Pe].maxX,nt=oe[Pe].maxY;Ee<Ie.minX&&(Ie.minX=Ee),Fe<Ie.minY&&(Ie.minY=Fe),Xe>Ie.maxX&&(Ie.maxX=Xe),nt>Ie.maxY&&(Ie.maxY=nt)}return Ie}function ps(oe,V,Z,se){var le=V.geometry,_e=V.type,Ie=[];if("Point"===_e||"MultiPoint"===_e)for(var Pe=0;Pe<le.length;Pe+=3)Ie.push(le[Pe]),Ie.push(le[Pe+1]),oe.numPoints++,oe.numSimplified++;else if("LineString"===_e)pi(Ie,le,oe,Z,!1,!1);else if("MultiLineString"===_e||"Polygon"===_e)for(Pe=0;Pe<le.length;Pe++)pi(Ie,le[Pe],oe,Z,"Polygon"===_e,0===Pe);else if("MultiPolygon"===_e)for(var Ee=0;Ee<le.length;Ee++){var Fe=le[Ee];for(Pe=0;Pe<Fe.length;Pe++)pi(Ie,Fe[Pe],oe,Z,!0,0===Pe)}if(Ie.length){var Xe=V.tags||null;if("LineString"===_e&&se.lineMetrics){for(var nt in Xe={},V.tags)Xe[nt]=V.tags[nt];Xe.mapbox_clip_start=le.start/le.size,Xe.mapbox_clip_end=le.end/le.size}var it={geometry:Ie,type:"Polygon"===_e||"MultiPolygon"===_e?3:"LineString"===_e||"MultiLineString"===_e?2:1,tags:Xe};null!==V.id&&(it.id=V.id),oe.features.push(it)}}function pi(oe,V,Z,se,le,_e){var Ie=se*se;if(se>0&&V.size<(le?Ie:se))Z.numPoints+=V.length/3;else{for(var Pe=[],Ee=0;Ee<V.length;Ee+=3)(0===se||V[Ee+2]>Ie)&&(Z.numSimplified++,Pe.push(V[Ee]),Pe.push(V[Ee+1])),Z.numPoints++;le&&function(Fe,Xe){for(var nt=0,it=0,Ht=Fe.length,Kt=Ht-2;it<Ht;Kt=it,it+=2)nt+=(Fe[it]-Fe[Kt])*(Fe[it+1]+Fe[Kt+1]);if(nt>0===Xe)for(it=0,Ht=Fe.length;it<Ht/2;it+=2){var ve=Fe[it],de=Fe[it+1];Fe[it]=Fe[Ht-2-it],Fe[it+1]=Fe[Ht-1-it],Fe[Ht-2-it]=ve,Fe[Ht-1-it]=de}}(Pe,_e),oe.push(Pe)}}function Kn(oe,V){var Z=(V=this.options=function(le,_e){for(var Ie in _e)le[Ie]=_e[Ie];return le}(Object.create(this.options),V)).debug;if(Z&&console.time("preprocess data"),V.maxZoom<0||V.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(V.promoteId&&V.generateId)throw new Error("promoteId and generateId cannot be used together.");var le,_e,Ie,Pe,Ee,Fe,se=function(le,_e){var Ie=[];if("FeatureCollection"===le.type)for(var Pe=0;Pe<le.features.length;Pe++)ti(Ie,le.features[Pe],_e,Pe);else ti(Ie,"Feature"===le.type?le:{geometry:le},_e);return Ie}(oe,V);this.tiles={},this.tileCoords=[],Z&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",V.indexMaxZoom,V.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(le=se,_e=V,Ie=_e.buffer/_e.extent,Pe=le,Ee=Jt(le,1,-1-Ie,Ie,0,-1,2,_e),Fe=Jt(le,1,1-Ie,2+Ie,0,-1,2,_e),(Ee||Fe)&&(Pe=Jt(le,1,-Ie,1+Ie,0,-1,2,_e)||[],Ee&&(Pe=Hn(Ee,1).concat(Pe)),Fe&&(Pe=Pe.concat(Hn(Fe,-1)))),se=Pe).length&&this.splitTile(se,0,0,0),Z&&(se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function no(oe,V,Z){return 32*((1<<oe)*Z+V)+oe}function ko(oe,V){const Z=oe.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);const se=this._geoJSONIndex.getTile(Z.z,Z.x,Z.y);if(!se)return V(null,null);const le=new Rt(se.features);let _e=xn(le);0===_e.byteOffset&&_e.byteLength===_e.buffer.byteLength||(_e=new Uint8Array(_e)),V(null,{vectorTile:le,rawData:_e.buffer})}Kn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Kn.prototype.splitTile=function(oe,V,Z,se,le,_e,Ie){for(var Pe=[oe,V,Z,se],Ee=this.options,Fe=Ee.debug;Pe.length;){se=Pe.pop(),Z=Pe.pop(),V=Pe.pop(),oe=Pe.pop();var Xe=1<<V,nt=no(V,Z,se),it=this.tiles[nt];if(!it&&(Fe>1&&console.time("creation"),it=this.tiles[nt]=qt(oe,V,Z,se,Ee),this.tileCoords.push({z:V,x:Z,y:se}),Fe)){Fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",V,Z,se,it.numFeatures,it.numPoints,it.numSimplified),console.timeEnd("creation"));var Ht="z"+V;this.stats[Ht]=(this.stats[Ht]||0)+1,this.total++}if(it.source=oe,le){if(V===Ee.maxZoom||V===le)continue;var Kt=1<<le-V;if(Z!==Math.floor(_e/Kt)||se!==Math.floor(Ie/Kt))continue}else if(V===Ee.indexMaxZoom||it.numPoints<=Ee.indexMaxPoints)continue;if(it.source=null,0!==oe.length){Fe>1&&console.time("clipping");var ve,de,ae,Se,Ze,At,Xt=.5*Ee.buffer/Ee.extent,Er=.5-Xt,Tr=.5+Xt,Fr=1+Xt;ve=de=ae=Se=null,Ze=Jt(oe,Xe,Z-Xt,Z+Tr,0,it.minX,it.maxX,Ee),At=Jt(oe,Xe,Z+Er,Z+Fr,0,it.minX,it.maxX,Ee),oe=null,Ze&&(ve=Jt(Ze,Xe,se-Xt,se+Tr,1,it.minY,it.maxY,Ee),de=Jt(Ze,Xe,se+Er,se+Fr,1,it.minY,it.maxY,Ee),Ze=null),At&&(ae=Jt(At,Xe,se-Xt,se+Tr,1,it.minY,it.maxY,Ee),Se=Jt(At,Xe,se+Er,se+Fr,1,it.minY,it.maxY,Ee),At=null),Fe>1&&console.timeEnd("clipping"),Pe.push(ve||[],V+1,2*Z,2*se),Pe.push(de||[],V+1,2*Z,2*se+1),Pe.push(ae||[],V+1,2*Z+1,2*se),Pe.push(Se||[],V+1,2*Z+1,2*se+1)}}},Kn.prototype.getTile=function(oe,V,Z){var se=this.options,le=se.extent,_e=se.debug;if(oe<0||oe>24)return null;var Ie=1<<oe,Pe=no(oe,V=(V%Ie+Ie)%Ie,Z);if(this.tiles[Pe])return Zn(this.tiles[Pe],le);_e>1&&console.log("drilling down to z%d-%d-%d",oe,V,Z);for(var Ee,Fe=oe,Xe=V,nt=Z;!Ee&&Fe>0;)Fe--,Xe=Math.floor(Xe/2),nt=Math.floor(nt/2),Ee=this.tiles[no(Fe,Xe,nt)];return Ee&&Ee.source?(_e>1&&console.log("found parent tile z%d-%d-%d",Fe,Xe,nt),_e>1&&console.time("drilling down"),this.splitTile(Ee.source,Fe,Xe,nt,oe,V,Z),_e>1&&console.timeEnd("drilling down"),this.tiles[Pe]?Zn(this.tiles[Pe],le):null):null};class ro extends u.VectorTileWorkerSource{constructor(V,Z,se,le,_e){super(V,Z,se,le,ko),_e&&(this.loadGeoJSON=_e)}loadData(V,Z){const se=V&&V.request,le=se&&se.collectResourceTiming;this.loadGeoJSON(V,(_e,Ie)=>{if(_e||!Ie)return Z(_e);if("object"!=typeof Ie)return Z(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{Me(Ie,!0);try{if(V.filter){const Ee=u.createExpression(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===Ee.result)throw new Error(Ee.value.map(Xe=>`${Xe.key}: ${Xe.message}`).join(", "));const Fe=Ie.features.filter(Xe=>Ee.value.evaluate({zoom:0},Xe));Ie={type:"FeatureCollection",features:Fe}}this._geoJSONIndex=V.cluster?new Fi(function({superclusterOptions:Ee,clusterProperties:Fe}){if(!Fe||!Ee)return Ee;const Xe={},nt={},it={accumulated:null,zoom:0},Ht={properties:null},Kt=Object.keys(Fe);for(const ve of Kt){const[de,ae]=Fe[ve],Se=u.createExpression(ae),Ze=u.createExpression("string"==typeof de?[de,["accumulated"],["get",ve]]:de);Xe[ve]=Se.value,nt[ve]=Ze.value}return Ee.map=ve=>{Ht.properties=ve;const de={};for(const ae of Kt)de[ae]=Xe[ae].evaluate(it,Ht);return de},Ee.reduce=(ve,de)=>{Ht.properties=de;for(const ae of Kt)it.accumulated=ve[ae],ve[ae]=nt[ae].evaluate(it,Ht)},Ee}(V)).load(Ie.features):new Kn(Ee=Ie,V.geojsonVtOptions)}catch(Ee){return Z(Ee)}this.loaded={};const Pe={};if(le){const Ee=u.getPerformanceMeasurement(se);Ee&&(Pe.resourceTiming={},Pe.resourceTiming[V.source]=JSON.parse(JSON.stringify(Ee)))}Z(null,Pe)}var Ee})}reloadTile(V,Z){const se=this.loaded;return se&&se[V.uid]?super.reloadTile(V,Z):this.loadTile(V,Z)}loadGeoJSON(V,Z){if(V.request)u.getJSON(V.request,Z);else{if("string"!=typeof V.data)return Z(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return Z(null,JSON.parse(V.data))}catch(se){return Z(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,Z){try{Z(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(se){Z(se)}}getClusterChildren(V,Z){try{Z(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(se){Z(se)}}getClusterLeaves(V,Z){try{Z(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(se){Z(se)}}}class Sn{constructor(V){this.self=V,this.actor=new u.Actor(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=u.getProjection({name:"mercator"}),this.workerSourceTypes={vector:u.VectorTileWorkerSource,geojson:ro},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Z,se)=>{if(this.workerSourceTypes[Z])throw new Error(`Worker source with name "${Z}" already registered.`);this.workerSourceTypes[Z]=se},this.self.registerRTLTextPlugin=Z=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=Z.applyArabicShaping,u.plugin.processBidirectionalText=Z.processBidirectionalText,u.plugin.processStyledBidirectionalText=Z.processStyledBidirectionalText}}clearCaches(V,Z,se){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],se()}checkIfReady(V,Z,se){se()}setReferrer(V,Z){this.referrer=Z}spriteLoaded(V,Z){this.isSpriteLoaded[V]=Z;for(const se in this.workerSources[V]){const le=this.workerSources[V][se];for(const _e in le)le[_e]instanceof u.VectorTileWorkerSource&&(le[_e].isSpriteLoaded=Z,le[_e].fire(new u.Event("isSpriteLoaded")))}}setImages(V,Z,se){this.availableImages[V]=Z;for(const le in this.workerSources[V]){const _e=this.workerSources[V][le];for(const Ie in _e)_e[Ie].availableImages=Z}se()}enableTerrain(V,Z,se){this.terrain=Z,se()}setProjection(V,Z){this.projections[V]=u.getProjection(Z)}setLayers(V,Z,se){this.getLayerIndex(V).replace(Z),se()}updateLayers(V,Z,se){this.getLayerIndex(V).update(Z.layers,Z.removedIds),se()}loadTile(V,Z,se){const le=this.enableTerrain?u.extend({enableTerrain:this.terrain},Z):Z;le.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,Z.type,Z.source).loadTile(le,se)}loadDEMTile(V,Z,se){const le=this.enableTerrain?u.extend({buildQuadTree:this.terrain},Z):Z;this.getDEMWorkerSource(V,Z.source).loadTile(le,se)}reloadTile(V,Z,se){const le=this.enableTerrain?u.extend({enableTerrain:this.terrain},Z):Z;le.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,Z.type,Z.source).reloadTile(le,se)}abortTile(V,Z,se){this.getWorkerSource(V,Z.type,Z.source).abortTile(Z,se)}removeTile(V,Z,se){this.getWorkerSource(V,Z.type,Z.source).removeTile(Z,se)}removeSource(V,Z,se){if(!this.workerSources[V]||!this.workerSources[V][Z.type]||!this.workerSources[V][Z.type][Z.source])return;const le=this.workerSources[V][Z.type][Z.source];delete this.workerSources[V][Z.type][Z.source],void 0!==le.removeSource?le.removeSource(Z,se):se()}loadWorkerSource(V,Z,se){try{this.self.importScripts(Z.url),se()}catch(le){se(le.toString())}}syncRTLPluginState(V,Z,se){try{u.plugin.setState(Z);const le=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&null!=le){this.self.importScripts(le);const _e=u.plugin.isParsed();se(_e?void 0:new Error(`RTL Text Plugin failed to import scripts from ${le}`),_e)}}catch(le){se(le.toString())}}getAvailableImages(V){let Z=this.availableImages[V];return Z||(Z=[]),Z}getLayerIndex(V){let Z=this.layerIndexes[V];return Z||(Z=this.layerIndexes[V]=new Nt),Z}getWorkerSource(V,Z,se){return this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][Z]||(this.workerSources[V][Z]={}),this.workerSources[V][Z][se]||(this.workerSources[V][Z][se]=new this.workerSourceTypes[Z]({send:(le,_e,Ie,Pe,Ee,Fe)=>{this.actor.send(le,_e,Ie,V,Ee,Fe)},scheduler:this.actor.scheduler},this.getLayerIndex(V),this.getAvailableImages(V),this.isSpriteLoaded[V])),this.workerSources[V][Z][se]}getDEMWorkerSource(V,Z){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][Z]||(this.demWorkerSources[V][Z]=new Et),this.demWorkerSources[V][Z]}enforceCacheSizeLimit(V,Z){u.enforceCacheSizeLimit(Z)}getWorkerPerformanceMetrics(V,Z,se){se(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Sn(self)),Sn}),Oe(0,function(u){var wt=en;function en(f){return n=f,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,_,x=new Blob([""],{type:"text/javascript"}),w=URL.createObjectURL(x);try{_=new Worker(w),p=!0}catch(S){p=!1}return _&&_.terminate(),URL.revokeObjectURL(w),p}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var p=document.createElement("canvas");p.width=p.height=1;var _=p.getContext("2d");if(!_)return!1;var x=_.getImageData(0,0,1,1);return x&&x.width===p.width}()||(void 0===Nt[l=n&&n.failIfMajorPerformanceCaveat]&&(Nt[l]=function(p){var _,w,S,F,x=(w=p,S=document.createElement("canvas"),(F=Object.create(en.webGLContextAttributes)).failIfMajorPerformanceCaveat=w,S.getContext("webgl",F)||S.getContext("experimental-webgl",F));if(!x)return!1;try{_=x.createShader(x.VERTEX_SHADER)}catch(w){return!1}return!(!_||x.isContextLost())&&(x.shaderSource(_,"void main() {}"),x.compileShader(_),!0===x.getShaderParameter(_,x.COMPILE_STATUS))}(l)),!Nt[l]||document.documentMode));var n,l}var Nt={};function et(f,n){var l=n[0],p=n[1],_=n[2],x=n[3],w=l*x-_*p;return w?(f[0]=x*(w=1/w),f[1]=-p*w,f[2]=-_*w,f[3]=l*w,f):null}function Et(f,n){if(Array.isArray(f)){if(!Array.isArray(n)||f.length!==n.length)return!1;for(let l=0;l<f.length;l++)if(!Et(f[l],n[l]))return!1;return!0}if("object"==typeof f&&null!==f&&null!==n){if("object"!=typeof n||Object.keys(f).length!==Object.keys(n).length)return!1;for(const l in f)if(!Et(f[l],n[l]))return!1;return!0}return f===n}en.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Me={create:function(f,n,l){const p=u.window.document.createElement(f);return void 0!==n&&(p.className=n),l&&l.appendChild(p),p},createSVG:function(f,n,l){const p=u.window.document.createElementNS("http://www.w3.org/2000/svg",f);for(const _ of Object.keys(n))p.setAttributeNS(null,_,n[_]);return l&&l.appendChild(p),p}},st=u.window.document&&u.window.document.documentElement.style,Ot=st&&void 0!==st.userSelect?"userSelect":"WebkitUserSelect";let Bn;Me.disableDrag=function(){st&&Ot&&(Bn=st[Ot],st[Ot]="none")},Me.enableDrag=function(){st&&Ot&&(st[Ot]=Bn)};const Ft=function(f){f.preventDefault(),f.stopPropagation(),u.window.removeEventListener("click",Ft,!0)};function Rt(f,n,l){const p=f.offsetWidth===n.width?1:f.offsetWidth/n.width;return new u.pointGeometry((l.clientX-n.left)*p,(l.clientY-n.top)*p)}function an(f){const{userImage:n}=f;return!!(n&&n.render&&n.render())&&(f.data.replace(new Uint8Array(n.data.buffer)),!0)}Me.suppressClick=function(){u.window.addEventListener("click",Ft,!0),u.window.setTimeout(()=>{u.window.removeEventListener("click",Ft,!0)},0)},Me.mousePos=function(f,n){const l=f.getBoundingClientRect();return Rt(f,l,n)},Me.touchPos=function(f,n){const l=f.getBoundingClientRect(),p=[];for(let _=0;_<n.length;_++)p.push(Rt(f,l,n[_]));return p},Me.mouseButton=function(f){return void 0!==u.window.InstallTrigger&&2===f.button&&f.ctrlKey&&u.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:f.button};class It extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}getImage(n){return this.images[n]}addImage(n,l){this._validate(n,l)&&(this.images[n]=l)}_validate(n,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new u.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),p=!1),p}_validateStretch(n,l){if(!n)return!0;let p=0;for(const _ of n){if(_[0]<p||_[1]<_[0]||l<_[1])return!1;p=_[1]}return!0}_validateContent(n,l){return!(n&&(4!==n.length||n[0]<0||l.data.width<n[0]||n[1]<0||l.data.height<n[1]||n[2]<0||l.data.width<n[2]||n[3]<0||l.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,l){l.version=this.images[n].version+1,this.images[n]=l,this.updatedImages[n]=!0}removeImage(n){const l=this.images[n];delete this.images[n],delete this.patterns[n],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,l){let p=!0;if(!this.isLoaded())for(const _ of n)this.images[_]||(p=!1);this.isLoaded()||p?this._notify(n,l):this.requestors.push({ids:n,callback:l})}_notify(n,l){const p={};for(const _ of n){this.images[_]||this.fire(new u.Event("styleimagemissing",{id:_}));const x=this.images[_];x?p[_]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:Boolean(x.userImage&&x.userImage.render)}:u.warnOnce(`Image "${_}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:n,height:l}=this.atlasImage;return{width:n,height:l}}getPattern(n){const l=this.patterns[n],p=this.getImage(n);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const _={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new u.ImagePosition(_,p);this.patterns[n]={bin:_,position:x}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const l=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.Texture(n,this.atlasImage,l.RGBA),this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const x in this.patterns)n.push(this.patterns[x].bin);const{w:l,h:p}=u.potpack(n),_=this.atlasImage;_.resize({width:l||1,height:p||1});for(const x in this.patterns){const{bin:w}=this.patterns[x],S=w.x+1,F=w.y+1,O=this.images[x].data,N=O.width,$=O.height;u.RGBAImage.copy(O,_,{x:0,y:0},{x:S,y:F},{width:N,height:$}),u.RGBAImage.copy(O,_,{x:0,y:$-1},{x:S,y:F-1},{width:N,height:1}),u.RGBAImage.copy(O,_,{x:0,y:0},{x:S,y:F+$},{width:N,height:1}),u.RGBAImage.copy(O,_,{x:N-1,y:0},{x:S-1,y:F},{width:1,height:$}),u.RGBAImage.copy(O,_,{x:0,y:0},{x:S+N,y:F},{width:1,height:$})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const l of n){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];an(p)&&this.updateImage(l,p)}}}const Nn=new u.Properties({anchor:new u.DataConstantProperty(u.spec.light.anchor),position:new class{constructor(){this.specification=u.spec.light.position}possiblyEvaluate(f,n){return function([l,p,_]){const x=u.degToRad(p+90),w=u.degToRad(_);return{x:l*Math.cos(x)*Math.sin(w),y:l*Math.sin(x)*Math.sin(w),z:l*Math.cos(w),azimuthal:p,polar:_}}(f.expression.evaluate(n))}interpolate(f,n,l){return{x:u.number(f.x,n.x,l),y:u.number(f.y,n.y,l),z:u.number(f.z,n.z,l),azimuthal:u.number(f.azimuthal,n.azimuthal,l),polar:u.number(f.polar,n.polar,l)}}},color:new u.DataConstantProperty(u.spec.light.color),intensity:new u.DataConstantProperty(u.spec.light.intensity)}),zn="-transition";class xn extends u.Evented{constructor(n){super(),this._transitionable=new u.Transitionable(Nn),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,l={}){if(!this._validate(u.validateLight,n,l))for(const p in n){const _=n[p];u.endsWith(p,zn)?this._transitionable.setTransition(p.slice(0,-zn.length),_):this._transitionable.setValue(p,_)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,p){return(!p||!1!==p.validate)&&u.emitValidationErrors(this,n.call(u.validateStyle,u.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}const ut=new u.Properties({source:new u.DataConstantProperty(u.spec.terrain.source),exaggeration:new u.DataConstantProperty(u.spec.terrain.exaggeration)}),Dt="-transition";class fn extends u.Evented{constructor(n,l){super(),this._transitionable=new u.Transitionable(ut),this.set(n),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(n){for(const l in n){const p=n[l];u.endsWith(l,Dt)?this._transitionable.setTransition(l.slice(0,-Dt.length),p):this._transitionable.setValue(l,p)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}}function Wt(f,n,l,p){const _=u.smoothstep(45,65,l),[x,w]=tn(f,p),S=u.length(n);let F=1-Math.min(1,Math.exp((S-x)/(w-x)*-6));return F*=F*F,F=Math.min(1,1.00747*F),F*_*f.alpha}function tn(f,n){const l=.5/Math.tan(.5*n);return[f.range[0]+l,f.range[1]+l]}const ft=new u.Properties({range:new u.DataConstantProperty(u.spec.fog.range),color:new u.DataConstantProperty(u.spec.fog.color),"horizon-blend":new u.DataConstantProperty(u.spec.fog["horizon-blend"])}),Ne="-transition";class $e extends u.Evented{constructor(n,l){super(),this._transitionable=new u.Transitionable(ft),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,l={}){if(!this._validate(u.validateFog,n,l))for(const p in n){const _=n[p];u.endsWith(p,Ne)?this._transitionable.setTransition(p.slice(0,-Ne.length),_):this._transitionable.setValue(p,_)}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return u.smoothstep(45,65,n)*l.a}getOpacityAtLatLng(n,l){return this._transform.projection.supportsFog?function(p,_,x){const w=u.MercatorCoordinate.fromLngLat(_),S=x.elevation?x.elevation.getAtPointOrZero(w):0,F=[w.x,w.y,S];return u.transformMat4(F,F,x.mercatorFogMatrix),Wt(p,F,x.pitch,x._fov)}(this.state,n,l):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?tn(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,l,p){return(!p||!1!==p.validate)&&u.emitValidationErrors(this,n.call(u.validateStyle,u.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}class He{constructor(n,l){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=u.uniqueId();const p=this.workerPool.acquire(this.id);for(let _=0;_<p.length;_++){const x=new He.Actor(p[_],l,this.id);x.name=`Worker ${_}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,l,p){u.asyncAll(this.actors,(_,x)=>{_.send(n,l,x)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function qe(f,n,l){return n*(u.EXTENT/(f.tileSize*Math.pow(2,l-f.tileID.overscaledZ)))}He.Actor=u.Actor;class _t{constructor(n,l,p){this.context=n;const _=n.gl;this.buffer=_.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),_.bufferData(_.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ve={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class En{constructor(n,l,p,_){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=_,this.context=n;const x=n.gl;this.buffer=x.createBuffer(),n.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete l.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,l){for(let p=0;p<this.attributes.length;p++){const _=l.attributes[this.attributes[p].name];void 0!==_&&n.enableVertexAttribArray(_)}}setVertexAttribPointers(n,l,p){for(let _=0;_<this.attributes.length;_++){const x=this.attributes[_],w=l.attributes[x.name];void 0!==w&&n.vertexAttribPointer(w,x.components,n[Ve[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Qt{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class br extends Qt{getDefault(){return u.Color.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class hn extends Qt{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class $r extends Qt{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class yi extends Qt{getDefault(){return[!0,!0,!0,!0]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class ur extends Qt{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class vi extends Qt{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Fi extends Qt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const l=this.current;(n.func!==l.func||n.ref!==l.ref||n.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Eo extends Qt{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Zi extends Qt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=n,this.dirty=!1}}class Lr extends Qt{getDefault(){return[0,1]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class $n extends Qt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=n,this.dirty=!1}}class Gn extends Qt{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Cn extends Qt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.BLEND):l.disable(l.BLEND),this.current=n,this.dirty=!1}}class qi extends Qt{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class ds extends Qt{getDefault(){return u.Color.transparent}set(n){const l=this.current;(n.r!==l.r||n.g!==l.g||n.b!==l.b||n.a!==l.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Gr extends Qt{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class Es extends Qt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;n?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=n,this.dirty=!1}}class To extends Qt{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class Pn extends Qt{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}class Yr extends Qt{getDefault(){return null}set(n){(n!==this.current||this.dirty)&&(this.gl.useProgram(n),this.current=n,this.dirty=!1)}}class Kr extends Qt{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class ti extends Qt{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const l=this.current;(n[0]!==l[0]||n[1]!==l[1]||n[2]!==l[2]||n[3]!==l[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class xi extends Qt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class cr extends Qt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class uo extends Qt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class fs extends Qt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ho extends Qt{getDefault(){return null}set(n){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class Jt extends Qt{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class wr extends Qt{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class un extends Qt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class cn extends Qt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class fo extends Qt{constructor(n,l){super(n),this.context=n,this.parent=l}getDefault(){return null}}class Po extends fo{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class hr extends fo{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class fi extends hr{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Hn{constructor(n,l,p,_){this.context=n,this.width=l,this.height=p;const x=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Po(n,x),_&&(this.depthAttachment=new hr(n,x))}destroy(){const n=this.context.gl,l=this.colorAttachment.get();if(l&&n.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&n.deleteRenderbuffer(p)}n.deleteFramebuffer(this.framebuffer)}}class po{constructor(n){this.gl=n,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new br(this),this.clearDepth=new hn(this),this.clearStencil=new $r(this),this.colorMask=new yi(this),this.depthMask=new ur(this),this.stencilMask=new vi(this),this.stencilFunc=new Fi(this),this.stencilOp=new Eo(this),this.stencilTest=new Zi(this),this.depthRange=new Lr(this),this.depthTest=new $n(this),this.depthFunc=new Gn(this),this.blend=new Cn(this),this.blendFunc=new qi(this),this.blendColor=new ds(this),this.blendEquation=new Gr(this),this.cullFace=new Es(this),this.cullFaceSide=new To(this),this.frontFace=new Pn(this),this.program=new Yr(this),this.activeTexture=new Kr(this),this.viewport=new ti(this),this.bindFramebuffer=new xi(this),this.bindRenderbuffer=new cr(this),this.bindTexture=new uo(this),this.bindVertexBuffer=new fs(this),this.bindElementBuffer=new ho(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Jt(this),this.pixelStoreUnpack=new wr(this),this.pixelStoreUnpackPremultiplyAlpha=new un(this),this.pixelStoreUnpackFlipY=new cn(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=n.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(n.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,l){return new _t(this,n,l)}createVertexBuffer(n,l,p){return new En(this,n,l,p)}createRenderbuffer(n,l,p){const _=this.gl,x=_.createRenderbuffer();return this.bindRenderbuffer.set(x),_.renderbufferStorage(_.RENDERBUFFER,n,l,p),this.bindRenderbuffer.set(null),x}createFramebuffer(n,l,p){return new Hn(this,n,l,p)}clear({color:n,depth:l,stencil:p}){const _=this.gl;let x=0;n&&(x|=_.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(x|=_.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==p&&(x|=_.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),_.clear(x)}setCullFace(n){!1===n.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){Et(n.blendFunction,u.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Zn{constructor(n,l,p,_){this.screenBounds=n,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(x=>_.pointCoordinate3D(x)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(n,l){let p,_;if(n instanceof u.pointGeometry||"number"==typeof n[0]){const x=u.pointGeometry.convert(n);p=[u.pointGeometry.convert(n)],_=l.isPointAboveHorizon(x)}else{const x=u.pointGeometry.convert(n[0]),w=u.pointGeometry.convert(n[1]);p=[x,w],_=u.polygonizeBounds(x,w).every(S=>l.isPointAboveHorizon(S))}return new Zn(p,l.getCameraPoint(),_,l)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(n){return u.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const l=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new u.pointGeometry(1,1)):this.screenBounds[1],_=u.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?_[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(_[3]=this.cameraPoint)),u.bufferConvexPolygon(_,n)}containsTile(n,l,p){const _=n.queryPadding+1,x=n.tileID.wrap,w=p?this._bufferedCameraMercator(_,l).map(te=>u.getTilePoint(n.tileTransform,te,x)):this._bufferedScreenMercator(_,l).map(te=>u.getTilePoint(n.tileTransform,te,x)),S=this.screenGeometryMercator.map(te=>u.getTileVec3(n.tileTransform,te,x)),F=S.map(te=>new u.pointGeometry(te[0],te[1])),O=l.getFreeCameraOptions().position||new u.MercatorCoordinate(0,0,0),N=u.getTileVec3(n.tileTransform,O,x),$=S.map(te=>{const ie=u.sub(te,te,N);return u.normalize(ie,ie),new u.Ray(N,ie)}),K=qe(n,1,l.zoom);if(u.polygonIntersectsBox(w,0,0,u.EXTENT,u.EXTENT))return{queryGeometry:this,tilespaceGeometry:F,tilespaceRays:$,bufferedTilespaceGeometry:w,bufferedTilespaceBounds:(re=u.getBounds(w),re.min.x=u.clamp(re.min.x,0,u.EXTENT),re.min.y=u.clamp(re.min.y,0,u.EXTENT),re.max.x=u.clamp(re.max.x,0,u.EXTENT),re.max.y=u.clamp(re.max.y,0,u.EXTENT),re),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:K};var re}_bufferedScreenMercator(n,l){const p=mo(n);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{const _=this.bufferedScreenGeometry(n).map(x=>l.pointCoordinate3D(x));return this._screenRaycastCache[p]=_,_}}_bufferedCameraMercator(n,l){const p=mo(n);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{const _=this.bufferedCameraGeometry(n).map(x=>l.pointCoordinate3D(x));return this._cameraRaycastCache[p]=_,_}}}function mo(f){return 100*f|0}function qt(f,n,l){const p=function(_,x){if(_)return l(_);if(x){const w=u.pick(u.extend(x,f),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(w.vectorLayers=x.vector_layers,w.vectorLayerIds=w.vectorLayers.map(S=>S.id)),w.tiles=n.canonicalizeTileset(w,f.url),l(null,w)}};return f.url?u.getJSON(n.transformRequest(n.normalizeSourceURL(f.url),u.ResourceType.Source),p):u.exported.frame(()=>p(null,f))}class ps{constructor(n,l,p){this.bounds=u.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(n){return Array.isArray(n)&&4===n.length?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const l=Math.pow(2,n.z),p=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*l),_=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*l),x=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*l),w=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*l);return n.x>=p&&n.x<x&&n.y>=_&&n.y<w}}class pi extends u.Evented{constructor(n,l,p,_){super(),this.id=n,this.dispatcher=p,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},l),u.extend(this,u.pick(l,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=qt(this._options,this.map._requestManager,(n,l)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new u.ErrorEvent(n)):l&&(u.extend(this,l),l.bounds&&(this.tileBounds=new ps(l.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(l.tiles),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,l){const p=u.exported.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);n.request=u.getImage(this.map._requestManager.transformRequest(_,u.ResourceType.Tile),(x,w,S,F)=>{if(delete n.request,n.aborted)n.state="unloaded",l(null);else if(x)n.state="errored",l(x);else if(w){this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:S,expires:F});const O=this.map.painter.context,N=O.gl;n.texture=this.map.painter.getTileTexture(w.width),n.texture?n.texture.update(w,{useMipmap:!0}):(n.texture=new u.Texture(O,w,N.RGBA,{useMipmap:!0}),n.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE),O.extTextureFilterAnisotropic&&N.texParameterf(N.TEXTURE_2D,O.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,O.extTextureFilterAnisotropicMax)),n.state="loaded",u.cacheEntryPossiblyAdded(this.dispatcher),l(null)}})}abortTile(n,l){n.request&&(n.request.cancel(),delete n.request),l()}unloadTile(n,l){n.texture&&this.map.painter.saveTileTexture(n.texture),l()}hasTransition(){return!1}}let Kn;function no(f,n,l,p,_,x,w,S){const F=[f,l,_,n,p,x,1,1,1],O=[w,S,1],N=u.adjoint([],F),[$,K,re]=u.transformMat3(O,O,u.transpose(N,N));return u.multiply(F,[$,0,0,0,K,0,0,0,re],F)}class ko extends u.Evented{constructor(n,l,p,_){super(),this.id=n,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(_),this.options=l}load(n,l){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,u.getImage(this.map._requestManager.transformRequest(this.url,u.ResourceType.Image),(p,_)=>{this._loaded=!0,p?this.fire(new u.ErrorEvent(p)):_&&(this.image=u.exported.getImageData(_),this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),l&&l(),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this.options.url=n.url,this.load(n.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}setCoordinates(n){this.coordinates=n,delete this._boundsArray;const l=n.map(u.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let _=1/0,x=1/0,w=-1/0,S=-1/0;for(const $ of p)_=Math.min(_,$.x),x=Math.min(x,$.y),w=Math.max(w,$.x),S=Math.max(S,$.y);const F=Math.max(w-_,S-x),O=Math.max(0,Math.floor(-Math.log(F)/Math.LN2)),N=Math.pow(2,O);return new u.CanonicalTileID(O,Math.floor((_+w)/2*N),Math.floor((x+S)/2*N))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){delete this._boundsArray}_makeBoundsArray(){const n=u.tileTransform(this.tileID,this.map.transform.projection),[l,p,_,x]=this.coordinates.map(w=>{const S=n.projection.project(w[0],w[1]);return u.getTilePoint(n,S)._round()});return this.perspectiveTransform=function(w,S,F,O,N,$,K,re,te,ie){const xe=no(0,0,w,0,0,S,w,S),ee=no(F,O,N,$,K,re,te,ie);return u.multiply(ee,u.adjoint(xe,xe),ee),[ee[6]/ee[8]*w/u.EXTENT,ee[7]/ee[8]*S/u.EXTENT]}(this.width,this.height,l.x,l.y,p.x,p.y,x.x,x.y,_.x,_.y),this._boundsArray=new u.StructArrayLayout4i8,this._boundsArray.emplaceBack(l.x,l.y,0,0),this._boundsArray.emplaceBack(p.x,p.y,u.EXTENT,0),this._boundsArray.emplaceBack(x.x,x.y,0,u.EXTENT),this._boundsArray.emplaceBack(_.x,_.y,u.EXTENT,u.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const n=this.map.painter.context,l=n.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,u.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new u.Texture(n,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE));for(const p in this.tiles){const _=this.tiles[p];"loaded"!==_.state&&(_.state="loaded",_.texture=this.texture)}}loadTile(n,l){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},l(null)):(n.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ro={vector:class extends u.Evented{constructor(f,n,l,p){if(super(),this.id=f,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(n,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p),this._tileWorkers={},this._deduped=new u.DedupedRequest}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=qt(this._options,this.map._requestManager,(f,n)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new u.ErrorEvent(f)):n&&(u.extend(this,n),n.bounds&&(this.tileBounds=new ps(n.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(n.tiles,this.map._requestManager._customAccessToken),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(f){return!this.tileBounds||this.tileBounds.contains(f.canonical)}onAdd(f){this.map=f,this.load()}setSourceProperty(f){this._tileJSONRequest&&this._tileJSONRequest.cancel(),f();const n=this.map.style._getSourceCaches(this.id);for(const l of n)l.clearTiles();this.load()}setTiles(f){return this.setSourceProperty(()=>{this._options.tiles=f}),this}setUrl(f){return this.setSourceProperty(()=>{this.url=f,this._options.url=f}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}loadTile(f,n){const l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(l,u.ResourceType.Tile),data:void 0,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,tileSize:this.tileSize*f.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:f.isSymbolTile};if(p.request.collectResourceTiming=this._collectResourceTiming,f.actor&&"expired"!==f.state)"loading"===f.state?f.reloadCallback=n:f.request=f.actor.send("reloadTile",p,_.bind(this));else if(f.actor=this._tileWorkers[l]=this._tileWorkers[l]||this.dispatcher.getActor(),this.dispatcher.ready)f.request=f.actor.send("loadTile",p,_.bind(this),void 0,!0);else{const x=u.loadVectorTile.call({deduped:this._deduped},p,(w,S)=>{w||!S?_.call(this,w):(p.data={cacheControl:S.cacheControl,expires:S.expires,rawData:S.rawData.slice(0)},f.actor&&f.actor.send("loadTile",p,_.bind(this),void 0,!0))},!0);f.request={cancel:x}}function _(x,w){return delete f.request,f.aborted?n(null):x&&404!==x.status?n(x):(w&&w.resourceTiming&&(f.resourceTiming=w.resourceTiming),this.map._refreshExpiredTiles&&w&&f.setExpiryData(w),f.loadVectorData(w,this.map.painter),u.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(f.reloadCallback&&(this.loadTile(f,f.reloadCallback),f.reloadCallback=null)))}}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.actor&&f.actor.send("abortTile",{uid:f.uid,type:this.type,source:this.id})}unloadTile(f){f.unloadVectorData(),f.actor&&f.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:pi,"raster-dem":class extends pi{constructor(f,n,l,p){super(f,n,l,p),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(f,n){const l=this.map._requestManager.normalizeTileURL(f.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(_,x){_&&(f.state="errored",n(_)),x&&(f.dem=x,f.dem.onDeserialize(),f.needsHillshadePrepare=!0,f.needsDEMTextureUpload=!0,f.state="loaded",n(null))}f.request=u.getImage(this.map._requestManager.transformRequest(l,u.ResourceType.Tile),function(_,x,w,S){if(delete f.request,f.aborted)f.state="unloaded",n(null);else if(_)f.state="errored",n(_);else if(x){this.map._refreshExpiredTiles&&f.setExpiryData({cacheControl:w,expires:S});const F=u.window.ImageBitmap&&x instanceof u.window.ImageBitmap&&(null==Kn&&(Kn=u.window.OffscreenCanvas&&new u.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof u.window.createImageBitmap),Kn),O=1-(x.width-u.prevPowerOfTwo(x.width))/2;O<1||f.neighboringTiles||(f.neighboringTiles=this._getNeighboringTiles(f.tileID));const N=F?x:u.exported.getImageData(x,O),$={uid:f.uid,coord:f.tileID,source:this.id,rawImageData:N,encoding:this.encoding,padding:O};f.actor&&"expired"!==f.state||(f.actor=this.dispatcher.getActor(),f.actor.send("loadDEMTile",$,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(f){const n=f.canonical,l=Math.pow(2,n.z),p=(n.x-1+l)%l,_=0===n.x?f.wrap-1:f.wrap,x=(n.x+1+l)%l,w=n.x+1===l?f.wrap+1:f.wrap,S={};return S[new u.OverscaledTileID(f.overscaledZ,_,n.z,p,n.y).key]={backfilled:!1},S[new u.OverscaledTileID(f.overscaledZ,w,n.z,x,n.y).key]={backfilled:!1},n.y>0&&(S[new u.OverscaledTileID(f.overscaledZ,_,n.z,p,n.y-1).key]={backfilled:!1},S[new u.OverscaledTileID(f.overscaledZ,f.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},S[new u.OverscaledTileID(f.overscaledZ,w,n.z,x,n.y-1).key]={backfilled:!1}),n.y+1<l&&(S[new u.OverscaledTileID(f.overscaledZ,_,n.z,p,n.y+1).key]={backfilled:!1},S[new u.OverscaledTileID(f.overscaledZ,f.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},S[new u.OverscaledTileID(f.overscaledZ,w,n.z,x,n.y+1).key]={backfilled:!1}),S}unloadTile(f){f.demTexture&&this.map.painter.saveTileTexture(f.demTexture),f.fbo&&(f.fbo.destroy(),delete f.fbo),f.dem&&delete f.dem,delete f.neighboringTiles,f.state="unloaded"}},geojson:class extends u.Evented{constructor(f,n,l,p){super(),this.id=f,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=n.data,this._options=u.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const _=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*_,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*_,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:u.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*_,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(f){this.map=f,this.setData(this._data)}setData(f){return this._data=f,this._updateWorkerData(),this}getClusterExpansionZoom(f,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:f,source:this.id},n),this}getClusterChildren(f,n){return this.actor.send("geojson.getClusterChildren",{clusterId:f,source:this.id},n),this}getClusterLeaves(f,n,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:f,limit:n,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new u.Event("dataloading",{dataType:"source"})),this._loaded=!1;const f=u.extend({},this.workerOptions),n=this._data;"string"==typeof n?(f.request=this.map._requestManager.transformRequest(u.exported.resolveURL(n),u.ResourceType.Source),f.request.collectResourceTiming=this._collectResourceTiming):f.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,f,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new u.ErrorEvent(l));else{const _={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(_.resourceTiming=p.resourceTiming[this.id]),this.fire(new u.Event("data",_)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(f,n){const l=f.actor?"reloadTile":"loadTile";f.actor=this.actor,f.request=this.actor.send(l,{type:this.type,uid:f.uid,tileID:f.tileID,tileZoom:f.tileZoom,zoom:f.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,_)=>(delete f.request,f.unloadVectorData(),f.aborted?n(null):p?n(p):(f.loadVectorData(_,this.map.painter,"reloadTile"===l),n(null))),void 0,"loadTile"===l)}abortTile(f){f.request&&(f.request.cancel(),delete f.request),f.aborted=!0}unloadTile(f){f.unloadVectorData(),this.actor.send("removeTile",{uid:f.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return u.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ko{constructor(f,n,l,p){super(f,n,l,p),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const f=this.options;this.urls=[];for(const n of f.urls)this.urls.push(this.map._requestManager.transformRequest(n,u.ResourceType.Source).url);u.getVideo(this.urls,(n,l)=>{this._loaded=!0,n?this.fire(new u.ErrorEvent(n)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(f){if(this.video){const n=this.video.seekable;f<n.start(0)||f>n.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=f}}getVideo(){return this.video}onAdd(f){this.map||(this.map=f,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const f=this.map.painter.context,n=f.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new u.Texture(f,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=f.createVertexBuffer(this._boundsArray,u.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2));for(const l in this.tiles){const p=this.tiles[l];"loaded"!==p.state&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ko,canvas:class extends ko{constructor(f,n,l,p){super(f,n,l,p),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(_=>!Array.isArray(_)||2!==_.length||_.some(x=>"number"!=typeof x))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof u.window.HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${f}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof u.window.HTMLCanvasElement?this.options.canvas:u.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(f){this.map=f,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let f=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,f=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,f=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const n=this.map.painter.context,l=n.gl;this._boundsArray||this._makeBoundsArray(),this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,u.boundsAttributes.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(f||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.Texture(n,this.canvas,l.RGBA,{premultiply:!0});for(const p in this.tiles){const _=this.tiles[p];"loaded"!==_.state&&(_.state="loaded",_.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const f of[this.canvas.width,this.canvas.height])if(isNaN(f)||f<=0)return!0;return!1}}},Sn=function(f,n,l,p){const _=new ro[n.type](f,n,l,p);if(_.id!==f)throw new Error(`Expected Source id to be ${f} instead of ${_.id}`);return u.bindAll(["load","abort","unload","serialize","prepare"],_),_};function oe(f,n){const l=u.identity([]);return u.scale(l,l,[.5*f.width,.5*-f.height,1]),u.translate(l,l,[1,-1,0]),u.multiply$1(l,l,f.calculateProjMatrix(n.toUnwrapped()))}function V(f,n,l,p,_,x,w,S=!1){const F=f.tilesIn(p,w,S);F.sort(se);const O=[];for(const $ of F)O.push({wrappedTileID:$.tile.tileID.wrapped().key,queryResults:$.tile.queryRenderedFeatures(n,l,f._state,$,_,x,oe(f.transform,$.tile.tileID),S)});const N=function($){const K={},re={};for(const te of $){const ie=te.queryResults,xe=te.wrappedTileID,ee=re[xe]=re[xe]||{};for(const ge in ie){const me=ie[ge],fe=ee[ge]=ee[ge]||{},pe=K[ge]=K[ge]||[];for(const be of me)fe[be.featureIndex]||(fe[be.featureIndex]=!0,pe.push(be))}}return K}(O);for(const $ in N)N[$].forEach(K=>{const re=K.feature,te=f.getFeatureState(re.layer["source-layer"],re.id);re.source=re.layer.source,re.layer["source-layer"]&&(re.sourceLayer=re.layer["source-layer"]),re.state=te});return N}function Z(f,n){const l=f.getRenderableIds().map(x=>f.getTileByID(x)),p=[],_={};for(let x=0;x<l.length;x++){const w=l[x],S=w.tileID.canonical.key;_[S]||(_[S]=!0,w.querySourceFeatures(p,n))}return p}function se(f,n){const l=f.tileID,p=n.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function le(){return null!=ys.workerClass?new ys.workerClass:new u.window.Worker(ys.workerUrl)}const _e="mapboxgl_preloaded_worker_pool";class Ie{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Ie.workerCount;)this.workers.push(new le);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_e]}numActive(){return Object.keys(this.active).length}}let Pe;function Ee(){return Pe||(Pe=new Ie),Pe}function Fe(f,n){const l={};for(const p in f)"ref"!==p&&(l[p]=f[p]);return u.refProperties.forEach(p=>{p in n&&(l[p]=n[p])}),l}function Xe(f){f=f.slice();const n=Object.create(null);for(let l=0;l<f.length;l++)n[f[l].id]=f[l];for(let l=0;l<f.length;l++)"ref"in f[l]&&(f[l]=Fe(f[l],n[f[l].ref]));return f}Ie.workerCount=2;const nt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function it(f,n,l){l.push({command:nt.addSource,args:[f,n[f]]})}function Ht(f,n,l){n.push({command:nt.removeSource,args:[f]}),l[f]=!0}function Kt(f,n,l,p){Ht(f,l,p),it(f,n,l)}function ve(f,n,l){let p;for(p in f[l])if(f[l].hasOwnProperty(p)&&"data"!==p&&!Et(f[l][p],n[l][p]))return!1;for(p in n[l])if(n[l].hasOwnProperty(p)&&"data"!==p&&!Et(f[l][p],n[l][p]))return!1;return!0}function de(f,n,l,p,_,x){let w;for(w in n=n||{},f=f||{})f.hasOwnProperty(w)&&(Et(f[w],n[w])||l.push({command:x,args:[p,w,n[w],_]}));for(w in n)n.hasOwnProperty(w)&&!f.hasOwnProperty(w)&&(Et(f[w],n[w])||l.push({command:x,args:[p,w,n[w],_]}))}function ae(f){return f.id}function Se(f,n){return f[n.id]=n,f}class Ze{constructor(n,l){this.reset(n,l)}reset(n,l){this.points=n||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(1===this.points.length)return this.points[0];n=u.clamp(n,0,1);let l=1,p=this._distances[l];const _=n*this.paddedLength+this.padding;for(;p<_&&l<this._distances.length;)p=this._distances[++l];const x=l-1,w=this._distances[x],S=p-w,F=S>0?(_-w)/S:0;return this.points[x].mult(1-F).add(this.points[l].mult(F))}}class At{constructor(n,l,p){const _=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(n/p),this.yCellCount=Math.ceil(l/p);for(let w=0;w<this.xCellCount*this.yCellCount;w++)_.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=l,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,l,p,_,x){this._forEachCell(l,p,_,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_),this.bboxes.push(x)}insertCircle(n,l,p,_){this._forEachCell(l-_,p-_,l+_,p+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(l),this.circles.push(p),this.circles.push(_)}_insertBoxCell(n,l,p,_,x,w){this.boxCells[x].push(w)}_insertCircleCell(n,l,p,_,x,w){this.circleCells[x].push(w)}_query(n,l,p,_,x,w){if(p<0||n>this.width||_<0||l>this.height)return!x&&[];const S=[];if(n<=0&&l<=0&&this.width<=p&&this.height<=_){if(x)return!0;for(let F=0;F<this.boxKeys.length;F++)S.push({key:this.boxKeys[F],x1:this.bboxes[4*F],y1:this.bboxes[4*F+1],x2:this.bboxes[4*F+2],y2:this.bboxes[4*F+3]});for(let F=0;F<this.circleKeys.length;F++){const O=this.circles[3*F],N=this.circles[3*F+1],$=this.circles[3*F+2];S.push({key:this.circleKeys[F],x1:O-$,y1:N-$,x2:O+$,y2:N+$})}return w?S.filter(w):S}return this._forEachCell(n,l,p,_,this._queryCell,S,{hitTest:x,seenUids:{box:{},circle:{}}},w),x?S.length>0:S}_queryCircle(n,l,p,_,x){const w=n-p,S=n+p,F=l-p,O=l+p;if(S<0||w>this.width||O<0||F>this.height)return!_&&[];const N=[];return this._forEachCell(w,F,S,O,this._queryCellCircle,N,{hitTest:_,circle:{x:n,y:l,radius:p},seenUids:{box:{},circle:{}}},x),_?N.length>0:N}query(n,l,p,_,x){return this._query(n,l,p,_,!1,x)}hitTest(n,l,p,_,x){return this._query(n,l,p,_,!0,x)}hitTestCircle(n,l,p,_){return this._queryCircle(n,l,p,!0,_)}_queryCell(n,l,p,_,x,w,S,F){const O=S.seenUids,N=this.boxCells[x];if(null!==N){const K=this.bboxes;for(const re of N)if(!O.box[re]){O.box[re]=!0;const te=4*re;if(n<=K[te+2]&&l<=K[te+3]&&p>=K[te+0]&&_>=K[te+1]&&(!F||F(this.boxKeys[re]))){if(S.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[re],x1:K[te],y1:K[te+1],x2:K[te+2],y2:K[te+3]})}}}const $=this.circleCells[x];if(null!==$){const K=this.circles;for(const re of $)if(!O.circle[re]){O.circle[re]=!0;const te=3*re;if(this._circleAndRectCollide(K[te],K[te+1],K[te+2],n,l,p,_)&&(!F||F(this.circleKeys[re]))){if(S.hitTest)return w.push(!0),!0;{const ie=K[te],xe=K[te+1],ee=K[te+2];w.push({key:this.circleKeys[re],x1:ie-ee,y1:xe-ee,x2:ie+ee,y2:xe+ee})}}}}}_queryCellCircle(n,l,p,_,x,w,S,F){const O=S.circle,N=S.seenUids,$=this.boxCells[x];if(null!==$){const re=this.bboxes;for(const te of $)if(!N.box[te]){N.box[te]=!0;const ie=4*te;if(this._circleAndRectCollide(O.x,O.y,O.radius,re[ie+0],re[ie+1],re[ie+2],re[ie+3])&&(!F||F(this.boxKeys[te])))return w.push(!0),!0}}const K=this.circleCells[x];if(null!==K){const re=this.circles;for(const te of K)if(!N.circle[te]){N.circle[te]=!0;const ie=3*te;if(this._circlesCollide(re[ie],re[ie+1],re[ie+2],O.x,O.y,O.radius)&&(!F||F(this.circleKeys[te])))return w.push(!0),!0}}}_forEachCell(n,l,p,_,x,w,S,F){const O=this._convertToXCellCoord(n),N=this._convertToYCellCoord(l),$=this._convertToXCellCoord(p),K=this._convertToYCellCoord(_);for(let re=O;re<=$;re++)for(let te=N;te<=K;te++)if(x.call(this,n,l,p,_,this.xCellCount*te+re,w,S,F))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,l,p,_,x,w){const S=_-n,F=x-l,O=p+w;return O*O>S*S+F*F}_circleAndRectCollide(n,l,p,_,x,w,S){const F=(w-_)/2,O=Math.abs(n-(_+F));if(O>F+p)return!1;const N=(S-x)/2,$=Math.abs(l-(x+N));if($>N+p)return!1;if(O<=F||$<=N)return!0;const K=O-F,re=$-N;return K*K+re*re<=p*p}}const Xt=Math.tan(85*Math.PI/180);function Er(f,n,l,p,_,x){let w=u.create();if(l){if("globe"===_.projection.name)w=u.calculateGlobeMatrix(_,_.worldSize/_._projectionScaler,[0,0]),u.multiply$1(w,w,u.globeDenormalizeECEF(u.globeTileBounds(n)));else{const S=et([],x);w[0]=S[0],w[1]=S[1],w[4]=S[2],w[5]=S[3]}p||u.rotateZ(w,w,_.angle)}else u.multiply$1(w,_.labelPlaneMatrix,f);return w}function Tr(f,n,l,p,_,x){if(l){if("globe"===_.projection.name){const w=Er(f,n,l,p,_,x);return u.invert(w,w),u.multiply$1(w,f,w),w}{const w=u.clone(f),S=u.identity([]);return S[0]=x[0],S[1]=x[1],S[4]=x[2],S[5]=x[3],u.multiply$1(w,w,S),p||u.rotateZ(w,w,-_.angle),w}}return _.glCoordMatrix}function Fr(f,n,l=0){const p=[f.x,f.y,l,1];l?u.transformMat4$1(p,p,n):Dr(p,p,n);const _=p[3];return{point:new u.pointGeometry(p[0]/_,p[1]/_),signedDistanceFromCamera:_}}function Si(f,n){return Math.min(.5+f/n*.5,1.5)}function Or(f,n){const l=f[0]/f[3],p=f[1]/f[3];return l>=-n[0]&&l<=n[0]&&p>=-n[1]&&p<=n[1]}function ms(f,n,l,p,_,x,w,S,F,O){const N=l.transform,$=p?f.textSizeData:f.iconSizeData,K=u.evaluateSizeForZoom($,l.transform.zoom),re=[256/l.width*2+1,256/l.height*2+1],te=p?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;te.clear();const ie=f.lineVertexArray,xe=p?f.text.placedSymbolArray:f.icon.placedSymbolArray,ee=l.transform.width/l.transform.height;let ge=!1;for(let me=0;me<xe.length;me++){const fe=xe.get(me);if(fe.writingMode!==u.WritingMode.vertical||ge||0!==me&&xe.get(me-1).writingMode===u.WritingMode.horizontal||(ge=!0),fe.hidden||fe.writingMode===u.WritingMode.vertical&&!ge){mi(fe.numGlyphs,te);continue}ge=!1;const pe=new u.pointGeometry(fe.tileAnchorX,fe.tileAnchorY),be=F?F(pe):[0,0,0],ze=N.projection.projectTilePoint(pe.x,pe.y,O.canonical),Ge=[ze.x+be[0],ze.y+be[1],ze.z+be[2]],bt=[...Ge,1];if(u.transformMat4$1(bt,bt,n),!Or(bt,re)){mi(fe.numGlyphs,te);continue}const ht=Si(l.transform.cameraToCenterDistance,bt[3]),lt=u.evaluateSizeForFeature($,K,fe),Ke=w?lt/ht:lt*ht,Ue=Fr(new u.pointGeometry(Ge[0],Ge[1]),_,Ge[2]);if(Ue.signedDistanceFromCamera<=0){mi(fe.numGlyphs,te);continue}let ct={};const Qe=w?null:F,Yt=kn(fe,Ke,!1,S,n,_,x,f.glyphOffsetArray,ie,te,Ue.point,pe,ct,ee,Qe,N.projection,O);ge=Yt.useVertical,Qe&&Yt.needsFlipping&&(ct={}),(Yt.notEnoughRoom||ge||Yt.needsFlipping&&kn(fe,Ke,!0,S,n,_,x,f.glyphOffsetArray,ie,te,Ue.point,pe,ct,ee,Qe,N.projection,O).notEnoughRoom)&&mi(fe.numGlyphs,te)}p?f.text.dynamicLayoutVertexBuffer.updateData(te):f.icon.dynamicLayoutVertexBuffer.updateData(te)}function Mi(f,n,l,p,_,x,w,S,F,O,N,$,K,re,te){const ie=S.glyphStartIndex+S.numGlyphs,xe=S.lineStartIndex,ee=S.lineStartIndex+S.lineLength,ge=n.getoffsetX(S.glyphStartIndex),me=n.getoffsetX(ie-1),fe=go(f*ge,l,p,_,x,w,S.segment,xe,ee,F,O,N,$,K,!0,re,te);if(!fe)return null;const pe=go(f*me,l,p,_,x,w,S.segment,xe,ee,F,O,N,$,K,!0,re,te);return pe?{first:fe,last:pe}:null}function Ut(f,n,l,p){return f.writingMode===u.WritingMode.horizontal&&Math.abs(l.y-n.y)>Math.abs(l.x-n.x)*p?{useVertical:!0}:f.writingMode===u.WritingMode.vertical?n.y<l.y?{needsFlipping:!0}:null:0!==f.flipState&&function(_,x,w){const S=(x.x-_.x)*w;return 0===S||Math.abs((x.y-_.y)/S)>Xt}(n,l,p)?1===f.flipState?{needsFlipping:!0}:null:n.x>l.x?{needsFlipping:!0}:null}function kn(f,n,l,p,_,x,w,S,F,O,N,$,K,re,te,ie,xe){const ee=n/24,ge=f.lineOffsetX*ee,me=f.lineOffsetY*ee;let fe;if(f.numGlyphs>1){const pe=f.glyphStartIndex+f.numGlyphs,be=f.lineStartIndex,ze=f.lineStartIndex+f.lineLength,Ge=Mi(ee,S,ge,me,l,N,$,f,F,x,K,te,!1,ie,xe);if(!Ge)return{notEnoughRoom:!0};const bt=Fr(Ge.first.point,w).point,ht=Fr(Ge.last.point,w).point;if(p&&!l){const lt=Ut(f,bt,ht,re);if(f.flipState=lt&&lt.needsFlipping?1:2,lt)return lt}fe=[Ge.first];for(let lt=f.glyphStartIndex+1;lt<pe-1;lt++)fe.push(go(ee*S.getoffsetX(lt),ge,me,l,N,$,f.segment,be,ze,F,x,K,te,!1,!1,ie,xe));fe.push(Ge.last)}else{if(p&&!l){const be=Fr($,_).point,ze=f.lineStartIndex+f.segment+1,Ge=new u.pointGeometry(F.getx(ze),F.gety(ze)),bt=Fr(Ge,_),ht=Ut(f,be,bt.signedDistanceFromCamera>0?bt.point:ci($,Ge,be,1,_,void 0,ie,xe.canonical),re);if(f.flipState=ht&&ht.needsFlipping?1:2,ht)return ht}const pe=go(ee*S.getoffsetX(f.glyphStartIndex),ge,me,l,N,$,f.segment,f.lineStartIndex,f.lineStartIndex+f.lineLength,F,x,K,te,!1,!1,ie,xe);if(!pe)return{notEnoughRoom:!0};fe=[pe]}for(const pe of fe)u.addDynamicAttributes(O,pe.point,pe.angle);return{}}function dr(f,n,l,p,_){const x=p.projectTilePoint(f.x,f.y,n);if(!_)return Fr(x,l,x.z);const w=_(f);return Fr(new u.pointGeometry(x.x+w[0],x.y+w[1]),l,x.z+w[2])}function ci(f,n,l,p,_,x,w,S){const F=dr(f.add(f.sub(n)._unit()),S,_,w,x).point,O=l.sub(F);return l.add(O._mult(p/O.mag()))}function go(f,n,l,p,_,x,w,S,F,O,N,$,K,re,te,ie,xe){const ee=p?f-n:f+n;let ge=ee>0?1:-1,me=0;p&&(ge*=-1,me=Math.PI),ge<0&&(me+=Math.PI);let fe=ge>0?S+w:S+w+1,pe=_,be=_,ze=0,Ge=0;const bt=Math.abs(ee),ht=[],lt=[];let Ke=x;const Ue=()=>{const xt=fe-ge;return 0===ze?x:new u.pointGeometry(O.getx(xt),O.gety(xt))},ct=()=>ci(Ue(),Ke,be,bt-ze+1,N,K,ie,xe.canonical);for(;ze+Ge<=bt;){if(fe+=ge,fe<S||fe>=F)return null;if(be=pe,ht.push(pe),re&&lt.push(Ke||Ue()),pe=$[fe],void 0===pe){Ke=new u.pointGeometry(O.getx(fe),O.gety(fe));const xt=dr(Ke,xe.canonical,N,ie,K);pe=xt.signedDistanceFromCamera>0?$[fe]=xt.point:ct()}else Ke=null;ze+=Ge,Ge=be.dist(pe)}te&&K&&(Ke=Ke||new u.pointGeometry(O.getx(fe),O.gety(fe)),$[fe]=pe=void 0===$[fe]?pe:ct(),Ge=be.dist(pe));const Qe=(bt-ze)/Ge,Yt=pe.sub(be),on=Yt.mult(Qe)._add(be);l&&on._add(Yt._unit()._perp()._mult(l*ge));const Ln=me+Math.atan2(pe.y-be.y,pe.x-be.x);return ht.push(on),re&&(Ke=Ke||new u.pointGeometry(O.getx(fe),O.gety(fe)),lt.push(function(xt,ln,yn){const yr=1-yn;return new u.pointGeometry(xt.x*yr+ln.x*yn,xt.y*yr+ln.y*yn)}(lt.length>0?lt[lt.length-1]:Ke,Ke,Qe))),{point:on,angle:Ln,path:ht,tilePath:lt}}const Qr=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function mi(f,n){for(let l=0;l<f;l++){const p=n.length;n.resize(p+4),n.float32.set(Qr,3*p)}}function Dr(f,n,l){const p=n[0],_=n[1];return f[0]=l[0]*p+l[4]*_+l[12],f[1]=l[1]*p+l[5]*_+l[13],f[3]=l[3]*p+l[7]*_+l[15],f}const io=100;class qo{constructor(n,l,p=new At(n.width+200,n.height+200,25),_=new At(n.width+200,n.height+200,25)){this.transform=n,this.grid=p,this.ignoredGrid=_,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+io,this.screenBottomBoundary=n.height+io,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=l}placeCollisionBox(n,l,p,_,x,w,S){let F=l.projectedAnchorX,O=l.projectedAnchorY,N=l.projectedAnchorZ;const $=l.elevation,K=l.tileID;if($&&K){const fe=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),pe=fe.upVector(K.canonical,l.tileAnchorX,l.tileAnchorY),be=fe.upVectorScale(K.canonical);F+=pe[0]*$*be,O+=pe[1]*$*be,N+=pe[2]*$*be}const re=this.projectAndGetPerspectiveRatio(w,F,O,N,l.tileID),te=x*re.perspectiveRatio,ie=(l.x1*n+p.x-l.padding)*te+re.point.x,xe=(l.y1*n+p.y-l.padding)*te+re.point.y,ee=(l.x2*n+p.x+l.padding)*te+re.point.x,ge=(l.y2*n+p.y+l.padding)*te+re.point.y,me=re.perspectiveRatio<=.55||re.aboveHorizon;return!this.isInsideGrid(ie,xe,ee,ge)||!_&&this.grid.hitTest(ie,xe,ee,ge,S)||me?{box:[],offscreen:!1}:{box:[ie,xe,ee,ge],offscreen:this.isOffscreen(ie,xe,ee,ge)}}placeCollisionCircles(n,l,p,_,x,w,S,F,O,N,$,K,re,te){const ie=[],xe=this.transform.elevation,ee=this.transform.projection.createTileTransform(this.transform,this.transform.worldSize),ge=xe?xe.getAtTileOffsetFunc(te,ee):Qe=>[0,0,0],me=new u.pointGeometry(l.tileAnchorX,l.tileAnchorY),fe=this.transform.projection.projectTilePoint(l.tileAnchorX,l.tileAnchorY,te.canonical),pe=ge(me),be=[fe.x+pe[0],fe.y+pe[1],fe.z+pe[2]],ze=this.projectAndGetPerspectiveRatio(w,be[0],be[1],be[2],te),{perspectiveRatio:Ge}=ze,bt=(N?x/Ge:x*Ge)/u.ONE_EM,ht=Fr(new u.pointGeometry(be[0],be[1]),S,be[2]).point,lt=ze.signedDistanceFromCamera>0?Mi(bt,_,l.lineOffsetX*bt,l.lineOffsetY*bt,!1,ht,me,l,p,S,{},xe&&!N?ge:null,N&&!!xe,this.transform.projection,te):null;let Ke=!1,Ue=!1,ct=!0;if(lt&&!ze.aboveHorizon){const Qe=.5*K*Ge+re,Yt=new u.pointGeometry(-100,-100),on=new u.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ln=new Ze,xt=lt.first,ln=lt.last;let yn=[];for(let mn=xt.path.length-1;mn>=1;mn--)yn.push(xt.path[mn]);for(let mn=1;mn<ln.path.length;mn++)yn.push(ln.path[mn]);const yr=2.5*Qe;if(F){const mn=yn.map(xe?(Vn,Fn)=>{const wi=ge(Fn<xt.path.length-1?xt.tilePath[xt.path.length-1-Fn]:ln.tilePath[Fn-xt.path.length+2]);return Fr(Vn,F,wi[2])}:Vn=>Fr(Vn,F));yn=mn.some(Vn=>Vn.signedDistanceFromCamera<=0)?[]:mn.map(Vn=>Vn.point)}let mr=[];if(yn.length>0){const mn=yn[0].clone(),Vn=yn[0].clone();for(let Fn=1;Fn<yn.length;Fn++)mn.x=Math.min(mn.x,yn[Fn].x),mn.y=Math.min(mn.y,yn[Fn].y),Vn.x=Math.max(Vn.x,yn[Fn].x),Vn.y=Math.max(Vn.y,yn[Fn].y);mr=mn.x>=Yt.x&&Vn.x<=on.x&&mn.y>=Yt.y&&Vn.y<=on.y?[yn]:Vn.x<Yt.x||mn.x>on.x||Vn.y<Yt.y||mn.y>on.y?[]:u.clipLine([yn],Yt.x,Yt.y,on.x,on.y)}for(const mn of mr){Ln.reset(mn,.25*Qe);let Vn=0;Vn=Ln.length<=.5*Qe?1:Math.ceil(Ln.paddedLength/yr)+1;for(let Fn=0;Fn<Vn;Fn++){const wi=Fn/Math.max(Vn-1,1),Vo=Ln.lerp(wi),jo=Vo.x+io,Co=Vo.y+io;ie.push(jo,Co,Qe,0);const nr=jo-Qe,wn=Co-Qe,qn=jo+Qe,qr=Co+Qe;if(ct=ct&&this.isOffscreen(nr,wn,qn,qr),Ue=Ue||this.isInsideGrid(nr,wn,qn,qr),!n&&this.grid.hitTestCircle(jo,Co,Qe,$)&&(Ke=!0,!O))return{circles:[],offscreen:!1,collisionDetected:Ke}}}}return{circles:!O&&Ke||!Ue?[]:ie,offscreen:ct,collisionDetected:Ke}}queryRenderedSymbols(n){if(0===n.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[];let p=1/0,_=1/0,x=-1/0,w=-1/0;for(const N of n){const $=new u.pointGeometry(N.x+io,N.y+io);p=Math.min(p,$.x),_=Math.min(_,$.y),x=Math.max(x,$.x),w=Math.max(w,$.y),l.push($)}const S=this.grid.query(p,_,x,w).concat(this.ignoredGrid.query(p,_,x,w)),F={},O={};for(const N of S){const $=N.key;if(void 0===F[$.bucketInstanceId]&&(F[$.bucketInstanceId]={}),F[$.bucketInstanceId][$.featureIndex])continue;const K=[new u.pointGeometry(N.x1,N.y1),new u.pointGeometry(N.x2,N.y1),new u.pointGeometry(N.x2,N.y2),new u.pointGeometry(N.x1,N.y2)];u.polygonIntersectsPolygon(l,K)&&(F[$.bucketInstanceId][$.featureIndex]=!0,void 0===O[$.bucketInstanceId]&&(O[$.bucketInstanceId]=[]),O[$.bucketInstanceId].push($.featureIndex))}return O}insertCollisionBox(n,l,p,_,x){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:_,collisionGroupID:x},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,l,p,_,x){const w=l?this.ignoredGrid:this.grid,S={bucketInstanceId:p,featureIndex:_,collisionGroupID:x};for(let F=0;F<n.length;F+=4)w.insertCircle(S,n[F],n[F+1],n[F+2])}projectAndGetPerspectiveRatio(n,l,p,_,x){const w=[l,p,_||0,1];let S=!1;if(_||this.transform.pitch>0){u.transformMat4$1(w,w,n);let F=!1;this.fogState&&x&&(F=function(O,N,$,K,re,te){const ie=te.calculateFogTileMatrix(re),xe=[N,$,K];return u.transformMat4(xe,xe,ie),Wt(O,xe,te.pitch,te._fov)}(this.fogState,l,p,_||0,x.toUnwrapped(),this.transform)>.9),S=w[2]>w[3]||F}else Dr(w,w,n);return{point:new u.pointGeometry((w[0]/w[3]+1)/2*this.transform.width+io,(-w[1]/w[3]+1)/2*this.transform.height+io),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/w[3]*.5,1.5),signedDistanceFromCamera:w[3],aboveHorizon:S}}isOffscreen(n,l,p,_){return p<io||n>=this.screenRightBoundary||_<io||l>this.screenBottomBoundary}isInsideGrid(n,l,p,_){return p>=0&&n<this.gridRightBoundary&&_>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const n=u.identity([]);return u.translate(n,n,[-100,-100,0]),n}}class Mn{constructor(n,l,p,_){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?l:-l))):_&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class Ro{constructor(n,l,p,_,x,w=!1){this.text=new Mn(n?n.text:null,l,p,x),this.icon=new Mn(n?n.icon:null,l,_,x),this.clipped=w}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class oo{constructor(n,l,p,_=!1){this.text=n,this.icon=l,this.skipFade=p,this.clipped=_}}class Wo{constructor(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]}}class Ts{constructor(n,l,p,_,x){this.bucketInstanceId=n,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=_,this.tileID=x}}class Ii{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const l=++this.maxGroupID;this.collisionGroups[n]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[n]}}function Xo(f,n,l,p,_){const{horizontalAlign:x,verticalAlign:w}=u.getAnchorAlignment(f),S=-(x-.5)*n,F=-(w-.5)*l,O=u.evaluateVariableOffset(f,p);return new u.pointGeometry(S+O[0]*_,F+O[1]*_)}function Ai(f,n,l,p,_){const x=new u.pointGeometry(f,n);return l&&x._rotate(p?_:-_),x}class Hr{constructor(n,l,p,_,x){this.transform=n.clone(),this.collisionIndex=new qo(this.transform,x),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Ii(p),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,l,p,_){const x=p.getBucket(l),w=p.latestFeatureIndex;if(!x||!w||l.id!==x.layerIds[0])return;const S=x.layers[0].layout,F=p.collisionBoxArray,O=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),N=p.tileSize/u.EXTENT,$=p.tileID.toUnwrapped(),K=this.transform.calculateProjMatrix($),re="map"===S.get("text-pitch-alignment"),te="map"===S.get("text-rotation-alignment");l.compileFilter();const ie=l.dynamicFilter(),xe=l.dynamicFilterNeedsFeature(),ee=this.transform.calculatePixelsToTileUnitsMatrix(p),ge=Er(K,p.tileID.canonical,re,te,this.transform,ee);let me=null;if(re){const be=Tr(K,p.tileID.canonical,re,te,this.transform,ee);me=u.multiply$1([],this.transform.labelPlaneMatrix,be)}let fe=null;ie&&p.latestFeatureIndex&&(fe={unwrappedTileID:$,dynamicFilter:ie,dynamicFilterNeedsFeature:xe,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[x.bucketInstanceId]=new Ts(x.bucketInstanceId,w,x.sourceLayerIndex,x.index,p.tileID);const pe={bucket:x,layout:S,posMatrix:K,textLabelPlaneMatrix:ge,labelToScreenMatrix:me,clippingData:fe,scale:O,textPixelRatio:N,holdingForFade:p.holdingForFade(),collisionBoxArray:F,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:u.evaluateSizeForZoom(x.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(_)for(const be of x.sortKeyRanges){const{sortKey:ze,symbolInstanceStart:Ge,symbolInstanceEnd:bt}=be;n.push({sortKey:ze,symbolInstanceStart:Ge,symbolInstanceEnd:bt,parameters:pe})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:pe})}attemptAnchorPlacement(n,l,p,_,x,w,S,F,O,N,$,K,re,te,ie,xe,ee,ge){const me=[K.textOffset0,K.textOffset1],fe=Xo(n,p,_,me,x),pe=this.collisionIndex.placeCollisionBox(x,l,Ai(fe.x,fe.y,w,S,this.transform.angle),$,F,O,N.predicate);if((!xe||0!==this.collisionIndex.placeCollisionBox(te.getSymbolInstanceIconSize(ge,this.transform.zoom,re),xe,Ai(fe.x,fe.y,w,S,this.transform.angle),$,F,O,N.predicate).box.length)&&pe.box.length>0){let be;return this.prevPlacement&&this.prevPlacement.variableOffsets[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID]&&this.prevPlacement.placements[K.crossTileID].text&&(be=this.prevPlacement.variableOffsets[K.crossTileID].anchor),this.variableOffsets[K.crossTileID]={textOffset:me,width:p,height:_,anchor:n,textScale:x,prevAnchor:be},this.markUsedJustification(te,n,K,ie),te.allowVerticalPlacement&&(this.markUsedOrientation(te,ie,K),this.placedOrientations[K.crossTileID]=ie),{shift:fe,placedGlyphBoxes:pe}}}placeLayerBucketPart(n,l,p,_){const{bucket:x,layout:w,posMatrix:S,textLabelPlaneMatrix:F,labelToScreenMatrix:O,clippingData:N,textPixelRatio:$,holdingForFade:K,collisionBoxArray:re,partiallyEvaluatedTextSize:te,partiallyEvaluatedIconSize:ie,collisionGroup:xe}=n.parameters,ee=w.get("text-optional"),ge=w.get("icon-optional"),me=w.get("text-allow-overlap"),fe=w.get("icon-allow-overlap"),pe="map"===w.get("text-rotation-alignment"),be="map"===w.get("text-pitch-alignment"),ze="none"!==w.get("icon-text-fit"),Ge="viewport-y"===w.get("symbol-z-order"),bt=me&&(fe||!x.hasIconData()||ge),ht=fe&&(me||!x.hasTextData()||ee);!x.collisionArrays&&re&&x.deserializeCollisionBoxes(re),p&&_&&x.updateCollisionDebugBuffers(this.transform.zoom,re);const lt=(Ke,Ue,ct)=>{if(N){const nr={zoom:this.transform.zoom,pitch:this.transform.pitch};let wn=null;if(N.dynamicFilterNeedsFeature){const qn=this.retainedQueryData[x.bucketInstanceId];wn=N.featureIndex.loadFeature({featureIndex:Ke.featureIndex,bucketIndex:qn.bucketIndex,sourceLayerIndex:qn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,N.dynamicFilter)(nr,wn,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new u.pointGeometry(Ke.tileAnchorX,Ke.tileAnchorY),this.transform.calculateDistanceTileData(N.unwrappedTileID)))return this.placements[Ke.crossTileID]=new oo(!1,!1,!1,!0),void(l[Ke.crossTileID]=!0)}if(l[Ke.crossTileID])return;if(K)return void(this.placements[Ke.crossTileID]=new oo(!1,!1,!1));let Qe=!1,Yt=!1,on=!0,Ln=null,xt={box:null,offscreen:null},ln={box:null,offscreen:null},yn=null,yr=null,mr=null,mn=0,Vn=0,Fn=0;ct.textFeatureIndex?mn=ct.textFeatureIndex:Ke.useRuntimeCollisionCircles&&(mn=Ke.featureIndex),ct.verticalTextFeatureIndex&&(Vn=ct.verticalTextFeatureIndex);const wi=nr=>{nr.tileID=this.retainedQueryData[x.bucketInstanceId].tileID,(this.transform.elevation||nr.elevation)&&(nr.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[x.bucketInstanceId].tileID,nr.tileAnchorX,nr.tileAnchorY):0)},Vo=ct.textBox;if(Vo){wi(Vo);const nr=qn=>{let qr=u.WritingMode.horizontal;if(x.allowVerticalPlacement&&!qn&&this.prevPlacement){const ao=this.prevPlacement.placedOrientations[Ke.crossTileID];ao&&(this.placedOrientations[Ke.crossTileID]=ao,qr=ao,this.markUsedOrientation(x,qr,Ke))}return qr},wn=(qn,qr)=>{if(x.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&ct.verticalTextBox){for(const ao of x.writingModes)if(ao===u.WritingMode.vertical?(xt=qr(),ln=xt):xt=qn(),xt&&xt.box&&xt.box.length)break}else xt=qn()};if(w.get("text-variable-anchor")){let qn=w.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ke.crossTileID]){const zr=this.prevPlacement.variableOffsets[Ke.crossTileID];qn.indexOf(zr.anchor)>0&&(qn=qn.filter(lo=>lo!==zr.anchor),qn.unshift(zr.anchor))}const qr=(zr,lo,Dc)=>{const So=x.getSymbolInstanceTextSize(te,Ke,this.transform.zoom,Ue),ya=(zr.x2-zr.x1)*So+2*zr.padding,$t=(zr.y2-zr.y1)*So+2*zr.padding,sn=ze&&!fe?lo:null;sn&&wi(sn);let Yi={box:[],offscreen:!1};const xl=me?2*qn.length:qn.length;for(let is=0;is<xl;++is){const Ei=this.attemptAnchorPlacement(qn[is%qn.length],zr,ya,$t,So,pe,be,$,S,xe,is>=qn.length,Ke,Ue,x,Dc,sn,te,ie);if(Ei&&(Yi=Ei.placedGlyphBoxes,Yi&&Yi.box&&Yi.box.length)){Qe=!0,Ln=Ei.shift;break}}return Yi};wn(()=>qr(Vo,ct.iconBox,u.WritingMode.horizontal),()=>{const zr=ct.verticalTextBox;return zr&&wi(zr),x.allowVerticalPlacement&&!(xt&&xt.box&&xt.box.length)&&Ke.numVerticalGlyphVertices>0&&zr?qr(zr,ct.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null}}),xt&&(Qe=xt.box,on=xt.offscreen);const ao=nr(xt&&xt.box);if(!Qe&&this.prevPlacement){const zr=this.prevPlacement.variableOffsets[Ke.crossTileID];zr&&(this.variableOffsets[Ke.crossTileID]=zr,this.markUsedJustification(x,zr.anchor,Ke,ao))}}else{const qn=(qr,ao)=>{const zr=x.getSymbolInstanceTextSize(te,Ke,this.transform.zoom,Ue),lo=this.collisionIndex.placeCollisionBox(zr,qr,new u.pointGeometry(0,0),me,$,S,xe.predicate);return lo&&lo.box&&lo.box.length&&(this.markUsedOrientation(x,ao,Ke),this.placedOrientations[Ke.crossTileID]=ao),lo};wn(()=>qn(Vo,u.WritingMode.horizontal),()=>{const qr=ct.verticalTextBox;return x.allowVerticalPlacement&&Ke.numVerticalGlyphVertices>0&&qr?(wi(qr),qn(qr,u.WritingMode.vertical)):{box:null,offscreen:null}}),nr(xt&&xt.box&&xt.box.length)}}if(yn=xt,Qe=yn&&yn.box&&yn.box.length>0,on=yn&&yn.offscreen,Ke.useRuntimeCollisionCircles){const nr=x.text.placedSymbolArray.get(Ke.centerJustifiedTextSymbolIndex>=0?Ke.centerJustifiedTextSymbolIndex:Ke.verticalPlacedTextSymbolIndex),wn=u.evaluateSizeForFeature(x.textSizeData,te,nr),qn=w.get("text-padding");yr=this.collisionIndex.placeCollisionCircles(me,nr,x.lineVertexArray,x.glyphOffsetArray,wn,S,F,O,p,be,xe.predicate,Ke.collisionCircleDiameter*wn/u.ONE_EM,qn,this.retainedQueryData[x.bucketInstanceId].tileID),Qe=me||yr.circles.length>0&&!yr.collisionDetected,on=on&&yr.offscreen}if(ct.iconFeatureIndex&&(Fn=ct.iconFeatureIndex),ct.iconBox){const nr=wn=>{wi(wn);const qn=ze&&Ln?Ai(Ln.x,Ln.y,pe,be,this.transform.angle):new u.pointGeometry(0,0),qr=x.getSymbolInstanceIconSize(ie,this.transform.zoom,Ue);return this.collisionIndex.placeCollisionBox(qr,wn,qn,fe,$,S,xe.predicate)};ln&&ln.box&&ln.box.length&&ct.verticalIconBox?(mr=nr(ct.verticalIconBox),Yt=mr.box.length>0):(mr=nr(ct.iconBox),Yt=mr.box.length>0),on=on&&mr.offscreen}const jo=ee||0===Ke.numHorizontalGlyphVertices&&0===Ke.numVerticalGlyphVertices,Co=ge||0===Ke.numIconVertices;if(jo||Co?Co?jo||(Yt=Yt&&Qe):Qe=Yt&&Qe:Yt=Qe=Yt&&Qe,Qe&&yn&&yn.box&&this.collisionIndex.insertCollisionBox(yn.box,w.get("text-ignore-placement"),x.bucketInstanceId,ln&&ln.box&&Vn?Vn:mn,xe.ID),Yt&&mr&&this.collisionIndex.insertCollisionBox(mr.box,w.get("icon-ignore-placement"),x.bucketInstanceId,Fn,xe.ID),yr&&(Qe&&this.collisionIndex.insertCollisionCircles(yr.circles,w.get("text-ignore-placement"),x.bucketInstanceId,mn,xe.ID),p)){const nr=x.bucketInstanceId;let wn=this.collisionCircleArrays[nr];void 0===wn&&(wn=this.collisionCircleArrays[nr]=new Wo);for(let qn=0;qn<yr.circles.length;qn+=4)wn.circles.push(yr.circles[qn+0]),wn.circles.push(yr.circles[qn+1]),wn.circles.push(yr.circles[qn+2]),wn.circles.push(yr.collisionDetected?1:0)}this.placements[Ke.crossTileID]=new oo(Qe||bt,Yt||ht,on||x.justReloaded),l[Ke.crossTileID]=!0};if(Ge){const Ke=x.getSortedSymbolIndexes(this.transform.angle);for(let Ue=Ke.length-1;Ue>=0;--Ue){const ct=Ke[Ue];lt(x.symbolInstances.get(ct),ct,x.collisionArrays[ct])}}else for(let Ke=n.symbolInstanceStart;Ke<n.symbolInstanceEnd;Ke++)lt(x.symbolInstances.get(Ke),Ke,x.collisionArrays[Ke]);if(p&&x.bucketInstanceId in this.collisionCircleArrays){const Ke=this.collisionCircleArrays[x.bucketInstanceId];u.invert(Ke.invProjMatrix,S),Ke.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(n,l,p,_){let x;x=_===u.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[u.getAnchorJustification(l)];const w=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const S of w)S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=x>=0&&S!==x?0:p.crossTileID)}markUsedOrientation(n,l,p){const _=l===u.WritingMode.horizontal||l===u.WritingMode.horizontalOnly?l:0,x=l===u.WritingMode.vertical?l:0,w=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const S of w)n.text.placedSymbolArray.get(S).placedOrientation=_;p.verticalPlacedTextSymbolIndex&&(n.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const _=l?l.symbolFadeChange(n):1,x=l?l.opacities:{},w=l?l.variableOffsets:{},S=l?l.placedOrientations:{};for(const F in this.placements){const O=this.placements[F],N=x[F];N?(this.opacities[F]=new Ro(N,_,O.text,O.icon,null,O.clipped),p=p||O.text!==N.text.placed||O.icon!==N.icon.placed):(this.opacities[F]=new Ro(null,_,O.text,O.icon,O.skipFade,O.clipped),p=p||O.text||O.icon)}for(const F in x){const O=x[F];if(!this.opacities[F]){const N=new Ro(O,_,!1,!1);N.isHidden()||(this.opacities[F]=N,p=p||O.text.placed||O.icon.placed)}}for(const F in w)this.variableOffsets[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.variableOffsets[F]=w[F]);for(const F in S)this.placedOrientations[F]||!this.opacities[F]||this.opacities[F].isHidden()||(this.placedOrientations[F]=S[F]);p?this.lastPlacementChangeTime=n:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:n)}updateLayerOpacities(n,l){const p={};for(const _ of l){const x=_.getBucket(n);x&&_.latestFeatureIndex&&n.id===x.layerIds[0]&&this.updateBucketOpacities(x,p,_.collisionBoxArray)}}updateBucketOpacities(n,l,p){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const _=n.layers[0].layout,x=!!n.layers[0].dynamicFilter(),w=new Ro(null,0,!1,!1,!0),S=_.get("text-allow-overlap"),F=_.get("icon-allow-overlap"),O=_.get("text-variable-anchor"),N="map"===_.get("text-rotation-alignment"),$="map"===_.get("text-pitch-alignment"),K="none"!==_.get("icon-text-fit"),re=new Ro(null,0,S&&(F||!n.hasIconData()||_.get("icon-optional")),F&&(S||!n.hasTextData()||_.get("text-optional")),!0);!n.collisionArrays&&p&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(p);const te=(xe,ee,ge)=>{for(let me=0;me<ee/4;me++)xe.opacityVertexArray.emplaceBack(ge)};let ie=0;for(let xe=0;xe<n.symbolInstances.length;xe++){const ee=n.symbolInstances.get(xe),{numHorizontalGlyphVertices:ge,numVerticalGlyphVertices:me,crossTileID:fe}=ee;let pe=this.opacities[fe];l[fe]?pe=w:pe||(pe=re,this.opacities[fe]=pe),l[fe]=!0;const be=ge>0||me>0,ze=ee.numIconVertices>0,Ge=this.placedOrientations[ee.crossTileID],bt=Ge===u.WritingMode.vertical,ht=Ge===u.WritingMode.horizontal||Ge===u.WritingMode.horizontalOnly;if(!be&&!ze||pe.isHidden()||ie++,be){const lt=Oi(pe.text);te(n.text,ge,bt?Lo:lt),te(n.text,me,ht?Lo:lt);const Ke=pe.text.isHidden();[ee.rightJustifiedTextSymbolIndex,ee.centerJustifiedTextSymbolIndex,ee.leftJustifiedTextSymbolIndex].forEach(Qe=>{Qe>=0&&(n.text.placedSymbolArray.get(Qe).hidden=Ke||bt?1:0)}),ee.verticalPlacedTextSymbolIndex>=0&&(n.text.placedSymbolArray.get(ee.verticalPlacedTextSymbolIndex).hidden=Ke||ht?1:0);const Ue=this.variableOffsets[ee.crossTileID];Ue&&this.markUsedJustification(n,Ue.anchor,ee,Ge);const ct=this.placedOrientations[ee.crossTileID];ct&&(this.markUsedJustification(n,"left",ee,ct),this.markUsedOrientation(n,ct,ee))}if(ze){const lt=Oi(pe.icon);ee.placedIconSymbolIndex>=0&&(te(n.icon,ee.numIconVertices,bt?Lo:lt),n.icon.placedSymbolArray.get(ee.placedIconSymbolIndex).hidden=pe.icon.isHidden()),ee.verticalPlacedIconSymbolIndex>=0&&(te(n.icon,ee.numVerticalIconVertices,ht?Lo:lt),n.icon.placedSymbolArray.get(ee.verticalPlacedIconSymbolIndex).hidden=pe.icon.isHidden())}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const lt=n.collisionArrays[xe];if(lt){let Ke=new u.pointGeometry(0,0),Ue=!0;if(lt.textBox||lt.verticalTextBox){if(O){const Qe=this.variableOffsets[fe];Qe?(Ke=Xo(Qe.anchor,Qe.width,Qe.height,Qe.textOffset,Qe.textScale),N&&Ke._rotate($?this.transform.angle:-this.transform.angle)):Ue=!1}x&&(Ue=!pe.clipped),lt.textBox&&Rn(n.textCollisionBox.collisionVertexArray,pe.text.placed,!Ue||bt,Ke.x,Ke.y),lt.verticalTextBox&&Rn(n.textCollisionBox.collisionVertexArray,pe.text.placed,!Ue||ht,Ke.x,Ke.y)}const ct=Ue&&Boolean(!ht&&lt.verticalIconBox);lt.iconBox&&Rn(n.iconCollisionBox.collisionVertexArray,pe.icon.placed,ct,K?Ke.x:0,K?Ke.y:0),lt.verticalIconBox&&Rn(n.iconCollisionBox.collisionVertexArray,pe.icon.placed,!ct,K?Ke.x:0,K?Ke.y:0)}}}if(n.fullyClipped=0===ie,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const xe=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=xe.invProjMatrix,n.placementViewportMatrix=xe.viewportMatrix,n.collisionCircleArray=xe.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return 0===this.fadeDuration?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>n}setStale(){this.stale=!0}}function Rn(f,n,l,p,_){f.emplaceBack(n?1:0,l?1:0,p||0,_||0),f.emplaceBack(n?1:0,l?1:0,p||0,_||0),f.emplaceBack(n?1:0,l?1:0,p||0,_||0),f.emplaceBack(n?1:0,l?1:0,p||0,_||0)}const We=Math.pow(2,25),kt=Math.pow(2,24),Jr=Math.pow(2,17),Nr=Math.pow(2,16),Pr=Math.pow(2,9),_o=Math.pow(2,8),Pi=Math.pow(2,1);function Oi(f){if(0===f.opacity&&!f.placed)return 0;if(1===f.opacity&&f.placed)return 4294967295;const n=f.placed?1:0,l=Math.floor(127*f.opacity);return l*We+n*kt+l*Jr+n*Nr+l*Pr+n*_o+l*Pi+n}const Lo=0;class Pt{constructor(n){this._sortAcrossTiles="viewport-y"!==n.layout.get("symbol-z-order")&&void 0!==n.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(n,l,p,_,x){const w=this._bucketParts;for(;this._currentTileIndex<n.length;)if(l.getBucketParts(w,_,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort((S,F)=>S.sortKey-F.sortKey));this._currentPartIndex<w.length;){const S=w[this._currentPartIndex];if(l.placeLayerBucketPart(S,this._seenCrossTileIDs,p,0===S.symbolInstanceStart),this._currentPartIndex++,x())return!0}return!1}}class In{constructor(n,l,p,_,x,w,S,F){this.placement=new Hr(n,x,w,S,F),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(n,l,p){const _=u.exported.now(),x=()=>{const w=u.exported.now()-_;return!this._forceFullPlacement&&w>2};for(;this._currentPlacementIndex>=0;){const w=l[n[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if("symbol"===w.type&&(!w.minzoom||w.minzoom<=S)&&(!w.maxzoom||w.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Pt(w)),this._inProgressLayer.continuePlacement(p[w.source],this.placement,this._showCollisionBoxes,w,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const Tn=512/u.EXTENT/2;class Yo{constructor(n,l,p){this.tileID=n,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(let _=0;_<l.length;_++){const x=l.get(_),w=x.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,n)})}}getScaledCoordinates(n,l){const p=Tn/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*u.EXTENT+n.tileAnchorX)*p),y:Math.floor((l.canonical.y*u.EXTENT+n.tileAnchorY)*p)}}findMatches(n,l,p){const _=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let x=0;x<n.length;x++){const w=n.get(x);if(w.crossTileID)continue;const S=this.indexedSymbolInstances[w.key];if(!S)continue;const F=this.getScaledCoordinates(w,l);for(const O of S)if(Math.abs(O.coord.x-F.x)<=_&&Math.abs(O.coord.y-F.y)<=_&&!p[O.crossTileID]){p[O.crossTileID]=!0,w.crossTileID=O.crossTileID;break}}}}class Ko{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class An{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const l=Math.round((n-this.lng)/360);if(0!==l)for(const p in this.indexes){const _=this.indexes[p],x={};for(const w in _){const S=_[w];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+l),x[S.tileID.key]=S}this.indexes[p]=x}this.lng=n}addBucket(n,l,p){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let x=0;x<l.symbolInstances.length;x++)l.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]={});const _=this.usedCrossTileIDs[n.overscaledZ];for(const x in this.indexes){const w=this.indexes[x];if(Number(x)>n.overscaledZ)for(const S in w){const F=w[S];F.tileID.isChildOf(n)&&F.findMatches(l.symbolInstances,n,_)}else{const S=w[n.scaledTo(Number(x)).key];S&&S.findMatches(l.symbolInstances,n,_)}}for(let x=0;x<l.symbolInstances.length;x++){const w=l.symbolInstances.get(x);w.crossTileID||(w.crossTileID=p.generate(),_[w.crossTileID]=!0)}return void 0===this.indexes[n.overscaledZ]&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new Yo(n,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(n,l){for(const p in l.indexedSymbolInstances)for(const _ of l.indexedSymbolInstances[p])delete this.usedCrossTileIDs[n][_.crossTileID]}removeStaleBuckets(n){let l=!1;for(const p in this.indexes){const _=this.indexes[p];for(const x in _)n[_[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,_[x]),delete _[x],l=!0)}return l}}class Ra{constructor(){this.layerIndexes={},this.crossTileIDs=new Ko,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,l,p,_){let x=this.layerIndexes[n.id];void 0===x&&(x=this.layerIndexes[n.id]=new An);let w=!1;const S={};"globe"!==_.name&&x.handleWrapJump(p);for(const F of l){const O=F.getBucket(n);O&&n.id===O.layerIds[0]&&(O.bucketInstanceId||(O.bucketInstanceId=++this.maxBucketInstanceId),x.addBucket(F.tileID,O,this.crossTileIDs)&&(w=!0),S[O.bucketInstanceId]=!0)}return x.removeStaleBuckets(S)&&(w=!0),w}pruneUnusedLayers(n){const l={};n.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const Ds=(f,n)=>u.emitValidationErrors(f,n&&n.filter(l=>"source.canvas"!==l.identifier)),Cs=u.pick(nt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),zi=u.pick(nt,["setCenter","setZoom","setBearing","setPitch"]),kr=function(){const f={},n=u.spec.$version;for(const l in u.spec.$root){const p=u.spec.$root[l];if(p.required){let _=null;_="version"===l?n:"array"===p.type?[]:{},null!=_&&(f[l]=_)}}return f}(),Ol={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Bi extends u.Evented{constructor(n,l={}){super(),this.map=n,this.dispatcher=new He(Ee(),this),this.imageManager=new It,this.imageManager.setEventedParent(this),this.glyphManager=new u.GlyphManager(n._requestManager,l.localFontFamily?u.LocalGlyphMode.all:l.localIdeographFontFamily?u.LocalGlyphMode.ideographs:u.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.lineAtlas=new u.LineAtlas(256,512),this.crossTileSymbolIndex=new Ra,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new u.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const p=this;this._rtlTextPluginCallback=Bi.registerForPluginStateChange(_=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(x,w)=>{if(u.triggerPluginCompletionEvent(x),w&&w.every(S=>S))for(const S in p._sourceCaches){const F=p._sourceCaches[S],O=F.getSource().type;"vector"!==O&&"geojson"!==O||F.reload()}})}),this.on("data",_=>{if("source"!==_.dataType||"metadata"!==_.sourceDataType)return;const x=this.getSource(_.sourceId);if(x&&x.vectorLayerIds)for(const w in this._layers){const S=this._layers[w];S.source===x.id&&this._validateLayer(S)}})}loadURL(n,l={}){this.fire(new u.Event("dataloading",{dataType:"style"}));const p="boolean"==typeof l.validate?l.validate:!u.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,l.accessToken);const _=this.map._requestManager.transformRequest(n,u.ResourceType.Style);this._request=u.getJSON(_,(x,w)=>{this._request=null,x?this.fire(new u.ErrorEvent(x)):w&&this._load(w,p)})}loadJSON(n,l={}){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.exported.frame(()=>{this._request=null,this._load(n,!1!==l.validate)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(kr,!1)}_updateLayerCount(n,l){const p=l?1:-1;n.is3D()&&(this._num3DLayers+=p),"circle"===n.type&&(this._numCircleLayers+=p),"symbol"===n.type&&(this._numSymbolLayers+=p)}_load(n,l){if(l&&Ds(this,u.validateStyle(n)))return;this._loaded=!0,this.stylesheet=n,this.updateProjection();for(const _ in n.sources)this.addSource(_,n.sources[_],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const p=Xe(this.stylesheet.layers);this._order=p.map(_=>_.id),this._layers={},this._serializedLayers={};for(let _ of p)_=u.createStyleLayer(_),_.setEventedParent(this,{layer:{id:_.id}}),this._layers[_.id]=_,this._serializedLayers[_.id]=_.serialize(),this._updateLayerCount(_,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new xn(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}terrainSetForDrapingOnly(){return this.terrain&&0===this.terrain.drapeRenderMode}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this.updateProjection()}updateProjection(){const n=this.map.transform.projection,l=this.map.transform.setProjection(this.map._runtimeProjection||(this.stylesheet?this.stylesheet.projection:void 0)),p=this.map.transform.projection;if(this._loaded&&(p.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null)),this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),l){if(p.isReprojectedInTileSpace||n.isReprojectedInTileSpace){this.map.painter.clearBackgroundTiles();for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()}else this._forceSymbolLayerUpdate();this.map._update(!0)}}_loadSprite(n){this._spriteRequest=function(l,p,_){let x,w,S;const F=u.exported.devicePixelRatio>1?"@2x":"";let O=u.getJSON(p.transformRequest(p.normalizeSpriteURL(l,F,".json"),u.ResourceType.SpriteJSON),(K,re)=>{O=null,S||(S=K,x=re,$())}),N=u.getImage(p.transformRequest(p.normalizeSpriteURL(l,F,".png"),u.ResourceType.SpriteImage),(K,re)=>{N=null,S||(S=K,w=re,$())});function $(){if(S)_(S);else if(x&&w){const K=u.exported.getImageData(w),re={};for(const te in x){const{width:ie,height:xe,x:ee,y:ge,sdf:me,pixelRatio:fe,stretchX:pe,stretchY:be,content:ze}=x[te],Ge=new u.RGBAImage({width:ie,height:xe});u.RGBAImage.copy(K,Ge,{x:ee,y:ge},{x:0,y:0},{width:ie,height:xe}),re[te]={data:Ge,pixelRatio:fe,sdf:me,stretchX:pe,stretchY:be,content:ze}}_(null,re)}}return{cancel(){O&&(O.cancel(),O=null),N&&(N.cancel(),N=null)}}}(n,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new u.ErrorEvent(l));else if(p)for(const _ in p)this.imageManager.addImage(_,p[_]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new u.Event("data",{dataType:"style"}))})}_validateLayer(n){const l=this.getSource(n.source);if(!l)return;const p=n.sourceLayer;p&&("geojson"===l.type||l.vectorLayerIds&&-1===l.vectorLayerIds.indexOf(p))&&this.fire(new u.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const l=[];for(const p of n){const _=this._layers[p];"custom"!==_.type&&l.push(_.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&Ol[n.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const l=this._changed;if(this._changed){const _=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(_.length||x.length)&&this._updateWorkerLayers(_,x);for(const w in this._updatedSources){const S=this._updatedSources[w];"reload"===S?this._reloadSource(w):"clear"===S&&this._clearSource(w)}this._updateTilesForChangedImages();for(const w in this._updatedPaintProps)this._layers[w].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const p={};for(const _ in this._sourceCaches){const x=this._sourceCaches[_];p[_]=x.used,x.used=!1}for(const _ of this._order){const x=this._layers[_];if(x.recalculate(n,this._availableImages),!x.isHidden(n.zoom)){const S=this._getLayerSourceCache(x);S&&(S.used=!0)}const w=this.map.painter;if(w){const S=x.getProgramIds();if(!S)continue;const F=x.getProgramConfiguration(n.zoom);for(const O of S)w.useProgram(O,F)}}for(const _ in p){const x=this._sourceCaches[_];p[_]!==x.used&&x.getSource().fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:x.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Ds(this,u.validateStyle(n)))return!1;(n=u.clone$1(n)).layers=Xe(n.layers);const l=function(_,x){if(!_)return[{command:nt.setStyle,args:[x]}];let w=[];try{if(!Et(_.version,x.version))return[{command:nt.setStyle,args:[x]}];Et(_.center,x.center)||w.push({command:nt.setCenter,args:[x.center]}),Et(_.zoom,x.zoom)||w.push({command:nt.setZoom,args:[x.zoom]}),Et(_.bearing,x.bearing)||w.push({command:nt.setBearing,args:[x.bearing]}),Et(_.pitch,x.pitch)||w.push({command:nt.setPitch,args:[x.pitch]}),Et(_.sprite,x.sprite)||w.push({command:nt.setSprite,args:[x.sprite]}),Et(_.glyphs,x.glyphs)||w.push({command:nt.setGlyphs,args:[x.glyphs]}),Et(_.transition,x.transition)||w.push({command:nt.setTransition,args:[x.transition]}),Et(_.light,x.light)||w.push({command:nt.setLight,args:[x.light]}),Et(_.fog,x.fog)||w.push({command:nt.setFog,args:[x.fog]}),Et(_.projection,x.projection)||w.push({command:nt.setProjection,args:[x.projection]});const S={},F=[];!function($,K,re,te){let ie;for(ie in K=K||{},$=$||{})$.hasOwnProperty(ie)&&(K.hasOwnProperty(ie)||Ht(ie,re,te));for(ie in K)K.hasOwnProperty(ie)&&($.hasOwnProperty(ie)?Et($[ie],K[ie])||("geojson"===$[ie].type&&"geojson"===K[ie].type&&ve($,K,ie)?re.push({command:nt.setGeoJSONSourceData,args:[ie,K[ie].data]}):Kt(ie,K,re,te)):it(ie,K,re))}(_.sources,x.sources,F,S);const O=[];_.layers&&_.layers.forEach($=>{S[$.source]?w.push({command:nt.removeLayer,args:[$.id]}):O.push($)});let N=_.terrain;N&&S[N.source]&&(w.push({command:nt.setTerrain,args:[void 0]}),N=void 0),w=w.concat(F),Et(N,x.terrain)||w.push({command:nt.setTerrain,args:[x.terrain]}),function($,K,re){K=K||[];const te=($=$||[]).map(ae),ie=K.map(ae),xe=$.reduce(Se,{}),ee=K.reduce(Se,{}),ge=te.slice(),me=Object.create(null);let fe,pe,be,ze,Ge,bt,ht;for(fe=0,pe=0;fe<te.length;fe++)be=te[fe],ee.hasOwnProperty(be)?pe++:(re.push({command:nt.removeLayer,args:[be]}),ge.splice(ge.indexOf(be,pe),1));for(fe=0,pe=0;fe<ie.length;fe++)be=ie[ie.length-1-fe],ge[ge.length-1-fe]!==be&&(xe.hasOwnProperty(be)?(re.push({command:nt.removeLayer,args:[be]}),ge.splice(ge.lastIndexOf(be,ge.length-pe),1)):pe++,bt=ge[ge.length-fe],re.push({command:nt.addLayer,args:[ee[be],bt]}),ge.splice(ge.length-fe,0,be),me[be]=!0);for(fe=0;fe<ie.length;fe++)if(be=ie[fe],ze=xe[be],Ge=ee[be],!me[be]&&!Et(ze,Ge))if(Et(ze.source,Ge.source)&&Et(ze["source-layer"],Ge["source-layer"])&&Et(ze.type,Ge.type)){for(ht in de(ze.layout,Ge.layout,re,be,null,nt.setLayoutProperty),de(ze.paint,Ge.paint,re,be,null,nt.setPaintProperty),Et(ze.filter,Ge.filter)||re.push({command:nt.setFilter,args:[be,Ge.filter]}),Et(ze.minzoom,Ge.minzoom)&&Et(ze.maxzoom,Ge.maxzoom)||re.push({command:nt.setLayerZoomRange,args:[be,Ge.minzoom,Ge.maxzoom]}),ze)ze.hasOwnProperty(ht)&&"layout"!==ht&&"paint"!==ht&&"filter"!==ht&&"metadata"!==ht&&"minzoom"!==ht&&"maxzoom"!==ht&&(0===ht.indexOf("paint.")?de(ze[ht],Ge[ht],re,be,ht.slice(6),nt.setPaintProperty):Et(ze[ht],Ge[ht])||re.push({command:nt.setLayerProperty,args:[be,ht,Ge[ht]]}));for(ht in Ge)Ge.hasOwnProperty(ht)&&!ze.hasOwnProperty(ht)&&"layout"!==ht&&"paint"!==ht&&"filter"!==ht&&"metadata"!==ht&&"minzoom"!==ht&&"maxzoom"!==ht&&(0===ht.indexOf("paint.")?de(ze[ht],Ge[ht],re,be,ht.slice(6),nt.setPaintProperty):Et(ze[ht],Ge[ht])||re.push({command:nt.setLayerProperty,args:[be,ht,Ge[ht]]}))}else re.push({command:nt.removeLayer,args:[be]}),bt=ge[ge.lastIndexOf(be)+1],re.push({command:nt.addLayer,args:[Ge,bt]})}(O,x.layers,w)}catch(S){console.warn("Unable to compute style diff:",S),w=[{command:nt.setStyle,args:[x]}]}return w}(this.serialize(),n).filter(_=>!(_.command in zi));if(0===l.length)return!1;const p=l.filter(_=>!(_.command in Cs));if(p.length>0)throw new Error(`Unimplemented: ${p.map(_=>_.command).join(", ")}.`);return l.forEach(_=>{"setTransition"!==_.command&&this[_.command].apply(this,_.args)}),this.stylesheet=n,this.updateProjection(),!0}addImage(n,l){if(this.getImage(n))return this.fire(new u.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(n,l),this._afterImageUpdated(n)}updateImage(n,l){this.imageManager.updateImage(n,l)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){if(!this.getImage(n))return this.fire(new u.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(n),this._afterImageUpdated(n)}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,l,p={}){if(this._checkLoaded(),void 0!==this.getSource(n))throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(u.validateStyle.source,`sources.${n}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const _=Sn(n,l,this.dispatcher,this);_.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:_.serialize(),sourceId:n}));const x=w=>{const S=(w?"symbol:":"other:")+n,F=this._sourceCaches[S]=new u.SourceCache(S,_,w);(w?this._symbolSourceCaches:this._otherSourceCaches)[n]=F,F.style=this,F.onAdd(this.map)};x(!1),"vector"!==l.type&&"geojson"!==l.type||x(!0),_.onAdd&&_.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const l=this.getSource(n);if(void 0===l)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===n)return this.fire(new u.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new u.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(n);for(const _ of p)delete this._sourceCaches[_.id],delete this._updatedSources[_.id],_.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles();delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(n,l){this._checkLoaded(),this.getSource(n).setData(l),this._changed=!0}getSource(n){const l=this._getSourceCache(n);return l&&l.getSource()}addLayer(n,l,p={}){this._checkLoaded();const _=n.id;if(this.getLayer(_))return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${_}" already exists on this map`)));let x;if("custom"===n.type){if(Ds(this,u.validateCustomStyleLayer(n)))return;x=u.createStyleLayer(n)}else{if("object"==typeof n.source&&(this.addSource(_,n.source),n=u.clone$1(n),n=u.extend(n,{source:_})),this._validate(u.validateStyle.layer,`layers.${_}`,n,{arrayIndex:-1},p))return;x=u.createStyleLayer(n),this._validateLayer(x),x.setEventedParent(this,{layer:{id:_}}),this._serializedLayers[x.id]=x.serialize(),this._updateLayerCount(x,!0)}const w=l?this._order.indexOf(l):this._order.length;if(l&&-1===w)return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(w,0,_),this._layerOrderChanged=!0,this._layers[_]=x;const S=this._getLayerSourceCache(x);if(this._removedLayers[_]&&x.source&&S&&"custom"!==x.type){const F=this._removedLayers[_];delete this._removedLayers[_],F.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",S.pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,l){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new u.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===l)return;const p=this._order.indexOf(n);this._order.splice(p,1);const _=l?this._order.indexOf(l):this._order.length;l&&-1===_?this.fire(new u.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(_,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const l=this._layers[n];if(!l)return void this.fire(new u.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(n);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=l,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const l in this._layers)if(this._layers[l].type===n)return!0;return!1}setLayerZoomRange(n,l,p){this._checkLoaded();const _=this.getLayer(n);_?_.minzoom===l&&_.maxzoom===p||(null!=l&&(_.minzoom=l),null!=p&&(_.maxzoom=p),this._updateLayer(_)):this.fire(new u.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,l,p={}){this._checkLoaded();const _=this.getLayer(n);if(_){if(!Et(_.filter,l))return null==l?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(u.validateStyle.filter,`layers.${_.id}.filter`,l,{layerType:_.type},p)||(_.filter=u.clone$1(l),this._updateLayer(_)))}else this.fire(new u.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){return u.clone$1(this.getLayer(n).filter)}setLayoutProperty(n,l,p,_={}){this._checkLoaded();const x=this.getLayer(n);x?Et(x.getLayoutProperty(l),p)||(x.setLayoutProperty(l,p,_),this._updateLayer(x)):this.fire(new u.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,l){const p=this.getLayer(n);if(p)return p.getLayoutProperty(l);this.fire(new u.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,l,p,_={}){this._checkLoaded();const x=this.getLayer(n);x?Et(x.getPaintProperty(l),p)||(x.setPaintProperty(l,p,_)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new u.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,l){return this.getLayer(n).getPaintProperty(l)}setFeatureState(n,l){this._checkLoaded();const p=n.source,_=n.sourceLayer,x=this.getSource(p);if(void 0===x)return void this.fire(new u.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const w=x.type;if("geojson"===w&&_)return void this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===w&&!_)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===n.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(p);for(const F of S)F.setFeatureState(_,n.id,l)}removeFeatureState(n,l){this._checkLoaded();const p=n.source,_=this.getSource(p);if(void 0===_)return void this.fire(new u.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const x=_.type,w="vector"===x?n.sourceLayer:void 0;if("vector"===x&&!w)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&"string"!=typeof n.id&&"number"!=typeof n.id)return void this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(p);for(const F of S)F.removeFeatureState(w,n.id,l)}getFeatureState(n){this._checkLoaded();const l=n.source,p=n.sourceLayer,_=this.getSource(l);if(void 0!==_){if("vector"!==_.type||p)return void 0===n.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,n.id);this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new u.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();n[p.id]||(n[p.id]=p.serialize())}return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},l=>void 0!==l)}_updateLayer(n){this._updatedLayers[n.id]=!0;const l=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&l&&"raster"!==l.getSource().type&&(this._updatedSources[n.source]="reload",l.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const l=w=>"fill-extrusion"===this._layers[w].type,p={},_=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(l(S)){p[S]=w;for(const F of n){const O=F[S];if(O)for(const N of O)_.push(N)}}}_.sort((w,S)=>S.intersectionZ-w.intersectionZ);const x=[];for(let w=this._order.length-1;w>=0;w--){const S=this._order[w];if(l(S))for(let F=_.length-1;F>=0;F--){const O=_[F].feature;if(p[O.layer.id]<w)break;x.push(O),_.pop()}else for(const F of n){const O=F[S];if(O)for(const N of O)x.push(N.feature)}}return x}queryRenderedFeatures(n,l,p){l&&l.filter&&this._validate(u.validateStyle.filter,"queryRenderedFeatures.filter",l.filter,null,l);const _={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const F of l.layers){const O=this._layers[F];if(!O)return this.fire(new u.ErrorEvent(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];_[O.source]=!0}}const x=[];l.availableImages=this._availableImages;const w=l&&l.layers?l.layers.some(F=>{const O=this.getLayer(F);return O&&O.is3D()}):this.has3DLayers(),S=Zn.createFromScreenPoints(n,p);for(const F in this._sourceCaches){const O=this._sourceCaches[F].getSource().id;l.layers&&!_[O]||x.push(V(this._sourceCaches[F],this._layers,this._serializedLayers,S,l,p,w,!!this.map._showQueryGeometry))}return this.placement&&x.push(function(F,O,N,$,K,re,te){const ie={},xe=re.queryRenderedSymbols($),ee=[];for(const ge of Object.keys(xe).map(Number))ee.push(te[ge]);ee.sort(se);for(const ge of ee){const me=ge.featureIndex.lookupSymbolFeatures(xe[ge.bucketInstanceId],O,ge.bucketIndex,ge.sourceLayerIndex,K.filter,K.layers,K.availableImages,F);for(const fe in me){const pe=ie[fe]=ie[fe]||[],be=me[fe];be.sort((ze,Ge)=>{const bt=ge.featureSortOrder;if(bt){const ht=bt.indexOf(ze.featureIndex);return bt.indexOf(Ge.featureIndex)-ht}return Ge.featureIndex-ze.featureIndex});for(const ze of be)pe.push(ze)}}for(const ge in ie)ie[ge].forEach(me=>{const fe=me.feature,pe=N(F[ge]).getFeatureState(fe.layer["source-layer"],fe.id);fe.source=fe.layer.source,fe.layer["source-layer"]&&(fe.sourceLayer=fe.layer["source-layer"]),fe.state=pe});return ie}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(n,l){l&&l.filter&&this._validate(u.validateStyle.filter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(n);let _=[];for(const x of p)_=_.concat(Z(x,l));return _}addSourceType(n,l,p){return Bi.getSourceType(n)?p(new Error(`A source type called "${n}" already exists.`)):(Bi.setSourceType(n,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(n,l={}){this._checkLoaded();const p=this.light.getLight();let _=!1;for(const w in n)if(!Et(n[w],p[w])){_=!0;break}if(!_)return;const x={now:u.exported.now(),transition:u.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(n,l),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,l=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===l){if("object"==typeof n.source){const p="terrain-dem-src";this.addSource(p,n.source),n=u.clone$1(n),n=u.extend(n,{source:p})}if(this._validate(u.validateStyle.terrain,"terrain",n))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode)this._createTerrain(n,l);else{const p=this.terrain,_=p.get();for(const x in n)if(!Et(n[x],_[x])){p.set(n),this.stylesheet.terrain=n;const w={now:u.exported.now(),transition:u.extend({duration:0},this.stylesheet.transition)};p.updateTransitions(w);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const l=this.fog=new $e(n,this.map.transform);this.stylesheet.fog=n;const p={now:u.exported.now(),transition:u.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(p)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();for(const _ in n)if(!Et(n[_],p[_])){l.set(n),this.stylesheet.fog=n;const x={now:u.exported.now(),transition:u.extend({duration:0},this.stylesheet.transition)};l.updateTransitions(x);break}}else this._createFog(n);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...l)}_createTerrain(n,l){const p=this.terrain=new fn(n,l);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();const _={now:u.exported.now(),transition:u.extend({duration:0},this.stylesheet.transition)};p.updateTransitions(_)}_force3DLayerUpdate(){for(const n in this._layers){const l=this._layers[n];"fill-extrusion"===l.type&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const l=this._layers[n];"symbol"===l.type&&this._updateLayer(l)}}_validate(n,l,p,_,x={}){return(!x||!1!==x.validate)&&Ds(this,n.call(u.validateStyle,u.extend({key:l,style:this.serialize(),value:p,styleSpec:u.spec},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const l=this._getSourceCaches(n);for(const p of l)p.clearTiles()}_reloadSource(n){const l=this._getSourceCaches(n);for(const p of l)p.resume(),p.reload()}_updateSources(n){for(const l in this._sourceCaches)this._sourceCaches[l].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const l=this._sourceCaches[n];l.resume(),l.reload()}}_updatePlacement(n,l,p,_,x=!1){let w=!1,S=!1;const F={};for(const O of this._order){const N=this._layers[O];if("symbol"!==N.type)continue;if(!F[N.source]){const K=this._getLayerSourceCache(N);if(!K)continue;F[N.source]=K.getRenderableIds(!0).map(re=>K.getTileByID(re)).sort((re,te)=>te.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(te.tileID)?-1:1))}const $=this.crossTileSymbolIndex.addLayer(N,F[N.source],n.center.lng,n.projection);w=w||$}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),x=x||this._layerOrderChanged||0===p,this._layerOrderChanged&&this.fire(new u.Event("neworder")),(x||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.exported.now(),n.zoom))&&(this.pauseablePlacement=new In(n,this._order,x,l,p,_,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,F),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.exported.now()),S=!0),w&&this.pauseablePlacement.placement.setStale()),S||w)for(const O of this._order){const N=this._layers[O];"symbol"===N.type&&this.placement.updateLayerOpacities(N,F[N.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const _=x=>{x&&x.setDependencies(l.tileID.key,l.type,l.icons)};_(this._otherSourceCaches[l.source]),_(this._symbolSourceCaches[l.source])}getGlyphs(n,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(n,l,p){return u.makeRequest(l,p)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return"symbol"===n.type?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const l=[];return this._otherSourceCaches[n]&&l.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&l.push(this._symbolSourceCaches[n]),l}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Bi.getSourceType=function(f){return ro[f]},Bi.setSourceType=function(f,n){ro[f]=n},Bi.registerForPluginStateChange=u.registerForPluginStateChange;var ol="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Ss="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ms={},Is={};Ms=bn("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Is=bn("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Un=bn("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {\n#if defined(PROJECTION_GLOBE_VIEW) && !defined(PROJECTED_POS_ON_VIEWPORT)\nreturn mix(globe,mercator,t);\n#else\nreturn globe;\n#endif\n}\n#ifdef PROJECTION_GLOBE_VIEW\nmat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),qs=ol;var ca={background:bn("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:bn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:bn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:bn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:bn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:bn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:bn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:bn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:bn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:bn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:bn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:bn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:bn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:bn("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:bn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:bn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:bn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:bn("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:bn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:bn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:bn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:bn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:bn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchorZ=a_z_tile_anchor.x;vec2 tileAnchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tileAnchor)*elevation(tileAnchor);vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tileAnchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchorZ)+h,mercator_pos,u_zoom_transition);vec4 projectedPoint=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),anchorZ,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchorZ),mercator_pos,u_zoom_transition);\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:bn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:bn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:bn("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ss),skyboxGradient:bn("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ss),skyboxCapture:bn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:bn("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;varying vec2 v_pos0;const float wireframeOffset=1e3;void main() {v_pos0=a_uv;vec2 uv=a_uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(a_globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(a_merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:bn("uniform vec2 u_center;uniform float u_radius;uniform vec2 u_screen_size;uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform float u_pixel_ratio;void main() {highp vec2 fragCoord=gl_FragCoord.xy/u_pixel_ratio;fragCoord.y=u_screen_size.y-fragCoord.y;float distFromCenter=length(fragCoord-u_center);float normDistFromCenter=length(fragCoord-u_center)/u_radius;if (normDistFromCenter < 1.0)\ndiscard;float t=clamp(1.0-sqrt(normDistFromCenter-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;void main() {gl_Position=vec4(a_pos,1.0);}")};function bn(f,n,l){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,x=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),w=f.match(_),S=n.match(_),F=ol.match(_);let O=S?S.concat(w):w;l||(Ms.staticUniforms&&(O=Ms.staticUniforms.concat(O)),Is.staticUniforms&&(O=Is.staticUniforms.concat(O))),O&&(O=O.concat(F));const N={};return{fragmentSource:f=f.replace(p,($,K,re,te,ie)=>(N[ie]=!0,"define"===K?`\n#ifndef HAS_UNIFORM_u_${ie}\nvarying ${re} ${te} ${ie};\n#else\nuniform ${re} ${te} u_${ie};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${ie}\n    ${re} ${te} ${ie} = u_${ie};\n#endif\n`)),vertexSource:n=n.replace(p,($,K,re,te,ie)=>{const xe="float"===te?"vec2":"vec4",ee=ie.match(/color/)?"color":xe;return N[ie]?"define"===K?`\n#ifndef HAS_UNIFORM_u_${ie}\nuniform lowp float u_${ie}_t;\nattribute ${re} ${xe} a_${ie};\nvarying ${re} ${te} ${ie};\n#else\nuniform ${re} ${te} u_${ie};\n#endif\n`:"vec4"===ee?`\n#ifndef HAS_UNIFORM_u_${ie}\n    ${ie} = a_${ie};\n#else\n    ${re} ${te} ${ie} = u_${ie};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${ie}\n    ${ie} = unpack_mix_${ee}(a_${ie}, u_${ie}_t);\n#else\n    ${re} ${te} ${ie} = u_${ie};\n#endif\n`:"define"===K?`\n#ifndef HAS_UNIFORM_u_${ie}\nuniform lowp float u_${ie}_t;\nattribute ${re} ${xe} a_${ie};\n#else\nuniform ${re} ${te} u_${ie};\n#endif\n`:"vec4"===ee?`\n#ifndef HAS_UNIFORM_u_${ie}\n    ${re} ${te} ${ie} = a_${ie};\n#else\n    ${re} ${te} ${ie} = u_${ie};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${ie}\n    ${re} ${te} ${ie} = unpack_mix_${ee}(a_${ie}, u_${ie}_t);\n#else\n    ${re} ${te} ${ie} = u_${ie};\n#endif\n`}),staticAttributes:x,staticUniforms:O}}class so{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(n,l,p,_,x,w,S,F){this.context=n;let O=this.boundPaintVertexBuffers.length!==_.length;for(let N=0;!O&&N<_.length;N++)this.boundPaintVertexBuffers[N]!==_[N]&&(O=!0);n.extVertexArrayObject&&this.vao&&this.boundProgram===l&&this.boundLayoutVertexBuffer===p&&!O&&this.boundIndexBuffer===x&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===F?(n.bindVertexArrayOES.set(this.vao),S&&S.bind(),x&&x.dynamicDraw&&x.bind(),F&&F.bind()):this.freshBind(l,p,_,x,w,S,F)}freshBind(n,l,p,_,x,w,S){let F;const O=n.numAttributes,N=this.context,$=N.gl;if(N.extVertexArrayObject)this.vao&&this.destroy(),this.vao=N.extVertexArrayObject.createVertexArrayOES(),N.bindVertexArrayOES.set(this.vao),F=0,this.boundProgram=n,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=_,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=S;else{F=N.currentNumAttributes||0;for(let K=O;K<F;K++)$.disableVertexAttribArray(K)}l.enableAttributes($,n);for(const K of p)K.enableAttributes($,n);w&&w.enableAttributes($,n),S&&S.enableAttributes($,n),l.bind(),l.setVertexAttribPointers($,n,x);for(const K of p)K.bind(),K.setVertexAttribPointers($,n,x);w&&(w.bind(),w.setVertexAttribPointers($,n,x)),_&&_.bind(),S&&(S.bind(),S.setVertexAttribPointers($,n,x)),N.currentNumAttributes=O}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function gs(f,n){const l=Math.pow(2,n.canonical.z),p=n.canonical.y;return[new u.MercatorCoordinate(0,p/l).toLngLat().lat,new u.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function ua(f,n,l,p,_,x,w){const S=f.context,F=S.gl,O=l.fbo;if(!O)return;f.prepareDrawTile(n);const N=f.useProgram("hillshade");S.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_2D,O.colorAttachment.get());const $=((ie,xe,ee,ge)=>{const me=ee.paint.get("hillshade-shadow-color"),fe=ee.paint.get("hillshade-highlight-color"),pe=ee.paint.get("hillshade-accent-color");let be=ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ee.paint.get("hillshade-illumination-anchor")&&(be-=ie.transform.angle);const ze=!ie.options.moving;return{u_matrix:ge||ie.transform.calculateProjMatrix(xe.tileID.toUnwrapped(),ze),u_image:0,u_latrange:gs(0,xe.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),be],u_shadow:me,u_highlight:fe,u_accent:pe}})(f,l,p,f.terrain?n.projMatrix:null);f.prepareDrawProgram(S,N,n.toUnwrapped());const{tileBoundsBuffer:K,tileBoundsIndexBuffer:re,tileBoundsSegments:te}=f.getTileBoundsBuffers(l);N.draw(S,F.TRIANGLES,_,x,w,u.CullFaceMode.disabled,$,p.id,K,re,te)}function Ur(f,n,l){if(!n.needsDEMTextureUpload)return;const p=f.context,_=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||f.getTileTexture(l.stride);const x=l.getPixels();n.demTexture?n.demTexture.update(x,{premultiply:!1}):n.demTexture=new u.Texture(p,x,_.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function ha(f,n,l,p,_,x){const w=f.context,S=w.gl;if(!n.dem)return;const F=n.dem;if(w.activeTexture.set(S.TEXTURE1),Ur(f,n,F),!n.demTexture)return;n.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const O=F.dim;w.activeTexture.set(S.TEXTURE0);let N=n.fbo;if(!N){const te=new u.Texture(w,{width:O,height:O,data:null},S.RGBA);te.bind(S.LINEAR,S.CLAMP_TO_EDGE),N=n.fbo=w.createFramebuffer(O,O,!0),N.colorAttachment.set(te.texture)}w.bindFramebuffer.set(N.framebuffer),w.viewport.set([0,0,O,O]);const{tileBoundsBuffer:$,tileBoundsIndexBuffer:K,tileBoundsSegments:re}=f.getMercatorTileBoundsBuffers();f.useProgram("hillshadePrepare").draw(w,S.TRIANGLES,p,_,x,u.CullFaceMode.disabled,((te,ie)=>{const xe=ie.stride,ee=u.create();return u.ortho(ee,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(ee,ee,[0,-u.EXTENT,0]),{u_matrix:ee,u_image:1,u_dimension:[xe,xe],u_zoom:te.overscaledZ,u_unpack:ie.unpackVector}})(n.tileID,F),l.id,$,K,re),n.needsHillshadePrepare=!1}const As=(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_image0:new u.Uniform1i(f,n.u_image0),u_skirt_height:new u.Uniform1f(f,n.u_skirt_height)}),bi=(f,n)=>({u_matrix:f,u_image0:0,u_skirt_height:n}),Ws=(f,n,l,p,_)=>({u_proj_matrix:Float32Array.from(f),u_globe_matrix:n,u_merc_matrix:l,u_zoom_transition:p,u_merc_center:_,u_image0:0});function ni(f,n){return null!=f&&null!=n&&!(!f.hasData()||!n.hasData())&&null!=f.demTexture&&null!=n.demTexture&&f.tileID.key!==n.tileID.key}const Fo=new class{constructor(){this.operations={}}newMorphing(f,n,l,p,_){if(f in this.operations){const x=this.operations[f];x.to.tileID.key!==l.tileID.key&&(x.queued=l)}else this.operations[f]={startTime:p,phase:0,duration:_,from:n,to:l,queued:null}}getMorphValuesForProxy(f){if(!(f in this.operations))return null;const n=this.operations[f];return{from:n.from,to:n.to,phase:n.phase}}update(f){for(const n in this.operations){const l=this.operations[n];for(l.phase=(f-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,f)){delete this.operations[n];break}}}_nextOp(f,n){return!!f.queued&&(f.from=f.to,f.to=f.queued,f.queued=null,f.phase=0,f.startTime=n,!0)}_validOp(f){return f.from.hasData()&&f.to.hasData()}},ki={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function dc(f,n){const l=1<<f.z;return!n&&(0===f.x||f.x===l-1)||0===f.y||f.y===l-1}const ri=f=>({u_matrix:f});function La(f,n,l,p,_){if(_>0){const x=u.exported.now(),w=(x-f.timeAdded)/_,S=n?(x-n.timeAdded)/_:-1,F=l.getSource(),O=p.coveringZoomLevel({tileSize:F.tileSize,roundZoom:F.roundZoom}),N=!n||Math.abs(n.tileID.overscaledZ-O)>Math.abs(f.tileID.overscaledZ-O),$=N&&f.refreshedUponExpiration?1:u.clamp(N?w:1-S,0,1);return f.refreshedUponExpiration&&w>=1&&(f.refreshedUponExpiration=!1),n?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}class z extends u.SourceCache{constructor(n){const l={type:"raster-dem",maxzoom:n.transform.maxZoom},p=new He(Ee(),null),_=Sn("mock-dem",l,p,n.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,l){n.state="loaded",l(null)}}class W extends u.SourceCache{constructor(n){const l=Sn("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new He(Ee(),null),n.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,l,p){if(n.freezeTileCoverage)return;this.transform=n;const _=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((x,w)=>{if(x[w.key]="",!this._tiles[w.key]){const S=new u.Tile(w,this._source.tileSize*w.overscaleFactor(),n.tileZoom);S.state="loaded",this._tiles[w.key]=S}return x},{});for(const x in this._tiles)x in _||(this.freeFBO(x),this._tiles[x].unloadVectorData(),delete this._tiles[x])}freeFBO(n){const l=this.proxyCachedFBO[n];if(void 0!==l){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class B extends u.OverscaledTileID{constructor(n,l,p){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class J extends u.Elevation{constructor(n,l){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,_,x]=function(F){const O=new u.StructArrayLayout4i8,N=new u.StructArrayLayout3ui6,$=131;O.reserve(17161),N.reserve(33800);const K=u.EXTENT/128,re=u.EXTENT+K/2,te=re+K;for(let xe=-K;xe<te;xe+=K)for(let ee=-K;ee<te;ee+=K){const ge=ee<0||ee>re||xe<0||xe>re?24575:0,me=u.clamp(Math.round(ee),0,u.EXTENT),fe=u.clamp(Math.round(xe),0,u.EXTENT);O.emplaceBack(me+ge,fe,me,fe)}const ie=(xe,ee)=>{const ge=ee*$+xe;N.emplaceBack(ge+1,ge,ge+$),N.emplaceBack(ge+$,ge+$+1,ge+1)};for(let xe=1;xe<129;xe++)for(let ee=1;ee<129;ee++)ie(ee,xe);return[0,129].forEach(xe=>{for(let ee=0;ee<130;ee++)ie(ee,xe),ie(xe,ee)}),[O,N,32768]}(),w=n.context;this.gridBuffer=w.createVertexBuffer(p,u.boundsAttributes.members),this.gridIndexBuffer=w.createIndexBuffer(_),this.gridSegments=u.SegmentVector.simpleSegment(0,0,p.length,_.length),this.gridNoSkirtSegments=u.SegmentVector.simpleSegment(0,0,p.length,x),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new W(l.map),this.orthoMatrix=u.create(),u.ortho(this.orthoMatrix,0,u.EXTENT,0,u.EXTENT,0,1);const S=w.gl;this._overlapStencilMode=new u.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new z(l.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency()}update(n,l,p){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const _=n.terrain.properties;this.sourceCache=0===n.terrain.drapeRenderMode?this._mockSourceCache:n._getSourceCache(_.get("source")),this._exaggeration=_.get("exaggeration");const x=()=>{this.sourceCache.used&&u.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const w=this.getScaledDemTileSize();this.sourceCache.update(l,w,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,x(),this._initializing=!0),x(),l.updateElevation(!p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==n.efficiency&&u.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&"source"===n.dataType?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):"style"===n.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=0===p._centerAltitude&&-1===this.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(p.center),-1),this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=l.getIds().map(F=>{const O=l.getTileByID(F).tileID;return O.projMatrix=p.calculateProjMatrix(O.toUnwrapped()),O});(function(F,O){const N=O.transform.pointCoordinate(O.transform.getCameraPoint()),$=new u.pointGeometry(N.x,N.y);F.sort((K,re)=>{if(re.overscaledZ-K.overscaledZ)return re.overscaledZ-K.overscaledZ;const te=new u.pointGeometry(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),ie=new u.pointGeometry(re.canonical.x+(1<<re.canonical.z)*re.wrap,re.canonical.y),xe=$.mult(1<<K.canonical.z);return xe.x-=.5,xe.y-=.5,xe.distSqr(te)-xe.distSqr(ie)})})(_,this.painter),this._previousZoom=p.zoom;const x=this.proxyToSource||{};this.proxyToSource={},_.forEach(F=>{this.proxyToSource[F.key]={}}),this.terrainTileForTile={};const w=this._style._sourceCaches;for(const F in w){const O=w[F];if(!O.used||(O!==this.sourceCache&&this.resetTileLookupCache(O.id),this._setupProxiedCoordsForOrtho(O,n[F],x),O.usedForTerrain))continue;const N=n[F];O.getSource().reparseOverscaled&&this._assignTerrainTiles(N)}this.proxiedCoords[l.id]=_.map(F=>new B(F,F.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(x),this.renderingToTexture=!1,this._updateTimestamp=u.exported.now();const S={};this._visibleDemTiles=[];for(const F of this.proxyCoords){const O=this.terrainTileForTile[F.key];if(!O)continue;const N=O.tileID.key;N in S||(this._visibleDemTiles.push(O),S[N]=N)}}_assignTerrainTiles(n){this._initializing||n.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const n=this.painter.context,l=n.gl;for(const p in this.terrainTileForTile){const _=this.terrainTileForTile[p],x=_.dem;!x||_.demTexture&&!_.needsDEMTextureUpload||(n.activeTexture.set(l.TEXTURE1),Ur(this.painter,_,x))}}_prepareDemTileUniforms(n,l,p,_){if(!l||null==l.demTexture)return!1;const x=n.tileID.canonical,w=Math.pow(2,l.tileID.canonical.z-x.z),S=_||"";return p[`u_dem_tl${S}`]=[x.x*w%1,x.y*w%1],p[`u_dem_scale${S}`]=w,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,l=n.gl;if(!this._emptyDepthBufferTexture){const p={width:1,height:1,data:new Uint8Array([255,255,255,255])};this._emptyDepthBufferTexture=new u.Texture(n,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const l=this._visibleDemTiles.reduce((p,_)=>{if(!_.dem)return p;const x=_.dem.tree.minimums[0];return x>0&&n++,p+x},0);return n?l/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,l=n.gl;n.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),_={width:1,height:1,data:new Uint8Array(u.DEMData.pack(p,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;let x=this._emptyDEMTexture;return x?x.update(_,{premultiply:!1}):x=this._emptyDEMTexture=new u.Texture(n,_,l.RGBA,{premultiply:!1}),x}setupElevationDraw(n,l,p){const _=this.painter.context,x=_.gl,w=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:u.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var S;w.u_dem_size=this.sourceCache.getSource().tileSize,w.u_exaggeration=this.exaggeration();const F=this.painter.transform,O=F.projection.createTileTransform(F,F.worldSize),N=n.tileID.canonical;w.u_tile_tl_up=O.upVector(N,0,0),w.u_tile_tr_up=O.upVector(N,u.EXTENT,0),w.u_tile_br_up=O.upVector(N,u.EXTENT,u.EXTENT),w.u_tile_bl_up=O.upVector(N,0,u.EXTENT),w.u_tile_up_scale=O.upVectorScale(N);let $=null,K=null,re=1;if(p&&p.morphing&&this._useVertexMorphing){const te=p.morphing.srcDemTile,ie=p.morphing.dstDemTile;re=p.morphing.phase,te&&ie&&(this._prepareDemTileUniforms(n,te,w,"_prev")&&(K=te),this._prepareDemTileUniforms(n,ie,w)&&($=ie))}if(K&&$?(_.activeTexture.set(x.TEXTURE2),$.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),_.activeTexture.set(x.TEXTURE4),K.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE,x.NEAREST),w.u_dem_lerp=re):($=this.terrainTileForTile[n.tileID.key],_.activeTexture.set(x.TEXTURE2),(this._prepareDemTileUniforms(n,$,w)?$.demTexture:this.emptyDEMTexture).bind(x.NEAREST,x.CLAMP_TO_EDGE)),_.activeTexture.set(x.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),w.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]):(this.emptyDepthBufferTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE),w.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&$){const te=(1<<$.tileID.canonical.z)*u.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;w.u_meter_to_dem=te}p&&p.labelPlaneMatrixInv&&(w.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(_,w)}renderToBackBuffer(n){const l=this.painter,p=this.painter.context;0!==n.length&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),this.renderingToTexture=!1,function(_,x,w,S,F){if("globe"===_.transform.projection.name)!function(O,N,$,K,re){const te=O.context,ie=te.gl;let xe,ee;const ge=O.options.showTerrainWireframe?2:0,me=(lt,Ke)=>{if(ee===lt)return;const Ue=[];Ke&&Ue.push(ki[ge]),Ue.push(ki[lt]),Ue.push("PROJECTION_GLOBE_VIEW"),xe=O.useProgram("globeRaster",null,Ue),ee=lt},fe=O.colorModeForRenderPass(),pe=new u.DepthMode(ie.LEQUAL,u.DepthMode.ReadWrite,O.depthRangeFor3D);Fo.update(re);const be=O.transform,ze=u.calculateGlobeMatrix(be,be.worldSize),Ge=u.calculateGlobeMercatorMatrix(be),bt=[u.mercatorXfromLng(be.center.lng),u.mercatorYfromLat(be.center.lat)],ht=O.globeSharedBuffers;(ge?[!1,!0]:[!1]).forEach(lt=>{ee=-1;const Ke=lt?ie.LINES:ie.TRIANGLES;for(const Ue of K){const ct=$.getTile(Ue),Qe=Math.pow(2,Ue.canonical.z),[Yt,on]=u.globeBuffersForTileMesh(O,ct,Ue,Qe),Ln=u.StencilMode.disabled,xt=N.prevTerrainTileForTile[Ue.key],ln=N.terrainTileForTile[Ue.key];ni(xt,ln)&&Fo.newMorphing(Ue.key,xt,ln,re,250),te.activeTexture.set(ie.TEXTURE0),ct.texture.bind(ie.LINEAR,ie.CLAMP_TO_EDGE);const yn=Fo.getMorphValuesForProxy(Ue.key),yr=yn?1:0,mr={};yn&&u.extend$1(mr,{morphing:{srcDemTile:yn.from,dstDemTile:yn.to,phase:u.easeCubicInOut(yn.phase)}});const mn=u.globeMatrixForTile(Ue.canonical,ze),Vn=Ws(be.projMatrix,mn,Ge,u.globeToMercatorTransition(be.zoom),bt);if(me(yr,lt),N.setupElevationDraw(ct,xe,mr),O.prepareDrawProgram(te,xe,Ue.toUnwrapped()),ht){const[Fn,wi]=lt?ht.getWirefameBuffer(O.context):[ht.gridIndexBuffer,ht.gridSegments];xe.draw(te,Ke,pe,Ln,fe,u.CullFaceMode.backCCW,Vn,"globe_raster",Yt,Fn,wi)}if(!lt){const Fn=[0===Ue.canonical.y?u.globePoleMatrixForTile(Ue.canonical,!1,be):null,Ue.canonical.y===Qe-1?u.globePoleMatrixForTile(Ue.canonical,!0,be):null];for(const wi of Fn){if(!wi)continue;const Vo=Ws(be.projMatrix,wi,wi,0,bt);ht&&xe.draw(te,Ke,pe,Ln,fe,u.CullFaceMode.disabled,Vo,"globe_pole_raster",on,ht.poleIndexBuffer,ht.poleSegments)}}}})}(_,x,w,S,F);else{const O=_.context,N=O.gl;let $,K;const re=_.options.showTerrainWireframe?2:0,te=(me,fe)=>{if(K===me)return;const pe=[ki[me]];fe&&pe.push(ki[re]),$=_.useProgram("terrainRaster",null,pe),K=me},ie=_.colorModeForRenderPass(),xe=new u.DepthMode(N.LEQUAL,u.DepthMode.ReadWrite,_.depthRangeFor3D);Fo.update(F);const ee=_.transform,ge=6*Math.pow(1.5,22-ee.zoom)*x.exaggeration();(re?[!1,!0]:[!1]).forEach(me=>{K=-1;const fe=me?N.LINES:N.TRIANGLES,[pe,be]=me?x.getWirefameBuffer():[x.gridIndexBuffer,x.gridSegments];for(const ze of S){const Ge=w.getTile(ze),bt=u.StencilMode.disabled,ht=x.prevTerrainTileForTile[ze.key],lt=x.terrainTileForTile[ze.key];ni(ht,lt)&&Fo.newMorphing(ze.key,ht,lt,F,250),O.activeTexture.set(N.TEXTURE0),Ge.texture.bind(N.LINEAR,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST);const Ke=Fo.getMorphValuesForProxy(ze.key),Ue=Ke?1:0;let ct;Ke&&(ct={morphing:{srcDemTile:Ke.from,dstDemTile:Ke.to,phase:u.easeCubicInOut(Ke.phase)}});const Qe=bi(ze.projMatrix,dc(ze.canonical,ee.renderWorldCopies)?ge/10:ge);te(Ue,me),x.setupElevationDraw(Ge,$,ct),_.prepareDrawProgram(O,$,ze.toUnwrapped()),$.draw(O,fe,xe,bt,ie,u.CullFaceMode.backCCW,Qe,"terrain_raster",x.gridBuffer,pe,be)}})}}(l,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,n.splice(0,n.length))}renderBatch(n){if(0===this._drapedRenderBatches.length)return n+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,_=this.proxySourceCache,x=this.proxiedCoords[_.id],w=this._drapedRenderBatches.shift(),S=[],F=l.style.order;let O=0;for(const N of x){const $=_.getTileByID(N.proxyTileKey),K=_.proxyCachedFBO[N.key]?_.proxyCachedFBO[N.key][n]:void 0,re=void 0!==K?_.renderCache[K]:this.pool[O++],te=void 0!==K;if($.texture=re.tex,te&&!re.dirty){S.push($.tileID);continue}let ie;p.bindFramebuffer.set(re.fb.framebuffer),this.renderedToTile=!1,re.dirty&&(p.clear({color:u.Color.transparent,stencil:0}),re.dirty=!1);for(let xe=w.start;xe<=w.end;++xe){const ee=l.style._layers[F[xe]];if(ee.isHidden(l.transform.zoom))continue;const ge=l.style._getLayerSourceCache(ee),me=ge?this.proxyToSource[N.key][ge.id]:[N];if(!me)continue;const fe=me;p.viewport.set([0,0,re.fb.width,re.fb.height]),ie!==(ge?ge.id:null)&&(this._setupStencil(re,me,ee,ge),ie=ge?ge.id:null),l.renderLayer(l,ge,ee,fe)}this.renderedToTile?(re.dirty=!0,S.push($.tileID)):te||--O,5===O&&(O=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),w.end+1}postRender(){}renderCacheEfficiency(n){const l=n.order.length;if(0===l)return{efficiency:100};let p,_=0,x=0,w=!1;for(let S=0;S<l;++S){const F=n._layers[n.order[S]];this._style.isLayerDraped(F)?(w&&++_,++x):w||(w=!0,p=F.id)}return 0===x?{efficiency:100}:{efficiency:100*(1-_/x),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{n=Math.min(n,l.dem.tree.minimums[0])}),0===n?n:(n-30)*this._exaggeration}raycast(n,l,p){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(x=>x.dem).map(x=>{const w=x.tileID,S=Math.pow(2,w.overscaledZ),{x:F,y:O}=w.canonical,N=F/S,$=(F+1)/S,K=O/S,re=(O+1)/S;return{minx:N,miny:K,maxx:$,maxy:re,t:x.dem.tree.raycastRoot(N,K,$,re,n,l,p),tile:x}});_.sort((x,w)=>(null!==x.t?x.t:Number.MAX_VALUE)-(null!==w.t?w.t:Number.MAX_VALUE));for(const x of _){if(null==x.t)return null;const w=x.tile.dem.tree.raycast(x.minx,x.miny,x.maxx,x.maxy,n,l,p);if(null!=w)return w}return null}_createFBO(){const n=this.painter.context,l=n.gl,p=this.drapeBufferSize;n.activeTexture.set(l.TEXTURE0);const _=new u.Texture(n,{width:p[0],height:p[1],data:null},l.RGBA);_.bind(l.LINEAR,l.CLAMP_TO_EDGE);const x=n.createFramebuffer(p[0],p[1],!1);return x.colorAttachment.set(_.texture),x.depthAttachment=new fi(n,x.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,x.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):x.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:x,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const l=this._style._layers[n],p=l.isHidden(this.painter.transform.zoom),_=l.getCrossfadeParameters(),x=!!_&&1!==_.t,w=l.hasTransition();return"custom"!==l.type&&!p&&(x||w)})}_clearRasterFadeFromRenderCache(){let n=!1;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l]._source instanceof pi){n=!0;break}if(n)for(let l=0;l<this._style.order.length;++l){const p=this._style._layers[this._style.order[l]],_=p.isHidden(this.painter.transform.zoom),x=this._style._getLayerSourceCache(p);if("raster"!==p.type||_||!x)continue;const w=p.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const F=this.proxyToSource[S.key][x.id];if(F)for(const O of F){const N=La(x.getTile(O),x.findLoadedParent(O,0),x,this.painter.transform,w);(1!==N.opacity||0!==N.mix)&&this._clearRenderCacheForTile(x.id,O)}}}}_setupDrapedRenderBatches(){const n=this._style.order,l=n.length;if(0===l)return;const p=[];let _,x=0,w=this._style._layers[n[x]];for(;!this._style.isLayerDraped(w)&&w.isHidden(this.painter.transform.zoom)&&++x<l;)w=this._style._layers[n[x]];for(;x<l;++x){const S=this._style._layers[n[x]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?void 0===_&&(_=x):void 0!==_&&(p.push({start:_,end:x-1}),_=void 0))}void 0!==_&&p.push({start:_,end:x-1}),this._drapedRenderBatches=p}_setupRenderCache(n){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const w=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let S=0;S<w.length;++S){const F=Object.values(w[S]);l.renderCachePool.push(...F)}}return}this._clearRasterFadeFromRenderCache();const p=this.proxyCoords,_=this._tilesDirty;for(let w=p.length-1;w>=0;w--){const S=p[w];if(l.getTileByID(S.key),void 0!==l.proxyCachedFBO[S.key]){const F=n[S.key],O=this.proxyToSource[S.key];let N=0;for(const $ in O){const K=O[$],re=F[$];if(!re||re.length!==K.length||K.some((te,ie)=>te!==re[ie]||_[$]&&_[$].hasOwnProperty(te.key))){N=-1;break}++N}for(const $ in l.proxyCachedFBO[S.key])l.renderCache[l.proxyCachedFBO[S.key][$]].dirty=N<0||N!==Object.values(F).length}}const x=[...this._drapedRenderBatches];x.sort((w,S)=>S.end-S.start-(w.end-w.start));for(const w of x)for(const S of p){if(l.proxyCachedFBO[S.key])continue;let F=l.renderCachePool.pop();void 0===F&&l.renderCache.length<50&&(F=l.renderCache.length,l.renderCache.push(this._createFBO())),void 0!==F&&(l.proxyCachedFBO[S.key]={},l.proxyCachedFBO[S.key][w.start]=F,l.renderCache[F].dirty=!0)}this._tilesDirty={}}_setupStencil(n,l,p,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const x=this.painter.context,w=x.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let S;if(p.isTileClipped())S=l.length,this._overlapStencilMode.test={func:w.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:w.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(x.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):u.StencilMode.disabled}_renderTileClippingMasks(n,l){const p=this.painter,_=this.painter.context,x=_.gl;p._tileClippingMaskIDs={},_.setColorMode(u.ColorMode.disabled),_.setDepthMode(u.DepthMode.disabled);const w=p.useProgram("clippingMask");for(const S of n){const F=p._tileClippingMaskIDs[S.key]=--l;w.draw(_,x.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:x.ALWAYS,mask:0},F,255,x.KEEP,x.KEEP,x.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,ri(S.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(n){const l=this.painter.transform;if(n.x<0||n.x>l.width||n.y<0||n.y>l.height)return null;const p=[n.x,n.y,1,1];u.transformMat4$1(p,p,l.pixelMatrixInverse),u.scale$1(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const _=l._camera.position,x=u.mercatorZfromAltitude(1,l.center.lat),w=[_[0],_[1],_[2]/x,0],S=u.subtract([],p.slice(0,3),w);u.normalize(S,S);const F=this.raycast(w,S,this._exaggeration);return null!==F&&F?(u.scaleAndAdd(w,w,S,F),w[3]=w[2],w[2]*=x,w):null}drawDepth(){const n=this.painter,l=n.context,p=this.proxySourceCache,_=Math.ceil(n.width),x=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===_&&this._depthFBO.height===x||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){const w=l.gl,S=l.createFramebuffer(_,x,!0);l.activeTexture.set(w.TEXTURE0);const F=new u.Texture(l,{width:_,height:x,data:null},w.RGBA);F.bind(w.NEAREST,w.CLAMP_TO_EDGE),S.colorAttachment.set(F.texture);const O=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,_,x);S.depthAttachment.set(O),this._depthFBO=S,this._depthTexture=F}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,_,x]),function(w,S,F,O){if("globe"===w.transform.projection.name)return;const N=w.context,$=N.gl;N.clear({depth:1});const K=w.useProgram("terrainDepth"),re=new u.DepthMode($.LESS,u.DepthMode.ReadWrite,w.depthRangeFor3D);for(const te of O){const ie=F.getTile(te),xe=bi(te.projMatrix,0);S.setupElevationDraw(ie,K),K.draw(N,$.TRIANGLES,re,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.backCCW,xe,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(n,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,l,p){if(n.getSource()instanceof ko)return this._setupProxiedCoordsForImageSource(n,l,p);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const _=this.proxiedCoords[n.id]=[],x=this.proxyCoords;for(let S=0;S<x.length;S++){const F=x[S],O=this._findTileCoveringTileID(F,n);if(O){const N=this._createProxiedId(F,O,p[F.key]&&p[F.key][n.id]);_.push(N),this.proxyToSource[F.key][n.id]=[N]}}let w=!1;for(let S=0;S<l.length;S++){const F=n.getTile(l[S]);if(!F||!F.hasData())continue;const O=this._findTileCoveringTileID(F.tileID,this.proxySourceCache);if(O&&O.tileID.canonical.z!==F.tileID.canonical.z){const N=this.proxyToSource[O.tileID.key][n.id],$=this._createProxiedId(O.tileID,F,p[O.tileID.key]&&p[O.tileID.key][n.id]);N?N.splice(N.length-1,0,$):this.proxyToSource[O.tileID.key][n.id]=[$],_.push($),w=!0}}this._sourceTilesOverlap[n.id]=w}_setupProxiedCoordsForImageSource(n,l,p){if(!n.getSource().loaded())return;const _=this.proxiedCoords[n.id]=[],x=this.proxyCoords,w=n.getSource(),S=new u.pointGeometry(w.tileID.x,w.tileID.y)._div(1<<w.tileID.z),F=w.coordinates.map(u.MercatorCoordinate.fromLngLat).reduce((N,$)=>(N.min.x=Math.min(N.min.x,$.x-S.x),N.min.y=Math.min(N.min.y,$.y-S.y),N.max.x=Math.max(N.max.x,$.x-S.x),N.max.y=Math.max(N.max.y,$.y-S.y),N),{min:new u.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new u.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),O=(N,$)=>{const K=N.wrap+N.canonical.x/(1<<N.canonical.z),re=N.canonical.y/(1<<N.canonical.z),te=u.EXTENT/(1<<N.canonical.z),ie=$.wrap+$.canonical.x/(1<<$.canonical.z),xe=$.canonical.y/(1<<$.canonical.z);return K+te<ie+F.min.x||K>ie+F.max.x||re+te<xe+F.min.y||re>xe+F.max.y};for(let N=0;N<x.length;N++){const $=x[N];for(let K=0;K<l.length;K++){const re=n.getTile(l[K]);if(!re||!re.hasData()||O($,re.tileID))continue;const te=this._createProxiedId($,re,p[$.key]&&p[$.key][n.id]),ie=this.proxyToSource[$.key][n.id];ie?ie.push(te):this.proxyToSource[$.key][n.id]=[te],_.push(te)}}}_createProxiedId(n,l,p){let _=this.orthoMatrix;if(p){const x=p.find(w=>w.key===l.tileID.key);if(x)return x}if(l.tileID.key!==n.key){const x=n.canonical.z-l.tileID.canonical.z;let w,S,F;_=u.create();const O=l.tileID.wrap-n.wrap<<n.overscaledZ;x>0?(w=u.EXTENT>>x,S=w*((l.tileID.canonical.x<<x)-n.canonical.x+O),F=w*((l.tileID.canonical.y<<x)-n.canonical.y)):(w=u.EXTENT<<-x,S=u.EXTENT*(l.tileID.canonical.x-(n.canonical.x+O<<-x)),F=u.EXTENT*(l.tileID.canonical.y-(n.canonical.y<<-x))),u.ortho(_,0,w,0,w,0,1),u.translate(_,_,[S,F,0])}return new B(l.tileID,n.key,_)}_findTileCoveringTileID(n,l){let p=l.getTile(n);if(p&&p.hasData())return p;const _=this._findCoveringTileCache[l.id],x=_[n.key];if(p=x?l.getTileByID(x):null,p&&p.hasData()||null===x)return p;let w=p?p.tileID:n,S=w.overscaledZ;const F=l.getSource().minzoom,O=[];if(!x){const $=l.getSource().maxzoom;if(n.canonical.z>=$){const K=n.canonical.z-$;l.getSource().reparseOverscaled?(S=Math.max(n.canonical.z+2,l.transform.tileZoom),w=new u.OverscaledTileID(S,n.wrap,$,n.canonical.x>>K,n.canonical.y>>K)):0!==K&&(S=$,w=new u.OverscaledTileID(S,n.wrap,$,n.canonical.x>>K,n.canonical.y>>K))}w.key!==n.key&&(O.push(w.key),p=l.getTile(w))}const N=$=>{O.forEach(K=>{_[K]=$}),O.length=0};for(S-=1;S>=F&&(!p||!p.hasData());S--){p&&N(p.tileID.key);const $=w.calculateScaledKey(S);if(p=l.getTileByID($),p&&p.hasData())break;const K=_[$];if(null===K)break;void 0===K?O.push($):p=l.getTileByID(K)}return N(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(n){this.renderedToTile=!0}_clearRenderCacheForTile(n,l){let p=this._tilesDirty[n];p||(p=this._tilesDirty[n]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(l){let p,_,x;const w=new u.StructArrayLayout2ui4,S=131;for(_=1;_<129;_++){for(p=1;p<129;p++)x=_*S+p,w.emplaceBack(x,x+1),w.emplaceBack(x,x+S),w.emplaceBack(x+1,x+S),128===_&&w.emplaceBack(x+S,x+S+1);w.emplaceBack(x+1,x+1+S)}return w}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=u.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Te(f){const n=[];for(let l=0;l<f.length;l++){if(null===f[l])continue;const p=f[l].split(" ");n.push(p.pop())}return n}class Ye{static cacheKey(n,l,p){let _=`${n}${p?p.cacheKey:""}`;for(const x of l)_+=`/${x}`;return _}constructor(n,l,p,_,x,w){const S=n.gl;this.program=S.createProgram();const F=Te(p.staticAttributes),O=_?_.getBinderAttributes():[],N=F.concat(O),$=p.staticUniforms?Te(p.staticUniforms):[],K=_?_.getBinderUniforms():[],re=$.concat(K),te=[];for(const pe of re)te.indexOf(pe)<0&&te.push(pe);let ie=_?_.defines():[];ie=ie.concat(w.map(pe=>`#define ${pe}`));const xe=ie.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",qs,Un.fragmentSource,Is.fragmentSource,p.fragmentSource).join("\n"),ee=ie.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",qs,Un.vertexSource,Is.vertexSource,Ms.vertexSource,p.vertexSource).join("\n"),ge=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(ge,xe),S.compileShader(ge),S.attachShader(this.program,ge);const me=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(me,ee),S.compileShader(me),S.attachShader(this.program,me),this.attributes={};const fe={};this.numAttributes=N.length;for(let pe=0;pe<this.numAttributes;pe++)N[pe]&&(S.bindAttribLocation(this.program,pe,N[pe]),this.attributes[N[pe]]=pe);S.linkProgram(this.program),S.deleteShader(me),S.deleteShader(ge);for(let pe=0;pe<te.length;pe++){const be=te[pe];if(be&&!fe[be]){const ze=S.getUniformLocation(this.program,be);ze&&(fe[be]=ze)}}var pe,be;this.fixedUniforms=x(n,fe),this.binderUniforms=_?_.getUniforms(n,fe):[],-1!==w.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new u.Uniform1i(pe=n,(be=fe).u_dem),u_dem_prev:new u.Uniform1i(pe,be.u_dem_prev),u_dem_unpack:new u.Uniform4f(pe,be.u_dem_unpack),u_dem_tl:new u.Uniform2f(pe,be.u_dem_tl),u_dem_scale:new u.Uniform1f(pe,be.u_dem_scale),u_dem_tl_prev:new u.Uniform2f(pe,be.u_dem_tl_prev),u_dem_scale_prev:new u.Uniform1f(pe,be.u_dem_scale_prev),u_dem_size:new u.Uniform1f(pe,be.u_dem_size),u_dem_lerp:new u.Uniform1f(pe,be.u_dem_lerp),u_exaggeration:new u.Uniform1f(pe,be.u_exaggeration),u_depth:new u.Uniform1i(pe,be.u_depth),u_depth_size_inv:new u.Uniform2f(pe,be.u_depth_size_inv),u_meter_to_dem:new u.Uniform1f(pe,be.u_meter_to_dem),u_label_plane_matrix_inv:new u.UniformMatrix4f(pe,be.u_label_plane_matrix_inv),u_tile_tl_up:new u.Uniform3f(pe,be.u_tile_tl_up),u_tile_tr_up:new u.Uniform3f(pe,be.u_tile_tr_up),u_tile_br_up:new u.Uniform3f(pe,be.u_tile_br_up),u_tile_bl_up:new u.Uniform3f(pe,be.u_tile_bl_up),u_tile_up_scale:new u.Uniform1f(pe,be.u_tile_up_scale)}),-1!==w.indexOf("FOG")&&(this.fogUniforms=((pe,be)=>({u_fog_matrix:new u.UniformMatrix4f(pe,be.u_fog_matrix),u_fog_range:new u.Uniform2f(pe,be.u_fog_range),u_fog_color:new u.Uniform4f(pe,be.u_fog_color),u_fog_horizon_blend:new u.Uniform1f(pe,be.u_fog_horizon_blend),u_fog_temporal_offset:new u.Uniform1f(pe,be.u_fog_temporal_offset)}))(n,fe))}setTerrainUniformValues(n,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in l)p[_].set(l[_])}}setFogUniformValues(n,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const _ in l)p[_].location&&p[_].set(l[_])}}draw(n,l,p,_,x,w,S,F,O,N,$,K,re,te,ie,xe){const ee=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(p),n.setStencilMode(_),n.setColorMode(x),n.setCullFace(w);for(const me of Object.keys(this.fixedUniforms))this.fixedUniforms[me].set(S[me]);te&&te.setUniforms(n,this.binderUniforms,K,{zoom:re});const ge={[ee.LINES]:2,[ee.TRIANGLES]:3,[ee.LINE_STRIP]:1}[l];for(const me of $.get()){const fe=me.vaos||(me.vaos={});(fe[F]||(fe[F]=new so)).bind(n,this,O,te?te.getPaintVertexBuffers():[],N,me.vertexOffset,ie,xe),ee.drawElements(l,me.primitiveLength*ge,ee.UNSIGNED_SHORT,me.primitiveOffset*ge*2)}}}function yt(f,n,l){const p=1/qe(l,1,n.transform.tileZoom),_=Math.pow(2,l.tileID.overscaledZ),x=l.tileSize*Math.pow(2,n.transform.tileZoom)/_,w=x*(l.tileID.canonical.x+l.tileID.wrap*_),S=x*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[p,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const rn=(f,n,l,p)=>{const _=n.style.light,x=_.properties.get("position"),w=[x.x,x.y,x.z],S=u.create$1();"viewport"===_.properties.get("anchor")&&(u.fromRotation(S,-n.transform.angle),u.transformMat3(w,w,S));const F=_.properties.get("color");return{u_matrix:f,u_lightpos:w,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[F.r,F.g,F.b],u_vertical_gradient:+l,u_opacity:p}},gn=(f,n,l,p,_,x,w)=>u.extend(rn(f,n,l,p),yt(x,n,w),{u_height_factor:-Math.pow(2,_.overscaledZ)/w.tileSize/8}),Cr=f=>({u_matrix:f}),Sr=(f,n,l,p)=>u.extend(Cr(f),yt(l,n,p)),dn=(f,n)=>({u_matrix:f,u_world:n}),_r=(f,n,l,p,_)=>u.extend(Sr(f,n,l,p),{u_world:_}),Vr=(f,n,l,p)=>{const _=f.transform;let x;return x="map"===p.paint.get("circle-pitch-alignment")?_.calculatePixelsToTileUnitsMatrix(l):new Float32Array([_.pixelsToGLUnits[0],0,0,_.pixelsToGLUnits[1]]),{u_camera_to_center_distance:_.cameraToCenterDistance,u_matrix:f.translatePosMatrix(n.projMatrix,l,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:u.exported.devicePixelRatio,u_extrude_scale:x}},ei=f=>{const n=[];return"map"===f.paint.get("circle-pitch-alignment")&&n.push("PITCH_WITH_MAP"),"map"===f.paint.get("circle-pitch-scale")&&n.push("SCALE_WITH_MAP"),n},ii=(f,n,l)=>{const p=u.EXTENT/l.tileSize;return{u_matrix:f,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/p,n.pixelsToGLUnits[1]/p]}},yo=(f,n,l=1)=>({u_matrix:f,u_color:n,u_overlay:0,u_overlay_scale:l}),Ps=(f,n,l,p)=>({u_matrix:f,u_extrude_scale:qe(n,1,l),u_intensity:p}),vo=(f,n,l,p,_,x)=>{const w=f.transform,S=w.calculatePixelsToTileUnitsMatrix(n),F={u_matrix:Do(f,n,l,_),u_pixels_to_tile_units:S,u_device_pixel_ratio:u.exported.devicePixelRatio,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:x,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Fa(l)){const O=Qo(n,f.transform);F.u_texsize=n.lineAtlasTexture.size,F.u_scale=[O,p.fromScale,p.toScale],F.u_mix=p.t}return F},oi=(f,n,l,p,_)=>{const x=f.transform,w=Qo(n,x);return{u_matrix:Do(f,n,l,_),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:x.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:u.exported.devicePixelRatio,u_image:0,u_scale:[w,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Qo(f,n){return 1/qe(f,1,n.tileZoom)}function Do(f,n,l,p){return f.translatePosMatrix(p||n.tileID.projMatrix,n,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function Fa(f){const n=f.paint.get("line-dasharray").value;return n.value||"constant"!==n.kind}const Oo=(f,n,l,p,_,x)=>{return{u_matrix:f,u_tl_parent:n,u_scale_parent:l,u_fade_t:p.mix,u_opacity:p.opacity*_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:_.paint.get("raster-brightness-min"),u_brightness_high:_.paint.get("raster-brightness-max"),u_saturation_factor:(S=_.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(w=_.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:ks(_.paint.get("raster-hue-rotate")),u_perspective_transform:x};var w,S};function ks(f){f*=Math.PI/180;const n=Math.sin(f),l=Math.cos(f);return[(2*l+1)/3,(-Math.sqrt(3)*n-l+1)/3,(Math.sqrt(3)*n-l+1)/3]}const da=(f,n,l,p,_,x,w,S,F,O,N,$,K,re)=>{const te=_.transform;return{u_is_size_zoom_constant:+("constant"===f||"source"===f),u_is_size_feature_constant:+("constant"===f||"camera"===f),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:te.cameraToCenterDistance,u_pitch:te.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:te.width/te.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:w,u_coord_matrix:S,u_is_text:+F,u_pitch_with_map:+p,u_texsize:O,u_tile_id:N,u_zoom_transition:$,u_inv_rot_matrix:K,u_merc_center:re,u_texture:0}},pn=(f,n,l,p,_,x,w,S,F,O,N,$,K,re,te)=>{const{cameraToCenterDistance:ie,_pitch:xe}=_.transform;return u.extend(da(f,n,l,p,_,x,w,S,F,O,$,K,re,te),{u_gamma_scale:p?ie*Math.cos(_.terrain?0:xe):1,u_device_pixel_ratio:u.exported.devicePixelRatio,u_is_halo:+N})},sl=(f,n,l,p,_,x,w,S,F,O,N,$,K,re)=>u.extend(pn(f,n,l,p,_,x,w,S,!0,F,!0,N,$,K,re),{u_texsize_icon:O,u_texture_icon:1}),or=(f,n,l)=>({u_matrix:f,u_opacity:n,u_color:l}),zl=(f,n,l,p,_,x)=>u.extend(function(w,S,F,O){const N=F.imageManager.getPattern(w.from.toString()),$=F.imageManager.getPattern(w.to.toString()),{width:K,height:re}=F.imageManager.getPixelSize(),te=Math.pow(2,O.tileID.overscaledZ),ie=O.tileSize*Math.pow(2,F.transform.tileZoom)/te,xe=ie*(O.tileID.canonical.x+O.tileID.wrap*te),ee=ie*O.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:N.tl,u_pattern_br_a:N.br,u_pattern_tl_b:$.tl,u_pattern_br_b:$.br,u_texsize:[K,re],u_mix:S.t,u_pattern_size_a:N.displaySize,u_pattern_size_b:$.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/qe(O,1,F.transform.tileZoom),u_pixel_coord_upper:[xe>>16,ee>>16],u_pixel_coord_lower:[65535&xe,65535&ee]}}(p,x,l,_),{u_matrix:f,u_opacity:n}),Bc={fillExtrusion:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_lightpos:new u.Uniform3f(f,n.u_lightpos),u_lightintensity:new u.Uniform1f(f,n.u_lightintensity),u_lightcolor:new u.Uniform3f(f,n.u_lightcolor),u_vertical_gradient:new u.Uniform1f(f,n.u_vertical_gradient),u_opacity:new u.Uniform1f(f,n.u_opacity)}),fillExtrusionPattern:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_lightpos:new u.Uniform3f(f,n.u_lightpos),u_lightintensity:new u.Uniform1f(f,n.u_lightintensity),u_lightcolor:new u.Uniform3f(f,n.u_lightcolor),u_vertical_gradient:new u.Uniform1f(f,n.u_vertical_gradient),u_height_factor:new u.Uniform1f(f,n.u_height_factor),u_image:new u.Uniform1i(f,n.u_image),u_texsize:new u.Uniform2f(f,n.u_texsize),u_pixel_coord_upper:new u.Uniform2f(f,n.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(f,n.u_pixel_coord_lower),u_scale:new u.Uniform3f(f,n.u_scale),u_fade:new u.Uniform1f(f,n.u_fade),u_opacity:new u.Uniform1f(f,n.u_opacity)}),fill:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix)}),fillPattern:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_image:new u.Uniform1i(f,n.u_image),u_texsize:new u.Uniform2f(f,n.u_texsize),u_pixel_coord_upper:new u.Uniform2f(f,n.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(f,n.u_pixel_coord_lower),u_scale:new u.Uniform3f(f,n.u_scale),u_fade:new u.Uniform1f(f,n.u_fade)}),fillOutline:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_world:new u.Uniform2f(f,n.u_world)}),fillOutlinePattern:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_world:new u.Uniform2f(f,n.u_world),u_image:new u.Uniform1i(f,n.u_image),u_texsize:new u.Uniform2f(f,n.u_texsize),u_pixel_coord_upper:new u.Uniform2f(f,n.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(f,n.u_pixel_coord_lower),u_scale:new u.Uniform3f(f,n.u_scale),u_fade:new u.Uniform1f(f,n.u_fade)}),circle:(f,n)=>({u_camera_to_center_distance:new u.Uniform1f(f,n.u_camera_to_center_distance),u_extrude_scale:new u.UniformMatrix2f(f,n.u_extrude_scale),u_device_pixel_ratio:new u.Uniform1f(f,n.u_device_pixel_ratio),u_matrix:new u.UniformMatrix4f(f,n.u_matrix)}),collisionBox:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_camera_to_center_distance:new u.Uniform1f(f,n.u_camera_to_center_distance),u_extrude_scale:new u.Uniform2f(f,n.u_extrude_scale)}),collisionCircle:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_inv_matrix:new u.UniformMatrix4f(f,n.u_inv_matrix),u_camera_to_center_distance:new u.Uniform1f(f,n.u_camera_to_center_distance),u_viewport_size:new u.Uniform2f(f,n.u_viewport_size)}),debug:(f,n)=>({u_color:new u.UniformColor(f,n.u_color),u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_overlay:new u.Uniform1i(f,n.u_overlay),u_overlay_scale:new u.Uniform1f(f,n.u_overlay_scale)}),clippingMask:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix)}),heatmap:(f,n)=>({u_extrude_scale:new u.Uniform1f(f,n.u_extrude_scale),u_intensity:new u.Uniform1f(f,n.u_intensity),u_matrix:new u.UniformMatrix4f(f,n.u_matrix)}),heatmapTexture:(f,n)=>({u_image:new u.Uniform1i(f,n.u_image),u_color_ramp:new u.Uniform1i(f,n.u_color_ramp),u_opacity:new u.Uniform1f(f,n.u_opacity)}),hillshade:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_image:new u.Uniform1i(f,n.u_image),u_latrange:new u.Uniform2f(f,n.u_latrange),u_light:new u.Uniform2f(f,n.u_light),u_shadow:new u.UniformColor(f,n.u_shadow),u_highlight:new u.UniformColor(f,n.u_highlight),u_accent:new u.UniformColor(f,n.u_accent)}),hillshadePrepare:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_image:new u.Uniform1i(f,n.u_image),u_dimension:new u.Uniform2f(f,n.u_dimension),u_zoom:new u.Uniform1f(f,n.u_zoom),u_unpack:new u.Uniform4f(f,n.u_unpack)}),line:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_pixels_to_tile_units:new u.UniformMatrix2f(f,n.u_pixels_to_tile_units),u_device_pixel_ratio:new u.Uniform1f(f,n.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(f,n.u_units_to_pixels),u_dash_image:new u.Uniform1i(f,n.u_dash_image),u_gradient_image:new u.Uniform1i(f,n.u_gradient_image),u_image_height:new u.Uniform1f(f,n.u_image_height),u_texsize:new u.Uniform2f(f,n.u_texsize),u_scale:new u.Uniform3f(f,n.u_scale),u_mix:new u.Uniform1f(f,n.u_mix),u_alpha_discard_threshold:new u.Uniform1f(f,n.u_alpha_discard_threshold)}),linePattern:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_texsize:new u.Uniform2f(f,n.u_texsize),u_pixels_to_tile_units:new u.UniformMatrix2f(f,n.u_pixels_to_tile_units),u_device_pixel_ratio:new u.Uniform1f(f,n.u_device_pixel_ratio),u_image:new u.Uniform1i(f,n.u_image),u_units_to_pixels:new u.Uniform2f(f,n.u_units_to_pixels),u_scale:new u.Uniform3f(f,n.u_scale),u_fade:new u.Uniform1f(f,n.u_fade),u_alpha_discard_threshold:new u.Uniform1f(f,n.u_alpha_discard_threshold)}),raster:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_tl_parent:new u.Uniform2f(f,n.u_tl_parent),u_scale_parent:new u.Uniform1f(f,n.u_scale_parent),u_fade_t:new u.Uniform1f(f,n.u_fade_t),u_opacity:new u.Uniform1f(f,n.u_opacity),u_image0:new u.Uniform1i(f,n.u_image0),u_image1:new u.Uniform1i(f,n.u_image1),u_brightness_low:new u.Uniform1f(f,n.u_brightness_low),u_brightness_high:new u.Uniform1f(f,n.u_brightness_high),u_saturation_factor:new u.Uniform1f(f,n.u_saturation_factor),u_contrast_factor:new u.Uniform1f(f,n.u_contrast_factor),u_spin_weights:new u.Uniform3f(f,n.u_spin_weights),u_perspective_transform:new u.Uniform2f(f,n.u_perspective_transform)}),symbolIcon:(f,n)=>({u_is_size_zoom_constant:new u.Uniform1i(f,n.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(f,n.u_is_size_feature_constant),u_size_t:new u.Uniform1f(f,n.u_size_t),u_size:new u.Uniform1f(f,n.u_size),u_camera_to_center_distance:new u.Uniform1f(f,n.u_camera_to_center_distance),u_pitch:new u.Uniform1f(f,n.u_pitch),u_rotate_symbol:new u.Uniform1i(f,n.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(f,n.u_aspect_ratio),u_fade_change:new u.Uniform1f(f,n.u_fade_change),u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(f,n.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(f,n.u_coord_matrix),u_is_text:new u.Uniform1i(f,n.u_is_text),u_pitch_with_map:new u.Uniform1i(f,n.u_pitch_with_map),u_texsize:new u.Uniform2f(f,n.u_texsize),u_tile_id:new u.Uniform3f(f,n.u_tile_id),u_zoom_transition:new u.Uniform1f(f,n.u_zoom_transition),u_inv_rot_matrix:new u.UniformMatrix4f(f,n.u_inv_rot_matrix),u_merc_center:new u.Uniform2f(f,n.u_merc_center),u_texture:new u.Uniform1i(f,n.u_texture)}),symbolSDF:(f,n)=>({u_is_size_zoom_constant:new u.Uniform1i(f,n.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(f,n.u_is_size_feature_constant),u_size_t:new u.Uniform1f(f,n.u_size_t),u_size:new u.Uniform1f(f,n.u_size),u_camera_to_center_distance:new u.Uniform1f(f,n.u_camera_to_center_distance),u_pitch:new u.Uniform1f(f,n.u_pitch),u_rotate_symbol:new u.Uniform1i(f,n.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(f,n.u_aspect_ratio),u_fade_change:new u.Uniform1f(f,n.u_fade_change),u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(f,n.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(f,n.u_coord_matrix),u_is_text:new u.Uniform1i(f,n.u_is_text),u_pitch_with_map:new u.Uniform1i(f,n.u_pitch_with_map),u_texsize:new u.Uniform2f(f,n.u_texsize),u_texture:new u.Uniform1i(f,n.u_texture),u_gamma_scale:new u.Uniform1f(f,n.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(f,n.u_device_pixel_ratio),u_tile_id:new u.Uniform3f(f,n.u_tile_id),u_zoom_transition:new u.Uniform1f(f,n.u_zoom_transition),u_inv_rot_matrix:new u.UniformMatrix4f(f,n.u_inv_rot_matrix),u_merc_center:new u.Uniform2f(f,n.u_merc_center),u_is_halo:new u.Uniform1i(f,n.u_is_halo)}),symbolTextAndIcon:(f,n)=>({u_is_size_zoom_constant:new u.Uniform1i(f,n.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(f,n.u_is_size_feature_constant),u_size_t:new u.Uniform1f(f,n.u_size_t),u_size:new u.Uniform1f(f,n.u_size),u_camera_to_center_distance:new u.Uniform1f(f,n.u_camera_to_center_distance),u_pitch:new u.Uniform1f(f,n.u_pitch),u_rotate_symbol:new u.Uniform1i(f,n.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(f,n.u_aspect_ratio),u_fade_change:new u.Uniform1f(f,n.u_fade_change),u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(f,n.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(f,n.u_coord_matrix),u_is_text:new u.Uniform1i(f,n.u_is_text),u_pitch_with_map:new u.Uniform1i(f,n.u_pitch_with_map),u_texsize:new u.Uniform2f(f,n.u_texsize),u_texsize_icon:new u.Uniform2f(f,n.u_texsize_icon),u_texture:new u.Uniform1i(f,n.u_texture),u_texture_icon:new u.Uniform1i(f,n.u_texture_icon),u_gamma_scale:new u.Uniform1f(f,n.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(f,n.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(f,n.u_is_halo)}),background:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_opacity:new u.Uniform1f(f,n.u_opacity),u_color:new u.UniformColor(f,n.u_color)}),backgroundPattern:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_opacity:new u.Uniform1f(f,n.u_opacity),u_image:new u.Uniform1i(f,n.u_image),u_pattern_tl_a:new u.Uniform2f(f,n.u_pattern_tl_a),u_pattern_br_a:new u.Uniform2f(f,n.u_pattern_br_a),u_pattern_tl_b:new u.Uniform2f(f,n.u_pattern_tl_b),u_pattern_br_b:new u.Uniform2f(f,n.u_pattern_br_b),u_texsize:new u.Uniform2f(f,n.u_texsize),u_mix:new u.Uniform1f(f,n.u_mix),u_pattern_size_a:new u.Uniform2f(f,n.u_pattern_size_a),u_pattern_size_b:new u.Uniform2f(f,n.u_pattern_size_b),u_scale_a:new u.Uniform1f(f,n.u_scale_a),u_scale_b:new u.Uniform1f(f,n.u_scale_b),u_pixel_coord_upper:new u.Uniform2f(f,n.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(f,n.u_pixel_coord_lower),u_tile_units_to_pixels:new u.Uniform1f(f,n.u_tile_units_to_pixels)}),terrainRaster:As,terrainDepth:As,skybox:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_sun_direction:new u.Uniform3f(f,n.u_sun_direction),u_cubemap:new u.Uniform1i(f,n.u_cubemap),u_opacity:new u.Uniform1f(f,n.u_opacity),u_temporal_offset:new u.Uniform1f(f,n.u_temporal_offset)}),skyboxGradient:(f,n)=>({u_matrix:new u.UniformMatrix4f(f,n.u_matrix),u_color_ramp:new u.Uniform1i(f,n.u_color_ramp),u_center_direction:new u.Uniform3f(f,n.u_center_direction),u_radius:new u.Uniform1f(f,n.u_radius),u_opacity:new u.Uniform1f(f,n.u_opacity),u_temporal_offset:new u.Uniform1f(f,n.u_temporal_offset)}),skyboxCapture:(f,n)=>({u_matrix_3f:new u.UniformMatrix3f(f,n.u_matrix_3f),u_sun_direction:new u.Uniform3f(f,n.u_sun_direction),u_sun_intensity:new u.Uniform1f(f,n.u_sun_intensity),u_color_tint_r:new u.Uniform4f(f,n.u_color_tint_r),u_color_tint_m:new u.Uniform4f(f,n.u_color_tint_m),u_luminance:new u.Uniform1f(f,n.u_luminance)}),globeRaster:(f,n)=>({u_proj_matrix:new u.UniformMatrix4f(f,n.u_proj_matrix),u_globe_matrix:new u.UniformMatrix4f(f,n.u_globe_matrix),u_merc_matrix:new u.UniformMatrix4f(f,n.u_merc_matrix),u_zoom_transition:new u.Uniform1f(f,n.u_zoom_transition),u_merc_center:new u.Uniform2f(f,n.u_merc_center),u_image0:new u.Uniform1i(f,n.u_image0)}),globeAtmosphere:(f,n)=>({u_center:new u.Uniform2f(f,n.u_center),u_radius:new u.Uniform1f(f,n.u_radius),u_screen_size:new u.Uniform2f(f,n.u_screen_size),u_pixel_ratio:new u.Uniform1f(f,n.u_pixel_ratio),u_opacity:new u.Uniform1f(f,n.u_opacity),u_fadeout_range:new u.Uniform1f(f,n.u_fadeout_range),u_start_color:new u.Uniform3f(f,n.u_start_color),u_end_color:new u.Uniform3f(f,n.u_end_color)})};let Oa;function fc(f,n,l,p,_,x,w){const S=f.context,F=S.gl,O=f.useProgram("collisionBox"),N=[];let $=0,K=0;for(let me=0;me<p.length;me++){const fe=p[me],pe=n.getTile(fe),be=pe.getBucket(l);if(!be)continue;let ze=fe.projMatrix;0===_[0]&&0===_[1]||(ze=f.translatePosMatrix(fe.projMatrix,pe,_,x));const Ge=w?be.textCollisionBox:be.iconCollisionBox,bt=be.collisionCircleArray;if(bt.length>0){const ht=u.create(),lt=ze;u.mul(ht,be.placementInvProjMatrix,f.transform.glCoordMatrix),u.mul(ht,ht,be.placementViewportMatrix),N.push({circleArray:bt,circleOffset:K,transform:lt,invTransform:ht}),$+=bt.length/4,K=$}Ge&&(f.terrain&&f.terrain.setupElevationDraw(pe,O),O.draw(S,F.LINES,u.DepthMode.disabled,u.StencilMode.disabled,f.colorModeForRenderPass(),u.CullFaceMode.disabled,ii(ze,f.transform,pe),l.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,null,f.transform.zoom,null,Ge.collisionVertexBuffer,Ge.collisionVertexBufferExt))}if(!w||!N.length)return;const re=f.useProgram("collisionCircle"),te=new u.StructArrayLayout2f1f2i16;te.resize(4*$),te._trim();let ie=0;for(const me of N)for(let fe=0;fe<me.circleArray.length/4;fe++){const pe=4*fe,be=me.circleArray[pe+0],ze=me.circleArray[pe+1],Ge=me.circleArray[pe+2],bt=me.circleArray[pe+3];te.emplace(ie++,be,ze,Ge,bt,0),te.emplace(ie++,be,ze,Ge,bt,1),te.emplace(ie++,be,ze,Ge,bt,2),te.emplace(ie++,be,ze,Ge,bt,3)}(!Oa||Oa.length<2*$)&&(Oa=function(me){const fe=2*me,pe=new u.StructArrayLayout3ui6;pe.resize(fe),pe._trim();for(let be=0;be<fe;be++){const ze=6*be;pe.uint16[ze+0]=4*be+0,pe.uint16[ze+1]=4*be+1,pe.uint16[ze+2]=4*be+2,pe.uint16[ze+3]=4*be+2,pe.uint16[ze+4]=4*be+3,pe.uint16[ze+5]=4*be+0}return pe}($));const xe=S.createIndexBuffer(Oa,!0),ee=S.createVertexBuffer(te,u.collisionCircleLayout.members,!0);for(const me of N){const fe={u_matrix:me.transform,u_inv_matrix:me.invTransform,u_camera_to_center_distance:(ge=f.transform).cameraToCenterDistance,u_viewport_size:[ge.width,ge.height]};re.draw(S,F.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,f.colorModeForRenderPass(),u.CullFaceMode.disabled,fe,l.id,ee,xe,u.SegmentVector.simpleSegment(0,2*me.circleOffset,me.circleArray.length,me.circleArray.length/2),null,f.transform.zoom,null,null,null)}var ge;ee.destroy(),xe.destroy()}const za=u.identity(new Float32Array(16));function mt(f,n,l,p,_,x){const{horizontalAlign:w,verticalAlign:S}=u.getAnchorAlignment(f),F=-(w-.5)*n,O=-(S-.5)*l,N=u.evaluateVariableOffset(f,p);return new u.pointGeometry((F/_+N[0])*x,(O/_+N[1])*x)}function tr(f,n,l,p,_,x,w,S,F,O,N,$){const K=f.text.placedSymbolArray,re=f.text.dynamicLayoutVertexArray,te=f.icon.dynamicLayoutVertexArray,ie={},xe=S.projMatrix,ee=x.elevation,ge=ee?ee.getAtTileOffsetFunc(S,$):me=>[0,0,0];re.clear();for(let me=0;me<K.length;me++){const fe=K.get(me),pe=f.allowVerticalPlacement&&!fe.placedOrientation,be=fe.hidden||!fe.crossTileID||pe?null:p[fe.crossTileID];if(be){const ze=new u.pointGeometry(fe.tileAnchorX,fe.tileAnchorY),Ge=ge(ze),bt=Fr(ze,l?xe:w,Ge[2]),ht=Si(x.cameraToCenterDistance,bt.signedDistanceFromCamera);let lt=_.evaluateSizeForFeature(f.textSizeData,O,fe)*ht/u.ONE_EM;l&&(lt*=f.tilePixelRatio/F);const{width:Ke,height:Ue,anchor:ct,textOffset:Qe,textScale:Yt}=be,on=mt(ct,Ke,Ue,Qe,Yt,lt),Ln=l?Fr(ze.add(on),w,Ge[2]).point:bt.point.add(n?on.rotate(-x.angle):on),xt=f.allowVerticalPlacement&&fe.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let ln=0;ln<fe.numGlyphs;ln++)u.addDynamicAttributes(re,Ln,xt);N&&fe.associatedIconIndex>=0&&(ie[fe.associatedIconIndex]={shiftedAnchor:Ln,angle:xt})}else mi(fe.numGlyphs,re)}if(N){te.clear();const me=f.icon.placedSymbolArray;for(let fe=0;fe<me.length;fe++){const pe=me.get(fe);if(pe.hidden)mi(pe.numGlyphs,te);else{const be=ie[fe];if(be)for(let ze=0;ze<pe.numGlyphs;ze++)u.addDynamicAttributes(te,be.shiftedAnchor,be.angle);else mi(pe.numGlyphs,te)}}f.icon.dynamicLayoutVertexBuffer.updateData(te)}f.text.dynamicLayoutVertexBuffer.updateData(re)}function al(f,n,l){return l.iconsInText&&n?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function si(f,n,l,p,_,x,w,S,F,O,N,$){const K=f.context,re=K.gl,te=f.transform,ie=te.projection.createTileTransform(te,te.worldSize),xe="map"===S,ee="map"===F,ge=xe&&"point"!==l.layout.get("symbol-placement"),me=xe&&!ee&&!ge,fe=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let pe=!1;const be=f.depthModeForSublayer(0,u.DepthMode.ReadOnly),ze=[u.mercatorXfromLng(te.center.lng),u.mercatorYfromLat(te.center.lat)],Ge=l.layout.get("text-variable-anchor"),bt="globe"===te.projection.name,ht=bt?u.globeToMercatorTransition(te.zoom):0,lt=[],Ke=[];f.terrain&&ee&&Ke.push("PITCH_WITH_MAP_TERRAIN"),bt&&Ke.push("PROJECTION_GLOBE_VIEW"),ge&&Ke.push("PROJECTED_POS_ON_VIEWPORT");for(const Ue of p){const ct=n.getTile(Ue),Qe=ct.getBucket(l);if(!Qe||Qe.projection!==te.projection.name)continue;const Yt=_?Qe.text:Qe.icon;if(!Yt||Qe.fullyClipped||!Yt.segments.get().length)continue;const on=Yt.programConfigurations.get(l.id),Ln=_||Qe.sdfIcons,xt=_?Qe.textSizeData:Qe.iconSizeData,ln=ee||0!==te.pitch,yn=f.useProgram(al(Ln,_,Qe),on,Ke),yr=u.evaluateSizeForZoom(xt,te.zoom),mr=[Ue.canonical.x,Ue.canonical.y,1<<Ue.canonical.z];let mn,Vn,Fn,wi,Vo=[0,0],jo=null;if(_){if(Vn=ct.glyphAtlasTexture,Fn=re.LINEAR,mn=ct.glyphAtlasTexture.size,Qe.iconsInText){Vo=ct.imageAtlasTexture.size,jo=ct.imageAtlasTexture;const Yi="composite"===xt.kind||"camera"===xt.kind;wi=ln||f.options.rotating||f.options.zooming||Yi?re.LINEAR:re.NEAREST}}else{const Yi=1!==l.layout.get("icon-size").constantOr(0)||Qe.iconsNeedLinear;Vn=ct.imageAtlasTexture,Fn=Ln||f.options.rotating||f.options.zooming||Yi||ln?re.LINEAR:re.NEAREST,mn=ct.imageAtlasTexture.size}const Co=f.transform.calculatePixelsToTileUnitsMatrix(ct),nr=Er(Ue.projMatrix,ct.tileID.canonical,ee,xe,f.transform,Co),wn=f.terrain&&ee&&ge?u.invert(new Float32Array(16),nr):za,qn=Tr(Ue.projMatrix,ct.tileID.canonical,ee,xe,f.transform,Co),qr=Ge&&Qe.hasTextData(),ao="none"!==l.layout.get("icon-text-fit")&&qr&&Qe.hasIconData();if(ge){const Yi=te.elevation,xl=Yi?Yi.getAtTileOffsetFunc(Ue,ie):is=>[0,0,0];ms(Qe,Ue.projMatrix,f,_,nr,qn,ee,O,xl,Ue)}const zr=f.translatePosMatrix(Ue.projMatrix,ct,x,w),lo=ge||_&&Ge||ao?za:nr,Dc=f.translatePosMatrix(qn,ct,x,w,!0),So=Ln&&0!==l.paint.get(_?"text-halo-width":"icon-halo-width").constantOr(1);let ya;const $t=ie.createInversionMatrix(Ue.toUnwrapped());ya=Ln?Qe.iconsInText?sl(xt.kind,yr,me,ee,f,zr,lo,Dc,mn,Vo,mr,ht,$t,ze):pn(xt.kind,yr,me,ee,f,zr,lo,Dc,_,mn,!0,mr,ht,$t,ze):da(xt.kind,yr,me,ee,f,zr,lo,Dc,_,mn,mr,ht,$t,ze);const sn={program:yn,buffers:Yt,uniformValues:ya,atlasTexture:Vn,atlasTextureIcon:jo,atlasInterpolation:Fn,atlasInterpolationIcon:wi,isSDF:Ln,hasHalo:So,tile:ct,labelPlaneMatrixInv:wn};if(fe&&Qe.canOverlap){pe=!0;const Yi=Yt.segments.get();for(const xl of Yi)lt.push({segments:new u.SegmentVector([xl]),sortKey:xl.sortKey,state:sn})}else lt.push({segments:Yt.segments,sortKey:0,state:sn})}pe&&lt.sort((Ue,ct)=>Ue.sortKey-ct.sortKey);for(const Ue of lt){const ct=Ue.state;if(f.terrain&&f.terrain.setupElevationDraw(ct.tile,ct.program,{useDepthForOcclusion:!bt,labelPlaneMatrixInv:ct.labelPlaneMatrixInv}),K.activeTexture.set(re.TEXTURE0),ct.atlasTexture.bind(ct.atlasInterpolation,re.CLAMP_TO_EDGE),ct.atlasTextureIcon&&(K.activeTexture.set(re.TEXTURE1),ct.atlasTextureIcon&&ct.atlasTextureIcon.bind(ct.atlasInterpolationIcon,re.CLAMP_TO_EDGE)),ct.isSDF){const Qe=ct.uniformValues;ct.hasHalo&&(Qe.u_is_halo=1,ll(ct.buffers,Ue.segments,l,f,ct.program,be,N,$,Qe)),Qe.u_is_halo=0}ll(ct.buffers,Ue.segments,l,f,ct.program,be,N,$,ct.uniformValues)}}function ll(f,n,l,p,_,x,w,S,F){const O=p.context;_.draw(O,O.gl.TRIANGLES,x,w,S,u.CullFaceMode.disabled,F,l.id,f.layoutVertexBuffer,f.indexBuffer,n,l.paint,p.transform.zoom,f.programConfigurations.get(l.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Jo(f,n,l,p,_,x,w){const S=f.context.gl,F=l.paint.get("fill-pattern"),O=F&&F.constantOr(1),N=l.getCrossfadeParameters();let $,K,re,te,ie;w?(K=O&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=S.LINES):(K=O?"fillPattern":"fill",$=S.TRIANGLES);for(const xe of p){const ee=n.getTile(xe);if(O&&!ee.patternsLoaded())continue;const ge=ee.getBucket(l);if(!ge)continue;f.prepareDrawTile(xe);const me=ge.programConfigurations.get(l.id),fe=f.useProgram(K,me);O&&(f.context.activeTexture.set(S.TEXTURE0),ee.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),me.updatePaintBuffers(N));const pe=F.constantOr(null);if(pe&&ee.imageAtlas){const ze=ee.imageAtlas,Ge=ze.patternPositions[pe.to.toString()],bt=ze.patternPositions[pe.from.toString()];Ge&&bt&&me.setConstantPatternPositions(Ge,bt)}const be=f.translatePosMatrix(xe.projMatrix,ee,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(w){te=ge.indexBuffer2,ie=ge.segments2;const ze=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];re="fillOutlinePattern"===K&&O?_r(be,f,N,ee,ze):dn(be,ze)}else te=ge.indexBuffer,ie=ge.segments,re=O?Sr(be,f,N,ee):Cr(be);f.prepareDrawProgram(f.context,fe,xe.toUnwrapped()),fe.draw(f.context,$,_,f.stencilModeForClipping(xe),x,u.CullFaceMode.disabled,re,l.id,ge.layoutVertexBuffer,te,ie,l.paint,f.transform.zoom,me)}}function xo(f,n,l,p,_,x,w){const S=f.context,F=S.gl,O=l.paint.get("fill-extrusion-pattern"),N=O.constantOr(1),$=l.getCrossfadeParameters(),K=l.paint.get("fill-extrusion-opacity");for(const re of p){const te=n.getTile(re),ie=te.getBucket(l);if(!ie)continue;const xe=ie.programConfigurations.get(l.id),ee=f.useProgram(N?"fillExtrusionPattern":"fillExtrusion",xe);if(f.terrain){const be=f.terrain;if(!ie.enableTerrain)continue;if(be.setupElevationDraw(te,ee,{useMeterToDem:!0}),Xs(S,n,re,ie,l,be),!ie.centroidVertexBuffer){const ze=ee.attributes.a_centroid_pos;void 0!==ze&&F.vertexAttrib2f(ze,0,0)}}N&&(f.context.activeTexture.set(F.TEXTURE0),te.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),xe.updatePaintBuffers($));const ge=O.constantOr(null);if(ge&&te.imageAtlas){const be=te.imageAtlas,ze=be.patternPositions[ge.to.toString()],Ge=be.patternPositions[ge.from.toString()];ze&&Ge&&xe.setConstantPatternPositions(ze,Ge)}const me=f.translatePosMatrix(re.projMatrix,te,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),fe=l.paint.get("fill-extrusion-vertical-gradient"),pe=N?gn(me,f,fe,K,re,$,te):rn(me,f,fe,K);f.prepareDrawProgram(S,ee,re.toUnwrapped()),ee.draw(S,S.gl.TRIANGLES,_,x,w,u.CullFaceMode.backCCW,pe,l.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,l.paint,f.transform.zoom,xe,f.terrain?ie.centroidVertexBuffer:null)}}function Xs(f,n,l,p,_,x){const w=[ee=>{let ge=ee.canonical.x-1,me=ee.wrap;return ge<0&&(ge=(1<<ee.canonical.z)-1,me--),new u.OverscaledTileID(ee.overscaledZ,me,ee.canonical.z,ge,ee.canonical.y)},ee=>{let ge=ee.canonical.x+1,me=ee.wrap;return ge===1<<ee.canonical.z&&(ge=0,me++),new u.OverscaledTileID(ee.overscaledZ,me,ee.canonical.z,ge,ee.canonical.y)},ee=>new u.OverscaledTileID(ee.overscaledZ,ee.wrap,ee.canonical.z,ee.canonical.x,(0===ee.canonical.y?1<<ee.canonical.z:ee.canonical.y)-1),ee=>new u.OverscaledTileID(ee.overscaledZ,ee.wrap,ee.canonical.z,ee.canonical.x,ee.canonical.y===(1<<ee.canonical.z)-1?0:ee.canonical.y+1)],S=ee=>{const ge=n.getSource().maxzoom,me=ze=>{const Ge=n.getTileByID(ze);if(Ge&&Ge.hasData())return Ge.getBucket(_)};let fe,pe,be;return(ee.overscaledZ===ee.canonical.z||ee.overscaledZ>=ge)&&(fe=me(ee.key)),ee.overscaledZ>=ge&&(pe=me(ee.calculateScaledKey(ee.overscaledZ+1))),ee.overscaledZ>ge&&(be=me(ee.calculateScaledKey(ee.overscaledZ-1))),fe||pe||be},F=[0,0,0],O=(ee,ge)=>(F[0]=Math.min(ee.min.y,ge.min.y),F[1]=Math.max(ee.max.y,ge.max.y),F[2]=u.EXTENT-ge.min.x>ee.max.x?ge.min.x-u.EXTENT:ee.max.x,F),N=(ee,ge)=>(F[0]=Math.min(ee.min.x,ge.min.x),F[1]=Math.max(ee.max.x,ge.max.x),F[2]=u.EXTENT-ge.min.y>ee.max.y?ge.min.y-u.EXTENT:ee.max.y,F),$=[(ee,ge)=>O(ee,ge),(ee,ge)=>O(ge,ee),(ee,ge)=>N(ee,ge),(ee,ge)=>N(ge,ee)],K=new u.pointGeometry(0,0);let re,te,ie;const xe=(ee,ge,me,fe,pe)=>{const be=[[fe?me:ee,fe?ee:me,0],[fe?me:ge,fe?ge:me,0]],ze=pe<0?u.EXTENT+pe:pe,Ge=[fe?ze:(ee+ge)/2,fe?(ee+ge)/2:ze,0];return 0===me&&pe<0||0!==me&&pe>0?x.getForTilePoints(ie,[Ge],!0,te):be.push(Ge),x.getForTilePoints(l,be,!0,re),Math.max(be[0][2],be[1][2],Ge[2])/x.exaggeration()};for(let ee=0;ee<4;ee++){const ge=p.borders[ee];if(0===ge.length&&(p.borderDone[ee]=!0),p.borderDone[ee])continue;const me=ie=w[ee](l),fe=S(me);if(!(fe&&fe.enableTerrain&&(te=x.findDEMTileFor(me),te&&te.dem)))continue;if(!re){const Ge=x.findDEMTileFor(l);if(!Ge||!Ge.dem)return;re=Ge}const pe=(ee<2?1:5)-ee,be=fe.borders[pe];let ze=0;for(let Ge=0;Ge<ge.length;Ge++){const bt=p.featuresOnBorder[ge[Ge]],ht=bt.borders[ee];let lt;for(;ze<be.length&&(lt=fe.featuresOnBorder[be[ze]],!(lt.borders[pe][1]>ht[0]+3));)fe.borderDone[pe]||fe.encodeCentroid(void 0,lt,!1),ze++;if(lt&&ze<be.length){const Ke=ze;let Ue=0;for(;!(lt.borders[pe][0]>ht[1]-3)&&(Ue++,++ze!==be.length);)lt=fe.featuresOnBorder[be[ze]];if(lt=fe.featuresOnBorder[be[Ke]],bt.intersectsCount()>1||lt.intersectsCount()>1||1!==Ue){1!==Ue&&(ze=Ke),p.encodeCentroid(void 0,bt,!1),fe.borderDone[pe]||fe.encodeCentroid(void 0,lt,!1);continue}const ct=$[ee](bt,lt),Qe=ee%2?u.EXTENT-1:0;K.x=xe(ct[0],Math.min(u.EXTENT-1,ct[1]),Qe,ee<2,ct[2]),K.y=0,p.encodeCentroid(K,bt,!1),fe.borderDone[pe]||fe.encodeCentroid(K,lt,!1)}else p.encodeCentroid(void 0,bt,!1)}p.borderDone[ee]=p.needsCentroidUpdate=!0,fe.borderDone[pe]||(fe.borderDone[pe]=fe.needsCentroidUpdate=!0)}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&0!==p.centroidVertexArray.length)&&p.uploadCentroid(f)}const Bl=new u.Color(1,0,0,1),fh=new u.Color(0,1,0,1),Rs=new u.Color(0,0,1,1),Ys=new u.Color(1,0,1,1),cl=new u.Color(0,1,1,1);function Mr(f,n,l,p){Ks(f,0,n+l/2,f.transform.width,l,p)}function zo(f,n,l,p){Ks(f,n-l/2,0,l,f.transform.height,p)}function Ks(f,n,l,p,_,x){const w=f.context,S=w.gl;S.enable(S.SCISSOR_TEST),S.scissor(n*u.exported.devicePixelRatio,l*u.exported.devicePixelRatio,p*u.exported.devicePixelRatio,_*u.exported.devicePixelRatio),w.clear({color:x}),S.disable(S.SCISSOR_TEST)}function Ls(f,n,l){const p=f.context,_=p.gl,x=l.projMatrix,w=f.useProgram("debug"),S=n.getTileByID(l.key);f.terrain&&f.terrain.setupElevationDraw(S,w);const F=u.DepthMode.disabled,O=u.StencilMode.disabled,N=f.colorModeForRenderPass(),$="$debug";p.activeTexture.set(_.TEXTURE0),f.emptyTexture.bind(_.LINEAR,_.CLAMP_TO_EDGE),S._makeDebugTileBoundsBuffers(f.context,f.transform.projection);const K=S._tileDebugBuffer||f.debugBuffer,re=S._tileDebugIndexBuffer||f.debugIndexBuffer,te=S._tileDebugSegments||f.debugSegments;w.draw(p,_.LINE_STRIP,F,O,N,u.CullFaceMode.disabled,yo(x,u.Color.red),$,K,re,te);const ie=S.latestRawTileData,xe=Math.floor((ie&&ie.byteLength||0)/1024),ee=n.getTile(l).tileSize,ge=512/Math.min(ee,512)*(l.overscaledZ/f.transform.zoom)*.5;let me=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(me+=` => ${l.overscaledZ}`),function(fe,pe){fe.initDebugOverlayCanvas();const be=fe.debugOverlayCanvas,ze=fe.context.gl,Ge=fe.debugOverlayCanvas.getContext("2d");Ge.clearRect(0,0,be.width,be.height),Ge.shadowColor="white",Ge.shadowBlur=2,Ge.lineWidth=1.5,Ge.strokeStyle="white",Ge.textBaseline="top",Ge.font="bold 36px Open Sans, sans-serif",Ge.fillText(pe,5,5),Ge.strokeText(pe,5,5),fe.debugOverlayTexture.update(be),fe.debugOverlayTexture.bind(ze.LINEAR,ze.CLAMP_TO_EDGE)}(f,`${me} ${xe}kb`),w.draw(p,_.TRIANGLES,F,O,u.ColorMode.alphaBlended,u.CullFaceMode.disabled,yo(x,u.Color.transparent,ge),$,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments)}const es=u.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:pc}=es;function Bo(f,n,l,p){f.emplaceBack(n,l,p)}class ul{constructor(n){this.vertexArray=new u.StructArrayLayout3f12,this.indices=new u.StructArrayLayout3ui6,Bo(this.vertexArray,-1,-1,1),Bo(this.vertexArray,1,-1,1),Bo(this.vertexArray,-1,1,1),Bo(this.vertexArray,1,1,1),Bo(this.vertexArray,-1,-1,-1),Bo(this.vertexArray,1,-1,-1),Bo(this.vertexArray,-1,1,-1),Bo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,pc),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=u.SegmentVector.simpleSegment(0,0,36,12)}}function Qs(f,n,l,p,_,x){const w=f.gl,S=n.paint.get("sky-atmosphere-color"),F=n.paint.get("sky-atmosphere-halo-color"),O=n.paint.get("sky-atmosphere-sun-intensity"),N={u_matrix_3f:u.fromMat4([],p),u_sun_direction:_,u_sun_intensity:O,u_color_tint_r:[(te=S).r,te.g,te.b,te.a],u_color_tint_m:[(ie=F).r,ie.g,ie.b,ie.a],u_luminance:5e-5};var te,ie;w.framebufferTexture2D(w.FRAMEBUFFER,w.COLOR_ATTACHMENT0,w.TEXTURE_CUBE_MAP_POSITIVE_X+x,n.skyboxTexture,0),l.draw(f,w.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.frontCW,N,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const fa={symbol:function(f,n,l,p,_){if("translucent"!==f.renderPass)return;const x=u.StencilMode.disabled,w=f.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(S,F,O,N,$,K,re){const te=F.transform,ie="map"===$,xe="map"===K,ee=te.projection.createTileTransform(te,te.worldSize);for(const ge of S){const me=N.getTile(ge),fe=me.getBucket(O);if(!fe||fe.projection!==te.projection.name||!fe.text||!fe.text.segments.get().length)continue;const pe=u.evaluateSizeForZoom(fe.textSizeData,te.zoom),be=F.transform.calculatePixelsToTileUnitsMatrix(me),ze=Er(ge.projMatrix,me.tileID.canonical,xe,ie,F.transform,be),Ge="none"!==O.layout.get("icon-text-fit")&&fe.hasIconData();if(pe){const bt=Math.pow(2,te.zoom-me.tileID.overscaledZ);tr(fe,ie,xe,re,u.symbolSize,te,ze,ge,bt,pe,Ge,ee)}}}(p,f,l,n,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),_),0!==l.paint.get("icon-opacity").constantOr(1)&&si(f,n,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),x,w),0!==l.paint.get("text-opacity").constantOr(1)&&si(f,n,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),x,w),n.map.showCollisionBoxes&&(fc(f,n,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),fc(f,n,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(f,n,l,p){if("translucent"!==f.renderPass)return;const _=l.paint.get("circle-opacity"),x=l.paint.get("circle-stroke-width"),w=l.paint.get("circle-stroke-opacity"),S=void 0!==l.layout.get("circle-sort-key").constantOr(1);if(0===_.constantOr(1)&&(0===x.constantOr(1)||0===w.constantOr(1)))return;const F=f.context,O=F.gl,N=f.depthModeForSublayer(0,u.DepthMode.ReadOnly),$=u.StencilMode.disabled,K=f.colorModeForRenderPass(),re=[];for(let ie=0;ie<p.length;ie++){const xe=p[ie],ee=n.getTile(xe),ge=ee.getBucket(l);if(!ge)continue;const me=ge.programConfigurations.get(l.id),fe=ei(l),pe={programConfiguration:me,program:f.useProgram("circle",me,fe),layoutVertexBuffer:ge.layoutVertexBuffer,indexBuffer:ge.indexBuffer,uniformValues:Vr(f,xe,ee,l),tile:ee};if(S){const be=ge.segments.get();for(const ze of be)re.push({segments:new u.SegmentVector([ze]),sortKey:ze.sortKey,state:pe})}else re.push({segments:ge.segments,sortKey:0,state:pe})}S&&re.sort((ie,xe)=>ie.sortKey-xe.sortKey);const te={useDepthForOcclusion:"globe"!==f.transform.projection.name};for(const ie of re){const{programConfiguration:xe,program:ee,layoutVertexBuffer:ge,indexBuffer:me,uniformValues:fe,tile:pe}=ie.state,be=ie.segments;f.terrain&&f.terrain.setupElevationDraw(pe,ee,te),f.prepareDrawProgram(F,ee,pe.tileID.toUnwrapped()),ee.draw(F,O.TRIANGLES,N,$,K,u.CullFaceMode.disabled,fe,l.id,ge,me,be,l.paint,f.transform.zoom,xe)}},heatmap:function(f,n,l,p){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===f.renderPass){const _=f.context,x=_.gl,w=u.StencilMode.disabled,S=new u.ColorMode([x.ONE,x.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(F,O,N){const $=F.gl;F.activeTexture.set($.TEXTURE1),F.viewport.set([0,0,O.width/4,O.height/4]);let K=N.heatmapFbo;if(K)$.bindTexture($.TEXTURE_2D,K.colorAttachment.get()),F.bindFramebuffer.set(K.framebuffer);else{const re=$.createTexture();$.bindTexture($.TEXTURE_2D,re),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_S,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_WRAP_T,$.CLAMP_TO_EDGE),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MIN_FILTER,$.LINEAR),$.texParameteri($.TEXTURE_2D,$.TEXTURE_MAG_FILTER,$.LINEAR),K=N.heatmapFbo=F.createFramebuffer(O.width/4,O.height/4,!1),function(te,ie,xe,ee){const ge=te.gl;ge.texImage2D(ge.TEXTURE_2D,0,ge.RGBA,ie.width/4,ie.height/4,0,ge.RGBA,te.extRenderToTextureHalfFloat?te.extTextureHalfFloat.HALF_FLOAT_OES:ge.UNSIGNED_BYTE,null),ee.colorAttachment.set(xe)}(F,O,re,K)}})(_,f,l),_.clear({color:u.Color.transparent});for(let F=0;F<p.length;F++){const O=p[F];if(n.hasRenderableParent(O))continue;const N=n.getTile(O),$=N.getBucket(l);if(!$)continue;const K=$.programConfigurations.get(l.id),re=f.useProgram("heatmap",K),{zoom:te}=f.transform;f.terrain&&f.terrain.setupElevationDraw(N,re),f.prepareDrawProgram(_,re,O.toUnwrapped()),re.draw(_,x.TRIANGLES,u.DepthMode.disabled,w,S,u.CullFaceMode.disabled,Ps(O.projMatrix,N,te,l.paint.get("heatmap-intensity")),l.id,$.layoutVertexBuffer,$.indexBuffer,$.segments,l.paint,f.transform.zoom,K)}_.viewport.set([0,0,f.width,f.height])}else"translucent"===f.renderPass&&(f.context.setColorMode(f.colorModeForRenderPass()),function(_,x){const w=_.context,S=w.gl,F=x.heatmapFbo;if(!F)return;w.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,F.colorAttachment.get()),w.activeTexture.set(S.TEXTURE1);let O=x.colorRampTexture;O||(O=x.colorRampTexture=new u.Texture(w,x.colorRamp,S.RGBA)),O.bind(S.LINEAR,S.CLAMP_TO_EDGE),_.useProgram("heatmapTexture").draw(w,S.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,_.colorModeForRenderPass(),u.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:x.paint.get("heatmap-opacity")},x.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,x.paint,_.transform.zoom)}(f,l))},line:function(f,n,l,p){if("translucent"!==f.renderPass)return;const _=l.paint.get("line-opacity"),x=l.paint.get("line-width");if(0===_.constantOr(1)||0===x.constantOr(1))return;const w=f.depthModeForSublayer(0,u.DepthMode.ReadOnly),S=f.colorModeForRenderPass(),F=l.paint.get("line-dasharray"),O=F.constantOr(1),N=l.layout.get("line-cap"),$=l.paint.get("line-pattern"),K=$.constantOr(1),re=l.paint.get("line-gradient"),te=l.getCrossfadeParameters(),ie=K?"linePattern":"line",xe=f.context,ee=xe.gl,ge=(fe=>{const pe=[];Fa(fe)&&pe.push("RENDER_LINE_DASH"),fe.paint.get("line-gradient")&&pe.push("RENDER_LINE_GRADIENT");const be=fe.paint.get("line-pattern").constantOr(1),ze=1!==fe.paint.get("line-opacity").constantOr(1);return!be&&ze&&pe.push("RENDER_LINE_ALPHA_DISCARD"),pe})(l);let me=ge.includes("RENDER_LINE_ALPHA_DISCARD");f.terrain&&f.terrain.clipOrMaskOverlapStencilType()&&(me=!1);for(const fe of p){const pe=n.getTile(fe);if(K&&!pe.patternsLoaded())continue;const be=pe.getBucket(l);if(!be)continue;f.prepareDrawTile(fe);const ze=be.programConfigurations.get(l.id),Ge=f.useProgram(ie,ze,ge),bt=$.constantOr(null);if(bt&&pe.imageAtlas){const Qe=pe.imageAtlas,Yt=Qe.patternPositions[bt.to.toString()],on=Qe.patternPositions[bt.from.toString()];Yt&&on&&ze.setConstantPatternPositions(Yt,on)}const ht=F.constantOr(null),lt=N.constantOr(null);if(!K&&ht&&lt&&pe.lineAtlas){const Qe=pe.lineAtlas,Yt=Qe.getDash(ht.to,lt),on=Qe.getDash(ht.from,lt);Yt&&on&&ze.setConstantPatternPositions(Yt,on)}const Ke=f.terrain?fe.projMatrix:null,Ue=K?oi(f,pe,l,te,Ke):vo(f,pe,l,te,Ke,be.lineClipsArray.length);if(re){const Qe=be.gradients[l.id];let Yt=Qe.texture;if(l.gradientVersion!==Qe.version){let on=256;if(l.stepInterpolant){const Ln=n.getSource().maxzoom,xt=fe.canonical.z===Ln?Math.ceil(1<<f.transform.maxZoom-fe.canonical.z):1;on=u.clamp(u.nextPowerOfTwo(be.maxLineLength/u.EXTENT*1024*xt),256,xe.maxTextureSize)}Qe.gradient=u.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:on,image:Qe.gradient||void 0,clips:be.lineClipsArray}),Qe.texture?Qe.texture.update(Qe.gradient):Qe.texture=new u.Texture(xe,Qe.gradient,ee.RGBA),Qe.version=l.gradientVersion,Yt=Qe.texture}xe.activeTexture.set(ee.TEXTURE1),Yt.bind(l.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}O&&(xe.activeTexture.set(ee.TEXTURE0),pe.lineAtlasTexture.bind(ee.LINEAR,ee.REPEAT),ze.updatePaintBuffers(te)),K&&(xe.activeTexture.set(ee.TEXTURE0),pe.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),ze.updatePaintBuffers(te)),f.prepareDrawProgram(xe,Ge,fe.toUnwrapped());const ct=Qe=>{Ge.draw(xe,ee.TRIANGLES,w,Qe,S,u.CullFaceMode.disabled,Ue,l.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,l.paint,f.transform.zoom,ze,be.layoutVertexBuffer2)};if(me){const Qe=f.stencilModeForClipping(fe).ref;0===Qe&&f.terrain&&xe.clear({stencil:0});const Yt={func:ee.EQUAL,mask:255};Ue.u_alpha_discard_threshold=.8,ct(new u.StencilMode(Yt,Qe,255,ee.KEEP,ee.KEEP,ee.INVERT)),Ue.u_alpha_discard_threshold=0,ct(new u.StencilMode(Yt,Qe,255,ee.KEEP,ee.KEEP,ee.KEEP))}else ct(f.stencilModeForClipping(fe))}me&&(f.resetStencilClippingMasks(),f.terrain&&xe.clear({stencil:0}))},fill:function(f,n,l,p){const _=l.paint.get("fill-color"),x=l.paint.get("fill-opacity");if(0===x.constantOr(1))return;const w=f.colorModeForRenderPass(),S=l.paint.get("fill-pattern"),F=f.opaquePassEnabledForLayer()&&!S.constantOr(1)&&1===_.constantOr(u.Color.transparent).a&&1===x.constantOr(0)?"opaque":"translucent";if(f.renderPass===F){const O=f.depthModeForSublayer(1,"opaque"===f.renderPass?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly);Jo(f,n,l,p,O,w,!1)}if("translucent"===f.renderPass&&l.paint.get("fill-antialias")){const O=f.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,u.DepthMode.ReadOnly);Jo(f,n,l,p,O,w,!0)}},"fill-extrusion":function(f,n,l,p){const _=l.paint.get("fill-extrusion-opacity");if(0!==_&&"translucent"===f.renderPass){const x=new u.DepthMode(f.context.gl.LEQUAL,u.DepthMode.ReadWrite,f.depthRangeFor3D);if(1!==_||l.paint.get("fill-extrusion-pattern").constantOr(1))xo(f,n,l,p,x,u.StencilMode.disabled,u.ColorMode.disabled),xo(f,n,l,p,x,f.stencilModeFor3D(),f.colorModeForRenderPass()),f.resetStencilClippingMasks();else{const w=f.colorModeForRenderPass();xo(f,n,l,p,x,u.StencilMode.disabled,w)}}},hillshade:function(f,n,l,p){if("offscreen"!==f.renderPass&&"translucent"!==f.renderPass)return;const _=f.context,x=f.depthModeForSublayer(0,u.DepthMode.ReadOnly),w=f.colorModeForRenderPass(),S=f.terrain&&f.terrain.renderingToTexture,[F,O]="translucent"!==f.renderPass||S?[{},p]:f.stencilConfigForOverlap(p);for(const N of O){const $=n.getTile(N);if($.needsHillshadePrepare&&"offscreen"===f.renderPass)ha(f,$,l,x,u.StencilMode.disabled,w);else if("translucent"===f.renderPass){const K=S&&f.terrain?f.terrain.stencilModeForRTTOverlap(N):F[N.overscaledZ];ua(f,N,$,l,x,K,w)}}_.viewport.set([0,0,f.width,f.height]),f.resetStencilClippingMasks()},raster:function(f,n,l,p,_,x){if("translucent"!==f.renderPass||0===l.paint.get("raster-opacity")||!p.length)return;const w=f.context,S=w.gl,F=n.getSource(),O=f.useProgram("raster"),N=f.colorModeForRenderPass(),$=f.terrain&&f.terrain.renderingToTexture,[K,re]=F instanceof ko||$?[{},p]:f.stencilConfigForOverlap(p),te=re[re.length-1].overscaledZ,ie=!f.options.moving;for(const xe of re){const ee=$?u.DepthMode.disabled:f.depthModeForSublayer(xe.overscaledZ-te,1===l.paint.get("raster-opacity")?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly,S.LESS),ge=xe.toUnwrapped(),me=n.getTile(xe);if($&&(!me||!me.hasData()))continue;const fe=$?xe.projMatrix:f.transform.calculateProjMatrix(ge,ie),pe=f.terrain&&$?f.terrain.stencilModeForRTTOverlap(xe):K[xe.overscaledZ],be=x?0:l.paint.get("raster-fade-duration");me.registerFadeDuration(be);const ze=n.findLoadedParent(xe,0),Ge=La(me,ze,n,f.transform,be);let bt,ht;f.terrain&&f.terrain.prepareDrawTile(xe);const lt="nearest"===l.paint.get("raster-resampling")?S.NEAREST:S.LINEAR;w.activeTexture.set(S.TEXTURE0),me.texture.bind(lt,S.CLAMP_TO_EDGE),w.activeTexture.set(S.TEXTURE1),ze?(ze.texture.bind(lt,S.CLAMP_TO_EDGE),bt=Math.pow(2,ze.tileID.overscaledZ-me.tileID.overscaledZ),ht=[me.tileID.canonical.x*bt%1,me.tileID.canonical.y*bt%1]):me.texture.bind(lt,S.CLAMP_TO_EDGE);const Ke=Oo(fe,ht||[0,0],bt||1,Ge,l,F instanceof ko?F.perspectiveTransform:[0,0]);if(f.prepareDrawProgram(w,O,ge),F instanceof ko)O.draw(w,S.TRIANGLES,ee,u.StencilMode.disabled,N,u.CullFaceMode.disabled,Ke,l.id,F.boundsBuffer,f.quadTriangleIndexBuffer,F.boundsSegments);else{const{tileBoundsBuffer:Ue,tileBoundsIndexBuffer:ct,tileBoundsSegments:Qe}=f.getTileBoundsBuffers(me);O.draw(w,S.TRIANGLES,ee,pe,N,u.CullFaceMode.disabled,Ke,l.id,Ue,ct,Qe)}}f.resetStencilClippingMasks()},background:function(f,n,l,p){const _=l.paint.get("background-color"),x=l.paint.get("background-opacity");if(0===x)return;const w=f.context,S=w.gl,F=f.transform,O=F.tileSize,N=l.paint.get("background-pattern");if(f.isPatternMissing(N))return;const $=!N&&1===_.a&&1===x&&f.opaquePassEnabledForLayer()?"opaque":"translucent";if(f.renderPass!==$)return;const K=u.StencilMode.disabled,re=f.depthModeForSublayer(0,"opaque"===$?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly),te=f.colorModeForRenderPass(),ie=f.useProgram(N?"backgroundPattern":"background");let xe,ee=p;ee||(xe=f.getBackgroundTiles(),ee=Object.values(xe).map(me=>me.tileID)),N&&(w.activeTexture.set(S.TEXTURE0),f.imageManager.bind(f.context));const ge=l.getCrossfadeParameters();for(const me of ee){const fe=me.toUnwrapped(),pe=p?me.projMatrix:f.transform.calculateProjMatrix(fe);f.prepareDrawTile(me);const be=n?n.getTile(me):xe?xe[me.key]:new u.Tile(me,O,F.zoom,f),ze=N?zl(pe,x,f,N,{tileID:me,tileSize:O},ge):or(pe,x,_);f.prepareDrawProgram(w,ie,fe);const{tileBoundsBuffer:Ge,tileBoundsIndexBuffer:bt,tileBoundsSegments:ht}=f.getTileBoundsBuffers(be);ie.draw(w,S.TRIANGLES,re,K,te,u.CullFaceMode.disabled,ze,l.id,Ge,bt,ht)}},sky:function(f,n,l){const p=f.transform,_="mercator"===p.projection.name||"globe"===p.projection.name?1:u.smoothstep(7,8,p.zoom),x=l.paint.get("sky-opacity")*_;if(0===x)return;const w=f.context,S=l.paint.get("sky-type"),F=new u.DepthMode(w.gl.LEQUAL,u.DepthMode.ReadOnly,[0,1]),O=f.frameCounter/1e3%1;"atmosphere"===S?"offscreen"===f.renderPass?l.needsSkyboxCapture(f)&&(function(N,$,K,re){const te=N.context,ie=te.gl;let xe=$.skyboxFbo;if(!xe){xe=$.skyboxFbo=te.createFramebuffer(32,32,!1),$.skyboxGeometry=new ul(te),$.skyboxTexture=te.gl.createTexture(),ie.bindTexture(ie.TEXTURE_CUBE_MAP,$.skyboxTexture),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_WRAP_S,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_WRAP_T,ie.CLAMP_TO_EDGE),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_MIN_FILTER,ie.LINEAR),ie.texParameteri(ie.TEXTURE_CUBE_MAP,ie.TEXTURE_MAG_FILTER,ie.LINEAR);for(let fe=0;fe<6;++fe)ie.texImage2D(ie.TEXTURE_CUBE_MAP_POSITIVE_X+fe,0,ie.RGBA,32,32,0,ie.RGBA,ie.UNSIGNED_BYTE,null)}te.bindFramebuffer.set(xe.framebuffer),te.viewport.set([0,0,32,32]);const ee=$.getCenter(N,!0),ge=N.useProgram("skyboxCapture"),me=new Float64Array(16);u.identity(me),u.rotateY(me,me,.5*-Math.PI),Qs(te,$,ge,me,ee,0),u.identity(me),u.rotateY(me,me,.5*Math.PI),Qs(te,$,ge,me,ee,1),u.identity(me),u.rotateX(me,me,.5*-Math.PI),Qs(te,$,ge,me,ee,2),u.identity(me),u.rotateX(me,me,.5*Math.PI),Qs(te,$,ge,me,ee,3),u.identity(me),Qs(te,$,ge,me,ee,4),u.identity(me),u.rotateY(me,me,Math.PI),Qs(te,$,ge,me,ee,5),te.viewport.set([0,0,N.width,N.height])}(f,l),l.markSkyboxValid(f)):"sky"===f.renderPass&&function(N,$,K,re,te){const ie=N.context,xe=ie.gl,ee=N.transform,ge=N.useProgram("skybox");ie.activeTexture.set(xe.TEXTURE0),xe.bindTexture(xe.TEXTURE_CUBE_MAP,$.skyboxTexture);const me={u_matrix:ee.skyboxMatrix,u_sun_direction:$.getCenter(N,!1),u_cubemap:0,u_opacity:re,u_temporal_offset:te};N.prepareDrawProgram(ie,ge),ge.draw(ie,xe.TRIANGLES,K,u.StencilMode.disabled,N.colorModeForRenderPass(),u.CullFaceMode.backCW,me,"skybox",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(f,l,F,x,O):"gradient"===S&&"sky"===f.renderPass&&function(N,$,K,re,te){const ie=N.context,xe=ie.gl,ee=N.transform,ge=N.useProgram("skyboxGradient");$.skyboxGeometry||($.skyboxGeometry=new ul(ie)),ie.activeTexture.set(xe.TEXTURE0);let me=$.colorRampTexture;me||(me=$.colorRampTexture=new u.Texture(ie,$.colorRamp,xe.RGBA)),me.bind(xe.LINEAR,xe.CLAMP_TO_EDGE);const fe=(pe=ee.skyboxMatrix,be=$.getCenter(N,!1),ze=$.paint.get("sky-gradient-radius"),Ge=re,bt=te,{u_matrix:pe,u_color_ramp:0,u_center_direction:be,u_radius:u.degToRad(ze),u_opacity:Ge,u_temporal_offset:bt});var pe,be,ze,Ge,bt;N.prepareDrawProgram(ie,ge),ge.draw(ie,xe.TRIANGLES,K,u.StencilMode.disabled,N.colorModeForRenderPass(),u.CullFaceMode.backCW,fe,"skyboxGradient",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(f,l,F,x,O)},debug:function(f,n,l){for(let p=0;p<l.length;p++)Ls(f,n,l[p])},custom:function(f,n,l){const p=f.context,_=l.implementation;if(f.transform.projection.unsupportedLayers&&f.transform.projection.unsupportedLayers.includes("custom"))u.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===f.renderPass){const x=_.prerender;x&&(f.setCustomLayerDefaults(),p.setColorMode(f.colorModeForRenderPass()),x.call(_,p.gl,f.transform.customLayerMatrix()),p.setDirty(),f.setBaseState())}else if("translucent"===f.renderPass){f.setCustomLayerDefaults(),p.setColorMode(f.colorModeForRenderPass()),p.setStencilMode(u.StencilMode.disabled);const x="3d"===_.renderingMode?new u.DepthMode(f.context.gl.LEQUAL,u.DepthMode.ReadWrite,f.depthRangeFor3D):f.depthModeForSublayer(0,u.DepthMode.ReadOnly);p.setDepthMode(x),_.render(p.gl,f.transform.customLayerMatrix()),p.setDirty(),f.setBaseState(),p.bindFramebuffer.set(null)}}};class Nl{constructor(n,l){this.context=new po(n),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=u.SourceCache.maxUnderzooming+u.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ra,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,l){const p=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new J(this,n));const _=this._terrain;this.transform.elevation=p?_:null,_.update(n,this.transform,l)}_updateFog(n){const l=n.fog;if(!l||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,_]=l.getFovAdjustedRange(this.transform._fov);if(p>_)return void(this.transform.fogCullDistSq=null);const x=p+.78*(_-p);this.transform.fogCullDistSq=x*x}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,l){if(this.width=n*u.exported.devicePixelRatio,this.height=l*u.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const n=this.context,l=new u.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(u.EXTENT,0),l.emplaceBack(0,u.EXTENT),l.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(l,u.posAttributes.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const p=new u.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(u.EXTENT,0),p.emplaceBack(0,u.EXTENT),p.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=n.createVertexBuffer(p,u.posAttributes.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const _=new u.StructArrayLayout2i4;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(_,u.posAttributes.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const x=new u.StructArrayLayout4i8;x.emplaceBack(0,0,0,0),x.emplaceBack(u.EXTENT,0,u.EXTENT,0),x.emplaceBack(0,u.EXTENT,0,u.EXTENT),x.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(x,u.boundsAttributes.members),this.mercatorBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const w=new u.StructArrayLayout3ui6;w.emplaceBack(0,1,2),w.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(w);const S=new u.StructArrayLayout1ui2;for(const O of[0,1,3,2,0])S.emplaceBack(O);this.debugIndexBuffer=n.createIndexBuffer(S),this.emptyTexture=new u.Texture(n,{width:1,height:1,data:new Uint8Array([0,0,0,0])},n.gl.RGBA),this.identityMat=u.create();const F=this.context.gl;this.stencilClearMode=new u.StencilMode({func:F.ALWAYS,mask:0},0,255,F.ZERO,F.ZERO,F.ZERO),this.loadTimeStamps.push(u.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,l=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,l.TRIANGLES,u.DepthMode.disabled,this.stencilClearMode,u.ColorMode.disabled,u.CullFaceMode.disabled,ri(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,l,p){if(!l||this.currentStencilSource===l.id||!n.isTileClipped()||!p||0===p.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const F of p)if(void 0===this._tileClippingMaskIDs[F.key]){S=!0;break}if(!S)return}this.currentStencilSource=l.id;const _=this.context,x=_.gl;this.nextStencilID+p.length>256&&this.clearStencil(),_.setColorMode(u.ColorMode.disabled),_.setDepthMode(u.DepthMode.disabled);const w=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of p){const F=l.getTile(S),O=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:N,tileBoundsIndexBuffer:$,tileBoundsSegments:K}=this.getTileBoundsBuffers(F);w.draw(_,x.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:x.ALWAYS,mask:0},O,255,x.KEEP,x.KEEP,x.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,ri(S.projMatrix),"$clipping",N,$,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,l=this.context.gl;return new u.StencilMode({func:l.NOTEQUAL,mask:255},n,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const l=this.context.gl;return new u.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(n){const l=this.context.gl,p=n.sort((w,S)=>S.overscaledZ-w.overscaledZ),_=p[p.length-1].overscaledZ,x=p[0].overscaledZ-_+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const w={};for(let S=0;S<x;S++)w[S+_]=new u.StencilMode({func:l.GEQUAL,mask:255},S+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=x,[w,p]}return[{[_]:u.StencilMode.disabled},p]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new u.ColorMode([n.CONSTANT_COLOR,n.ONE],new u.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?u.ColorMode.unblended:u.ColorMode.alphaBlended}depthModeForSublayer(n,l,p){if(!this.opaquePassEnabledForLayer())return u.DepthMode.disabled;const _=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new u.DepthMode(p||this.context.gl.LEQUAL,l,[_,_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,l){this.style=n,this.options=l,this.lineAtlas=n.lineAtlas,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(u.exported.now()),this.imageManager.beginFrame();const p=this.style.order,_=this.style._sourceCaches;for(const O in _){const N=_[O];N.used&&N.prepare(this.context)}const x={},w={},S={};for(const O in _){const N=_[O];x[O]=N.getVisibleCoordinates(),w[O]=x[O].slice().reverse(),S[O]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let O=0;O<p.length;O++)if(this.style._layers[p[O]].is3D()){this.opaquePassCutoff=O;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new u.GlobeSharedBuffers(this.context)),!u.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const O of p){const N=this.style._layers[O],$=n._getLayerSourceCache(N);if(!N.hasOffscreenPass()||N.isHidden(this.transform.zoom))continue;const K=$?w[$.id]:void 0;("custom"===N.type||N.isSky()||K&&K.length)&&this.renderLayer(this,$,N,K)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let F=u.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(F=this.style.fog.properties.get("color")),this.context.clear({color:l.showOverdrawInspector?u.Color.black:F,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const O=this.style._layers[p[this.currentLayer]],N=n._getLayerSourceCache(O);if(O.isSky())continue;const $=N?w[N.id]:void 0;this._renderTileClippingMasks(O,N,$),this.renderLayer(this,N,O,$)}if(this.renderPass="sky",(u.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const O=this.style._layers[p[this.currentLayer]],N=n._getLayerSourceCache(O);O.isSky()&&this.renderLayer(this,N,O,N?w[N.id]:void 0)}for("globe"===this.transform.projection.name&&function(O){const N=O.context,$=N.gl,K=O.transform,re=new u.DepthMode($.LEQUAL,u.DepthMode.ReadOnly,[0,1]),te=O.useProgram("globeAtmosphere"),ie=K._camera.getWorldToCamera(K.worldSize,1),xe=K._camera.getCameraToClipPerspective(K._fov,K.width/K.height,K._nearZ,K._farZ),ee=u.mul([],ie,u.calculateGlobeMatrix(K,K.worldSize)),ge=u.mul([],K.labelPlaneMatrix,xe),me=u.transformMat4([],[0,0,0],ee),fe=u.add([],me,[K.worldSize/Math.PI/2,0,0]),pe=u.transformMat4([],me,ge),be=u.transformMat4([],fe,ge),ze=u.length(u.sub([],be,pe)),Ge=1-u.globeToMercatorTransition(K.zoom),bt={u_center:pe,u_radius:ze,u_screen_size:[K.width,K.height],u_pixel_ratio:u.exported.devicePixelRatio,u_opacity:Ge,u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};O.prepareDrawProgram(N,te);const ht=O.globeSharedBuffers;ht&&te.draw(N,$.TRIANGLES,re,u.StencilMode.disabled,u.ColorMode.alphaBlended,u.CullFaceMode.backCW,bt,"skybox",ht.atmosphereVertexBuffer,ht.atmosphereIndexBuffer,ht.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const O=this.style._layers[p[this.currentLayer]],N=n._getLayerSourceCache(O);if(O.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(O)){if(O.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const $=N?("symbol"===O.type?S:w)[N.id]:void 0;this._renderTileClippingMasks(O,N,N?x[N.id]:void 0),this.renderLayer(this,N,O,$),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let O=null;u.values(this.style._layers).forEach(N=>{const $=n._getLayerSourceCache(N);$&&!N.isHidden(this.transform.zoom)&&(!O||O.getSource().maxzoom<$.getSource().maxzoom)&&(O=$)}),O&&this.options.showTileBoundaries&&fa.debug(this,O,O.getVisibleCoordinates())}this.options.showPadding&&function(O){const N=O.transform.padding;Mr(O,O.transform.height-(N.top||0),3,Bl),Mr(O,N.bottom||0,3,fh),zo(O,N.left||0,3,Rs),zo(O,O.transform.width-(N.right||0),3,Ys);const $=O.transform.centerPoint;var K,re,te,ie;Ks(K=O,(re=$.x)-1,(te=O.transform.height-$.y)-10,2,20,ie=cl),Ks(K,re-10,te-1,20,2,ie)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(u.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,l,p,_){p.isHidden(this.transform.zoom)||("background"===p.type||"sky"===p.type||"custom"===p.type||_&&_.length)&&(this.id=p.id,this.gpuTimingStart(p),n.transform.projection.unsupportedLayers&&n.transform.projection.unsupportedLayers.includes(p.type)||fa[p.type](n,l,p,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[n.id];p||(p=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}queryGpuTimers(n){const l={};for(const p in n){const _=n[p],x=this.context.extTimerQuery,w=x.getQueryObjectEXT(_.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(_.query),l[p]=w}return l}translatePosMatrix(n,l,p,_,x){if(!p[0]&&!p[1])return n;const w=x?"map"===_?this.transform.angle:0:"viewport"===_?-this.transform.angle:0;if(w){const O=Math.sin(w),N=Math.cos(w);p=[p[0]*N-p[1]*O,p[0]*O+p[1]*N]}const S=[x?p[0]:qe(l,p[0],this.transform.zoom),x?p[1]:qe(l,p[1],this.transform.zoom),0],F=new Float32Array(16);return u.translate(F,n,S),F}saveTileTexture(n){const l=this._tileTextures[n.size[0]];l?l.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const l=this._tileTextures[n];return l&&l.length>0?l.pop():null}isPatternMissing(n){if(!n)return!1;if(!n.from||!n.to)return!0;const l=this.imageManager.getPattern(n.from.toString()),p=this.imageManager.getPattern(n.to.toString());return!l||!p}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,l=this.style&&this.style.fog,p=[];return this.terrain&&!this.terrain.renderingToTexture&&p.push("TERRAIN"),l&&!n&&0!==l.getOpacity(this.transform.pitch)&&p.push("FOG"),n&&p.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&p.push("OVERDRAW_INSPECTOR"),p}useProgram(n,l,p){this.cache=this.cache||{};const _=p||[],x=this.currentGlobalDefines().concat(_),w=Ye.cacheKey(n,x,l);return this.cache[w]||(this.cache[w]=new Ye(this.context,n,ca[n],l,Bc[n],x)),this.cache[w]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=u.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(n){this.terrain&&this.terrain.prepareDrawTile(n)}prepareDrawProgram(n,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const x=_.getOpacity(this.transform.pitch);0!==x&&l.setFogUniformValues(n,((w,S,F,O)=>{const N=S.properties.get("color"),$=w.frameCounter/1e3%1,K=[N.r/N.a,N.g/N.a,N.b/N.a,O];return{u_fog_matrix:F?w.transform.calculateFogTileMatrix(F):w.identityMat,u_fog_range:S.getFovAdjustedRange(w.transform._fov),u_fog_color:K,u_fog_horizon_blend:S.properties.get("horizon-blend"),u_fog_temporal_offset:$}})(this,_,p,x))}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const n=this.context.gl,l=n.createTexture();return n.bindTexture(n.TEXTURE_2D,l),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&0!==n.getOpacity(this.transform.pitch)}getBackgroundTiles(){const n=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const _ of p)l[_.key]=n[_.key]||new u.Tile(_,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class hl{constructor(n=0,l=0,p=0,_=0){if(isNaN(n)||n<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=l,this.left=p,this.right=_}interpolate(n,l,p){return null!=l.top&&null!=n.top&&(this.top=u.number(n.top,l.top,p)),null!=l.bottom&&null!=n.bottom&&(this.bottom=u.number(n.bottom,l.bottom,p)),null!=l.left&&null!=n.left&&(this.left=u.number(n.left,l.left,p)),null!=l.right&&null!=n.right&&(this.right=u.number(n.right,l.right,p)),this}getCenter(n,l){const p=u.clamp((this.left+n-this.right)/2,0,n),_=u.clamp((this.top+l-this.bottom)/2,0,l);return new u.pointGeometry(p,_)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new hl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function _s(f,n){const l=u.getColumn(f,3);u.fromQuat(f,n),u.setColumn(f,3,l)}function mc(f,n){u.setColumn(f,3,[n[0],n[1],n[2],1])}function gc(f,n){const l=u.identity$1([]);return u.rotateZ$1(l,l,-n),u.rotateX$1(l,l,-f),l}function pa(f,n){const l=[f[0],f[1],0],p=[n[0],n[1],0];if(u.length(l)>=1e-15){const w=u.normalize([],l);u.scale$2(p,w,u.dot(p,w)),n[0]=p[0],n[1]=p[1]}const _=u.cross([],n,f);if(u.len(_)<1e-15)return null;const x=Math.atan2(-_[1],_[0]);return gc(Math.atan2(Math.sqrt(f[0]*f[0]+f[1]*f[1]),-f[2]),x)}class Ul{constructor(n,l){this.position=n,this.orientation=l}get position(){return this._position}set position(n){this._position=this._renderWorldCopies?function(l){if(!l)return;const p=Array.isArray(l)?new u.MercatorCoordinate(l[0],l[1],l[2]):l;return p.x=u.wrap(p.x,0,1),p}(n):n}lookAtPoint(n,l){if(this.orientation=null,!this.position)return;const p=this._elevation?this._elevation.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(n)):0,_=this.position,x=u.MercatorCoordinate.fromLngLat(n,p),w=[x.x-_.x,x.y-_.y,x.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=pa(w,l)}setPitchBearing(n,l){this.orientation=gc(u.degToRad(n),u.degToRad(-l))}}class dl{constructor(n,l){this._transform=u.identity([]),this._orientation=u.identity$1([]),l&&(this._orientation=l,_s(this._transform,this._orientation)),n&&mc(this._transform,n)}get mercatorPosition(){const n=this.position;return new u.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=u.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){mc(this._transform,n)}get orientation(){return this._orientation}set orientation(n){this._orientation=n,_s(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,l){this._orientation=gc(n,l),_s(this._transform,this._orientation)}forward(){const n=u.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=u.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=u.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,l){const p=new Float64Array(16);return u.invert(p,this.getWorldToCamera(n,l)),p}getWorldToCameraPosition(n,l,p){const _=this.position;u.scale$2(_,_,-n);const x=new Float64Array(16);return u.fromScaling(x,[p,p,p]),u.translate(x,x,_),x[10]*=l,x}getWorldToCamera(n,l){const p=new Float64Array(16),_=new Float64Array(4),x=this.position;return u.conjugate(_,this._orientation),u.scale$2(x,x,-n),u.fromQuat(p,_),u.translate(p,p,x),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(n,l,p,_){const x=new Float64Array(16);return u.perspective(x,n,l,p,_),x}getDistanceToElevation(n){const l=0===n?0:u.mercatorZfromAltitude(n,this.position[1]),p=this.forward();return(l-this.position[2])/p[2]}clone(){return new dl([...this.position],[...this.orientation])}}function Vl(f,n){const l=ma(f),p=function(x,w,S,F,O){const N=new u.LngLat(S.lng-180*ts,S.lat),$=new u.LngLat(S.lng+180*ts,S.lat),K=x.project(N.lng,N.lat),re=x.project($.lng,$.lat),te=-Math.atan2(re.y-K.y,re.x-K.x),ie=u.MercatorCoordinate.fromLngLat(S);ie.y=u.clamp(ie.y,-.999975,.999975);const xe=ie.toLngLat(),ee=x.project(xe.lng,xe.lat),ge=u.MercatorCoordinate.fromLngLat(xe);ge.x+=ts;const me=ge.toLngLat(),fe=x.project(me.lng,me.lat),pe=Ri(fe.x-ee.x,fe.y-ee.y,te),be=u.MercatorCoordinate.fromLngLat(xe);be.y+=ts;const ze=be.toLngLat(),Ge=x.project(ze.lng,ze.lat),bt=Ri(Ge.x-ee.x,Ge.y-ee.y,te),ht=Math.abs(pe.x)/Math.abs(bt.y),lt=u.identity([]);u.rotateZ(lt,lt,-te*(1-(O?0:F)));const Ke=u.identity([]);return u.scale(Ke,Ke,[1,1-(1-ht)*F,1]),Ke[4]=-bt.x/bt.y*F,u.rotateZ(Ke,Ke,te),u.multiply$1(Ke,lt,Ke),Ke}(f.projection,0,f.center,l,n),_=fl(f);return u.scale(p,p,[_,_,1]),p}function fl(f){const n=f.projection,l=ma(f),p=_c(n,f.center),_=_c(n,u.LngLat.convert(n.center));return Math.pow(2,p*l+(1-l)*_)}function ma(f){const n=f.projection.range;if(!n)return 0;const l=Math.max(f.width,f.height),p=Math.log(l/1024)/Math.LN2;return u.smoothstep(n[0]+p,n[1]+p,f.zoom)}const ts=1/4e4;function _c(f,n){const l=u.clamp(n.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),p=new u.LngLat(n.lng-180*ts,l),_=new u.LngLat(n.lng+180*ts,l),x=f.project(p.lng,l),w=f.project(_.lng,l),S=u.MercatorCoordinate.fromLngLat(p),F=u.MercatorCoordinate.fromLngLat(_),O=w.x-x.x,N=w.y-x.y,$=F.x-S.x,K=F.y-S.y,re=Math.sqrt(($*$+K*K)/(O*O+N*N));return Math.log(re)/Math.LN2}function Ri(f,n,l){const p=Math.cos(l),_=Math.sin(l);return{x:f*p-n*_,y:f*_+n*p}}class No{constructor(n,l,p,_,x){this.tileSize=512,this._renderWorldCopies=void 0===x||x,this._minZoom=n||0,this._maxZoom=l||22,this._minPitch=null==p?0:p,this._maxPitch=null==_?60:_,this.setProjection(),this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new hl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new dl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const n=new No(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return n.setProjection(this.getProjection()),n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n.tileSize=this.tileSize,n.setMaxBounds(this.getMaxBounds()),n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._cameraZoom=this._cameraZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,n?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}updateElevation(n){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),n&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return u.pick(this.projection,["name","center","parallels"])}setProjection(n){null==n&&(n={name:"mercator"}),this.projectionOptions=n;const l=this.projection?this.getProjection():void 0;return this.projection=u.getProjection(n),!Et(l,this.getProjection())&&(this._calcMatrices(),!0)}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(n){void 0===n?n=!0:null===n&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.pointGeometry(this.width,this.height)}get bearing(){return u.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const l=-n*Math.PI/180;var p,_,x,w,S,F,O,N,$,K;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new u.ARRAY_TYPE(4),u.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),_=this.rotationMatrix,w=this.angle,S=(x=this.rotationMatrix)[0],F=x[1],O=x[2],N=x[3],$=Math.sin(w),K=Math.cos(w),_[0]=S*K+O*$,_[1]=F*K+N*$,_[2]=S*-$+O*K,_[3]=F*-$+N*K)}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const l=u.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=n/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices()}get zoom(){return this._zoom}set zoom(n){const l=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCenterElevation(){if(!this._elevation)return!1;const n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center),-1);return-1===n?(this._cameraZoom=null,!1):(this._centerAltitude=n,!0)}_updateCameraOnTerrain(){this._cameraZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize)}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let _=0,x=0;for(let w=0;w<l.length;w++){const S=new u.pointGeometry(l[w][0]*this.width,p+l[w][1]*(this.height-p)),F=n.pointCoordinate(S);if(!F)continue;const O=1/Math.hypot(F[0]-this._camera.position[0],F[1]-this._camera.position[1]);_+=F[3]*O,x+=O}return 0===x?NaN:_/x}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._cameraZoom||!this._elevation)return;const n=this._cameraZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,_=this._mercatorZfromZoom(n),x=this._mercatorZfromZoom(this._maxZoom),w=Math.max(_-p,x);this._setZoom(this._zoomFromMercatorZ(w))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let p;p=n.z<this._camera.position[2]?[l.x,l.y,l.z]:[n.x,n.y,n.z];const _=u.length(u.sub([],this._camera.position,p));return u.clamp(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let l=!1;if(n.orientation&&!u.exactEquals(n.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(n.orientation)),n.position){const p=[n.position.x,n.position.y,n.position.z];u.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,l=new Ul;return l.position=new u.MercatorCoordinate(n[0],n[1],n[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(n){if(!u.length$1(n))return!1;u.normalize$1(n,n);const l=u.transformQuat([],[0,0,-1],n),p=u.transformQuat([],[0,-1,0],n);if(p[2]<0)return!1;const _=pa(l,p);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(n){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;n[2]=u.clamp(n[2],_/p,_/l),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,l,p){this._unmodified=!1,this._edgeInsets.interpolate(n,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const l=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(n){const l=[new u.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const p=this.pointCoordinate(new u.pointGeometry(0,0)),_=this.pointCoordinate(new u.pointGeometry(this.width,0)),x=this.pointCoordinate(new u.pointGeometry(this.width,this.height)),w=this.pointCoordinate(new u.pointGeometry(0,this.height)),S=Math.floor(Math.min(p.x,_.x,x.x,w.x)),F=Math.floor(Math.max(p.x,_.x,x.x,w.x)),O=1;for(let N=S-O;N<=F+O;N++)0!==N&&l.push(new u.UnwrappedTileID(N,n))}return l}coveringTiles(n){let l=this.coveringZoomLevel(n);const p=l,_=this.elevation&&!n.isTerrainDEM,x="mercator"===this.projection.name;if(void 0!==n.minzoom&&l<n.minzoom)return[];void 0!==n.maxzoom&&l>n.maxzoom&&(l=n.maxzoom);const w=this.locationCoordinate(this.center),S=1<<l,F=[S*w.x,S*w.y,0],O=u.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,"globe"!==this.projection.name),N=this.pointCoordinate(this.getCameraPoint()),$=S*u.mercatorZfromAltitude(1,this.center.lat),K=this._camera.position[2]/u.mercatorZfromAltitude(1,this.center.lat),re=[S*N.x,S*N.y,K],te=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),ie=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,xe=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ee=n.isTerrainDEM?-xe:this._elevation?this._elevation.getMinElevationBelowMSL():0,ge=this.projection.isReprojectedInTileSpace?fl(this):1,me=Ue=>{const Qe=new u.MercatorCoordinate(Ue.x+25e-6,Ue.y,Ue.z),Yt=new u.MercatorCoordinate(Ue.x,Ue.y+25e-6,Ue.z),on=Ue.toLngLat(),Ln=Qe.toLngLat(),xt=Yt.toLngLat(),ln=this.locationCoordinate(on),yn=this.locationCoordinate(Ln),yr=this.locationCoordinate(xt),mr=Math.hypot(yn.x-ln.x,yn.y-ln.y),mn=Math.hypot(yr.x-ln.x,yr.y-ln.y);return Math.sqrt(mr*mn)*ge/25e-6},fe=Ue=>{const ct=xe,Qe=ee;return{aabb:u.tileAABB(this,S,0,0,0,Ue,Qe,ct,this.projection),zoom:0,x:0,y:0,minZ:Qe,maxZ:ct,wrap:Ue,fullyVisible:!1}},pe=[];let be=[];const ze=l,Ge=n.reparseOverscaled?p:l,bt=Ue=>Ue*Ue,ht=bt((K-this._centerAltitude)*$),lt=Ue=>{if(!this._elevation||!Ue.tileID||!x)return;const ct=this._elevation.getMinMaxForTile(Ue.tileID),Qe=Ue.aabb;ct?(Qe.min[2]=ct.min,Qe.max[2]=ct.max,Qe.center[2]=(Qe.min[2]+Qe.max[2])/2):(Ue.shouldSplit=Ke(Ue),Ue.shouldSplit||(Qe.min[2]=Qe.max[2]=Qe.center[2]=this._centerAltitude))},Ke=Ue=>{if(Ue.zoom<ie)return!0;if(Ue.zoom===ze)return!1;if(null!=Ue.shouldSplit)return Ue.shouldSplit;const ct=Ue.aabb.distanceX(re),Qe=Ue.aabb.distanceY(re);let Yt=ht;_&&(Yt=bt(Ue.aabb.distanceZ(re)*$));let on=1;if(this.projection.isReprojectedInTileSpace&&p<=5){const xt=Math.pow(2,Ue.zoom),ln=me(new u.MercatorCoordinate((Ue.x+.5)/xt,(Ue.y+.5)/xt));on=ln>.85?1:ln}const Ln=ct*ct+Qe*Qe+Yt;return Ln<bt((1<<ze-Ue.zoom)*te*on*((xt,ln)=>{if(ln*bt(.707)<xt)return 1;const yn=Math.sqrt(ln/xt);return yn/(1.4144271570014144+(Math.pow(1.1,yn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Yt,ht),Ln))};if(this.renderWorldCopies)for(let Ue=1;Ue<=3;Ue++)pe.push(fe(-Ue)),pe.push(fe(Ue));for(pe.push(fe(0));pe.length>0;){const Ue=pe.pop(),ct=Ue.x,Qe=Ue.y;let Yt=Ue.fullyVisible;if(!Yt){const on=Ue.aabb.intersects(O);if(0===on)continue;Yt=2===on}if(Ue.zoom!==ze&&Ke(Ue))for(let on=0;on<4;on++){const Ln=(ct<<1)+on%2,xt=(Qe<<1)+(on>>1),ln={aabb:x?Ue.aabb.quadrant(on):u.tileAABB(this,S,Ue.zoom+1,Ln,xt,Ue.wrap,Ue.minZ,Ue.maxZ,this.projection),zoom:Ue.zoom+1,x:Ln,y:xt,wrap:Ue.wrap,fullyVisible:Yt,tileID:void 0,shouldSplit:void 0,minZ:Ue.minZ,maxZ:Ue.maxZ};_&&(ln.tileID=new u.OverscaledTileID(Ue.zoom+1===ze?Ge:Ue.zoom+1,Ue.wrap,Ue.zoom+1,Ln,xt),lt(ln)),pe.push(ln)}else{const on=Ue.zoom===ze?Ge:Ue.zoom;if(n.minzoom&&n.minzoom>on)continue;const Ln=F[0]-(.5+ct+(Ue.wrap<<Ue.zoom))*(1<<l-Ue.zoom),xt=F[1]-.5-Qe,ln=Ue.tileID?Ue.tileID:new u.OverscaledTileID(on,Ue.wrap,Ue.zoom,ct,Qe);be.push({tileID:ln,distanceSq:Ln*Ln+xt*xt})}}if(this.fogCullDistSq){const Ue=this.fogCullDistSq,ct=this.horizonLineFromTop();be=be.filter(Qe=>{const Yt=[0,0,0,1],on=[u.EXTENT,u.EXTENT,0,1],Ln=this.calculateFogTileMatrix(Qe.tileID.toUnwrapped());u.transformMat4$1(Yt,Yt,Ln),u.transformMat4$1(on,on,Ln);const xt=u.getAABBPointSquareDist(Yt,on);if(0===xt)return!0;let ln=!1;const yn=this._elevation;if(yn&&xt>Ue&&0!==ct){const yr=this.calculateProjMatrix(Qe.tileID.toUnwrapped());let mr;n.isTerrainDEM||(mr=yn.getMinMaxForTile(Qe.tileID)),mr||(mr={min:ee,max:xe});const mn=u.furthestTileCorner(this.rotation),Vn=[mn[0]*u.EXTENT,mn[1]*u.EXTENT,mr.max];u.transformMat4(Vn,Vn,yr),ln=(1-Vn[1])*this.height*.5<ct}return xt<Ue||ln})}return be.sort((Ue,ct)=>Ue.distanceSq-ct.distanceSq).map(Ue=>Ue.tileID)}resize(n,l){this.width=n,this.height=l,this.pixelsToGLUnits=[2/n,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const l=u.clamp(n.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),p=this.projection.project(n.lng,l);return new u.pointGeometry(p.x*this.worldSize,p.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(n,l){const p=this.pointCoordinate(l),_=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(n);this.setLocation(new u.MercatorCoordinate(x.x-(p.x-_.x),x.y-(p.y-_.y)))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this._coordinatePoint(this.locationCoordinate(n),!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,l){const p=l?u.mercatorZfromAltitude(l,n.lat):void 0,_=this.projection.project(n.lng,n.lat);return new u.MercatorCoordinate(_.x,_.y,p)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,l){const p=null!=l?l:this._centerAltitude,_=[n.x,n.y,0,1],x=[n.x,n.y,1,1];u.transformMat4$1(_,_,this.pixelMatrixInverse),u.transformMat4$1(x,x,this.pixelMatrixInverse);const w=x[3];u.scale$1(_,_,1/_[3]),u.scale$1(x,x,1/w);const S=_[2],F=x[2];return{p0:_,p1:x,t:S===F?0:(p-S)/(F-S)}}screenPointToMercatorRay(n){const l=[n.x,n.y,0,1],p=[n.x,n.y,1,1];return u.transformMat4$1(l,l,this.pixelMatrixInverse),u.transformMat4$1(p,p,this.pixelMatrixInverse),u.scale$1(l,l,1/l[3]),u.scale$1(p,p,1/p[3]),l[2]=u.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=u.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,u.scale$1(l,l,1/this.worldSize),u.scale$1(p,p,1/this.worldSize),new u.Ray([l[0],l[1],l[2]],u.normalize([],u.sub([],p,l)))}rayIntersectionCoordinate(n){const{p0:l,p1:p,t:_}=n,x=u.mercatorZfromAltitude(l[2],this._center.lat),w=u.mercatorZfromAltitude(p[2],this._center.lat);return new u.MercatorCoordinate(u.number(l[0],p[0],_)/this.worldSize,u.number(l[1],p[1],_)/this.worldSize,u.number(x,w,_))}pointCoordinate(n,l=this._centerAltitude){return this.projection.createTileTransform(this,this.worldSize).pointCoordinate(n.x,n.y,l)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);const l=this.elevation;let p=this.elevation.pointCoordinate(n);if(p)return new u.MercatorCoordinate(p[0],p[1],p[2]);let _=0,x=this.horizonLineFromTop();if(n.y>x)return this.pointCoordinate(n);const w=.02*x,S=n.clone();for(let F=0;F<10&&x-_>w;F++){S.y=u.number(_,x,.66);const O=l.pointCoordinate(S);O?(x=S.y,p=O):_=S.y}return p?new u.MercatorCoordinate(p[0],p[1],p[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){if(this.elevation)return!this.elevation.pointCoordinate(n);{const l=this.horizonLineFromTop();return n.y<l}}_coordinatePoint(n,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,_=[n.x*this.worldSize,n.y*this.worldSize,p+n.toAltitude(),1];return u.transformMat4$1(_,_,this.pixelMatrix),_[3]>0?new u.pointGeometry(_[0]/_[3],_[1]/_[3]):new u.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(n,l){const p=new u.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),_=new u.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),x=new u.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),w=new u.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let S=this.pointCoordinate(p,n),F=this.pointCoordinate(_,n);const O=this.pointCoordinate(x,l),N=this.pointCoordinate(w,l),$=(K,re)=>(re.y-K.y)/(re.x-K.x);return S.y>1&&F.y>=0?S=new u.MercatorCoordinate((1-N.y)/$(N,S)+N.x,1):S.y<0&&F.y<=1&&(S=new u.MercatorCoordinate(-N.y/$(N,S)+N.x,0)),F.y>1&&S.y>=0?F=new u.MercatorCoordinate((1-O.y)/$(O,F)+O.x,1):F.y<0&&S.y<=1&&(F=new u.MercatorCoordinate(-O.y/$(O,F)+O.x,0)),(new u.LngLatBounds).extend(this.coordinateLocation(S)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(O))}_getBounds3D(){const n=this.elevation;if(!n.visibleDemTiles.length)return this._getBounds(0,0);const l=n.visibleDemTiles.reduce((p,_)=>{if(_.dem){const x=_.dem.tree;p.min=Math.min(p.min,x.minimums[0]),p.max=Math.max(p.max,x.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBounds(l.min*n.exaggeration(),l.max*n.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(n=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return n?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-u.MAX_MERCATOR_LATITUDE,this.maxLat=u.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=u.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=u.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=u.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=u.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,l){return this.projection.createTileTransform(this,l).createTileMatrix(n)}calculateDistanceTileData(n){const l=n.key,p=this._distanceTileDataCache;if(p[l])return p[l];const _=n.canonical,x=1/this.height,w=this.cameraWorldSize/this.zoomScale(_.z),S=(_.x+Math.pow(2,_.z)*n.wrap)*w,F=_.y*w,O=this.point,N=this.angle,$=Math.sin(-N),K=-Math.cos(-N);return p[l]={bearing:[$,K],center:[(O.x-S)*x,(O.y-F)*x],scale:w/u.EXTENT*x},p[l]}calculateFogTileMatrix(n){const l=n.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const _=this.calculatePosMatrix(n,this.cameraWorldSize);return u.multiply$1(_,this.worldToFogMatrix,_),p[l]=new Float32Array(_),p[l]}calculateProjMatrix(n,l=!1){const p=n.key,_=l?this._alignedProjMatrixCache:this._projMatrixCache;if(_[p])return _[p];const x=this.calculatePosMatrix(n,this.worldSize);return u.multiply$1(x,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,x),_[p]=new Float32Array(x),_[p]}calculatePixelsToTileUnitsMatrix(n){const l=n.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const _=function(x,w){const{scale:S}=x.tileTransform,F=S*u.EXTENT/(x.tileSize*Math.pow(2,w.zoom-x.tileID.overscaledZ+x.tileID.canonical.z));return O=new Float32Array(4),K=(N=w.inverseAdjustmentMatrix)[1],re=N[2],te=N[3],xe=($=[F,F])[1],O[0]=N[0]*(ie=$[0]),O[1]=K*ie,O[2]=re*xe,O[3]=te*xe,O;var O,N,$,K,re,te,ie,xe}(n,this);return p[l]=_,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const l=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=this._camera.forward(),x=u.mercatorZfromAltitude(1,this._center.lat);p[2]/=x,_[2]/=x,u.normalize(_,_);const w=n.raycast(p,_,n.exaggeration());if(w){const S=u.scaleAndAdd([],p,_,w),F=new u.MercatorCoordinate(S[0],S[1],u.mercatorZfromAltitude(S[2],u.latFromMercatorY(S[1]))),O=(F.z+u.length([F.x-p[0],F.y-p[1],F.z-p[2]*x]))*this._projectionScaler;this._cameraZoom=this._zoomFromMercatorZ(O),this._centerAltitude=F.toAltitude(),this._center=this.coordinateLocation(F),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const n=this._elevation;this._updateCameraState();const l=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),_=n.getAtPointOrZero(new u.MercatorCoordinate(...p)),x=this._minimumHeightOverTerrain()*Math.cos(u.degToRad(this._maxPitch)),w=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*_;if(w<x){const S=this.locationCoordinate(this._center,this._centerAltitude),F=[S.x-p[0],S.y-p[1],S.z-p[2]],O=u.length(F);F[2]-=(x-w)/this._projectionScaler;const N=u.length(F);if(0===N)return;u.scale$2(F,F,O/N*this._projectionScaler),this._camera.position=[S.x-F[0],S.y-F[1],S.z*this._projectionScaler-F[2]],this._camera.orientation=pa(F,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const $=this.center;return $.lat=u.clamp($.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||($.lng=u.clamp($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const n=this._unmodified,{x:l,y:p}=this.point;let _=0,x=l,w=p;const S=this.width/2,F=this.height/2,O=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(p-F<O&&(w=O+F),p+F>N&&(w=N-F),N-O<this.height&&(_=Math.max(_,this.height/(N-O)),w=(N+O)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,K=this.worldMaxX*this.scale,re=this.worldSize/2-($+K)/2;x=(l+re+this.worldSize)%this.worldSize-re,x-S<$&&(x=$+S),x+S>K&&(x=K-S),K-$<this.width&&(_=Math.max(_,this.width/(K-$)),x=(K+$)/2)}x===l&&w===p||(this.center=this.unproject(new u.pointGeometry(x,w))),_&&(this.zoom+=this.scaleZoom(_)),this._constrainCameraAltitude(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this._fov/2,l=this.centerOffset,p=this.pixelsPerMeter;this._projectionScaler=p/(u.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(n)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const _=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?p:1),x=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);x[8]=2*-l.x/this.width,x[9]=2*l.y/this.height;let w=u.mul([],x,_);if(this.projection.isReprojectedInTileSpace){const fe=this.locationCoordinate(this.center),pe=u.identity([]);u.translate(pe,pe,[fe.x*this.worldSize,fe.y*this.worldSize,0]),u.multiply$1(pe,pe,Vl(this)),u.translate(pe,pe,[-fe.x*this.worldSize,-fe.y*this.worldSize,0]),u.multiply$1(w,w,pe),this.inverseAdjustmentMatrix=function(be){const ze=Vl(be,!0);return et([],[ze[0],ze[1],ze[4],ze[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=u.scale([],w,[this.worldSize,this.worldSize,this.worldSize/p,1]),this.projMatrix=w,this.invProjMatrix=u.invert(new Float64Array(16),this.projMatrix);const S=new Float32Array(16);u.identity(S),u.scale(S,S,[1,-1,1]),u.rotateX(S,S,this._pitch),u.rotateZ(S,S,this.angle);const F=u.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),O=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-l.x/this.width,F[9]=2*(l.y+O)/this.height,this.skyboxMatrix=u.multiply$1(S,F,S);const N=this.point,$=N.x,K=N.y,re=this.width%2/2,te=this.height%2/2,ie=Math.cos(this.angle),xe=Math.sin(this.angle),ee=$-Math.round($)+ie*re+xe*te,ge=K-Math.round(K)+ie*te+xe*re,me=new Float64Array(w);if(u.translate(me,me,[ee>.5?ee-1:ee,ge>.5?ge-1:ge,0]),this.alignedProjMatrix=me,w=u.create(),u.scale(w,w,[this.width/2,-this.height/2,1]),u.translate(w,w,[1,-1,0]),this.labelPlaneMatrix=w,w=u.create(),u.scale(w,w,[1,-1,1]),u.translate(w,w,[-1,-1,0]),u.scale(w,w,[2/this.width,2/this.height,1]),this.glCoordMatrix=w,this.pixelMatrix=u.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},w=u.invert(new Float64Array(16),this.pixelMatrix),!w)throw new Error("failed to invert matrix");this.pixelMatrixInverse=w,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSize,l=this.cameraPixelsPerMeter,p=this._camera.position,_=1/this.height,x=[n,n,l];u.scale$2(x,x,_),u.scale$2(p,p,-1),u.multiply$2(p,p,x);const w=u.create();u.translate(w,w,p),u.scale(w,w,x),this.mercatorFogMatrix=w,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,l,_)}_computeCameraPosition(n){const l=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),_=this.point,x=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)*l-n/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-p[0]*x,_.y/this.worldSize-p[1]*x,n/this.worldSize*this._centerAltitude-p[2]*x]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=n[2];let _=1;p>0&&(_=Math.min((l-this._camera.position[2])/p,1)),this._camera.position=u.scaleAndAdd([],this._camera.position,n,_),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:_}=this._camera.getPitchBearing(),x=u.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,w=this._mercatorZfromZoom(this._maxZoom)*Math.cos(u.degToRad(this._maxPitch)),S=Math.max((n[2]-x)/Math.cos(p),w),F=this._zoomFromMercatorZ(S);u.scaleAndAdd(n,n,l,S),this._pitch=u.clamp(p,u.degToRad(this.minPitch),u.degToRad(this.maxPitch)),this.angle=u.wrap(_,-Math.PI,Math.PI),this._setZoom(u.clamp(F,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=this.coordinateLocation(new u.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(u.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(n,l){const p=Math.min(n.x,l.x),_=Math.max(n.x,l.x),x=Math.min(n.y,l.y),w=Math.max(n.y,l.y);if(x<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const S=[new u.pointGeometry(p,x),new u.pointGeometry(_,w),new u.pointGeometry(p,w),new u.pointGeometry(_,x)],F=this.renderWorldCopies?-3:0,O=this.renderWorldCopies?4:1;for(const N of S){const $=this.pointRayIntersection(N);if($.t<0)return!0;const K=this.rayIntersectionCoordinate($);if(K.x<F||K.y<0||K.x>O||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+u.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new u.pointGeometry(0,0),new u.pointGeometry(this.width,this.height))}zoomDeltaToMovement(n,l){const p=u.length(u.sub([],this._camera.position,n)),_=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(_)}getCameraPoint(){const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.pointGeometry(0,n))}}function fr(f,n){let l=!1,p=null;const _=()=>{p=null,l&&(f(),p=setTimeout(_,n),l=!1)};return()=>(l=!0,p||_(),p)}class Nc{constructor(n){this._hashName=n&&encodeURIComponent(n),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=fr(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,u.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return u.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(n){const l=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,_=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,_),w=Math.round(l.lng*x)/x,S=Math.round(l.lat*x)/x,F=this._map.getBearing(),O=this._map.getPitch();let N="";if(N+=n?`/${w}/${S}/${p}`:`${p}/${S}/${w}`,(F||O)&&(N+="/"+Math.round(10*F)/10),O&&(N+=`/${Math.round(O)}`),this._hashName){const $=this._hashName;let K=!1;const re=u.window.location.hash.slice(1).split("&").map(te=>{const ie=te.split("=")[0];return ie===$?(K=!0,`${ie}=${N}`):te}).filter(te=>te);return K||re.push(`${$}=${N}`),`#${re.join("&")}`}return`#${N}`}_getCurrentHash(){const n=u.window.location.hash.replace("#","");if(this._hashName){let l;return n.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._getCurrentHash();if(n.length>=3&&!n.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(n[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:l,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=u.window.location.href.replace(/(#.+)?$/,this.getHashString());u.window.history.replaceState(u.window.history.state,null,n)}}const Fs={linearity:.3,easing:u.bezier(0,0,.3,1)},Ba=u.extend({deceleration:2500,maxSpeed:1400},Fs),jl=u.extend({deceleration:20,maxSpeed:1400},Fs),$l=u.extend({deceleration:1e3,maxSpeed:360},Fs),rr=u.extend({deceleration:1e3,maxSpeed:90},Fs);class ga{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,l=u.exported.now();for(;n.length>0&&l-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const l={zoom:0,bearing:0,pitch:0,pan:new u.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)l.zoom+=x.zoomDelta||0,l.bearing+=x.bearingDelta||0,l.pitch+=x.pitchDelta||0,x.panDelta&&l.pan._add(x.panDelta),x.around&&(l.around=x.around),x.pinchAround&&(l.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(l.pan.mag()){const x=Js(l.pan.mag(),p,u.extend({},Ba,n||{}));_.offset=l.pan.mult(x.amount/l.pan.mag()),_.center=this._map.transform.center,_a(_,x)}if(l.zoom){const x=Js(l.zoom,p,jl);_.zoom=this._map.transform.zoom+x.amount,_a(_,x)}if(l.bearing){const x=Js(l.bearing,p,$l);_.bearing=this._map.transform.bearing+u.clamp(x.amount,-179,179),_a(_,x)}if(l.pitch){const x=Js(l.pitch,p,rr);_.pitch=this._map.transform.pitch+x.amount,_a(_,x)}if(_.zoom||_.bearing){const x=void 0===l.pinchAround?l.around:l.pinchAround;_.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),u.extend(_,{noMoveStart:!0})}}function _a(f,n){(!f.duration||f.duration<n.duration)&&(f.duration=n.duration,f.easing=n.easing)}function Js(f,n,l){const{maxSpeed:p,linearity:_,deceleration:x}=l,w=u.clamp(f*_/(n/1e3),-p,p),S=Math.abs(w)/(x*_);return{easing:l.easing,duration:1e3*S,amount:w*(S/2)}}class gi extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,p,_={}){const x=Me.mousePos(l.getCanvasContainer(),p),w=l.unproject(x);super(n,u.extend({point:x,lngLat:w,originalEvent:p},_)),this._defaultPrevented=!1,this.target=l}}class pl extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,p){const _="touchend"===n?p.changedTouches:p.touches,x=Me.touchPos(l.getCanvasContainer(),_),w=x.map(F=>l.unproject(F)),S=x.reduce((F,O,N,$)=>F.add(O.div($.length)),new u.pointGeometry(0,0));super(n,{points:x,point:S,lngLats:w,lngLat:l.unproject(S),originalEvent:p}),this._defaultPrevented=!1}}class Mu extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,l,p){super(n,{originalEvent:p}),this._defaultPrevented=!1}}class ui{constructor(n,l){this._map=n,this._clickTolerance=l.clickTolerance}reset(){delete this._mousedownPos}wheel(n){return this._firePreventable(new Mu(n.type,this._map,n))}mousedown(n,l){return this._mousedownPos=l,this._firePreventable(new gi(n.type,this._map,n))}mouseup(n){this._map.fire(new gi(n.type,this._map,n))}preclick(n){const l=u.extend({},n);l.type="preclick",this._map.fire(new gi(l.type,this._map,l))}click(n,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(n),this._map.fire(new gi(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new gi(n.type,this._map,n))}mouseover(n){this._map.fire(new gi(n.type,this._map,n))}mouseout(n){this._map.fire(new gi(n.type,this._map,n))}touchstart(n){return this._firePreventable(new pl(n.type,this._map,n))}touchmove(n){this._map.fire(new pl(n.type,this._map,n))}touchend(n){this._map.fire(new pl(n.type,this._map,n))}touchcancel(n){this._map.fire(new pl(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ml{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,delete this._contextMenuEvent}mousemove(n){this._map.fire(new gi(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new gi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new gi(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Na{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,l){this.isEnabled()&&n.shiftKey&&0===n.button&&(Me.disableDrag(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(n,l){if(!this._active)return;const p=l;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const _=this._startPos;this._lastPos=p,this._box||(this._box=Me.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const x=Math.min(_.x,p.x),w=Math.max(_.x,p.x),S=Math.min(_.y,p.y),F=Math.max(_.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${S}px)`,this._box.style.width=w-x+"px",this._box.style.height=F-S+"px")})}mouseupWindow(n,l){if(!this._active||0!==n.button)return;const p=this._startPos,_=l;if(this.reset(),Me.suppressClick(),p.x!==_.x||p.y!==_.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:x=>x.fitScreenCoordinates(p,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}keydown(n){this._active&&27===n.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Me.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(n,l){return this._map.fire(new u.Event(n,{originalEvent:l}))}}function Os(f,n){const l={};for(let p=0;p<f.length;p++)l[f[p].identifier]=n[p];return l}class ns{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(n,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=n.timeStamp),p.length===this.numTouches&&(this.centroid=function(_){const x=new u.pointGeometry(0,0);for(const w of _)x._add(w);return x.div(_.length)}(l),this.touches=Os(p,l)))}touchmove(n,l,p){if(this.aborted||!this.centroid)return;const _=Os(p,l);for(const x in this.touches){const w=this.touches[x],S=_[x];(!S||S.dist(w)>30)&&(this.aborted=!0)}}touchend(n,l,p){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Uo{constructor(n){this.singleTap=new ns(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(n,l,p){this.singleTap.touchstart(n,l,p)}touchmove(n,l,p){this.singleTap.touchmove(n,l,p)}touchend(n,l,p){const _=this.singleTap.touchend(n,l,p);if(_){const x=n.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(_)<30;if(x&&w||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Gl{constructor(){this._zoomIn=new Uo({numTouches:1,numTaps:2}),this._zoomOut=new Uo({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,l,p){this._zoomIn.touchstart(n,l,p),this._zoomOut.touchstart(n,l,p)}touchmove(n,l,p){this._zoomIn.touchmove(n,l,p),this._zoomOut.touchmove(n,l,p)}touchend(n,l,p){const _=this._zoomIn.touchend(n,l,p),x=this._zoomOut.touchend(n,l,p);return _?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()+1,around:w.unproject(_)},{originalEvent:n})}):x?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:w=>w.easeTo({duration:300,zoom:w.getZoom()-1,around:w.unproject(x)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Uc={0:1,2:2};class Ua{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(n,l){return!1}_move(n,l){return{}}mousedown(n,l){if(this._lastPoint)return;const p=Me.mouseButton(n);this._correctButton(n,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(n,l){const p=this._lastPoint;if(p)if(n.preventDefault(),function(_,x){const w=Uc[x];return void 0===_.buttons||(_.buttons&w)!==w}(n,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}mouseupWindow(n){this._lastPoint&&Me.mouseButton(n)===this._eventButton&&(this._moved&&Me.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yc extends Ua{mousedown(n,l){super.mousedown(n,l),this._lastPoint&&(this._active=!0)}_correctButton(n,l){return 0===l&&!n.ctrlKey}_move(n,l){return{around:l,panDelta:l.sub(n)}}}class Wi extends Ua{_correctButton(n,l){return 0===l&&n.ctrlKey||2===l}_move(n,l){const p=.8*(l.x-n.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(n){n.preventDefault()}}class gl extends Ua{_correctButton(n,l){return 0===l&&n.ctrlKey||2===l}_move(n,l){const p=-.5*(l.y-n.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(n){n.preventDefault()}}class Va{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),u.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new u.pointGeometry(0,0)}touchstart(n,l,p){return this._calculateTransform(n,l,p)}touchmove(n,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===p.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.preventDefault(),this._calculateTransform(n,l,p)}}touchend(n,l,p){this._calculateTransform(n,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,l,p){p.length>0&&(this._active=!0);const _=Os(p,l),x=new u.pointGeometry(0,0),w=new u.pointGeometry(0,0);let S=0;for(const O in _){const N=_[O],$=this._touches[O];$&&(x._add(N),w._add(N.sub($)),S++,_[O]=N)}if(this._touches=_,S<this._minTouches||!w.mag())return;const F=w.div(S);return this._sum._add(F),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(S),panDelta:F}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Me.create("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class ja{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(n){}_move(n,l,p){return{}}touchstart(n,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(n,l,p){if(!this._firstTwoTouches)return;n.preventDefault();const[_,x]=this._firstTwoTouches,w=Xi(p,l,_),S=Xi(p,l,x);if(!w||!S)return;const F=this._aroundCenter?null:w.add(S).div(2);return this._move([w,S],F,n)}touchend(n,l,p){if(!this._firstTwoTouches)return;const[_,x]=this._firstTwoTouches,w=Xi(p,l,_),S=Xi(p,l,x);w&&S||(this._active&&Me.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Xi(f,n,l){for(let p=0;p<f.length;p++)if(f[p].identifier===l)return n[p]}function _l(f,n){return Math.log(f/n)/Math.LN2}class zs extends ja{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,l){const p=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(_l(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_l(this._distance,p),pinchAround:l}}}function Hl(f,n){return 180*f.angleWith(n)/Math.PI}class Bs extends ja{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,l){const p=this._vector;if(this._vector=n[0].sub(n[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Hl(this._vector,p),pinchAround:l}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const l=25/(Math.PI*this._minDiameter)*360,p=Hl(n,this._startVector);return Math.abs(p)<l}}function $a(f){return Math.abs(f.y)>Math.abs(f.x)}class yl extends ja{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}_start(n){this._lastPoints=n,$a(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,l,p){const _=n[0].sub(this._lastPoints[0]),x=n[1].sub(this._lastPoints[1]);if(!(this._map._cooperativeGestures&&p.touches.length<3)&&(this._valid=this.gestureBeginsVertically(_,x,p.timeStamp),this._valid))return this._lastPoints=n,this._active=!0,{pitchDelta:(_.y+x.y)/2*-.5}}gestureBeginsVertically(n,l,p){if(void 0!==this._valid)return this._valid;const _=n.mag()>=2,x=l.mag()>=2;if(!_&&!x)return;if(!_||!x)return void 0===this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const w=n.y>0==l.y>0;return $a(n)&&$a(l)&&w}}const vl={panStep:100,bearingStep:15,pitchStep:10};class vc{constructor(){const n=vl;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let l=0,p=0,_=0,x=0,w=0;switch(n.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:n.shiftKey?p=-1:(n.preventDefault(),x=-1);break;case 39:n.shiftKey?p=1:(n.preventDefault(),x=1);break;case 38:n.shiftKey?_=1:(n.preventDefault(),w=-1);break;case 40:n.shiftKey?_=-1:(n.preventDefault(),w=1);break;default:return}return this._rotationDisabled&&(p=0,_=0),{cameraAnimation:S=>{const F=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Vc,zoom:l?Math.round(F)+l*(n.shiftKey?2:1):F,bearing:S.getBearing()+p*this._bearingStep,pitch:S.getPitch()+_*this._pitchStep,offset:[-x*this._panStep,-w*this._panStep],center:S.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Vc(f){return f*(2-f)}const xc=4.000244140625;class Zl{constructor(n,l){this._map=n,this._el=n.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,u.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&"center"===n.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=n.deltaMode===u.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const p=u.exported.now(),_=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==l&&l%xc==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(_*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),n.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=n,this._delta-=l,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=Me.mousePos(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform,l=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(0!==this._delta){const F="wheel"===this._type&&Math.abs(this._delta)>xc?this._wheelZoomRate:this._defaultZoomRate;let O=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&0!==O&&(O=1/O);const N=l(),$=Math.pow(2,N),K="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):$;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(K*O))),"wheel"===this._type&&(this._startZoom=l(),this._easing=this._smoothOutEasing(200)),this._delta=0}const p="number"==typeof this._targetZoom?this._targetZoom:l(),_=this._startZoom,x=this._easing;let w,S=!1;if("wheel"===this._type&&_&&x){const F=Math.min((u.exported.now()-this._lastWheelEventTime)/200,1),O=x(F);w=u.number(_,p,O),F<1?this._frameId||(this._frameId=!0):S=!0}else w=p,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:w-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let l=u.ease;if(this._prevEase){const p=this._prevEase,_=(u.exported.now()-p.start)/p.duration,x=p.easing(_+.01)-p.easing(_),w=.27/Math.sqrt(x*x+1e-4)*.01,S=Math.sqrt(.0729-w*w);l=u.bezier(w,S,.25,1)}return this._prevEase={start:u.exported.now(),duration:n,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Me.create("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(u.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!u.window.document.fullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Ns{constructor(n,l){this._clickZoom=n,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ql{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,l){return n.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(n.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wl{constructor(){this._tap=new Uo({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(n,l,p){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(n,l,p))}touchmove(n,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const _=l[0],x=_.y-this._swipePoint.y;return this._swipePoint=_,n.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(n,l,p)}touchend(n,l,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(n,l,p)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ea{constructor(n,l,p){this._el=n,this._mousePan=l,this._touchPan=p}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ga{constructor(n,l,p){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Iu{constructor(n,l,p,_){this._el=n,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const A=f=>f.zoom||f.drag||f.pitch||f.rotate;class C extends u.Event{}class D{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,l){const p=u.sub([],l,n);this.radius=u.length(p[2]<0?u.div([],p,this.constants):[p[0],p[1],0])}projectRay(n){u.div(n,n,this.constants),u.normalize(n,n),u.mul$1(n,n,this.constants);const l=u.scale$2([],n,this.radius);if(l[2]>0){const p=u.scale$2([],[0,0,1],u.dot(l,[0,0,1])),_=u.scale$2([],u.normalize([],[l[0],l[1],0]),this.radius),x=u.add([],l,u.scale$2([],u.sub([],u.add([],_,p),l),2));l[0]=x[0],l[1]=x[1]}return l}}function L(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class U{constructor(n,l){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ga(n),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new D,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),u.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[u.window.document,"mousemove",{capture:!0}],[u.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[u.window,"blur",void 0]];for(const[_,x,w]of this._listeners)_.addEventListener(x,_===u.window.document?this.handleWindowEvent:this.handleEvent,w)}destroy(){for(const[n,l,p]of this._listeners)n.removeEventListener(l,n===u.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(n){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new ui(l,n));const _=l.boxZoom=new Na(l,n);this._add("boxZoom",_);const x=new Gl,w=new ql;l.doubleClickZoom=new Ns(w,x),this._add("tapZoom",x),this._add("clickZoom",w);const S=new Wl;this._add("tapDragZoom",S);const F=l.touchPitch=new yl(l);this._add("touchPitch",F);const O=new Wi(n),N=new gl(n);l.dragRotate=new Ga(n,O,N),this._add("mouseRotate",O,["mousePitch"]),this._add("mousePitch",N,["mouseRotate"]);const $=new yc(n),K=new Va(l,n);l.dragPan=new ea(p,$,K),this._add("mousePan",$),this._add("touchPan",K,["touchZoom","touchRotate"]);const re=new Bs,te=new zs;l.touchZoomRotate=new Iu(p,te,re,S),this._add("touchRotate",re,["touchPan","touchZoom"]),this._add("touchZoom",te,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ml(l));const ie=l.scrollZoom=new Zl(l,this);this._add("scrollZoom",ie,["mousePan"]);const xe=l.keyboard=new vc;this._add("keyboard",xe);for(const ee of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[ee]&&l[ee].enable(n[ee])}_add(n,l,p){this._handlers.push({handlerName:n,handler:l,allowed:p}),this._handlersById[n]=l}stop(n){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(A(this._eventsInProgress))||this.isZooming()}_blockedByActive(n,l,p){for(const _ in n)if(_!==p&&(!l||l.indexOf(_)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const l=[];for(const p of n)this._el.contains(p.target)&&l.push(p);return l}handleEvent(n,l){this._updatingCamera=!0;const p="renderFrame"===n.type,_=p?void 0:n,x={needsRenderFrame:!1},w={},S={},F=n.touches?this._getMapTouches(n.touches):void 0,O=F?Me.touchPos(this._el,F):p?void 0:Me.mousePos(this._el,n);for(const{handlerName:K,handler:re,allowed:te}of this._handlers){if(!re.isEnabled())continue;let ie;this._blockedByActive(S,te,K)?re.reset():re[l||n.type]&&(ie=re[l||n.type](n,O,F),this.mergeHandlerResult(x,w,ie,K,_),ie&&ie.needsRenderFrame&&this._triggerRenderFrame()),(ie||re.isActive())&&(S[K]=re)}const N={};for(const K in this._previousActiveHandlers)S[K]||(N[K]=_);this._previousActiveHandlers=S,(Object.keys(N).length||L(x))&&(this._changes.push([x,w,N]),this._triggerRenderFrame()),(Object.keys(S).length||L(x))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=x;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))}mergeHandlerResult(n,l,p,_,x){if(!p)return;u.extend(n,p);const w={handlerName:_,originalEvent:p.originalEvent||x};void 0!==p.zoomDelta&&(l.zoom=w),void 0!==p.panDelta&&(l.drag=w),void 0!==p.pitchDelta&&(l.pitch=w),void 0!==p.bearingDelta&&(l.rotate=w)}_applyChanges(){const n={},l={},p={};for(const[_,x,w]of this._changes)_.panDelta&&(n.panDelta=(n.panDelta||new u.pointGeometry(0,0))._add(_.panDelta)),_.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+_.pitchDelta),void 0!==_.around&&(n.around=_.around),void 0!==_.aroundCoord&&(n.aroundCoord=_.aroundCoord),void 0!==_.pinchAround&&(n.pinchAround=_.pinchAround),_.noInertia&&(n.noInertia=_.noInertia),u.extend(l,x),u.extend(p,w);this._updateMapTransform(n,l,p),this._changes=[]}_updateMapTransform(n,l,p){const _=this._map,x=_.transform,w=ge=>[ge.x,ge.y,ge.z];if((ge=>{const me=this._eventsInProgress.drag;return me&&!this._handlersById[me.handlerName].isActive()})()&&!L(n)){const ge=x.zoom;x.cameraElevationReference="sea",x.recenterOnTerrain(),x.cameraElevationReference="ground",ge!==x.zoom&&this._map._update(!0)}if(!L(n))return this._fireEvents(l,p,!0);let{panDelta:S,zoomDelta:F,bearingDelta:O,pitchDelta:N,around:$,aroundCoord:K,pinchAround:re}=n;void 0!==re&&($=re),(ge=>l.drag&&!this._eventsInProgress.drag)()&&$&&(this._dragOrigin=w(x.pointCoordinate3D($)),this._trackingEllipsoid.setup(x._camera.position,this._dragOrigin)),x.cameraElevationReference="sea",_._stop(!0),$=$||_.transform.centerPoint,O&&(x.bearing+=O),N&&(x.pitch+=N),x._updateCameraState();const te=[0,0,0];if(S){const ge=x.pointCoordinate($),me=x.pointCoordinate($.sub(S));ge&&me&&(te[0]=me.x-ge.x,te[1]=me.y-ge.y)}const ie=x.zoom,xe=[0,0,0];if(F){const ge=w(K||x.pointCoordinate3D($)),me={dir:u.normalize([],u.sub([],ge,x._camera.position))};if(me.dir[2]<0){const fe=x.zoomDeltaToMovement(ge,F);u.scale$2(xe,me.dir,fe)}}const ee=u.add(te,te,xe);x._translateCameraConstrained(ee),F&&Math.abs(x.zoom-ie)>1e-4&&x.recenterOnTerrain(),x.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(l,p,!0)}_fireEvents(n,l,p){const _=A(this._eventsInProgress),x=A(n),w={};for(const N in n){const{originalEvent:$}=n[N];this._eventsInProgress[N]||(w[`${N}start`]=$),this._eventsInProgress[N]=n[N]}!_&&x&&this._fireEvent("movestart",x.originalEvent);for(const N in w)this._fireEvent(N,w[N]);x&&this._fireEvent("move",x.originalEvent);for(const N in n){const{originalEvent:$}=n[N];this._fireEvent(N,$)}const S={};let F;for(const N in this._eventsInProgress){const{handlerName:$,originalEvent:K}=this._eventsInProgress[N];this._handlersById[$].isActive()||(delete this._eventsInProgress[N],F=l[$]||K,S[`${N}end`]=F)}for(const N in S)this._fireEvent(N,S[N]);const O=A(this._eventsInProgress);if(p&&(_||x)&&!O){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),$=K=>0!==K&&-this._bearingSnap<K&&K<this._bearingSnap;N?($(N.bearing||this._map.getBearing())&&(N.bearing=0),this._map.easeTo(N,{originalEvent:F})):(this._map.fire(new u.Event("moveend",{originalEvent:F})),$(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,l){this._map.fire(new u.Event(n,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{delete this._frameId,this.handleEvent(new C("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const X="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class he extends u.Evented{constructor(n,l){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=l.bearingSnap,u.bindAll(["_renderFrameCallback"],this)}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,l){return this.jumpTo({center:n},l)}panBy(n,l,p){return n=u.pointGeometry.convert(n).mult(-1),this.panTo(this.transform.center,u.extend({offset:n},l),p)}panTo(n,l,p){return this.easeTo(u.extend({center:n},l),p)}getZoom(){return this.transform.zoom}setZoom(n,l){return this.jumpTo({zoom:n},l),this}zoomTo(n,l,p){return this.easeTo(u.extend({zoom:n},l),p)}zoomIn(n,l){return this.zoomTo(this.getZoom()+1,n,l),this}zoomOut(n,l){return this.zoomTo(this.getZoom()-1,n,l),this}getBearing(){return this.transform.bearing}setBearing(n,l){return this.jumpTo({bearing:n},l),this}getPadding(){return this.transform.padding}setPadding(n,l){return this.jumpTo({padding:n},l),this}rotateTo(n,l,p){return this.easeTo(u.extend({bearing:n},l),p)}resetNorth(n,l){return this.rotateTo(0,u.extend({duration:1e3},n),l),this}resetNorthPitch(n,l){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},n),l),this}snapToNorth(n,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,l):this}getPitch(){return this.transform.pitch}setPitch(n,l){return this.jumpTo({pitch:n},l),this}cameraForBounds(n,l){n=u.LngLatBounds.convert(n);const p=l&&l.bearing||0;return this._cameraForBoxAndBearing(n.getNorthWest(),n.getSouthEast(),p,l)}_extendCameraOptions(n){const l={top:0,bottom:0,right:0,left:0};if("number"==typeof(n=u.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding){const p=n.padding;n.padding={top:p,bottom:p,right:p,left:p}}return n.padding=u.extend(l,n.padding),n}_cameraForBoxAndBearing(n,l,p,_){const x=this._extendCameraOptions(_),w=this.transform,S=w.padding,F=w.project(u.LngLat.convert(n)),O=w.project(u.LngLat.convert(l)),N=F.rotate(-u.degToRad(p)),$=O.rotate(-u.degToRad(p)),K=new u.pointGeometry(Math.max(N.x,$.x),Math.max(N.y,$.y)),re=new u.pointGeometry(Math.min(N.x,$.x),Math.min(N.y,$.y)),te=K.sub(re),ie=(w.width-(S.left+S.right+x.padding.left+x.padding.right))/te.x,xe=(w.height-(S.top+S.bottom+x.padding.top+x.padding.bottom))/te.y;if(xe<0||ie<0)return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ee=Math.min(w.scaleZoom(w.scale*Math.min(ie,xe)),x.maxZoom),ge="number"==typeof x.offset.x?new u.pointGeometry(x.offset.x,x.offset.y):u.pointGeometry.convert(x.offset),me=new u.pointGeometry((x.padding.left-x.padding.right)/2,(x.padding.top-x.padding.bottom)/2).rotate(p*Math.PI/180),fe=ge.add(me).mult(w.scale/w.zoomScale(ee));return{center:w.unproject(F.add(O).div(2).sub(fe)),zoom:ee,bearing:p}}_cameraForBox(n,l,p,_,x){const w=this._extendCameraOptions(x);p=p||0,_=_||0,n=u.LngLat.convert(n),l=u.LngLat.convert(l);const S=this.transform.clone();S.padding=w.padding;const F=this.getFreeCameraOptions(),O=new u.LngLat(.5*(n.lng+l.lng),.5*(n.lat+l.lat)),N=.5*(p+_);if(S._camera.position[2]<u.mercatorZfromAltitude(N,O.lat))return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");F.lookAtPoint(O),S.setFreeCameraOptions(F);const $=u.MercatorCoordinate.fromLngLat(n),K=u.MercatorCoordinate.fromLngLat(l),re=S.pointRayIntersection(S.centerPoint,N),te=[(ie=S.rayIntersectionCoordinate(re)).x,ie.y,ie.z];var ie;const xe=S.screenPointToMercatorRay(S.centerPoint),ee="globe"!==S.projection.name;let ge,me=0;do{const fe=Math.floor(S.zoom),pe=1<<fe,be=Math.min(pe*$.x,pe*K.x),ze=Math.min(pe*$.y,pe*K.y),Ge=Math.max(pe*$.x,pe*K.x),bt=Math.max(pe*$.y,pe*K.y),ht=new u.Aabb([be,ze,p],[Ge,bt,_]),lt=u.Frustum.fromInvProjectionMatrix(S.invProjMatrix,S.worldSize,fe,ee);if(2!==ht.intersects(lt)){ge&&(S._camera.position=u.scaleAndAdd([],S._camera.position,xe.dir,-ge),S._updateStateFromCamera());break}const Ke=u.sub([],S._camera.position,te);ge=.5*u.length(Ke),S._camera.position=u.scaleAndAdd([],S._camera.position,xe.dir,ge);try{S._updateStateFromCamera()}catch(Ue){return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++me<10);return{center:S.center,zoom:S.zoom,bearing:S.bearing,pitch:S.pitch}}fitBounds(n,l,p){return this._fitInternal(this.cameraForBounds(n,l),l,p)}_raycastElevationBox(n,l){const p=this.transform.elevation;if(!p)return;const _=new u.pointGeometry(n.x,l.y),x=new u.pointGeometry(l.x,n.y),w=p.pointCoordinate(n);if(!w)return;const S=p.pointCoordinate(l);if(!S)return;const F=p.pointCoordinate(_);if(!F)return;const O=p.pointCoordinate(x);if(!O)return;const N=new u.MercatorCoordinate(w[0],w[1]).toLngLat(),$=new u.MercatorCoordinate(S[0],S[1]).toLngLat(),K=new u.MercatorCoordinate(F[0],F[1]).toLngLat(),re=new u.MercatorCoordinate(O[0],O[1]).toLngLat(),te=Math.min(N.lng,Math.min($.lng,Math.min(K.lng,re.lng))),ie=Math.min(N.lat,Math.min($.lat,Math.min(K.lat,re.lat))),xe=Math.max(N.lng,Math.max($.lng,Math.max(K.lng,re.lng))),ee=Math.max(N.lat,Math.max($.lat,Math.max(K.lat,re.lat))),ge=Math.min(w[3],Math.min(S[3],Math.min(F[3],O[3]))),me=Math.max(w[3],Math.max(S[3],Math.max(F[3],O[3])));return{minLngLat:new u.LngLat(te,ie),maxLngLat:new u.LngLat(xe,ee),minAltitude:ge,maxAltitude:me}}fitScreenCoordinates(n,l,p,_,x){let w,S,F,O;const N=u.pointGeometry.convert(n),$=u.pointGeometry.convert(l),K=this._raycastElevationBox(N,$);if(K)w=K.minLngLat,S=K.maxLngLat,F=K.minAltitude,O=K.maxAltitude;else{if(this.transform.anyCornerOffEdge(N,$))return this;w=this.transform.pointLocation(N),S=this.transform.pointLocation($)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(u.pointGeometry.convert(n)),this.transform.pointLocation(u.pointGeometry.convert(l)),p,_):this._cameraForBox(w,S,F,O,_),_,x)}_fitInternal(n,l,p){return n?(delete(l=u.extend(n,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(n,l){this.stop();const p=n.preloadOnly?this.transform.clone():this.transform;let _=!1,x=!1,w=!1;return"zoom"in n&&p.zoom!==+n.zoom&&(_=!0,p.zoom=+n.zoom),void 0!==n.center&&(p.center=u.LngLat.convert(n.center)),"bearing"in n&&p.bearing!==+n.bearing&&(x=!0,p.bearing=+n.bearing),"pitch"in n&&p.pitch!==+n.pitch&&(w=!0,p.pitch=+n.pitch),null==n.padding||p.isPaddingEqual(n.padding)||(p.padding=n.padding),n.preloadOnly?(this._preloadTiles(p),this):(this.fire(new u.Event("movestart",l)).fire(new u.Event("move",l)),_&&this.fire(new u.Event("zoomstart",l)).fire(new u.Event("zoom",l)).fire(new u.Event("zoomend",l)),x&&this.fire(new u.Event("rotatestart",l)).fire(new u.Event("rotate",l)).fire(new u.Event("rotateend",l)),w&&this.fire(new u.Event("pitchstart",l)).fire(new u.Event("pitch",l)).fire(new u.Event("pitchend",l)),this.fire(new u.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||u.warnOnce(X),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return void u.warnOnce(X);this.stop();const _=p.zoom,x=p.pitch,w=p.bearing;p.setFreeCameraOptions(n);const S=_!==p.zoom,F=x!==p.pitch,O=w!==p.bearing;return this.fire(new u.Event("movestart",l)).fire(new u.Event("move",l)),S&&this.fire(new u.Event("zoomstart",l)).fire(new u.Event("zoom",l)).fire(new u.Event("zoomend",l)),O&&this.fire(new u.Event("rotatestart",l)).fire(new u.Event("rotate",l)).fire(new u.Event("rotateend",l)),F&&this.fire(new u.Event("pitchstart",l)).fire(new u.Event("pitch",l)).fire(new u.Event("pitchend",l)),this.fire(new u.Event("moveend",l)),this}easeTo(n,l){this._stop(!1,n.easeId),(!1===(n=u.extend({offset:[0,0],duration:500,easing:u.ease},n)).animate||!n.essential&&u.exported.prefersReducedMotion)&&(n.duration=0);const p=this.transform,_=this.getZoom(),x=this.getBearing(),w=this.getPitch(),S=this.getPadding(),F="zoom"in n?+n.zoom:_,O="bearing"in n?this._normalizeBearing(n.bearing,x):x,N="pitch"in n?+n.pitch:w,$="padding"in n?n.padding:p.padding,K=u.pointGeometry.convert(n.offset);let re=p.centerPoint.add(K);const te="globe"===p.projection.name?p.pointCoordinate(re).toLngLat():p.pointLocation(re),ie=u.LngLat.convert(n.center||te);this._normalizeCenter(ie);const xe=p.project(te),ee=p.project(ie).sub(xe),ge=p.zoomScale(F-_);let me,fe;n.around&&(me=u.LngLat.convert(n.around),fe=p.locationPoint(me));const pe=this._zooming||F!==_,be=this._rotating||x!==O,ze=this._pitching||N!==w,Ge=!p.isPaddingEqual($),bt=lt=>Ke=>{if(pe&&(lt.zoom=u.number(_,F,Ke)),be&&(lt.bearing=u.number(x,O,Ke)),ze&&(lt.pitch=u.number(w,N,Ke)),Ge&&(lt.interpolatePadding(S,$,Ke),re=lt.centerPoint.add(K)),me)lt.setLocationAtPoint(me,fe);else{const Ue=lt.zoomScale(lt.zoom-_),ct=F>_?Math.min(2,ge):Math.max(.5,ge),Qe=Math.pow(ct,1-Ke),Yt=lt.unproject(xe.add(ee.mult(Ke*Qe)).mult(Ue));lt.setLocationAtPoint(lt.renderWorldCopies?Yt.wrap():Yt,re)}return n.preloadOnly||this._fireMoveEvents(l),lt};if(n.preloadOnly){const lt=this._emulate(bt,n.duration,p);return this._preloadTiles(lt),this}const ht={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=pe,this._rotating=be,this._pitching=ze,this._padding=Ge,this._easeId=n.easeId,this._prepareEase(l,n.noMoveStart,ht),this._ease(bt(p),lt=>{p.recenterOnTerrain(),this._afterEase(l,lt)},n),this}_prepareEase(n,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new u.Event("movestart",n)),this._zooming&&!p.zooming&&this.fire(new u.Event("zoomstart",n)),this._rotating&&!p.rotating&&this.fire(new u.Event("rotatestart",n)),this._pitching&&!p.pitching&&this.fire(new u.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new u.Event("move",n)),this._zooming&&this.fire(new u.Event("zoom",n)),this._rotating&&this.fire(new u.Event("rotate",n)),this._pitching&&this.fire(new u.Event("pitch",n))}_afterEase(n,l){if(this._easeId&&l&&this._easeId===l)return;delete this._easeId,this.transform.cameraElevationReference="ground";const p=this._zooming,_=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new u.Event("zoomend",n)),_&&this.fire(new u.Event("rotateend",n)),x&&this.fire(new u.Event("pitchend",n)),this.fire(new u.Event("moveend",n))}flyTo(n,l){if(!n.essential&&u.exported.prefersReducedMotion){const xt=u.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(xt,l)}this.stop(),n=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},n);const p=this.transform,_=this.getZoom(),x=this.getBearing(),w=this.getPitch(),S=this.getPadding(),F="zoom"in n?u.clamp(+n.zoom,p.minZoom,p.maxZoom):_,O="bearing"in n?this._normalizeBearing(n.bearing,x):x,N="pitch"in n?+n.pitch:w,$="padding"in n?n.padding:p.padding,K=p.zoomScale(F-_),re=u.pointGeometry.convert(n.offset);let te=p.centerPoint.add(re);const ie=p.pointLocation(te),xe=u.LngLat.convert(n.center||ie);this._normalizeCenter(xe);const ee=p.project(ie),ge=p.project(xe).sub(ee);let me=n.curve;const fe=Math.max(p.width,p.height),pe=fe/K,be=ge.mag();if("minZoom"in n){const xt=u.clamp(Math.min(n.minZoom,_,F),p.minZoom,p.maxZoom),ln=fe/p.zoomScale(xt-_);me=Math.sqrt(ln/be*2)}const ze=me*me;function Ge(xt){const ln=(pe*pe-fe*fe+(xt?-1:1)*ze*ze*be*be)/(2*(xt?pe:fe)*ze*be);return Math.log(Math.sqrt(ln*ln+1)-ln)}function bt(xt){return(Math.exp(xt)-Math.exp(-xt))/2}function ht(xt){return(Math.exp(xt)+Math.exp(-xt))/2}const lt=Ge(0);let Ke=function(xt){return ht(lt)/ht(lt+me*xt)},Ue=function(xt){return fe*((ht(lt)*(bt(ln=lt+me*xt)/ht(ln))-bt(lt))/ze)/be;var ln},ct=(Ge(1)-lt)/me;if(Math.abs(be)<1e-6||!isFinite(ct)){if(Math.abs(fe-pe)<1e-6)return this.easeTo(n,l);const xt=pe<fe?-1:1;ct=Math.abs(Math.log(pe/fe))/me,Ue=function(){return 0},Ke=function(ln){return Math.exp(xt*me*ln)}}n.duration="duration"in n?+n.duration:1e3*ct/("screenSpeed"in n?+n.screenSpeed/me:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const Qe=x!==O,Yt=N!==w,on=!p.isPaddingEqual($),Ln=xt=>ln=>{const yn=ln*ct,yr=1/Ke(yn);xt.zoom=1===ln?F:_+xt.scaleZoom(yr),Qe&&(xt.bearing=u.number(x,O,ln)),Yt&&(xt.pitch=u.number(w,N,ln)),on&&(xt.interpolatePadding(S,$,ln),te=xt.centerPoint.add(re));const mr=1===ln?xe:xt.unproject(ee.add(ge.mult(Ue(yn))).mult(yr));return xt.setLocationAtPoint(xt.renderWorldCopies?mr.wrap():mr,te),xt._updateCenterElevation(),n.preloadOnly||this._fireMoveEvents(l),xt};if(n.preloadOnly){const xt=this._emulate(Ln,n.duration,p);return this._preloadTiles(xt),this}return this._zooming=!0,this._rotating=Qe,this._pitching=Yt,this._padding=on,this._prepareEase(l,!1),this._ease(Ln(p),()=>this._afterEase(l),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,l)}if(!n){const p=this.handlers;p&&p.stop(!1)}return this}_ease(n,l,p){!1===p.animate||0===p.duration?(n(1),l()):(this._easeStart=u.exported.now(),this._easeOptions=p,this._onEaseFrame=n,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((u.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,l){n=u.wrap(n,-180,180);const p=Math.abs(n-l);return Math.abs(n-360-l)<p&&(n-=360),Math.abs(n+360-l)<p&&(n+=360),n}_normalizeCenter(n){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const p=n.lng-l.center.lng;n.lng+=p>180?-360:p<-180?360:0}_emulate(n,l,p){const _=Math.ceil(15*l/1e3),x=[],w=n(p.clone());for(let S=0;S<=_;S++){const F=w(S/_);x.push(F.clone())}return x}}class we{constructor(n={}){this.options=n,u.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const l=this.options&&this.options.compact;return this._map=n,this._container=Me.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Me.create("button","mapboxgl-ctrl-attrib-button",this._container),Me.create("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden",!0),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Me.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===l&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,l){const p=this._map._getUIString(`AttributionControl.${l}`);n.setAttribute("aria-label",p),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||u.config.ACCESS_TOKEN}];if(n){const p=l.reduce((_,x,w)=>(x.value&&(_+=`${x.key}=${x.value}${w<l.length-1?"&":""}`),_),"?");n.href=`${u.config.FEEDBACK_URL}/${p}${this._map._hash?this._map._hash.getHashString(!0):""}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||"metadata"!==n.sourceDataType&&"visibility"!==n.sourceDataType&&"style"!==n.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const l=this._map.style._sourceCaches;for(const _ in l){const x=l[_];if(x.used){const w=x.getSource();w.attribution&&n.indexOf(w.attribution)<0&&n.push(w.attribution)}}n.sort((_,x)=>_.length-x.length),n=n.filter((_,x)=>{for(let w=x+1;w<n.length;w++)if(n[w].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const p=n.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,n.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class je{constructor(){u.bindAll(["_updateLogo"],this),u.bindAll(["_updateCompact"],this)}onAdd(n){this._map=n,this._container=Me.create("div","mapboxgl-ctrl");const l=Me.create("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&"metadata"!==n.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(0===Object.entries(n).length)return!0;for(const l in n){const p=n[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const l=n[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Lt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const l=++this._id;return this._queue.push({callback:n,id:l,cancelled:!1}),l}remove(n){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const _ of p)if(_.id===n)return void(_.cancelled=!0)}run(n=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function _n(f,n,l){if(f=new u.LngLat(f.lng,f.lat),n){const p=new u.LngLat(f.lng-360,f.lat),_=new u.LngLat(f.lng+360,f.lat),x=360*Math.ceil(Math.abs(f.lng-l.center.lng)/360),w=l.locationPoint(f).distSqr(n),S=n.x<0||n.y<0||n.x>l.width||n.y>l.height;l.locationPoint(p).distSqr(n)<w&&(S||Math.abs(p.lng-l.center.lng)<x)?f=p:l.locationPoint(_).distSqr(n)<w&&(S||Math.abs(_.lng-l.center.lng)<x)&&(f=_)}for(;Math.abs(f.lng-l.center.lng)>180;){const p=l.locationPoint(f);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;f.lng>l.center.lng?f.lng-=360:f.lng+=360}return f}const zt={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class pr extends u.Evented{constructor(n,l){if(super(),(n instanceof u.window.HTMLElement||l)&&(n=u.extend({element:n},l)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&"auto"!==n.pitchAlignment?n.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),n&&n.element)this._element=n.element,this._offset=u.pointGeometry.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=Me.create("div");const _=41,x=27,w=Me.createSVG("svg",{display:"block",height:_*this._scale+"px",width:x*this._scale+"px",viewBox:`0 0 ${x} ${_}`},this._element),S=Me.createSVG("radialGradient",{id:"shadowGradient"},Me.createSVG("defs",{},w));Me.createSVG("stop",{offset:"10%","stop-opacity":.4},S),Me.createSVG("stop",{offset:"100%","stop-opacity":.05},S),Me.createSVG("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},w),Me.createSVG("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},w),Me.createSVG("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},w),Me.createSVG("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},w),this._offset=u.pointGeometry.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",_=>{_.preventDefault()}),this._element.addEventListener("mousedown",_=>{_.preventDefault()});const p=this._element.classList;for(const _ in zt)p.remove(`mapboxgl-marker-anchor-${_}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick)),this}remove(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._updateMoving),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._map.off("remove",this._clearFadeTimer),this._map._removeMarker(this),delete this._map),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=u.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(24.6+_)],"bottom-right":[-_,-1*(24.6+_)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=n,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const l=n.code,p=n.charCode||n.keyCode;"Space"!==l&&"Enter"!==l&&32!==p&&13!==p||this.togglePopup()}_onMapClick(n){const l=n.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const n=this._pos?this._pos.sub(this._transformedOffset()):null;if(!this._withinScreenBounds(n))return void this._clearFadeTimer();const l=this._map.unproject(n);let p=!1;if(this._map.transform._terrainEnabled()&&this._map.getTerrain()){const x=this._map.getFreeCameraOptions();if(x.position){const w=x.position.toLngLat();p=w.distanceTo(l)<.9*w.distanceTo(this._lngLat)}}const _=(1-this._map._queryFogOpacity(l))*(p?.2:1);this._element.style.opacity=`${_}`,this._popup&&this._popup._setOpacity(`${_}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_withinScreenBounds(n){const l=this._map.transform;return!!n&&n.x>=0&&n.x<l.width&&n.y>=0&&n.y<l.height}_updateDOM(){const n=this._pos||new u.pointGeometry(0,0),l=this._calculatePitch(),p=this._calculateRotation();this._element.style.transform=`${zt[this._anchor]} translate(${n.x}px, ${n.y}px) rotateX(${l}deg) rotateZ(${p}deg)`}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(n){u.window.cancelAnimationFrame(this._updateFrameId),this._map&&(this._map.transform.renderWorldCopies&&(this._lngLat=_n(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),!0===n?this._updateFrameId=u.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),this._map._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!this._map.getTerrain()&&!this._map.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}_transformedOffset(){if(!this._defaultMarker)return this._offset;const n=this._map.transform,l=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&l._rotate(n.angle),"map"===this._pitchAlignment&&(l.y*=Math.cos(n._pitch)),l}getOffset(){return this._offset}setOffset(n){return this._offset=u.pointGeometry.convert(n),this._update(),this}_onMove(n){if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=n.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=n.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new u.Event("dragend")),this._state="inactive"}_addDragHandler(n){this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=n.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(n){return this._draggable=!!n,this._map&&(n?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n&&"auto"!==n?n:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class Qn{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const l=u.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,l,p){this._start=this.getValue(l),this._end=n,this._startTime=l,this._endTime=l+p}}const Us={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},{HTMLImageElement:Zr,HTMLElement:Ni,ImageBitmap:Ui}=u.window,ta={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function rs(f){f.parentNode&&f.parentNode.removeChild(f)}const Vs={showCompass:!0,showZoom:!0,visualizePitch:!1};class Au{constructor(n,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Wi({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,p&&(this.mousePitch=new gl({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(n,l){this.mouseRotate.mousedown(n,l),this.mousePitch&&this.mousePitch.mousedown(n,l),Me.disableDrag()}move(n,l){const p=this.map,_=this.mouseRotate.mousemoveWindow(n,l);if(_&&_.bearingDelta&&p.setBearing(p.getBearing()+_.bearingDelta),this.mousePitch){const x=this.mousePitch.mousemoveWindow(n,l);x&&x.pitchDelta&&p.setPitch(p.getPitch()+x.pitchDelta)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Me.enableDrag(),u.window.removeEventListener("mousemove",this.mousemove),u.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(u.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Me.mousePos(this.element,n)),u.window.addEventListener("mousemove",this.mousemove),u.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Me.mousePos(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){1!==n.targetTouches.length?this.reset():(this._startPos=this._lastPos=Me.touchPos(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){1!==n.targetTouches.length?this.reset():(this._lastPos=Me.touchPos(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){0===n.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const bc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let sr,wc=0,Ec=!1;const jc={maxWidth:100,unit:"metric"};function jt(f,n,l){const p=l&&l.maxWidth||100,_=f._containerHeight/2,x=f.unproject([0,_]),w=f.unproject([p,_]),S=x.distanceTo(w);if(l&&"imperial"===l.unit){const F=3.2808*S;F>5280?Tc(n,p,F/5280,f._getUIString("ScaleControl.Miles"),f):Tc(n,p,F,f._getUIString("ScaleControl.Feet"),f)}else l&&"nautical"===l.unit?Tc(n,p,S/1852,f._getUIString("ScaleControl.NauticalMiles"),f):S>=1e3?Tc(n,p,S/1e3,f._getUIString("ScaleControl.Kilometers"),f):Tc(n,p,S,f._getUIString("ScaleControl.Meters"),f)}function Tc(f,n,l,p,_){const x=function(S){const F=Math.pow(10,`${Math.floor(S)}`.length-1);let O=S/F;return O=O>=10?10:O>=5?5:O>=3?3:O>=2?2:O>=1?1:function(N){const $=Math.pow(10,Math.ceil(-Math.log(N)/Math.LN10));return Math.round(N*$)/$}(O),F*O}(l),w=x/l;_._requestDomTask(()=>{f.style.width=n*w+"px",f.innerHTML=`${x}&nbsp;${p}`})}const hd={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},$c=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),ys={version:u.version,supported:wt,setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:class extends he{constructor(f){if(null!=(f=u.extend({},ta,f)).minZoom&&null!=f.maxZoom&&f.minZoom>f.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=f.minPitch&&null!=f.maxPitch&&f.minPitch>f.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=f.minPitch&&f.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=f.maxPitch&&f.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new No(f.minZoom,f.maxZoom,f.minPitch,f.maxPitch,f.renderWorldCopies),f),this._interactive=f.interactive,this._minTileCacheSize=f.minTileCacheSize,this._maxTileCacheSize=f.maxTileCacheSize,this._failIfMajorPerformanceCaveat=f.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=f.preserveDrawingBuffer,this._antialias=f.antialias,this._trackResize=f.trackResize,this._bearingSnap=f.bearingSnap,this._refreshExpiredTiles=f.refreshExpiredTiles,this._fadeDuration=f.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=f.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=f.collectResourceTiming,this._optimizeForTerrain=f.optimizeForTerrain,this._renderTaskQueue=new Lt,this._domRenderTaskQueue=new Lt,this._controls=[],this._markers=[],this._mapId=u.uniqueId(),this._locale=u.extend({},Us,f.locale),this._clickTolerance=f.clickTolerance,this._cooperativeGestures=f.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevation=new Qn(0),this._requestManager=new u.RequestManager(f.transformRequest,f.accessToken,f.testMode),this._silenceAuthErrors=!!f.testMode,"string"==typeof f.container){if(this._container=u.window.document.getElementById(f.container),!this._container)throw new Error(`Container '${f.container}' not found.`)}else{if(!(f.container instanceof Ni))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=f.container}if(this._container.childNodes.length>0&&u.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),f.maxBounds&&this.setMaxBounds(f.maxBounds),u.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==u.window&&(u.window.addEventListener("online",this._onWindowOnline,!1),u.window.addEventListener("resize",this._onWindowResize,!1),u.window.addEventListener("orientationchange",this._onWindowResize,!1),u.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new U(this,f),this._localFontFamily=f.localFontFamily,this._localIdeographFontFamily=f.localIdeographFontFamily,f.style&&this.setStyle(f.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),f.projection&&this.setProjection(f.projection),this._hash=f.hash&&new Nc("string"==typeof f.hash&&f.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch}),f.bounds&&(this.resize(),this.fitBounds(f.bounds,u.extend({},f.fitBoundsOptions,{duration:0})))),this.resize(),f.attributionControl&&this.addControl(new we({customAttribution:f.customAttribution})),this._logoControl=new je,this.addControl(this._logoControl,f.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update("style"===n.dataType),this.fire(new u.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new u.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(f,n){if(void 0===n&&(n=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=f.onAdd(this);this._controls.push(f);const p=this._controlPositions[n];return-1!==n.indexOf("bottom")?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(f);return n>-1&&this._controls.splice(n,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(f){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new u.Event("movestart",f)).fire(new u.Event("move",f)),this.fire(new u.Event("resize",f)),n&&this.fire(new u.Event("moveend",f)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(f){return this.transform.setMaxBounds(u.LngLatBounds.convert(f)),this._update()}setMinZoom(f){if((f=null==f?-2:f)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f?this.setZoom(f):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=null==f?22:f)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f?this.setZoom(f):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=null==f?0:f)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f?this.setPitch(f):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=null==f?85:f)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f?this.setPitch(f):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}getProjection(){return this.transform.getProjection()}setProjection(f){return this._lazyInitEmptyStyle(),"string"==typeof f&&(f={name:f}),this._runtimeProjection=f,this.style.updateProjection(),this._transitionFromGlobe=!1,this}project(f){return this.transform.locationPoint3D(u.LngLat.convert(f))}unproject(f){return this.transform.pointLocation3D(u.pointGeometry.convert(f))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()}_createDelegatedListener(f,n,l){if("mouseenter"===f||"mouseover"===f){let p=!1;const _=w=>{const S=n.filter(O=>this.getLayer(O)),F=S.length?this.queryRenderedFeatures(w.point,{layers:S}):[];F.length?p||(p=!0,l.call(this,new gi(f,this,w.originalEvent,{features:F}))):p=!1},x=()=>{p=!1};return{layers:new Set(n),listener:l,delegates:{mousemove:_,mouseout:x}}}if("mouseleave"===f||"mouseout"===f){let p=!1;const _=w=>{const S=n.filter(F=>this.getLayer(F));(S.length?this.queryRenderedFeatures(w.point,{layers:S}):[]).length?p=!0:p&&(p=!1,l.call(this,new gi(f,this,w.originalEvent)))},x=w=>{p&&(p=!1,l.call(this,new gi(f,this,w.originalEvent)))};return{layers:new Set(n),listener:l,delegates:{mousemove:_,mouseout:x}}}{const p=_=>{const x=n.filter(S=>this.getLayer(S)),w=x.length?this.queryRenderedFeatures(_.point,{layers:x}):[];w.length&&(_.features=w,l.call(this,_),delete _.features)};return{layers:new Set(n),listener:l,delegates:{[f]:p}}}}on(f,n,l){if(void 0===l)return super.on(f,n);Array.isArray(n)||(n=[n]);const p=this._createDelegatedListener(f,n,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(p);for(const _ in p.delegates)this.on(_,p.delegates[_]);return this}once(f,n,l){if(void 0===l)return super.once(f,n);Array.isArray(n)||(n=[n]);const p=this._createDelegatedListener(f,n,l);for(const _ in p.delegates)this.once(_,p.delegates[_]);return this}off(f,n,l){if(void 0===l)return super.off(f,n);n=new Set(Array.isArray(n)?n:[n]);const p=(x,w)=>{if(x.size!==w.size)return!1;for(const S of x)if(!w.has(S))return!1;return!0},_=this._delegatedListeners?this._delegatedListeners[f]:void 0;return _&&(x=>{for(let w=0;w<x.length;w++){const S=x[w];if(S.listener===l&&p(S.layers,n)){for(const F in S.delegates)this.off(F,S.delegates[F]);return x.splice(w,1),this}}})(_),this}queryRenderedFeatures(f,n){return this.style?(void 0!==n||void 0===f||f instanceof u.pointGeometry||Array.isArray(f)||(n=f,f=void 0),this.style.queryRenderedFeatures(f=f||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(f,n){return this.style.querySourceFeatures(f,n)}queryTerrainElevation(f,n){const l=this.transform.elevation;return l?(n=u.extend({},{exaggerated:!0},n),l.getAtPoint(u.MercatorCoordinate.fromLngLat(f),null,n.exaggerated)):null}setStyle(f,n){return!1!==(n=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&f?(this._diffStyle(f,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(f,n))}_getUIString(f){const n=this._locale[f];if(null==n)throw new Error(`Missing UI string '${f}'`);return n}_updateStyle(f,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),f&&(this.style=new Bi(this,n||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof f?this.style.loadURL(f):this.style.loadJSON(f)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Bi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,n){if("string"==typeof f){const l=this._requestManager.normalizeStyleURL(f),p=this._requestManager.transformRequest(l,u.ResourceType.Style);u.getJSON(p,(_,x)=>{_?this.fire(new u.ErrorEvent(_)):x&&this._updateDiff(x,n)})}else"object"==typeof f&&this._updateDiff(f,n)}_updateDiff(f,n){try{this.style.setState(f)&&this._update(!0)}catch(l){u.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(f,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.warnOnce("There is no style added to the map.")}addSource(f,n){return this._lazyInitEmptyStyle(),this.style.addSource(f,n),this._update(!0)}isSourceLoaded(f){const n=this.style&&this.style._getSourceCaches(f);if(0!==n.length)return n.every(l=>l.loaded());this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${f}'`)))}areTilesLoaded(){const f=this.style&&this.style._sourceCaches;for(const n in f){const l=f[n]._tiles;for(const p in l){const _=l[p];if("loaded"!==_.state&&"errored"!==_.state)return!1}}return!0}addSourceType(f,n,l){return this._lazyInitEmptyStyle(),this.style.addSourceType(f,n,l)}removeSource(f){return this.style.removeSource(f),this._updateTerrain(),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,n,{pixelRatio:l=1,sdf:p=!1,stretchX:_,stretchY:x,content:w}={}){if(this._lazyInitEmptyStyle(),n instanceof Zr||Ui&&n instanceof Ui){const{width:S,height:F,data:O}=u.exported.getImageData(n);this.style.addImage(f,{data:new u.RGBAImage({width:S,height:F},O),pixelRatio:l,stretchX:_,stretchY:x,content:w,sdf:p,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:F,data:O}=n,N=n;this.style.addImage(f,{data:new u.RGBAImage({width:S,height:F},new Uint8Array(O)),pixelRatio:l,stretchX:_,stretchY:x,content:w,sdf:p,version:0,userImage:N}),N.onAdd&&N.onAdd(this,f)}}}updateImage(f,n){const l=this.style.getImage(f);if(!l)return this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=n instanceof Zr||Ui&&n instanceof Ui?u.exported.getImageData(n):n,{width:_,height:x,data:w}=p;return void 0===_||void 0===x?this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):_!==l.data.width||x!==l.data.height?this.fire(new u.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(l.data.replace(w,!(n instanceof Zr||Ui&&n instanceof Ui)),void this.style.updateImage(f,l))}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f,n){u.getImage(this._requestManager.transformRequest(f,u.ResourceType.Image),(l,p)=>{n(l,p instanceof Zr?u.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(f,n){return this._lazyInitEmptyStyle(),this.style.addLayer(f,n),this._update(!0)}moveLayer(f,n){return this.style.moveLayer(f,n),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}setLayerZoomRange(f,n,l){return this.style.setLayerZoomRange(f,n,l),this._update(!0)}setFilter(f,n,l={}){return this.style.setFilter(f,n,l),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,n,l,p={}){return this.style.setPaintProperty(f,n,l,p),this._update(!0)}getPaintProperty(f,n){return this.style.getPaintProperty(f,n)}setLayoutProperty(f,n,l,p={}){return this.style.setLayoutProperty(f,n,l,p),this._update(!0)}getLayoutProperty(f,n){return this.style.getLayoutProperty(f,n)}setLight(f,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(f){return this._lazyInitEmptyStyle(),!f&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(f),this._averageElevationLastSampledAt=-1/0,this._update(!0)}_updateProjection(){"globe"===this.transform.projection.name&&this.transform.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX&&!this._transitionFromGlobe&&(this.setProjection({name:"mercator"}),this._transitionFromGlobe=!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(f){return this._lazyInitEmptyStyle(),this.style.setFog(f),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(f){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(u.LngLat.convert(f),this.transform):0}setFeatureState(f,n){return this.style.setFeatureState(f,n),this._update()}removeFeatureState(f,n){return this.style.removeFeatureState(f,n),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}_updateContainerDimensions(){if(!this._container)return;const f=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let l,p=this._container;for(;p&&!l;){const _=u.window.getComputedStyle(p).transform;_&&"none"!==_&&(l=_.match(/matrix.*\((.+)\)/)[1].split(", ")),p=p.parentElement}l?(this._containerWidth=l[0]&&"0"!==l[0]?Math.abs(f/l[0]):f,this._containerHeight=l[3]&&"0"!==l[3]?Math.abs(n/l[3]):n):(this._containerWidth=f,this._containerHeight=n)}_detectMissingCSS(){"rgb(250, 128, 114)"!==u.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&u.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const f=this._container;f.classList.add("mapboxgl-map"),(this._missingCSSCanary=Me.create("div","mapboxgl-canary",f)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=Me.create("div","mapboxgl-canvas-container",f);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=Me.create("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=Me.create("div","mapboxgl-control-container",f),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(_=>{p[_]=Me.create("div",`mapboxgl-ctrl-${_}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,n){const l=u.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(f),this._canvas.height=l*Math.ceil(n),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${n}px`}_addMarker(f){this._markers.push(f)}_removeMarker(f){const n=this._markers.indexOf(f);-1!==n&&this._markers.splice(n,1)}_setupPainter(){const f=u.extend({},wt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._canvas.getContext("webgl",f)||this._canvas.getContext("experimental-webgl",f);n?(u.storeAuthState(n,!0),this.painter=new Nl(n,this.transform),this.on("data",l=>{"source"===l.dataType&&this.painter.setTileLoadedFlag(!0)}),u.exported$1.testSupport(n)):this.fire(new u.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(f){f.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:f}))}_contextRestored(f){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:f}))}_onMapScroll(f){if(f.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_requestDomTask(f){!this.loaded()||this.loaded()&&!this.isMoving()?f():this._domRenderTaskQueue.add(f)}_render(f){let n;const l=this.painter.context.extTimerQuery,p=u.exported.now();this.listens("gpu-timing-frame")&&(n=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,n));let _=this._updateAverageElevation(p);if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._domRenderTaskQueue.run(f),this._removed)return;this._updateProjection();let x=!1;const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const F=this.transform.zoom,O=this.transform.pitch,N=u.exported.now();this.style.zoomHistory.update(F,N);const $=new u.EvaluationParameters(F,{now:N,fadeDuration:w,pitch:O,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),K=$.crossFadingFactor();1===K&&K===this._crossFadingFactor||(x=!0,this._crossFadingFactor=K),this.style.update($)}if(this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),this.style._updateSources(this.transform),this._forceMarkerUpdate()),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new u.Event("load"))),this.style&&(this.style.hasTransitions()||x)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const F=u.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,n),setTimeout(()=>{const O=l.getQueryObjectEXT(n,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(n),this.fire(new u.Event("gpu-timing-frame",{cpuTime:F,gpuTime:O}))},50)}if(this.listens("gpu-timing-layer")){const F=this.painter.collectGpuTimers();setTimeout(()=>{const O=this.painter.queryGpuTimers(F);this.fire(new u.Event("gpu-timing-layer",{layerTimes:O}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(S||this._repaint)this.triggerRepaint();else{const F=!this.isMoving()&&this.loaded();if(F&&(_=this._updateAverageElevation(p,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),F&&(this.fire(new u.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const O=this._calculateSpeedIndex();this.fire(new u.Event("speedindexcompleted",{speedIndex:O})),this.speedIndexTiming=!1}}return!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,this._authenticate()),this}_forceMarkerUpdate(){for(const f of this._markers)f._update()}_updateAverageElevation(f,n=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&l(0);if((n||f-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(f)){const p=this.transform.averageElevation;let _=this.transform.sampleAverageElevation();isNaN(_)?_=0:this._averageElevationLastSampledAt=f;const x=Math.abs(p-_);if(x>1){if(this._isInitialLoad)return this._averageElevation.jumpTo(_),l(_);this._averageElevation.easeTo(_,f,300)}else if(x>1e-4)return this._averageElevation.jumpTo(_),l(_)}return!!this._averageElevation.isEasing(f)&&l(this._averageElevation.getValue(f))}_authenticate(){u.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,f=>{if(f&&(f.message===u.AUTH_ERR_MSG||401===f.status)){const n=this.painter.context.gl;u.storeAuthState(n,!1),this._logoControl instanceof je&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new u.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),u.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const f=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function _(x){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,x,0);const w=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,w),w}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(_(f),n.canvasCopies.map(_),n.timeStamps)}_canvasPixelComparison(f,n,l){let p=l[1]-l[0];const _=f.length/4;for(let x=0;x<n.length;x++){const w=n[x];let S=0;for(let F=0;F<w.length;F+=4)w[F]===f[F]&&w[F+1]===f[F+1]&&w[F+2]===f[F+2]&&w[F+3]===f[F+3]&&(S+=1);p+=(l[x+2]-l[x+1])*(1-S/_)}return p}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==u.window&&(u.window.removeEventListener("resize",this._onWindowResize,!1),u.window.removeEventListener("orientationchange",this._onWindowResize,!1),u.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.removeEventListener("online",this._onWindowOnline,!1));const f=this.painter.context.gl.getExtension("WEBGL_lose_context");f&&f.loseContext(),rs(this._canvasContainer),rs(this._controlContainer),rs(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),u.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(f){this._renderNextFrame=this._renderNextFrame||f,this.style&&!this._frame&&(this._frame=u.exported.frame(n=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(n)}))}_preloadTiles(f){const n=this.style&&Object.values(this.style._sourceCaches)||[];return u.asyncAll(n,(l,p)=>l._preloadTiles(f,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(f){this._trackResize&&this.resize({originalEvent:f})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(f){this._showTerrainWireframe!==f&&(this._showTerrainWireframe=f,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(f){this._speedIndexTiming!==f&&(this._speedIndexTiming=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}_setCacheLimits(f,n){u.setCacheLimits(f,n)}get version(){return u.version}},NavigationControl:class{constructor(f){this.options=u.extend({},Vs,f),this._container=Me.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>this._map.zoomIn({},{originalEvent:n})),Me.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>this._map.zoomOut({},{originalEvent:n})),Me.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:n}):this._map.resetNorth({},{originalEvent:n})}),this._compassIcon=Me.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}_updateZoomButtons(){const f=this._map.getZoom(),n=f===this._map.getMaxZoom(),l=f===this._map.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())}_rotateCompassArrow(){const f=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._map._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=f)})}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Au(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){this._container.remove(),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,n){const l=Me.create("button",f,this._container);return l.type="button",l.addEventListener("click",n),l}_setButtonTitle(f,n){const l=this._map._getUIString(`NavigationControl.${n}`);f.setAttribute("aria-label",l),f.firstElementChild&&f.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends u.Evented{constructor(f){super(),this.options=u.extend({},bc,f),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation"],this),this._onDeviceOrientationListener=this._onDeviceOrientation.bind(this),this._updateMarkerRotationThrottled=fr(this._updateMarkerRotation,20)}onAdd(f){var n;return this._map=f,this._container=Me.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==sr?n(sr):void 0!==u.window.navigator.permissions?u.window.navigator.permissions.query({name:"geolocation"}).then(l=>{sr="denied"!==l.state,n(sr)}):(sr=!!u.window.navigator.geolocation,n(sr)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(u.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,wc=0,Ec=!1}_isOutOfMapMaxBounds(f){const n=this._map.getMaxBounds(),l=f.coords;return n&&(l.longitude<n.getWest()||l.longitude>n.getEast()||l.latitude<n.getSouth()||l.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(f){if(this._map){if(this._isOutOfMapMaxBounds(f))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",f)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=f,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(f),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(f),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("geolocate",f)),this._finish()}}_updateCamera(f){const n=new u.LngLat(f.coords.longitude,f.coords.latitude),l=f.coords.accuracy,p=this._map.getBearing(),_=u.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(l),_,{geolocateSource:!0})}_updateMarker(f){if(f){const n=new u.LngLat(f.coords.longitude,f.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=f.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const f=this._map._containerHeight/2,n=this._map.unproject([0,f]),l=this._map.unproject([100,f]),p=n.distanceTo(l)/100,_=Math.ceil(2*this._accuracy/p);this._circleElement.style.width=`${_}px`,this._circleElement.style.height=`${_}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(f){if(this._map){if(this.options.trackUserLocation)if(1===f.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===f.code&&Ec)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("error",f)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(f){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=Me.create("button","mapboxgl-ctrl-geolocate",this._container),Me.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===f){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Me.create("div","mapboxgl-user-location"),this._dotElement.appendChild(Me.create("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Me.create("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new pr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Me.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new pr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||"ACTIVE_LOCK"!==this._watchState||n.originalEvent&&"resize"===n.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}_onDeviceOrientation(f){this._userLocationDotMarker&&(f.webkitCompassHeading?this._heading=f.webkitCompassHeading:!0===f.absolute&&(this._heading=-1*f.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":wc--,Ec=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let f;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),wc++,wc>1?(f={maximumAge:6e5,timeout:0},Ec=!0):(f=this.options.positionOptions,Ec=!1),this._geolocationWatchID=u.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else u.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const f=()=>{u.window.addEventListener("ondeviceorientationabsolute"in u.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientationListener)};void 0!==u.window.DeviceMotionEvent&&"function"==typeof u.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(n=>{"granted"===n&&f()}).catch(console.error):f()}_clearWatch(){u.window.navigator.geolocation.clearWatch(this._geolocationWatchID),u.window.removeEventListener("deviceorientation",this._onDeviceOrientationListener),u.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientationListener),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:we,ScaleControl:class{constructor(f){this.options=u.extend({},jc,f),u.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){jt(this._map,this._container,this.options)}onAdd(f){return this._map=f,this._container=Me.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(f){this.options.unit=f,jt(this._map,this._container,this.options)}},FullscreenControl:class{constructor(f){this._fullscreen=!1,f&&f.container&&(f.container instanceof u.window.HTMLElement?this._container=f.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),u.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in u.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in u.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=Me.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",u.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,u.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!u.window.document.fullscreenEnabled&&!u.window.document.webkitFullscreenEnabled)}_setupUI(){const f=this._fullscreenButton=Me.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Me.create("span","mapboxgl-ctrl-icon",f).setAttribute("aria-hidden",!0),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),u.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",f)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(u.window.document.fullscreenElement||u.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?u.window.document.exitFullscreen?u.window.document.exitFullscreen():u.window.document.webkitCancelFullScreen&&u.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends u.Evented{constructor(f){super(),this.options=u.extend(Object.create(hd),f),u.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this),this._classList=new Set(f&&f.className?f.className.trim().split(/\s+/):[])}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("preclick",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&this._content.remove(),this._container&&(this._container.remove(),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new u.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=u.LngLat.convert(f),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(u.window.document.createTextNode(f))}setHTML(f){const n=u.window.document.createDocumentFragment(),l=u.window.document.createElement("body");let p;for(l.innerHTML=f;p=l.firstChild,p;)n.appendChild(p);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Me.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._classList.add(f),this._container&&this._updateClassList(),this}removeClassName(f){return this._classList.delete(f),this._container&&this._updateClassList(),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){let n;return this._classList.delete(f)?n=!1:(this._classList.add(f),n=!0),this._container&&this._updateClassList(),n}_createCloseButton(){this.options.closeButton&&(this._closeButton=Me.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.setAttribute("aria-hidden","true"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(f){this._update(f.point)}_onMouseMove(f){this._update(f.point)}_onDrag(f){this._update(f.point)}_getAnchor(f){if(this.options.anchor)return this.options.anchor;const n=this._pos,l=this._container.offsetWidth,p=this._container.offsetHeight;let _;return _=n.y+f.bottom.y<p?["top"]:n.y>this._map.transform.height-p?["bottom"]:[],n.x<l/2?_.push("left"):n.x>this._map.transform.width-l/2&&_.push("right"),0===_.length?"bottom":_.join("-")}_updateClassList(){const f=[...this._classList];f.push("mapboxgl-popup"),this._anchor&&f.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&f.push("mapboxgl-popup-track-pointer"),this._container.className=f.join(" ")}_update(f){if(this._map&&(this._lngLat||this._trackPointer)&&this._content){if(this._container||(this._container=Me.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Me.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content)),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=_n(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||f){const n=this._pos=this._trackPointer&&f?f:this._map.project(this._lngLat),l=function(x){if(x||(x=new u.pointGeometry(0,0)),"number"==typeof x){const w=Math.round(Math.sqrt(.5*Math.pow(x,2)));return{center:new u.pointGeometry(0,0),top:new u.pointGeometry(0,x),"top-left":new u.pointGeometry(w,w),"top-right":new u.pointGeometry(-w,w),bottom:new u.pointGeometry(0,-x),"bottom-left":new u.pointGeometry(w,-w),"bottom-right":new u.pointGeometry(-w,-w),left:new u.pointGeometry(x,0),right:new u.pointGeometry(-x,0)}}if(x instanceof u.pointGeometry||Array.isArray(x)){const w=u.pointGeometry.convert(x);return{center:w,top:w,"top-left":w,"top-right":w,bottom:w,"bottom-left":w,"bottom-right":w,left:w,right:w}}return{center:u.pointGeometry.convert(x.center||[0,0]),top:u.pointGeometry.convert(x.top||[0,0]),"top-left":u.pointGeometry.convert(x["top-left"]||[0,0]),"top-right":u.pointGeometry.convert(x["top-right"]||[0,0]),bottom:u.pointGeometry.convert(x.bottom||[0,0]),"bottom-left":u.pointGeometry.convert(x["bottom-left"]||[0,0]),"bottom-right":u.pointGeometry.convert(x["bottom-right"]||[0,0]),left:u.pointGeometry.convert(x.left||[0,0]),right:u.pointGeometry.convert(x.right||[0,0])}}(this.options.offset),p=this._anchor=this._getAnchor(l),_=n.add(l[p]).round();this._map._requestDomTask(()=>{this._container&&p&&(this._container.style.transform=`${zt[p]} translate(${_.x}px,${_.y}px)`)})}this._updateClassList()}}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector($c);f&&f.focus()}_onClose(){this.remove()}_setOpacity(f){this._content&&(this._content.style.opacity=f),this._tip&&(this._tip.style.opacity=f)}},Marker:pr,Style:Bi,LngLat:u.LngLat,LngLatBounds:u.LngLatBounds,Point:u.pointGeometry,MercatorCoordinate:u.MercatorCoordinate,FreeCameraOptions:Ul,Evented:u.Evented,config:u.config,prewarm:function(){Ee().acquire(_e)},clearPrewarmedResources:function(){const f=Pe;f&&(f.isPreloaded()&&1===f.numActive()?(f.release(_e),Pe=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return u.config.ACCESS_TOKEN},set accessToken(f){u.config.ACCESS_TOKEN=f},get baseApiUrl(){return u.config.API_URL},set baseApiUrl(f){u.config.API_URL=f},get workerCount(){return Ie.workerCount},set workerCount(f){Ie.workerCount=f},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(f){u.config.MAX_PARALLEL_IMAGE_REQUESTS=f},clearStorage(f){u.clearTileCache(f)},workerUrl:"",workerClass:null,setNow:u.exported.setNow,restoreNow:u.exported.restoreNow};return ys}),Y}()},655:(er,Gt,Le)=>{"use strict";function et(Ne,$e,He,qe){return new(He||(He=Promise))(function(Ve,En){function Qt($r){try{hn(qe.next($r))}catch(yi){En(yi)}}function br($r){try{hn(qe.throw($r))}catch(yi){En(yi)}}function hn($r){$r.done?Ve($r.value):function _t(Ve){return Ve instanceof He?Ve:new He(function(En){En(Ve)})}($r.value).then(Qt,br)}hn((qe=qe.apply(Ne,$e||[])).next())})}function It(Ne){return this instanceof It?(this.v=Ne,this):new It(Ne)}function Nn(Ne,$e,He){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var _t,qe=He.apply(Ne,$e||[]),Ve=[];return _t={},En("next"),En("throw"),En("return"),_t[Symbol.asyncIterator]=function(){return this},_t;function En(ur){qe[ur]&&(_t[ur]=function(vi){return new Promise(function(Fi,Eo){Ve.push([ur,vi,Fi,Eo])>1||Qt(ur,vi)})})}function Qt(ur,vi){try{!function br(ur){ur.value instanceof It?Promise.resolve(ur.value.v).then(hn,$r):yi(Ve[0][2],ur)}(qe[ur](vi))}catch(Fi){yi(Ve[0][3],Fi)}}function hn(ur){Qt("next",ur)}function $r(ur){Qt("throw",ur)}function yi(ur,vi){ur(vi),Ve.shift(),Ve.length&&Qt(Ve[0][0],Ve[0][1])}}function xn(Ne){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var He,$e=Ne[Symbol.asyncIterator];return $e?$e.call(Ne):(Ne=function Ot(Ne){var $e="function"==typeof Symbol&&Symbol.iterator,He=$e&&Ne[$e],qe=0;if(He)return He.call(Ne);if(Ne&&"number"==typeof Ne.length)return{next:function(){return Ne&&qe>=Ne.length&&(Ne=void 0),{value:Ne&&Ne[qe++],done:!Ne}}};throw new TypeError($e?"Object is not iterable.":"Symbol.iterator is not defined.")}(Ne),He={},qe("next"),qe("throw"),qe("return"),He[Symbol.asyncIterator]=function(){return this},He);function qe(Ve){He[Ve]=Ne[Ve]&&function(En){return new Promise(function(Qt,br){!function _t(Ve,En,Qt,br){Promise.resolve(br).then(function(hn){Ve({value:hn,done:Qt})},En)}(Qt,br,(En=Ne[Ve](En)).done,En.value)})}}}Le.d(Gt,{mG:()=>et,qq:()=>It,FC:()=>Nn,KL:()=>xn})},808:(er,Gt,Le)=>{"use strict";Le.d(Gt,{mr:()=>zn,ez:()=>ca,K0:()=>Nt,JJ:()=>Bi,Do:()=>ut,V_:()=>Me,Ye:()=>Dt,S$:()=>It,sg:()=>mi,PC:()=>Rn,b0:()=>xn,lw:()=>et,EM:()=>ni,JF:()=>La,w_:()=>en,bD:()=>bn,q:()=>Mt,Mx:()=>dr,HT:()=>wt});var Y=Le(223);let Oe=null;function Mt(){return Oe}function wt(z){Oe||(Oe=z)}class en{}const Nt=new Y.OlP("DocumentToken");let et=(()=>{class z{historyGo(B){throw new Error("Not implemented")}}return z.\u0275fac=function(B){return new(B||z)},z.\u0275prov=Y.Yz7({token:z,factory:function(){return function Et(){return(0,Y.LFG)(st)}()},providedIn:"platform"}),z})();const Me=new Y.OlP("Location Initialized");let st=(()=>{class z extends et{constructor(B){super(),this._doc=B,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Mt().getBaseHref(this._doc)}onPopState(B){const J=Mt().getGlobalEventTarget(this._doc,"window");return J.addEventListener("popstate",B,!1),()=>J.removeEventListener("popstate",B)}onHashChange(B){const J=Mt().getGlobalEventTarget(this._doc,"window");return J.addEventListener("hashchange",B,!1),()=>J.removeEventListener("hashchange",B)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(B){this.location.pathname=B}pushState(B,J,Te){Ot()?this._history.pushState(B,J,Te):this.location.hash=Te}replaceState(B,J,Te){Ot()?this._history.replaceState(B,J,Te):this.location.hash=Te}forward(){this._history.forward()}back(){this._history.back()}historyGo(B=0){this._history.go(B)}getState(){return this._history.state}}return z.\u0275fac=function(B){return new(B||z)(Y.LFG(Nt))},z.\u0275prov=Y.Yz7({token:z,factory:function(){return function Bn(){return new st((0,Y.LFG)(Nt))}()},providedIn:"platform"}),z})();function Ot(){return!!window.history.pushState}function Ft(z,W){if(0==z.length)return W;if(0==W.length)return z;let B=0;return z.endsWith("/")&&B++,W.startsWith("/")&&B++,2==B?z+W.substring(1):1==B?z+W:z+"/"+W}function Rt(z){const W=z.match(/#|\?|$/),B=W&&W.index||z.length;return z.slice(0,B-("/"===z[B-1]?1:0))+z.slice(B)}function an(z){return z&&"?"!==z[0]?"?"+z:z}let It=(()=>{class z{historyGo(B){throw new Error("Not implemented")}}return z.\u0275fac=function(B){return new(B||z)},z.\u0275prov=Y.Yz7({token:z,factory:function(){return function Nn(z){const W=(0,Y.LFG)(Nt).location;return new xn((0,Y.LFG)(et),W&&W.origin||"")}()},providedIn:"root"}),z})();const zn=new Y.OlP("appBaseHref");let xn=(()=>{class z extends It{constructor(B,J){if(super(),this._platformLocation=B,this._removeListenerFns=[],null==J&&(J=this._platformLocation.getBaseHrefFromDOM()),null==J)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=J}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(B){this._removeListenerFns.push(this._platformLocation.onPopState(B),this._platformLocation.onHashChange(B))}getBaseHref(){return this._baseHref}prepareExternalUrl(B){return Ft(this._baseHref,B)}path(B=!1){const J=this._platformLocation.pathname+an(this._platformLocation.search),Te=this._platformLocation.hash;return Te&&B?`${J}${Te}`:J}pushState(B,J,Te,Ye){const yt=this.prepareExternalUrl(Te+an(Ye));this._platformLocation.pushState(B,J,yt)}replaceState(B,J,Te,Ye){const yt=this.prepareExternalUrl(Te+an(Ye));this._platformLocation.replaceState(B,J,yt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(B=0){var J,Te;null===(Te=(J=this._platformLocation).historyGo)||void 0===Te||Te.call(J,B)}}return z.\u0275fac=function(B){return new(B||z)(Y.LFG(et),Y.LFG(zn,8))},z.\u0275prov=Y.Yz7({token:z,factory:z.\u0275fac}),z})(),ut=(()=>{class z extends It{constructor(B,J){super(),this._platformLocation=B,this._baseHref="",this._removeListenerFns=[],null!=J&&(this._baseHref=J)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(B){this._removeListenerFns.push(this._platformLocation.onPopState(B),this._platformLocation.onHashChange(B))}getBaseHref(){return this._baseHref}path(B=!1){let J=this._platformLocation.hash;return null==J&&(J="#"),J.length>0?J.substring(1):J}prepareExternalUrl(B){const J=Ft(this._baseHref,B);return J.length>0?"#"+J:J}pushState(B,J,Te,Ye){let yt=this.prepareExternalUrl(Te+an(Ye));0==yt.length&&(yt=this._platformLocation.pathname),this._platformLocation.pushState(B,J,yt)}replaceState(B,J,Te,Ye){let yt=this.prepareExternalUrl(Te+an(Ye));0==yt.length&&(yt=this._platformLocation.pathname),this._platformLocation.replaceState(B,J,yt)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(B=0){var J,Te;null===(Te=(J=this._platformLocation).historyGo)||void 0===Te||Te.call(J,B)}}return z.\u0275fac=function(B){return new(B||z)(Y.LFG(et),Y.LFG(zn,8))},z.\u0275prov=Y.Yz7({token:z,factory:z.\u0275fac}),z})(),Dt=(()=>{class z{constructor(B,J){this._subject=new Y.vpe,this._urlChangeListeners=[],this._platformStrategy=B;const Te=this._platformStrategy.getBaseHref();this._platformLocation=J,this._baseHref=Rt(tn(Te)),this._platformStrategy.onPopState(Ye=>{this._subject.emit({url:this.path(!0),pop:!0,state:Ye.state,type:Ye.type})})}path(B=!1){return this.normalize(this._platformStrategy.path(B))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(B,J=""){return this.path()==this.normalize(B+an(J))}normalize(B){return z.stripTrailingSlash(function Wt(z,W){return z&&W.startsWith(z)?W.substring(z.length):W}(this._baseHref,tn(B)))}prepareExternalUrl(B){return B&&"/"!==B[0]&&(B="/"+B),this._platformStrategy.prepareExternalUrl(B)}go(B,J="",Te=null){this._platformStrategy.pushState(Te,"",B,J),this._notifyUrlChangeListeners(this.prepareExternalUrl(B+an(J)),Te)}replaceState(B,J="",Te=null){this._platformStrategy.replaceState(Te,"",B,J),this._notifyUrlChangeListeners(this.prepareExternalUrl(B+an(J)),Te)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(B=0){var J,Te;null===(Te=(J=this._platformStrategy).historyGo)||void 0===Te||Te.call(J,B)}onUrlChange(B){this._urlChangeListeners.push(B),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(J=>{this._notifyUrlChangeListeners(J.url,J.state)}))}_notifyUrlChangeListeners(B="",J){this._urlChangeListeners.forEach(Te=>Te(B,J))}subscribe(B,J,Te){return this._subject.subscribe({next:B,error:J,complete:Te})}}return z.normalizeQueryParams=an,z.joinWithSlash=Ft,z.stripTrailingSlash=Rt,z.\u0275fac=function(B){return new(B||z)(Y.LFG(It),Y.LFG(et))},z.\u0275prov=Y.Yz7({token:z,factory:function(){return function fn(){return new Dt((0,Y.LFG)(It),(0,Y.LFG)(et))}()},providedIn:"root"}),z})();function tn(z){return z.replace(/\/index.html$/,"")}var Ne=(()=>((Ne=Ne||{})[Ne.Decimal=0]="Decimal",Ne[Ne.Percent=1]="Percent",Ne[Ne.Currency=2]="Currency",Ne[Ne.Scientific=3]="Scientific",Ne))(),Ve=(()=>((Ve=Ve||{})[Ve.Decimal=0]="Decimal",Ve[Ve.Group=1]="Group",Ve[Ve.List=2]="List",Ve[Ve.PercentSign=3]="PercentSign",Ve[Ve.PlusSign=4]="PlusSign",Ve[Ve.MinusSign=5]="MinusSign",Ve[Ve.Exponential=6]="Exponential",Ve[Ve.SuperscriptingExponent=7]="SuperscriptingExponent",Ve[Ve.PerMille=8]="PerMille",Ve[Ve.Infinity=9]="Infinity",Ve[Ve.NaN=10]="NaN",Ve[Ve.TimeSeparator=11]="TimeSeparator",Ve[Ve.CurrencyDecimal=12]="CurrencyDecimal",Ve[Ve.CurrencyGroup=13]="CurrencyGroup",Ve))();function Lr(z,W){const B=(0,Y.cg1)(z),J=B[Y.wAp.NumberSymbols][W];if(void 0===J){if(W===Ve.CurrencyDecimal)return B[Y.wAp.NumberSymbols][Ve.Decimal];if(W===Ve.CurrencyGroup)return B[Y.wAp.NumberSymbols][Ve.Group]}return J}const Fe=/^(\d+)?\.((\d+)(-(\d+))?)?$/;function Or(z){const W=parseInt(z);if(isNaN(W))throw new Error("Invalid integer literal when parsing "+z);return W}function dr(z,W){W=encodeURIComponent(W);for(const B of z.split(";")){const J=B.indexOf("="),[Te,Ye]=-1==J?[B,""]:[B.slice(0,J),B.slice(J+1)];if(Te.trim()===W)return decodeURIComponent(Ye)}return null}class Qr{constructor(W,B,J,Te){this.$implicit=W,this.ngForOf=B,this.index=J,this.count=Te}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let mi=(()=>{class z{constructor(B,J,Te){this._viewContainer=B,this._template=J,this._differs=Te,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(B){this._ngForOf=B,this._ngForOfDirty=!0}set ngForTrackBy(B){this._trackByFn=B}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(B){B&&(this._template=B)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const B=this._ngForOf;!this._differ&&B&&(this._differ=this._differs.find(B).create(this.ngForTrackBy))}if(this._differ){const B=this._differ.diff(this._ngForOf);B&&this._applyChanges(B)}}_applyChanges(B){const J=this._viewContainer;B.forEachOperation((Te,Ye,yt)=>{if(null==Te.previousIndex)J.createEmbeddedView(this._template,new Qr(Te.item,this._ngForOf,-1,-1),null===yt?void 0:yt);else if(null==yt)J.remove(null===Ye?void 0:Ye);else if(null!==Ye){const rn=J.get(Ye);J.move(rn,yt),Dr(rn,Te)}});for(let Te=0,Ye=J.length;Te<Ye;Te++){const rn=J.get(Te).context;rn.index=Te,rn.count=Ye,rn.ngForOf=this._ngForOf}B.forEachIdentityChange(Te=>{Dr(J.get(Te.currentIndex),Te)})}static ngTemplateContextGuard(B,J){return!0}}return z.\u0275fac=function(B){return new(B||z)(Y.Y36(Y.s_b),Y.Y36(Y.Rgc),Y.Y36(Y.ZZ4))},z.\u0275dir=Y.lG2({type:z,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),z})();function Dr(z,W){z.context.$implicit=W.item}let Rn=(()=>{class z{constructor(B,J,Te){this._ngEl=B,this._differs=J,this._renderer=Te,this._ngStyle=null,this._differ=null}set ngStyle(B){this._ngStyle=B,!this._differ&&B&&(this._differ=this._differs.find(B).create())}ngDoCheck(){if(this._differ){const B=this._differ.diff(this._ngStyle);B&&this._applyChanges(B)}}_setStyle(B,J){const[Te,Ye]=B.split(".");null!=(J=null!=J&&Ye?`${J}${Ye}`:J)?this._renderer.setStyle(this._ngEl.nativeElement,Te,J):this._renderer.removeStyle(this._ngEl.nativeElement,Te)}_applyChanges(B){B.forEachRemovedItem(J=>this._setStyle(J.key,null)),B.forEachAddedItem(J=>this._setStyle(J.key,J.currentValue)),B.forEachChangedItem(J=>this._setStyle(J.key,J.currentValue))}}return z.\u0275fac=function(B){return new(B||z)(Y.Y36(Y.SBq),Y.Y36(Y.aQg),Y.Y36(Y.Qsj))},z.\u0275dir=Y.lG2({type:z,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),z})();let Bi=(()=>{class z{constructor(B){this._locale=B}transform(B,J,Te){if(!function Ms(z){return!(null==z||""===z||z!=z)}(B))return null;Te=Te||this._locale;try{return function Xt(z,W,B){return function Se(z,W,B,J,Te,Ye,yt=!1){let rn="",gn=!1;if(isFinite(z)){let Cr=function Fr(z){let J,Te,Ye,yt,rn,W=Math.abs(z)+"",B=0;for((Te=W.indexOf("."))>-1&&(W=W.replace(".","")),(Ye=W.search(/e/i))>0?(Te<0&&(Te=Ye),Te+=+W.slice(Ye+1),W=W.substring(0,Ye)):Te<0&&(Te=W.length),Ye=0;"0"===W.charAt(Ye);Ye++);if(Ye===(rn=W.length))J=[0],Te=1;else{for(rn--;"0"===W.charAt(rn);)rn--;for(Te-=Ye,J=[],yt=0;Ye<=rn;Ye++,yt++)J[yt]=Number(W.charAt(Ye))}return Te>22&&(J=J.splice(0,21),B=Te-1,Te=1),{digits:J,exponent:B,integerLen:Te}}(z);yt&&(Cr=function Tr(z){if(0===z.digits[0])return z;const W=z.digits.length-z.integerLen;return z.exponent?z.exponent+=2:(0===W?z.digits.push(0,0):1===W&&z.digits.push(0),z.integerLen+=2),z}(Cr));let Sr=W.minInt,dn=W.minFrac,_r=W.maxFrac;if(Ye){const vo=Ye.match(Fe);if(null===vo)throw new Error(`${Ye} is not a valid digit info`);const oi=vo[1],Qo=vo[3],Do=vo[5];null!=oi&&(Sr=Or(oi)),null!=Qo&&(dn=Or(Qo)),null!=Do?_r=Or(Do):null!=Qo&&dn>_r&&(_r=dn)}!function Si(z,W,B){if(W>B)throw new Error(`The minimum number of digits after fraction (${W}) is higher than the maximum (${B}).`);let J=z.digits,Te=J.length-z.integerLen;const Ye=Math.min(Math.max(W,Te),B);let yt=Ye+z.integerLen,rn=J[yt];if(yt>0){J.splice(Math.max(z.integerLen,yt));for(let dn=yt;dn<J.length;dn++)J[dn]=0}else{Te=Math.max(0,Te),z.integerLen=1,J.length=Math.max(1,yt=Ye+1),J[0]=0;for(let dn=1;dn<yt;dn++)J[dn]=0}if(rn>=5)if(yt-1<0){for(let dn=0;dn>yt;dn--)J.unshift(0),z.integerLen++;J.unshift(1),z.integerLen++}else J[yt-1]++;for(;Te<Math.max(0,Ye);Te++)J.push(0);let gn=0!==Ye;const Cr=W+z.integerLen,Sr=J.reduceRight(function(dn,_r,Vr,ei){return ei[Vr]=(_r+=dn)<10?_r:_r-10,gn&&(0===ei[Vr]&&Vr>=Cr?ei.pop():gn=!1),_r>=10?1:0},0);Sr&&(J.unshift(Sr),z.integerLen++)}(Cr,dn,_r);let Vr=Cr.digits,ei=Cr.integerLen;const ii=Cr.exponent;let yo=[];for(gn=Vr.every(vo=>!vo);ei<Sr;ei++)Vr.unshift(0);for(;ei<0;ei++)Vr.unshift(0);ei>0?yo=Vr.splice(ei,Vr.length):(yo=Vr,Vr=[0]);const Ps=[];for(Vr.length>=W.lgSize&&Ps.unshift(Vr.splice(-W.lgSize,Vr.length).join(""));Vr.length>W.gSize;)Ps.unshift(Vr.splice(-W.gSize,Vr.length).join(""));Vr.length&&Ps.unshift(Vr.join("")),rn=Ps.join(Lr(B,J)),yo.length&&(rn+=Lr(B,Te)+yo.join("")),ii&&(rn+=Lr(B,Ve.Exponential)+"+"+ii)}else rn=Lr(B,Ve.Infinity);return rn=z<0&&!gn?W.negPre+rn+W.negSuf:W.posPre+rn+W.posSuf,rn}(z,function Er(z,W="-"){const B={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},J=z.split(";"),Te=J[0],Ye=J[1],yt=-1!==Te.indexOf(".")?Te.split("."):[Te.substring(0,Te.lastIndexOf("0")+1),Te.substring(Te.lastIndexOf("0")+1)],rn=yt[0],gn=yt[1]||"";B.posPre=rn.substr(0,rn.indexOf("#"));for(let Sr=0;Sr<gn.length;Sr++){const dn=gn.charAt(Sr);"0"===dn?B.minFrac=B.maxFrac=Sr+1:"#"===dn?B.maxFrac=Sr+1:B.posSuf+=dn}const Cr=rn.split(",");if(B.gSize=Cr[1]?Cr[1].length:0,B.lgSize=Cr[2]||Cr[1]?(Cr[2]||Cr[1]).length:0,Ye){const Sr=Te.length-B.posPre.length-B.posSuf.length,dn=Ye.indexOf("#");B.negPre=Ye.substr(0,dn).replace(/'/g,""),B.negSuf=Ye.substr(dn+Sr).replace(/'/g,"")}else B.negPre=W+B.posPre,B.negSuf=B.posSuf;return B}(function $n(z,W){return(0,Y.cg1)(z)[Y.wAp.NumberFormats][W]}(W,Ne.Decimal),Lr(W,Ve.MinusSign)),W,Ve.Group,Ve.Decimal,B)}(function Is(z){if("string"==typeof z&&!isNaN(Number(z)-parseFloat(z)))return Number(z);if("number"!=typeof z)throw new Error(`${z} is not a number`);return z}(B),Te,J)}catch(Ye){throw function Jr(z,W){return new Y.vHH(2100,"")}()}}}return z.\u0275fac=function(B){return new(B||z)(Y.Y36(Y.soG,16))},z.\u0275pipe=Y.Yjl({name:"number",type:z,pure:!0}),z})();let ca=(()=>{class z{}return z.\u0275fac=function(B){return new(B||z)},z.\u0275mod=Y.oAB({type:z}),z.\u0275inj=Y.cJS({}),z})();const bn="browser";let ni=(()=>{class z{}return z.\u0275prov=(0,Y.Yz7)({token:z,providedIn:"root",factory:()=>new Fo((0,Y.LFG)(Nt),window)}),z})();class Fo{constructor(W,B){this.document=W,this.window=B,this.offset=()=>[0,0]}setOffset(W){this.offset=Array.isArray(W)?()=>W:W}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(W){this.supportsScrolling()&&this.window.scrollTo(W[0],W[1])}scrollToAnchor(W){if(!this.supportsScrolling())return;const B=function dc(z,W){const B=z.getElementById(W)||z.getElementsByName(W)[0];if(B)return B;if("function"==typeof z.createTreeWalker&&z.body&&(z.body.createShadowRoot||z.body.attachShadow)){const J=z.createTreeWalker(z.body,NodeFilter.SHOW_ELEMENT);let Te=J.currentNode;for(;Te;){const Ye=Te.shadowRoot;if(Ye){const yt=Ye.getElementById(W)||Ye.querySelector(`[name="${W}"]`);if(yt)return yt}Te=J.nextNode()}}return null}(this.document,W);B&&(this.scrollToElement(B),B.focus())}setHistoryScrollRestoration(W){if(this.supportScrollRestoration()){const B=this.window.history;B&&B.scrollRestoration&&(B.scrollRestoration=W)}}scrollToElement(W){const B=W.getBoundingClientRect(),J=B.left+this.window.pageXOffset,Te=B.top+this.window.pageYOffset,Ye=this.offset();this.window.scrollTo(J-Ye[0],Te-Ye[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const W=ki(this.window.history)||ki(Object.getPrototypeOf(this.window.history));return!(!W||!W.writable&&!W.set)}catch(W){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(W){return!1}}}function ki(z){return Object.getOwnPropertyDescriptor(z,"scrollRestoration")}class La{}},223:(er,Gt,Le)=>{"use strict";Le.d(Gt,{deG:()=>wc,tb:()=>Jv,AFp:()=>Xv,ip1:()=>Wv,CZH:()=>p_,hGG:()=>tw,z2F:()=>b_,sBO:()=>Nb,Sil:()=>xb,_Vd:()=>Mm,EJc:()=>yb,SBq:()=>Uf,qLn:()=>bh,vpe:()=>hc,tBr:()=>qr,XFs:()=>Jt,OlP:()=>sr,zs3:()=>aa,ZZ4:()=>S_,aQg:()=>M_,soG:()=>g_,YKP:()=>lv,h0i:()=>ld,PXZ:()=>kb,R0b:()=>Ll,FiY:()=>ao,Lbi:()=>Qv,g9A:()=>Kv,Qsj:()=>f1,FYo:()=>iv,JOm:()=>Ea,tp0:()=>lo,Rgc:()=>Gf,dDg:()=>r0,GfV:()=>ov,s_b:()=>Pm,ifc:()=>Zn,eFA:()=>a0,G48:()=>Bb,_c5:()=>ew,VLi:()=>Ib,c2e:()=>e0,zSh:()=>Xh,wAp:()=>Dn,vHH:()=>Wt,cg1:()=>Hg,kL8:()=>Iy,dqk:()=>Kn,sIi:()=>ah,CqO:()=>Cu,QGY:()=>ac,F4k:()=>Du,RDi:()=>Ye,AaK:()=>It,TTD:()=>Ur,xp6:()=>Hd,uIk:()=>Oc,Suo:()=>Sv,Xpm:()=>Pe,lG2:()=>ve,Yz7:()=>Gr,cJS:()=>To,oAB:()=>it,Yjl:()=>de,Y36:()=>Ir,_UZ:()=>co,qZA:()=>Br,TgZ:()=>Ci,EpF:()=>la,LFG:()=>Fn,$8M:()=>Us,$Z:()=>$i,NdJ:()=>td,CRH:()=>Mv,oxw:()=>Pa,ALo:()=>yv,xi3:()=>vv,Q6J:()=>ws,VKq:()=>dv,iGM:()=>Dv,MAs:()=>I,CHM:()=>al,LSH:()=>vd,YNc:()=>b,_uU:()=>uy,Oqu:()=>$g,hij:()=>wm,lnq:()=>Gg,Gf:()=>Cv});var Y=Le(189),Oe=Le(421),Mt=Le(515),u=Le(669),wt=Le(76),Nt=Le(579),et=Le(727),Et=Le(306),Me=Le(698),st=Le(961),Ot=Le(482);function Ft(i,o,...a){return!0===o?(i(),null):!1===o?null:o(...a).pipe((0,Me.q)(1)).subscribe(()=>i())}function Rt(i){for(let o in i)if(i[o]===Rt)return o;throw Error("Could not find renamed property on target object.")}function It(i){if("string"==typeof i)return i;if(Array.isArray(i))return"["+i.map(It).join(", ")+"]";if(null==i)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;const o=i.toString();if(null==o)return""+o;const a=o.indexOf("\n");return-1===a?o:o.substring(0,a)}function Nn(i,o){return null==i||""===i?null===o?"":o:null==o||""===o?i:i+" "+o}const zn=Rt({__forward_ref__:Rt});function xn(i){return i.__forward_ref__=xn,i.toString=function(){return It(this())},i}function ut(i){return function Dt(i){return"function"==typeof i&&i.hasOwnProperty(zn)&&i.__forward_ref__===xn}(i)?i():i}class Wt extends Error{constructor(o,a){super(function tn(i,o){return`NG0${Math.abs(i)}${o?": "+o:""}`}(o,a)),this.code=o}}function ft(i){return"string"==typeof i?i:null==i?"":String(i)}function Ne(i){return"function"==typeof i?i.name||i.toString():"object"==typeof i&&null!=i&&"function"==typeof i.type?i.type.name||i.type.toString():ft(i)}function _t(i,o){const a=o?` in ${o}`:"";throw new Wt(-201,`No provider for ${Ne(i)} found${a}`)}function $n(i,o){null==i&&function Gn(i,o,a,h){throw new Error(`ASSERTION ERROR: ${i}`+(null==h?"":` [Expected=> ${a} ${h} ${o} <=Actual]`))}(o,i,null,"!=")}function Gr(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function To(i){return{providers:i.providers||[],imports:i.imports||[]}}function Pn(i){return Yr(i,cr)||Yr(i,fs)}function Yr(i,o){return i.hasOwnProperty(o)?i[o]:null}function xi(i){return i&&(i.hasOwnProperty(uo)||i.hasOwnProperty(ho))?i[uo]:null}const cr=Rt({\u0275prov:Rt}),uo=Rt({\u0275inj:Rt}),fs=Rt({ngInjectableDef:Rt}),ho=Rt({ngInjectorDef:Rt});var Jt=(()=>((Jt=Jt||{})[Jt.Default=0]="Default",Jt[Jt.Host=1]="Host",Jt[Jt.Self=2]="Self",Jt[Jt.SkipSelf=4]="SkipSelf",Jt[Jt.Optional=8]="Optional",Jt))();let wr;function cn(i){const o=wr;return wr=i,o}function fo(i,o,a){const h=Pn(i);return h&&"root"==h.providedIn?void 0===h.value?h.value=h.factory():h.value:a&Jt.Optional?null:void 0!==o?o:void _t(It(i),"Injector")}function hr(i){return{toString:i}.toString()}var fi=(()=>((fi=fi||{})[fi.OnPush=0]="OnPush",fi[fi.Default=1]="Default",fi))(),Zn=(()=>{return(i=Zn||(Zn={}))[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",Zn;var i})();const mo="undefined"!=typeof globalThis&&globalThis,qt="undefined"!=typeof window&&window,ps="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Kn=mo||"undefined"!=typeof global&&global||qt||ps,ro={},Sn=[],oe=Rt({\u0275cmp:Rt}),V=Rt({\u0275dir:Rt}),Z=Rt({\u0275pipe:Rt}),se=Rt({\u0275mod:Rt}),le=Rt({\u0275fac:Rt}),_e=Rt({__NG_ELEMENT_ID__:Rt});let Ie=0;function Pe(i){return hr(()=>{const a={},h={type:i.type,providersResolver:null,decls:i.decls,vars:i.vars,factory:null,template:i.template||null,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:a,inputs:null,outputs:null,exportAs:i.exportAs||null,onPush:i.changeDetection===fi.OnPush,directiveDefs:null,pipeDefs:null,selectors:i.selectors||Sn,viewQuery:i.viewQuery||null,features:i.features||null,data:i.data||{},encapsulation:i.encapsulation||Zn.Emulated,id:"c",styles:i.styles||Sn,_:null,setInput:null,schemas:i.schemas||null,tView:null},g=i.directives,v=i.features,T=i.pipes;return h.id+=Ie++,h.inputs=Kt(i.inputs,a),h.outputs=Kt(i.outputs),v&&v.forEach(M=>M(h)),h.directiveDefs=g?()=>("function"==typeof g?g():g).map(Fe):null,h.pipeDefs=T?()=>("function"==typeof T?T():T).map(Xe):null,h})}function Fe(i){return ae(i)||function Se(i){return i[V]||null}(i)}function Xe(i){return function Ze(i){return i[Z]||null}(i)}const nt={};function it(i){return hr(()=>{const o={type:i.type,bootstrap:i.bootstrap||Sn,declarations:i.declarations||Sn,imports:i.imports||Sn,exports:i.exports||Sn,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null};return null!=i.id&&(nt[i.id]=i.type),o})}function Kt(i,o){if(null==i)return ro;const a={};for(const h in i)if(i.hasOwnProperty(h)){let g=i[h],v=g;Array.isArray(g)&&(v=g[1],g=g[0]),a[g]=h,o&&(o[g]=v)}return a}const ve=Pe;function de(i){return{type:i.type,name:i.name,factory:null,pure:!1!==i.pure,onDestroy:i.type.prototype.ngOnDestroy||null}}function ae(i){return i[oe]||null}function At(i,o){const a=i[se]||null;if(!a&&!0===o)throw new Error(`Type ${It(i)} does not have '\u0275mod' property.`);return a}function Jr(i){return Array.isArray(i)&&"object"==typeof i[1]}function Nr(i){return Array.isArray(i)&&!0===i[1]}function Pr(i){return 0!=(8&i.flags)}function _o(i){return 2==(2&i.flags)}function Pi(i){return 1==(1&i.flags)}function Oi(i){return null!==i.template}function Lo(i){return 0!=(512&i[2])}function gs(i,o){return i.hasOwnProperty(le)?i[le]:null}class ua{constructor(o,a,h){this.previousValue=o,this.currentValue=a,this.firstChange=h}isFirstChange(){return this.firstChange}}function Ur(){return ha}function ha(i){return i.type.prototype.ngOnChanges&&(i.setInput=bi),As}function As(){const i=ni(this),o=null==i?void 0:i.current;if(o){const a=i.previous;if(a===ro)i.previous=o;else for(let h in o)a[h]=o[h];i.current=null,this.ngOnChanges(o)}}function bi(i,o,a,h){const g=ni(i)||function Fo(i,o){return i[Ws]=o}(i,{previous:ro,current:null}),v=g.current||(g.current={}),T=g.previous,M=this.declaredInputs[a],k=T[M];v[M]=new ua(k&&k.currentValue,o,T===ro),i[h]=o}Ur.ngInherit=!0;const Ws="__ngSimpleChanges__";function ni(i){return i[Ws]||null}const W="math";let Te;function Ye(i){Te=i}function gn(i){return!!i.listen}const Cr={createRenderer:(i,o)=>function yt(){return void 0!==Te?Te:"undefined"!=typeof document?document:void 0}()};function dn(i){for(;Array.isArray(i);)i=i[0];return i}function ii(i,o){return dn(o[i.index])}function Ps(i,o){return i.data[o]}function vo(i,o){return i[o]}function oi(i,o){const a=o[i];return Jr(a)?a:a[0]}function Qo(i){return 4==(4&i[2])}function Do(i){return 128==(128&i[2])}function Oo(i,o){return null==o?null:i[o]}function ks(i){i[18]=0}function da(i,o){i[5]+=o;let a=i,h=i[3];for(;null!==h&&(1===o&&1===a[5]||-1===o&&0===a[5]);)h[5]+=o,a=h,h=h[3]}const pn={lFrame:dl(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Oa(){return pn.bindingsEnabled}function mt(){return pn.lFrame.lView}function tr(){return pn.lFrame.tView}function al(i){return pn.lFrame.contextLView=i,i[8]}function si(){let i=ll();for(;null!==i&&64===i.type;)i=i.parent;return i}function ll(){return pn.lFrame.currentTNode}function xo(i,o){const a=pn.lFrame;a.currentTNode=i,a.isParent=o}function Xs(){return pn.lFrame.isParent}function Ys(){return pn.isInCheckNoChangesMode}function cl(i){pn.isInCheckNoChangesMode=i}function Mr(){const i=pn.lFrame;let o=i.bindingRootIndex;return-1===o&&(o=i.bindingRootIndex=i.tView.bindingStartIndex),o}function Ls(){return pn.lFrame.bindingIndex++}function ul(i,o){const a=pn.lFrame;a.bindingIndex=a.bindingRootIndex=i,fa(o)}function fa(i){pn.lFrame.currentDirectiveIndex=i}function hl(){return pn.lFrame.currentQueryIndex}function _s(i){pn.lFrame.currentQueryIndex=i}function mc(i){const o=i[1];return 2===o.type?o.declTNode:1===o.type?i[6]:null}function gc(i,o,a){if(a&Jt.SkipSelf){let g=o,v=i;for(;!(g=g.parent,null!==g||a&Jt.Host||(g=mc(v),null===g||(v=v[15],10&g.type))););if(null===g)return!1;o=g,i=v}const h=pn.lFrame=Ul();return h.currentTNode=o,h.lView=i,!0}function pa(i){const o=Ul(),a=i[1];pn.lFrame=o,o.currentTNode=a.firstChild,o.lView=i,o.tView=a,o.contextLView=i,o.bindingIndex=a.bindingStartIndex,o.inI18n=!1}function Ul(){const i=pn.lFrame,o=null===i?null:i.child;return null===o?dl(i):o}function dl(i){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return null!==i&&(i.child=o),o}function Vl(){const i=pn.lFrame;return pn.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}const fl=Vl;function ma(){const i=Vl();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function Ri(){return pn.lFrame.selectedIndex}function No(i){pn.lFrame.selectedIndex=i}function fr(){const i=pn.lFrame;return Ps(i.tView,i.selectedIndex)}function ga(i,o){for(let a=o.directiveStart,h=o.directiveEnd;a<h;a++){const v=i.data[a].type.prototype,{ngAfterContentInit:T,ngAfterContentChecked:M,ngAfterViewInit:k,ngAfterViewChecked:G,ngOnDestroy:q}=v;T&&(i.contentHooks||(i.contentHooks=[])).push(-a,T),M&&((i.contentHooks||(i.contentHooks=[])).push(a,M),(i.contentCheckHooks||(i.contentCheckHooks=[])).push(a,M)),k&&(i.viewHooks||(i.viewHooks=[])).push(-a,k),G&&((i.viewHooks||(i.viewHooks=[])).push(a,G),(i.viewCheckHooks||(i.viewCheckHooks=[])).push(a,G)),null!=q&&(i.destroyHooks||(i.destroyHooks=[])).push(a,q)}}function _a(i,o,a){pl(i,o,3,a)}function Js(i,o,a,h){(3&i[2])===a&&pl(i,o,a,h)}function gi(i,o){let a=i[2];(3&a)===o&&(a&=2047,a+=1,i[2]=a)}function pl(i,o,a,h){const v=null!=h?h:-1,T=o.length-1;let M=0;for(let k=void 0!==h?65535&i[18]:0;k<T;k++)if("number"==typeof o[k+1]){if(M=o[k],null!=h&&M>=h)break}else o[k]<0&&(i[18]+=65536),(M<v||-1==v)&&(Mu(i,a,o,k),i[18]=(4294901760&i[18])+k+2),k++}function Mu(i,o,a,h){const g=a[h]<0,v=a[h+1],M=i[g?-a[h]:a[h]];if(g){if(i[2]>>11<i[18]>>16&&(3&i[2])===o){i[2]+=2048;try{v.call(M)}finally{}}}else try{v.call(M)}finally{}}class ml{constructor(o,a,h){this.factory=o,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=h}}function Wi(i,o,a){const h=gn(i);let g=0;for(;g<a.length;){const v=a[g];if("number"==typeof v){if(0!==v)break;g++;const T=a[g++],M=a[g++],k=a[g++];h?i.setAttribute(o,M,k,T):o.setAttributeNS(T,M,k)}else{const T=v,M=a[++g];Va(T)?h&&i.setProperty(o,T,M):h?i.setAttribute(o,T,M):o.setAttribute(T,M),g++}}return g}function gl(i){return 3===i||4===i||6===i}function Va(i){return 64===i.charCodeAt(0)}function ja(i,o){if(null!==o&&0!==o.length)if(null===i||0===i.length)i=o.slice();else{let a=-1;for(let h=0;h<o.length;h++){const g=o[h];"number"==typeof g?a=g:0===a||Xi(i,a,g,null,-1===a||2===a?o[++h]:null)}}return i}function Xi(i,o,a,h,g){let v=0,T=i.length;if(-1===o)T=-1;else for(;v<i.length;){const M=i[v++];if("number"==typeof M){if(M===o){T=-1;break}if(M>o){T=v-1;break}}}for(;v<i.length;){const M=i[v];if("number"==typeof M)break;if(M===a){if(null===h)return void(null!==g&&(i[v+1]=g));if(h===i[v+1])return void(i[v+2]=g)}v++,null!==h&&v++,null!==g&&v++}-1!==T&&(i.splice(T,0,o),v=T+1),i.splice(v++,0,a),null!==h&&i.splice(v++,0,h),null!==g&&i.splice(v++,0,g)}function _l(i){return-1!==i}function zs(i){return 32767&i}function Bs(i,o){let a=function Hl(i){return i>>16}(i),h=o;for(;a>0;)h=h[15],a--;return h}let $a=!0;function yl(i){const o=$a;return $a=i,o}let xc=0;function Ns(i,o){const a=Wl(i,o);if(-1!==a)return a;const h=o[1];h.firstCreatePass&&(i.injectorIndex=o.length,ql(h.data,i),ql(o,null),ql(h.blueprint,null));const g=ea(i,o),v=i.injectorIndex;if(_l(g)){const T=zs(g),M=Bs(g,o),k=M[1].data;for(let G=0;G<8;G++)o[v+G]=M[T+G]|k[T+G]}return o[v+8]=g,v}function ql(i,o){i.push(0,0,0,0,0,0,0,0,o)}function Wl(i,o){return-1===i.injectorIndex||i.parent&&i.parent.injectorIndex===i.injectorIndex||null===o[i.injectorIndex+8]?-1:i.injectorIndex}function ea(i,o){if(i.parent&&-1!==i.parent.injectorIndex)return i.parent.injectorIndex;let a=0,h=null,g=o;for(;null!==g;){const v=g[1],T=v.type;if(h=2===T?v.declTNode:1===T?g[6]:null,null===h)return-1;if(a++,g=g[15],-1!==h.injectorIndex)return h.injectorIndex|a<<16}return-1}function Ga(i,o,a){!function Zl(i,o,a){let h;"string"==typeof a?h=a.charCodeAt(0)||0:a.hasOwnProperty(_e)&&(h=a[_e]),null==h&&(h=a[_e]=xc++);const g=255&h;o.data[i+(g>>5)]|=1<<g}(i,o,a)}function A(i,o,a){if(a&Jt.Optional)return i;_t(o,"NodeInjector")}function C(i,o,a,h){if(a&Jt.Optional&&void 0===h&&(h=null),0==(a&(Jt.Self|Jt.Host))){const g=i[9],v=cn(void 0);try{return g?g.get(o,h,a&Jt.Optional):fo(o,h,a&Jt.Optional)}finally{cn(v)}}return A(h,o,a)}function D(i,o,a,h=Jt.Default,g){if(null!==i){const v=function je(i){if("string"==typeof i)return i.charCodeAt(0)||0;const o=i.hasOwnProperty(_e)?i[_e]:void 0;return"number"==typeof o?o>=0?255&o:U:o}(a);if("function"==typeof v){if(!gc(o,i,h))return h&Jt.Host?A(g,a,h):C(o,a,h,g);try{const T=v(h);if(null!=T||h&Jt.Optional)return T;_t(a)}finally{fl()}}else if("number"==typeof v){let T=null,M=Wl(i,o),k=-1,G=h&Jt.Host?o[16][6]:null;for((-1===M||h&Jt.SkipSelf)&&(k=-1===M?ea(i,o):o[M+8],-1!==k&&_n(h,!1)?(T=o[1],M=zs(k),o=Bs(k,o)):M=-1);-1!==M;){const q=o[1];if(Lt(v,M,q.data)){const ue=X(M,o,a,T,h,G);if(ue!==L)return ue}k=o[M+8],-1!==k&&_n(h,o[1].data[M+8]===G)&&Lt(v,M,o)?(T=q,M=zs(k),o=Bs(k,o)):M=-1}}}return C(o,a,h,g)}const L={};function U(){return new zt(si(),mt())}function X(i,o,a,h,g,v){const T=o[1],M=T.data[i+8],q=he(M,T,a,null==h?_o(M)&&$a:h!=T&&0!=(3&M.type),g&Jt.Host&&v===M);return null!==q?we(o,T,q,M):L}function he(i,o,a,h,g){const v=i.providerIndexes,T=o.data,M=1048575&v,k=i.directiveStart,q=v>>20,Ce=g?M+q:i.directiveEnd;for(let Be=h?M:M+q;Be<Ce;Be++){const ot=T[Be];if(Be<k&&a===ot||Be>=k&&ot.type===a)return Be}if(g){const Be=T[k];if(Be&&Oi(Be)&&Be.type===a)return k}return null}function we(i,o,a,h){let g=i[a];const v=o.data;if(function Na(i){return i instanceof ml}(g)){const T=g;T.resolving&&function $e(i,o){const a=o?`. Dependency path: ${o.join(" > ")} > ${i}`:"";throw new Wt(-200,`Circular dependency in DI detected for ${i}${a}`)}(Ne(v[a]));const M=yl(T.canSeeViewProviders);T.resolving=!0;const k=T.injectImpl?cn(T.injectImpl):null;gc(i,h,Jt.Default);try{g=i[a]=T.factory(void 0,v,i,h),o.firstCreatePass&&a>=h.directiveStart&&function rr(i,o,a){const{ngOnChanges:h,ngOnInit:g,ngDoCheck:v}=o.type.prototype;if(h){const T=ha(o);(a.preOrderHooks||(a.preOrderHooks=[])).push(i,T),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(i,T)}g&&(a.preOrderHooks||(a.preOrderHooks=[])).push(0-i,g),v&&((a.preOrderHooks||(a.preOrderHooks=[])).push(i,v),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(i,v))}(a,v[a],o)}finally{null!==k&&cn(k),yl(M),T.resolving=!1,fl()}}return g}function Lt(i,o,a){return!!(a[o+(i>>5)]&1<<i)}function _n(i,o){return!(i&Jt.Self||i&Jt.Host&&o)}class zt{constructor(o,a){this._tNode=o,this._lView=a}get(o,a,h){return D(this._tNode,this._lView,o,h,a)}}function Us(i){return function Iu(i,o){if("class"===o)return i.classes;if("style"===o)return i.styles;const a=i.attrs;if(a){const h=a.length;let g=0;for(;g<h;){const v=a[g];if(gl(v))break;if(0===v)g+=2;else if("number"==typeof v)for(g++;g<h&&"string"==typeof a[g];)g++;else{if(v===o)return a[g+1];g+=2}}}return null}(si(),i)}const Ni="__parameters__";function Vs(i,o,a){return hr(()=>{const h=function rs(i){return function(...a){if(i){const h=i(...a);for(const g in h)this[g]=h[g]}}}(o);function g(...v){if(this instanceof g)return h.apply(this,v),this;const T=new g(...v);return M.annotation=T,M;function M(k,G,q){const ue=k.hasOwnProperty(Ni)?k[Ni]:Object.defineProperty(k,Ni,{value:[]})[Ni];for(;ue.length<=q;)ue.push(null);return(ue[q]=ue[q]||[]).push(T),k}}return a&&(g.prototype=Object.create(a.prototype)),g.prototype.ngMetadataName=i,g.annotationCls=g,g})}class sr{constructor(o,a){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof a?this.__NG_ELEMENT_ID__=a:void 0!==a&&(this.\u0275prov=Gr({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}toString(){return`InjectionToken ${this._desc}`}}const wc=new sr("AnalyzeForEntryComponents");function w(i,o){void 0===o&&(o=i);for(let a=0;a<i.length;a++){let h=i[a];Array.isArray(h)?(o===i&&(o=i.slice(0,a)),w(h,o)):o!==i&&o.push(h)}return o}function S(i,o){i.forEach(a=>Array.isArray(a)?S(a,o):o(a))}function F(i,o,a){o>=i.length?i.push(a):i.splice(o,0,a)}function O(i,o){return o>=i.length-1?i.pop():i.splice(o,1)[0]}const Qe={},Yt="__NG_DI_FLAG__",on="ngTempTokenPath",xt=/\n/gm,yn="__source",yr=Rt({provide:String,useValue:Rt});let mr;function mn(i){const o=mr;return mr=i,o}function Vn(i,o=Jt.Default){if(void 0===mr)throw new Wt(203,"");return null===mr?fo(i,void 0,o):mr.get(i,o&Jt.Optional?null:void 0,o)}function Fn(i,o=Jt.Default){return(function un(){return wr}()||Vn)(ut(i),o)}const Vo=Fn;function jo(i){const o=[];for(let a=0;a<i.length;a++){const h=ut(i[a]);if(Array.isArray(h)){if(0===h.length)throw new Wt(900,"");let g,v=Jt.Default;for(let T=0;T<h.length;T++){const M=h[T],k=nr(M);"number"==typeof k?-1===k?g=M.token:v|=k:g=M}o.push(Fn(g,v))}else o.push(Fn(h))}return o}function Co(i,o){return i[Yt]=o,i.prototype[Yt]=o,i}function nr(i){return i[Yt]}const qr=Co(Vs("Inject",i=>({token:i})),-1),ao=Co(Vs("Optional"),8),lo=Co(Vs("SkipSelf"),4);class _h{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}const ep=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,tp=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var ai=(()=>((ai=ai||{})[ai.NONE=0]="NONE",ai[ai.HTML=1]="HTML",ai[ai.STYLE=2]="STYLE",ai[ai.SCRIPT=3]="SCRIPT",ai[ai.URL=4]="URL",ai[ai.RESOURCE_URL=5]="RESOURCE_URL",ai))();function vd(i){const o=function wa(){const i=mt();return i&&i[12]}();return o?o.sanitize(ai.URL,i)||"":function Yl(i,o){const a=function vh(i){return i instanceof _h&&i.getTypeName()||null}(i);if(null!=a&&a!==o){if("ResourceURL"===a&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${a} (see https://g.co/ng/security#xss)`)}return a===o}(i,"URL")?function os(i){return i instanceof _h?i.changingThisBreaksApplicationSecurity:i}(i):function ku(i){return(i=String(i)).match(ep)||i.match(tp)?i:"unsafe:"+i}(ft(i))}const bd="__ngContext__";function Vi(i,o){i[bd]=o}function $s(i){const o=function qa(i){return i[bd]||null}(i);return o?Array.isArray(o)?o:o.lView:null}function eu(i){return i.ngOriginalError}function hp(i,...o){i.error(...o)}class bh{constructor(){this._console=console}handleError(o){const a=this._findOriginalError(o),h=function Cd(i){return i&&i.ngErrorLogger||hp}(o);h(this._console,"ERROR",o),a&&h(this._console,"ORIGINAL ERROR",a)}_findOriginalError(o){let a=o&&eu(o);for(;a&&eu(a);)a=eu(a);return a||null}}const nu=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Kn))();function Xa(i){return i instanceof Function?i():i}var Ea=(()=>((Ea=Ea||{})[Ea.Important=1]="Important",Ea[Ea.DashCase=2]="DashCase",Ea))();function kd(i,o){return undefined(i,o)}function iu(i){const o=i[3];return Nr(o)?o[3]:o}function ss(i){return Dh(i[13])}function Rd(i){return Dh(i[4])}function Dh(i){for(;null!==i&&!Nr(i);)i=i[4];return i}function ou(i,o,a,h,g){if(null!=h){let v,T=!1;Nr(h)?v=h:Jr(h)&&(T=!0,h=h[0]);const M=dn(h);0===i&&null!==a?null==g?zu(o,a,M):jr(o,a,M,g||null,!0):1===i&&null!==a?jr(o,a,M,g||null,!0):2===i?function Ih(i,o,a){const h=Ic(i,o);h&&function Ch(i,o,a,h){gn(i)?i.removeChild(o,a,h):o.removeChild(a)}(i,h,o,a)}(o,M,T):3===i&&o.destroyNode(M),null!=v&&function ig(i,o,a,h,g){const v=a[7];v!==dn(a)&&ou(o,i,h,v,g);for(let M=10;M<a.length;M++){const k=a[M];Ac(k[1],k,i,o,h,v)}}(o,i,v,a,g)}}function su(i,o,a){if(gn(i))return i.createElement(o,a);{const h=null!==a?function J(i){const o=i.toLowerCase();return"svg"===o?"http://www.w3.org/2000/svg":o===W?"http://www.w3.org/1998/MathML/":null}(a):null;return null===h?i.createElement(o):i.createElementNS(h,o)}}function xp(i,o){const a=i[9],h=a.indexOf(o),g=o[3];1024&o[2]&&(o[2]&=-1025,da(g,-1)),a.splice(h,1)}function Fd(i,o){if(i.length<=10)return;const a=10+o,h=i[a];if(h){const g=h[17];null!==g&&g!==i&&xp(g,h),o>0&&(i[a-1][4]=h[4]);const v=O(i,10+o);!function vp(i,o){Ac(i,o,o[11],2,null,null),o[0]=null,o[6]=null}(h[1],h);const T=v[19];null!==T&&T.detachView(v[1]),h[3]=null,h[4]=null,h[2]&=-129}return h}function bp(i,o){if(!(256&o[2])){const a=o[11];gn(a)&&a.destroyNode&&Ac(i,o,a,3,null,null),function eg(i){let o=i[13];if(!o)return Od(i[1],i);for(;o;){let a=null;if(Jr(o))a=o[13];else{const h=o[10];h&&(a=h)}if(!a){for(;o&&!o[4]&&o!==i;)Jr(o)&&Od(o[1],o),o=o[3];null===o&&(o=i),Jr(o)&&Od(o[1],o),a=o&&o[4]}o=a}}(o)}}function Od(i,o){if(!(256&o[2])){o[2]&=-129,o[2]|=256,function rg(i,o){let a;if(null!=i&&null!=(a=i.destroyHooks))for(let h=0;h<a.length;h+=2){const g=o[a[h]];if(!(g instanceof ml)){const v=a[h+1];if(Array.isArray(v))for(let T=0;T<v.length;T+=2){const M=g[v[T]],k=v[T+1];try{k.call(M)}finally{}}else try{v.call(g)}finally{}}}}(i,o),function zd(i,o){const a=i.cleanup,h=o[7];let g=-1;if(null!==a)for(let v=0;v<a.length-1;v+=2)if("string"==typeof a[v]){const T=a[v+1],M="function"==typeof T?T(o):dn(o[T]),k=h[g=a[v+2]],G=a[v+3];"boolean"==typeof G?M.removeEventListener(a[v],k,G):G>=0?h[g=G]():h[g=-G].unsubscribe(),v+=2}else{const T=h[g=a[v+1]];a[v].call(T)}if(null!==h){for(let v=g+1;v<h.length;v++)h[v]();o[7]=null}}(i,o),1===o[1].type&&gn(o[11])&&o[11].destroy();const a=o[17];if(null!==a&&Nr(o[3])){a!==o[3]&&xp(a,o);const h=o[19];null!==h&&h.detachView(i)}}}function Mc(i,o,a){return function wp(i,o,a){let h=o;for(;null!==h&&40&h.type;)h=(o=h).parent;if(null===h)return a[0];if(2&h.flags){const g=i.data[h.directiveStart].encapsulation;if(g===Zn.None||g===Zn.Emulated)return null}return ii(h,a)}(i,o.parent,a)}function jr(i,o,a,h,g){gn(i)?i.insertBefore(o,a,h,g):o.insertBefore(a,h,g)}function zu(i,o,a){gn(i)?i.appendChild(o,a):o.appendChild(a)}function Bd(i,o,a,h,g){null!==h?jr(i,o,a,h,g):zu(i,o,a)}function Ic(i,o){return gn(i)?i.parentNode(o):o.parentNode}let au=function Ud(i,o,a){return 40&i.type?ii(i,a):null};function Mh(i,o,a,h){const g=Mc(i,h,o),v=o[11],M=function Nd(i,o,a){return au(i,o,a)}(h.parent||o[6],h,o);if(null!=g)if(Array.isArray(a))for(let k=0;k<a.length;k++)Bd(v,g,a[k],M,!1);else Bd(v,g,a,M,!1)}function Uu(i,o){if(null!==o){const a=o.type;if(3&a)return ii(o,i);if(4&a)return Vd(-1,i[o.index]);if(8&a){const h=o.child;if(null!==h)return Uu(i,h);{const g=i[o.index];return Nr(g)?Vd(-1,g):dn(g)}}if(32&a)return kd(o,i)()||dn(i[o.index]);{const h=lu(i,o);return null!==h?Array.isArray(h)?h[0]:Uu(iu(i[16]),h):Uu(i,o.next)}}return null}function lu(i,o){return null!==o?i[16][6].projection[o.projection]:null}function Vd(i,o){const a=10+i+1;if(a<o.length){const h=o[a],g=h[1].firstChild;if(null!==g)return Uu(h,g)}return o[7]}function jd(i,o,a,h,g,v,T){for(;null!=a;){const M=h[a.index],k=a.type;if(T&&0===o&&(M&&Vi(dn(M),h),a.flags|=4),64!=(64&a.flags))if(8&k)jd(i,o,a.child,h,g,v,!1),ou(o,i,g,M,v);else if(32&k){const G=kd(a,h);let q;for(;q=G();)ou(o,i,g,q,v);ou(o,i,g,M,v)}else 16&k?Vu(i,o,h,a,g,v):ou(o,i,g,M,v);a=T?a.projectionNext:a.next}}function Ac(i,o,a,h,g,v){jd(a,h,i.firstChild,o,g,v,!1)}function Vu(i,o,a,h,g,v){const T=a[16],k=T[6].projection[h.projection];if(Array.isArray(k))for(let G=0;G<k.length;G++)ou(o,i,g,k[G],v);else jd(i,o,k,T[3],g,v,!0)}function Ep(i,o,a){gn(i)?i.setAttribute(o,"style",a):o.style.cssText=a}function Gd(i,o,a){gn(i)?""===a?i.removeAttribute(o,"class"):i.setAttribute(o,"class",a):o.className=a}function Tp(i,o,a){let h=i.length;for(;;){const g=i.indexOf(o,a);if(-1===g)return g;if(0===g||i.charCodeAt(g-1)<=32){const v=o.length;if(g+v===h||i.charCodeAt(g+v)<=32)return g}a=g+1}}const Pc="ng-template";function ag(i,o,a){let h=0;for(;h<i.length;){let g=i[h++];if(a&&"class"===g){if(g=i[h],-1!==Tp(g.toLowerCase(),o,0))return!0}else if(1===g){for(;h<i.length&&"string"==typeof(g=i[h++]);)if(g.toLowerCase()===o)return!0;return!1}}return!1}function Dp(i){return 4===i.type&&i.value!==Pc}function Cp(i,o,a){return o===(4!==i.type||a?i.value:Pc)}function Sp(i,o,a){let h=4;const g=i.attrs||[],v=function ug(i){for(let o=0;o<i.length;o++)if(gl(i[o]))return o;return i.length}(g);let T=!1;for(let M=0;M<o.length;M++){const k=o[M];if("number"!=typeof k){if(!T)if(4&h){if(h=2|1&h,""!==k&&!Cp(i,k,a)||""===k&&1===o.length){if(Ta(h))return!1;T=!0}}else{const G=8&h?k:o[++M];if(8&h&&null!==i.attrs){if(!ag(i.attrs,G,a)){if(Ta(h))return!1;T=!0}continue}const ue=lg(8&h?"class":k,g,Dp(i),a);if(-1===ue){if(Ta(h))return!1;T=!0;continue}if(""!==G){let Ce;Ce=ue>v?"":g[ue+1].toLowerCase();const Be=8&h?Ce:null;if(Be&&-1!==Tp(Be,G,0)||2&h&&G!==Ce){if(Ta(h))return!1;T=!0}}}}else{if(!T&&!Ta(h)&&!Ta(k))return!1;if(T&&Ta(k))continue;T=!1,h=k|1&h}}return Ta(h)||T}function Ta(i){return 0==(1&i)}function lg(i,o,a,h){if(null===o)return-1;let g=0;if(h||!a){let v=!1;for(;g<o.length;){const T=o[g];if(T===i)return g;if(3===T||6===T)v=!0;else{if(1===T||2===T){let M=o[++g];for(;"string"==typeof M;)M=o[++g];continue}if(4===T)break;if(0===T){g+=4;continue}}g+=v?1:2}return-1}return function ju(i,o){let a=i.indexOf(4);if(a>-1)for(a++;a<i.length;){const h=i[a];if("number"==typeof h)return-1;if(h===o)return a;a++}return-1}(o,i)}function Ql(i,o,a=!1){for(let h=0;h<o.length;h++)if(Sp(i,o[h],a))return!0;return!1}function Ah(i,o){return i?":not("+o.trim()+")":o}function hg(i){let o=i[0],a=1,h=2,g="",v=!1;for(;a<i.length;){let T=i[a];if("string"==typeof T)if(2&h){const M=i[++a];g+="["+T+(M.length>0?'="'+M+'"':"")+"]"}else 8&h?g+="."+T:4&h&&(g+=" "+T);else""!==g&&!Ta(T)&&(o+=Ah(v,g),g=""),h=T,v=v||!Ta(h);a++}return""!==g&&(o+=Ah(v,g)),o}const On={};function Hd(i){Ip(tr(),mt(),Ri()+i,Ys())}function Ip(i,o,a,h){if(!h)if(3==(3&o[2])){const v=i.preOrderCheckHooks;null!==v&&_a(o,v,a)}else{const v=i.preOrderHooks;null!==v&&Js(o,v,0,a)}No(a)}function nf(i,o){const a=i.contentQueries;if(null!==a)for(let h=0;h<a.length;h+=2){const g=a[h],v=a[h+1];if(-1!==v){const T=i.data[v];_s(g),T.contentQueries(2,o[v],v)}}}function Ka(i,o,a,h,g,v,T,M,k,G){const q=o.blueprint.slice();return q[0]=g,q[2]=140|h,ks(q),q[3]=q[15]=i,q[8]=a,q[10]=T||i&&i[10],q[11]=M||i&&i[11],q[12]=k||i&&i[12]||null,q[9]=G||i&&i[9]||null,q[6]=v,q[16]=2==o.type?i[16]:q,q}function rc(i,o,a,h,g){let v=i.data[o];if(null===v)v=function uu(i,o,a,h,g){const v=ll(),T=Xs(),k=i.data[o]=function Np(i,o,a,h,g,v){return{type:a,index:h,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:g,attrs:v,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,T?v:v&&v.parent,a,o,h,g);return null===i.firstChild&&(i.firstChild=k),null!==v&&(T?null==v.child&&null!==k.parent&&(v.child=k):null===v.next&&(v.next=k)),k}(i,o,a,h,g),function pc(){return pn.lFrame.inI18n}()&&(v.flags|=64);else if(64&v.type){v.type=a,v.value=h,v.attrs=g;const T=function Jo(){const i=pn.lFrame,o=i.currentTNode;return i.isParent?o:o.parent}();v.injectorIndex=null===T?-1:T.injectorIndex}return xo(v,!0),v}function hu(i,o,a,h){if(0===a)return-1;const g=o.length;for(let v=0;v<a;v++)o.push(h),i.blueprint.push(h),i.data.push(null);return g}function du(i,o,a){pa(o);try{const h=i.viewQuery;null!==h&&_f(1,h,a);const g=i.template;null!==g&&rf(i,o,g,1,a),i.firstCreatePass&&(i.firstCreatePass=!1),i.staticContentQueries&&nf(i,o),i.staticViewQueries&&_f(2,i.viewQuery,a);const v=i.components;null!==v&&function Wu(i,o){for(let a=0;a<o.length;a++)jh(i,o[a])}(o,v)}catch(h){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),h}finally{o[2]&=-5,ma()}}function kc(i,o,a,h){const g=o[2];if(256==(256&g))return;pa(o);const v=Ys();try{ks(o),function Ks(i){return pn.lFrame.bindingIndex=i}(i.bindingStartIndex),null!==a&&rf(i,o,a,2,h);const T=3==(3&g);if(!v)if(T){const G=i.preOrderCheckHooks;null!==G&&_a(o,G,null)}else{const G=i.preOrderHooks;null!==G&&Js(o,G,0,null),gi(o,0)}if(function kg(i){for(let o=ss(i);null!==o;o=Rd(o)){if(!o[2])continue;const a=o[9];for(let h=0;h<a.length;h++){const g=a[h],v=g[3];0==(1024&g[2])&&da(v,1),g[2]|=1024}}}(o),function df(i){for(let o=ss(i);null!==o;o=Rd(o))for(let a=10;a<o.length;a++){const h=o[a],g=h[1];Do(h)&&kc(g,h,g.template,h[8])}}(o),null!==i.contentQueries&&nf(i,o),!v)if(T){const G=i.contentCheckHooks;null!==G&&_a(o,G)}else{const G=i.contentHooks;null!==G&&Js(o,G,1),gi(o,1)}!function tf(i,o){const a=i.hostBindingOpCodes;if(null!==a)try{for(let h=0;h<a.length;h++){const g=a[h];if(g<0)No(~g);else{const v=g,T=a[++h],M=a[++h];ul(T,v),M(2,o[v])}}}finally{No(-1)}}(i,o);const M=i.components;null!==M&&function Gs(i,o){for(let a=0;a<o.length;a++)Rg(i,o[a])}(o,M);const k=i.viewQuery;if(null!==k&&_f(2,k,h),!v)if(T){const G=i.viewCheckHooks;null!==G&&_a(o,G)}else{const G=i.viewHooks;null!==G&&Js(o,G,2),gi(o,2)}!0===i.firstUpdatePass&&(i.firstUpdatePass=!1),v||(o[2]&=-73),1024&o[2]&&(o[2]&=-1025,da(o[3],-1))}finally{ma()}}function wg(i,o,a,h){const g=o[10],v=!Ys(),T=Qo(o);try{v&&!T&&g.begin&&g.begin(),T&&du(i,o,h),kc(i,o,a,h)}finally{v&&!T&&g.end&&g.end()}}function rf(i,o,a,h,g){const v=Ri(),T=2&h;try{No(-1),T&&o.length>20&&Ip(i,o,20,Ys()),a(h,g)}finally{No(v)}}function Xu(i,o,a){!Oa()||(function Sg(i,o,a,h){const g=a.directiveStart,v=a.directiveEnd;i.firstCreatePass||Ns(a,o),Vi(h,o);const T=a.initialInputs;for(let M=g;M<v;M++){const k=i.data[M],G=Oi(k);G&&Ag(o,a,k);const q=we(o,i,M,a);Vi(q,o),null!==T&&ic(0,M-g,q,k,0,T),G&&(oi(a.index,o)[8]=q)}}(i,o,a,ii(a,o)),128==(128&a.flags)&&function Mg(i,o,a){const h=a.directiveStart,g=a.directiveEnd,T=a.index,M=function Qs(){return pn.lFrame.currentDirectiveIndex}();try{No(T);for(let k=h;k<g;k++){const G=i.data[k],q=o[k];fa(k),(null!==G.hostBindings||0!==G.hostVars||null!==G.hostAttrs)&&Gp(G,q)}}finally{No(-1),fa(M)}}(i,o,a))}function Yu(i,o,a=ii){const h=o.localNames;if(null!==h){let g=o.index+1;for(let v=0;v<h.length;v+=2){const T=h[v+1],M=-1===T?a(o,i):i[T];i[g++]=M}}}function sf(i){const o=i.tView;return null===o||o.incompleteFirstPass?i.tView=Bh(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts):o}function Bh(i,o,a,h,g,v,T,M,k,G){const q=20+h,ue=q+g,Ce=function Bp(i,o){const a=[];for(let h=0;h<o;h++)a.push(h<i?null:On);return a}(q,ue),Be="function"==typeof G?G():G;return Ce[1]={type:i,blueprint:Ce,template:a,queries:null,viewQuery:M,declTNode:o,data:Ce.slice().fill(null,q),bindingStartIndex:q,expandoStartIndex:ue,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof v?v():v,pipeRegistry:"function"==typeof T?T():T,firstChild:null,schemas:k,consts:Be,incompleteFirstPass:!1}}function lf(i,o,a,h){const g=Xp(o);null===a?g.push(h):(g.push(a),i.firstCreatePass&&Zh(i).push(h,g.length-1))}function Up(i,o,a){for(let h in i)if(i.hasOwnProperty(h)){const g=i[h];(a=null===a?{}:a).hasOwnProperty(h)?a[h].push(o,g):a[h]=[o,g]}return a}function Uh(i,o,a,h){let g=!1;if(Oa()){const v=function Ig(i,o,a){const h=i.directiveRegistry;let g=null;if(h)for(let v=0;v<h.length;v++){const T=h[v];Ql(a,T.selectors,!1)&&(g||(g=[]),Ga(Ns(a,o),i,T.type),Oi(T)?(Hp(i,a),g.unshift(T)):g.push(T))}return g}(i,o,a),T=null===h?null:{"":-1};if(null!==v){g=!0,Zp(a,i.data.length,v.length);for(let q=0;q<v.length;q++){const ue=v[q];ue.providersResolver&&ue.providersResolver(ue)}let M=!1,k=!1,G=hu(i,o,v.length,null);for(let q=0;q<v.length;q++){const ue=v[q];a.mergedAttrs=ja(a.mergedAttrs,ue.hostAttrs),uf(i,a,o,G,ue),cf(G,ue,T),null!==ue.contentQueries&&(a.flags|=8),(null!==ue.hostBindings||null!==ue.hostAttrs||0!==ue.hostVars)&&(a.flags|=128);const Ce=ue.type.prototype;!M&&(Ce.ngOnChanges||Ce.ngOnInit||Ce.ngDoCheck)&&((i.preOrderHooks||(i.preOrderHooks=[])).push(a.index),M=!0),!k&&(Ce.ngOnChanges||Ce.ngDoCheck)&&((i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(a.index),k=!0),G++}!function Tg(i,o){const h=o.directiveEnd,g=i.data,v=o.attrs,T=[];let M=null,k=null;for(let G=o.directiveStart;G<h;G++){const q=g[G],ue=q.inputs,Ce=null===v||Dp(o)?null:qp(ue,v);T.push(Ce),M=Up(ue,G,M),k=Up(q.outputs,G,k)}null!==M&&(M.hasOwnProperty("class")&&(o.flags|=16),M.hasOwnProperty("style")&&(o.flags|=32)),o.initialInputs=T,o.inputs=M,o.outputs=k}(i,a)}T&&function fu(i,o,a){if(o){const h=i.localNames=[];for(let g=0;g<o.length;g+=2){const v=a[o[g+1]];if(null==v)throw new Wt(-301,!1);h.push(o[g],v)}}}(a,h,T)}return a.mergedAttrs=ja(a.mergedAttrs,a.attrs),g}function Qu(i,o,a,h,g,v){const T=v.hostBindings;if(T){let M=i.hostBindingOpCodes;null===M&&(M=i.hostBindingOpCodes=[]);const k=~o.index;(function Vh(i){let o=i.length;for(;o>0;){const a=i[--o];if("number"==typeof a&&a<0)return a}return 0})(M)!=k&&M.push(k),M.push(h,g,T)}}function Gp(i,o){null!==i.hostBindings&&i.hostBindings(1,o)}function Hp(i,o){o.flags|=2,(i.components||(i.components=[])).push(o.index)}function cf(i,o,a){if(a){if(o.exportAs)for(let h=0;h<o.exportAs.length;h++)a[o.exportAs[h]]=i;Oi(o)&&(a[""]=i)}}function Zp(i,o,a){i.flags|=1,i.directiveStart=o,i.directiveEnd=o+a,i.providerIndexes=o}function uf(i,o,a,h,g){i.data[h]=g;const v=g.factory||(g.factory=gs(g.type)),T=new ml(v,Oi(g),null);i.blueprint[h]=T,a[h]=T,Qu(i,o,0,h,hu(i,a,g.hostVars,On),g)}function Ag(i,o,a){const h=ii(o,i),g=sf(a),v=i[10],T=$h(i,Ka(i,g,null,a.onPush?64:16,h,o,v,v.createRenderer(h,a),null,null));i[o.index]=T}function oa(i,o,a,h,g,v){const T=ii(i,o);!function hf(i,o,a,h,g,v,T){if(null==v)gn(i)?i.removeAttribute(o,g,a):o.removeAttribute(g);else{const M=null==T?ft(v):T(v,h||"",g);gn(i)?i.setAttribute(o,g,M,a):a?o.setAttributeNS(a,g,M):o.setAttribute(g,M)}}(o[11],T,v,i.value,a,h,g)}function ic(i,o,a,h,g,v){const T=v[o];if(null!==T){const M=h.setInput;for(let k=0;k<T.length;){const G=T[k++],q=T[k++],ue=T[k++];null!==M?h.setInput(a,ue,G,q):a[q]=ue}}}function qp(i,o){let a=null,h=0;for(;h<o.length;){const g=o[h];if(0!==g)if(5!==g){if("number"==typeof g)break;i.hasOwnProperty(g)&&(null===a&&(a=[]),a.push(g,i[g],o[h+1])),h+=2}else h+=2;else h+=4}return a}function Ju(i,o,a,h){return new Array(i,!0,!1,o,null,0,h,a,null,null)}function Rg(i,o){const a=oi(o,i);if(Do(a)){const h=a[1];80&a[2]?kc(h,a,h.template,a[8]):a[5]>0&&ff(a)}}function ff(i){for(let h=ss(i);null!==h;h=Rd(h))for(let g=10;g<h.length;g++){const v=h[g];if(1024&v[2]){const T=v[1];kc(T,v,T.template,v[8])}else v[5]>0&&ff(v)}const a=i[1].components;if(null!==a)for(let h=0;h<a.length;h++){const g=oi(a[h],i);Do(g)&&g[5]>0&&ff(g)}}function jh(i,o){const a=oi(o,i),h=a[1];(function pf(i,o){for(let a=o.length;a<i.blueprint.length;a++)o.push(i.blueprint[a])})(h,a),du(h,a,a[8])}function $h(i,o){return i[13]?i[14][4]=o:i[13]=o,i[14]=o,o}function eh(i){for(;i;){i[2]|=64;const o=iu(i);if(Lo(i)&&!o)return i;i=o}return null}function gf(i,o,a){const h=o[10];h.begin&&h.begin();try{kc(i,o,i.template,a)}catch(g){throw yf(o,g),g}finally{h.end&&h.end()}}function Gh(i){!function Ja(i){for(let o=0;o<i.components.length;o++){const a=i.components[o],h=$s(a),g=h[1];wg(g,h,g.template,a)}}(i[8])}function _f(i,o,a){_s(0),o(i,a)}const Lg=(()=>Promise.resolve(null))();function Xp(i){return i[7]||(i[7]=[])}function Zh(i){return i.cleanup||(i.cleanup=[])}function yf(i,o){const a=i[9],h=a?a.get(bh,null):null;h&&h.handleError(o)}function vf(i,o,a,h,g){for(let v=0;v<a.length;){const T=a[v++],M=a[v++],k=o[T],G=i.data[T];null!==G.setInput?G.setInput(k,g,h,M):k[M]=g}}function el(i,o,a){const h=function ei(i,o){return dn(o[i])}(o,i);!function Fu(i,o,a){gn(i)?i.setValue(o,a):o.textContent=a}(i[11],h,a)}function th(i,o,a){let h=a?i.styles:null,g=a?i.classes:null,v=0;if(null!==o)for(let T=0;T<o.length;T++){const M=o[T];"number"==typeof M?v=M:1==v?g=Nn(g,M):2==v&&(h=Nn(h,M+": "+o[++T]+";"))}a?i.styles=h:i.stylesWithoutHost=h,a?i.classes=g:i.classesWithoutHost=g}const xf=new sr("INJECTOR",-1);class Qp{get(o,a=Qe){if(a===Qe){const h=new Error(`NullInjectorError: No provider for ${It(o)}!`);throw h.name="NullInjectorError",h}return a}}const Xh=new sr("Set Injector scope."),nh={},Jp={};let pu;function Yh(){return void 0===pu&&(pu=new Qp),pu}function Go(i,o=null,a=null,h){const g=mu(i,o,a,h);return g._resolveInjectorDefTypes(),g}function mu(i,o=null,a=null,h){return new gu(i,a,o||Yh(),h)}class gu{constructor(o,a,h,g=null){this.parent=h,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const v=[];a&&S(a,M=>this.processProvider(M,o,a)),S([o],M=>this.processInjectorType(M,[],v)),this.records.set(xf,oc(void 0,this));const T=this.records.get(Xh);this.scope=null!=T?T.value:null,this.source=g||("object"==typeof o?null:It(o))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(o=>o.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(o,a=Qe,h=Jt.Default){this.assertNotDestroyed();const g=mn(this),v=cn(void 0);try{if(!(h&Jt.SkipSelf)){let M=this.records.get(o);if(void 0===M){const k=function om(i){return"function"==typeof i||"object"==typeof i&&i instanceof sr}(o)&&Pn(o);M=k&&this.injectableDefInScope(k)?oc(rh(o),nh):null,this.records.set(o,M)}if(null!=M)return this.hydrate(o,M)}return(h&Jt.Self?Yh():this.parent).get(o,a=h&Jt.Optional&&a===Qe?null:a)}catch(T){if("NullInjectorError"===T.name){if((T[on]=T[on]||[]).unshift(It(o)),g)throw T;return function wn(i,o,a,h){const g=i[on];throw o[yn]&&g.unshift(o[yn]),i.message=function qn(i,o,a,h=null){i=i&&"\n"===i.charAt(0)&&"\u0275"==i.charAt(1)?i.substr(2):i;let g=It(o);if(Array.isArray(o))g=o.map(It).join(" -> ");else if("object"==typeof o){let v=[];for(let T in o)if(o.hasOwnProperty(T)){let M=o[T];v.push(T+":"+("string"==typeof M?JSON.stringify(M):It(M)))}g=`{${v.join(", ")}}`}return`${a}${h?"("+h+")":""}[${g}]: ${i.replace(xt,"\n  ")}`}("\n"+i.message,g,a,h),i.ngTokenPath=g,i[on]=null,i}(T,o,"R3InjectorError",this.source)}throw T}finally{cn(v),mn(g)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(o=>this.get(o))}toString(){const o=[];return this.records.forEach((h,g)=>o.push(It(g))),`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Wt(205,!1)}processInjectorType(o,a,h){if(!(o=ut(o)))return!1;let g=xi(o);const v=null==g&&o.ngModule||void 0,T=void 0===v?o:v,M=-1!==h.indexOf(T);if(void 0!==v&&(g=xi(v)),null==g)return!1;if(null!=g.imports&&!M){let q;h.push(T);try{S(g.imports,ue=>{this.processInjectorType(ue,a,h)&&(void 0===q&&(q=[]),q.push(ue))})}finally{}if(void 0!==q)for(let ue=0;ue<q.length;ue++){const{ngModule:Ce,providers:Be}=q[ue];S(Be,ot=>this.processProvider(ot,Ce,Be||Sn))}}this.injectorDefTypes.add(T);const k=gs(T)||(()=>new T);this.records.set(T,oc(k,nh));const G=g.providers;if(null!=G&&!M){const q=o;S(G,ue=>this.processProvider(ue,q,G))}return void 0!==v&&void 0!==o.providers}processProvider(o,a,h){let g=_u(o=ut(o))?o:ut(o&&o.provide);const v=function tl(i,o,a){return sa(i)?oc(void 0,i.useValue):oc(function Kh(i,o,a){let h;if(_u(i)){const g=ut(i);return gs(g)||rh(g)}if(sa(i))h=()=>ut(i.useValue);else if(function tm(i){return!(!i||!i.useFactory)}(i))h=()=>i.useFactory(...jo(i.deps||[]));else if(function em(i){return!(!i||!i.useExisting)}(i))h=()=>Fn(ut(i.useExisting));else{const g=ut(i&&(i.useClass||i.provide));if(!function rm(i){return!!i.deps}(i))return gs(g)||rh(g);h=()=>new g(...jo(i.deps))}return h}(i),nh)}(o);if(_u(o)||!0!==o.multi)this.records.get(g);else{let T=this.records.get(g);T||(T=oc(void 0,nh,!0),T.factory=()=>jo(T.multi),this.records.set(g,T)),g=o,T.multi.push(o)}this.records.set(g,v)}hydrate(o,a){return a.value===nh&&(a.value=Jp,a.value=a.factory()),"object"==typeof a.value&&a.value&&function im(i){return null!==i&&"object"==typeof i&&"function"==typeof i.ngOnDestroy}(a.value)&&this.onDestroy.add(a.value),a.value}injectableDefInScope(o){if(!o.providedIn)return!1;const a=ut(o.providedIn);return"string"==typeof a?"any"===a||a===this.scope:this.injectorDefTypes.has(a)}}function rh(i){const o=Pn(i),a=null!==o?o.factory:gs(i);if(null!==a)return a;if(i instanceof sr)throw new Wt(204,!1);if(i instanceof Function)return function bf(i){const o=i.length;if(o>0)throw function N(i,o){const a=[];for(let h=0;h<i;h++)a.push(o);return a}(o,"?"),new Wt(204,!1);const a=function Kr(i){const o=i&&(i[cr]||i[fs]);if(o){const a=function ti(i){if(i.hasOwnProperty("name"))return i.name;const o=(""+i).match(/^function\s*([^\s(]+)/);return null===o?"":o[1]}(i);return console.warn(`DEPRECATED: DI is instantiating a token "${a}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${a}" class.`),o}return null}(i);return null!==a?()=>a.factory(i):()=>new i}(i);throw new Wt(204,!1)}function oc(i,o,a=!1){return{factory:i,value:o,multi:a?[]:void 0}}function sa(i){return null!==i&&"object"==typeof i&&yr in i}function _u(i){return"function"==typeof i}let aa=(()=>{class i{static create(a,h){var g;if(Array.isArray(a))return Go({name:""},h,a,"");{const v=null!==(g=a.name)&&void 0!==g?g:"";return Go({name:v},a.parent,a.providers,v)}}}return i.THROW_IF_NOT_FOUND=Qe,i.NULL=new Qp,i.\u0275prov=Gr({token:i,providedIn:"any",factory:()=>Fn(xf)}),i.__NG_ELEMENT_ID__=-1,i})();function Fc(i,o){ga($s(i)[1],si())}let vu=null;function Sa(){if(!vu){const i=Kn.Symbol;if(i&&i.iterator)vu=i.iterator;else{const o=Object.getOwnPropertyNames(Map.prototype);for(let a=0;a<o.length;++a){const h=o[a];"entries"!==h&&"size"!==h&&Map.prototype[h]===Map.prototype.entries&&(vu=h)}}}return vu}function ah(i){return!!ed(i)&&(Array.isArray(i)||!(i instanceof Map)&&Sa()in i)}function ed(i){return null!==i&&("function"==typeof i||"object"==typeof i)}function il(i,o,a){return i[o]=a}function Ho(i,o,a){return!Object.is(i[o],a)&&(i[o]=a,!0)}function Ia(i,o,a,h){const g=Ho(i,o,a);return Ho(i,o+1,h)||g}function Oc(i,o,a,h){const g=mt();return Ho(g,Ls(),o)&&(tr(),oa(fr(),g,i,o,a,h)),Oc}function Aa(i,o,a,h,g,v,T,M){const G=function sc(i,o,a,h,g){const v=Ia(i,o,a,h);return Ho(i,o+2,g)||v}(i,function zo(){return pn.lFrame.bindingIndex}(),a,g,T);return function es(i){const o=pn.lFrame,a=o.bindingIndex;return o.bindingIndex=o.bindingIndex+i,a}(3),G?o+ft(a)+h+ft(g)+v+ft(T)+M:On}function b(i,o,a,h,g,v,T,M){const k=mt(),G=tr(),q=i+20,ue=G.firstCreatePass?function y(i,o,a,h,g,v,T,M,k){const G=o.consts,q=rc(o,i,4,T||null,Oo(G,M));Uh(o,a,q,Oo(G,k)),ga(o,q);const ue=q.tViews=Bh(2,q,h,g,v,o.directiveRegistry,o.pipeRegistry,null,o.schemas,G);return null!==o.queries&&(o.queries.template(o,q),ue.queries=o.queries.embeddedTView(q)),q}(q,G,k,o,a,h,g,v,T):G.data[q];xo(ue,!1);const Ce=k[11].createComment("");Mh(G,k,Ce,ue),Vi(Ce,k),$h(k,k[q]=Ju(Ce,k,Ce,ue)),Pi(ue)&&Xu(G,k,ue),null!=T&&Yu(k,ue,M)}function I(i){return vo(function Rs(){return pn.lFrame.contextLView}(),20+i)}function Ir(i,o=Jt.Default){const a=mt();return null===a?Fn(i,o):D(si(),a,ut(i),o)}function $i(){throw new Error("invalid")}function ws(i,o,a){const h=mt();return Ho(h,Ls(),o)&&function xs(i,o,a,h,g,v,T,M){const k=ii(o,a);let q,G=o.inputs;!M&&null!=G&&(q=G[h])?(vf(i,a,q,h,g),_o(o)&&function Ku(i,o){const a=oi(o,i);16&a[2]||(a[2]|=64)}(a,o.index)):3&o.type&&(h=function Vp(i){return"class"===i?"className":"for"===i?"htmlFor":"formaction"===i?"formAction":"innerHtml"===i?"innerHTML":"readonly"===i?"readOnly":"tabindex"===i?"tabIndex":i}(h),g=null!=T?T(g,o.value||"",h):g,gn(v)?v.setProperty(k,h,g):Va(h)||(k.setProperty?k.setProperty(h,g):k[h]=g))}(tr(),fr(),h,i,o,h[11],a,!1),ws}function Gi(i,o,a,h,g){const T=g?"class":"style";vf(i,a,o.inputs[T],T,h)}function Ci(i,o,a,h){const g=mt(),v=tr(),T=20+i,M=g[11],k=g[T]=su(M,o,function $l(){return pn.lFrame.currentNamespace}()),G=v.firstCreatePass?function Ar(i,o,a,h,g,v,T){const M=o.consts,G=rc(o,i,2,g,Oo(M,v));return Uh(o,a,G,Oo(M,T)),null!==G.attrs&&th(G,G.attrs,!1),null!==G.mergedAttrs&&th(G,G.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,G),G}(T,v,g,0,o,a,h):v.data[T];xo(G,!0);const q=G.mergedAttrs;null!==q&&Wi(M,k,q);const ue=G.classes;null!==ue&&Gd(M,k,ue);const Ce=G.styles;return null!==Ce&&Ep(M,k,Ce),64!=(64&G.flags)&&Mh(v,g,k,G),0===function or(){return pn.lFrame.elementDepthCount}()&&Vi(k,g),function zl(){pn.lFrame.elementDepthCount++}(),Pi(G)&&(Xu(v,g,G),function of(i,o,a){if(Pr(o)){const g=o.directiveEnd;for(let v=o.directiveStart;v<g;v++){const T=i.data[v];T.contentQueries&&T.contentQueries(1,a[v],v)}}}(v,G,g)),null!==h&&Yu(g,G),Ci}function Br(){let i=si();Xs()?function Bl(){pn.lFrame.isParent=!1}():(i=i.parent,xo(i,!1));const o=i;!function Bc(){pn.lFrame.elementDepthCount--}();const a=tr();return a.firstCreatePass&&(ga(a,i),Pr(i)&&a.queries.elementEnd(i)),null!=o.classesWithoutHost&&function Gl(i){return 0!=(16&i.flags)}(o)&&Gi(a,o,mt(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function Uc(i){return 0!=(32&i.flags)}(o)&&Gi(a,o,mt(),o.stylesWithoutHost,!1),Br}function co(i,o,a,h){return Ci(i,o,a,h),Br(),co}function la(){return mt()}function ac(i){return!!i&&"function"==typeof i.then}function Du(i){return!!i&&"function"==typeof i.subscribe}const Cu=Du;function td(i,o,a,h){const g=mt(),v=tr(),T=si();return function Pf(i,o,a,h,g,v,T,M){const k=Pi(h),q=i.firstCreatePass&&Zh(i),ue=o[8],Ce=Xp(o);let Be=!0;if(3&h.type||M){const Vt=ii(h,o),nn=M?M(Vt):Vt,dt=Ce.length,vn=M?gr=>M(dn(gr[h.index])):h.index;if(gn(a)){let gr=null;if(!M&&k&&(gr=function ym(i,o,a,h){const g=i.cleanup;if(null!=g)for(let v=0;v<g.length-1;v+=2){const T=g[v];if(T===a&&g[v+1]===h){const M=o[7],k=g[v+2];return M.length>k?M[k]:null}"string"==typeof T&&(v+=2)}return null}(i,o,g,h.index)),null!==gr)(gr.__ngLastListenerFn__||gr).__ngNextListenerFn__=v,gr.__ngLastListenerFn__=v,Be=!1;else{v=lh(h,o,ue,v,!1);const Xr=a.listen(nn,g,v);Ce.push(v,Xr),q&&q.push(g,vn,dt,dt+1)}}else v=lh(h,o,ue,v,!0),nn.addEventListener(g,v,T),Ce.push(v),q&&q.push(g,vn,dt,T)}else v=lh(h,o,ue,v,!1);const ot=h.outputs;let Ct;if(Be&&null!==ot&&(Ct=ot[g])){const Vt=Ct.length;if(Vt)for(let nn=0;nn<Vt;nn+=2){const ka=o[Ct[nn]][Ct[nn+1]].subscribe(v),dh=Ce.length;Ce.push(v,ka),q&&q.push(g,h.index,dh,-(dh+1))}}}(v,g,g[11],T,i,o,!!a,h),td}function nd(i,o,a,h){try{return!1!==a(h)}catch(g){return yf(i,g),!1}}function lh(i,o,a,h,g){return function v(T){if(T===Function)return h;const M=2&i.flags?oi(i.index,o):o;0==(32&o[2])&&eh(M);let k=nd(o,0,h,T),G=v.__ngNextListenerFn__;for(;G;)k=nd(o,0,G,T)&&k,G=G.__ngNextListenerFn__;return g&&!1===k&&(T.preventDefault(),T.returnValue=!1),k}}function Pa(i=1){return function ts(i){return(pn.lFrame.contextLView=function _c(i,o){for(;i>0;)o=o[15],i--;return o}(i,pn.lFrame.contextLView))[8]}(i)}function uy(i,o=""){const a=mt(),h=tr(),g=i+20,v=h.firstCreatePass?rc(h,g,1,o,null):h.data[g],T=a[g]=function Ld(i,o){return gn(i)?i.createText(o):i.createTextNode(o)}(a[11],o);Mh(h,a,T,v),xo(v,!1)}function $g(i){return wm("",i,""),$g}function wm(i,o,a){const h=mt(),g=function xu(i,o,a,h){return Ho(i,Ls(),a)?o+ft(a)+h:On}(h,i,o,a);return g!==On&&el(h,Ri(),g),wm}function Gg(i,o,a,h,g,v,T){const M=mt(),k=Aa(M,i,o,a,h,g,v,T);return k!==On&&el(M,Ri(),k),Gg}const uh=void 0;var ax=["en",[["a","p"],["AM","PM"],uh],[["AM","PM"],uh,uh],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],uh,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],uh,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",uh,"{1} 'at' {0}",uh],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function sx(i){const a=Math.floor(Math.abs(i)),h=i.toString().replace(/^[^.]*\.?/,"").length;return 1===a&&0===h?1:5}];let od={};function Hg(i){const o=function lx(i){return i.toLowerCase().replace(/_/g,"-")}(i);let a=Ay(o);if(a)return a;const h=o.split("-")[0];if(a=Ay(h),a)return a;if("en"===h)return ax;throw new Error(`Missing locale data for the locale "${i}".`)}function Iy(i){return Hg(i)[Dn.PluralCase]}function Ay(i){return i in od||(od[i]=Kn.ng&&Kn.ng.common&&Kn.ng.common.locales&&Kn.ng.common.locales[i]),od[i]}var Dn=(()=>((Dn=Dn||{})[Dn.LocaleId=0]="LocaleId",Dn[Dn.DayPeriodsFormat=1]="DayPeriodsFormat",Dn[Dn.DayPeriodsStandalone=2]="DayPeriodsStandalone",Dn[Dn.DaysFormat=3]="DaysFormat",Dn[Dn.DaysStandalone=4]="DaysStandalone",Dn[Dn.MonthsFormat=5]="MonthsFormat",Dn[Dn.MonthsStandalone=6]="MonthsStandalone",Dn[Dn.Eras=7]="Eras",Dn[Dn.FirstDayOfWeek=8]="FirstDayOfWeek",Dn[Dn.WeekendRange=9]="WeekendRange",Dn[Dn.DateFormat=10]="DateFormat",Dn[Dn.TimeFormat=11]="TimeFormat",Dn[Dn.DateTimeFormat=12]="DateTimeFormat",Dn[Dn.NumberSymbols=13]="NumberSymbols",Dn[Dn.NumberFormats=14]="NumberFormats",Dn[Dn.CurrencyCode=15]="CurrencyCode",Dn[Dn.CurrencySymbol=16]="CurrencySymbol",Dn[Dn.CurrencyName=17]="CurrencyName",Dn[Dn.Currencies=18]="Currencies",Dn[Dn.Directionality=19]="Directionality",Dn[Dn.PluralCase=20]="PluralCase",Dn[Dn.ExtraData=21]="ExtraData",Dn))();const Em="en-US";let Py=Em;class nv{}class u1{resolveComponentFactory(o){throw function c1(i){const o=Error(`No component factory found for ${It(i)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=i,o}(o)}}let Mm=(()=>{class i{}return i.NULL=new u1,i})();function h1(){return ad(si(),mt())}function ad(i,o){return new Uf(ii(i,o))}let Uf=(()=>{class i{constructor(a){this.nativeElement=a}}return i.__NG_ELEMENT_ID__=h1,i})();function d1(i){return i instanceof Uf?i.nativeElement:i}class iv{}let f1=(()=>{class i{}return i.__NG_ELEMENT_ID__=()=>function m1(){const i=mt(),a=oi(si().index,i);return function p1(i){return i[11]}(Jr(a)?a:i)}(),i})(),g1=(()=>{class i{}return i.\u0275prov=Gr({token:i,providedIn:"root",factory:()=>null}),i})();class ov{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const _1=new ov("13.2.5"),Qg={};function Im(i,o,a,h,g=!1){for(;null!==a;){const v=o[a.index];if(null!==v&&h.push(dn(v)),Nr(v))for(let M=10;M<v.length;M++){const k=v[M],G=k[1].firstChild;null!==G&&Im(k[1],k,G,h)}const T=a.type;if(8&T)Im(i,o,a.child,h);else if(32&T){const M=kd(a,o);let k;for(;k=M();)h.push(k)}else if(16&T){const M=lu(o,a);if(Array.isArray(M))h.push(...M);else{const k=iu(o[16]);Im(k[1],k,M,h,!0)}}a=g?a.projectionNext:a.next}return h}class Vf{constructor(o,a){this._lView=o,this._cdRefInjectingView=a,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const o=this._lView,a=o[1];return Im(a,o,a.firstChild,[])}get context(){return this._lView[8]}set context(o){this._lView[8]=o}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[3];if(Nr(o)){const a=o[8],h=a?a.indexOf(this):-1;h>-1&&(Fd(o,h),O(a,h))}this._attachedToViewContainer=!1}bp(this._lView[1],this._lView)}onDestroy(o){lf(this._lView[1],this._lView,null,o)}markForCheck(){eh(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){gf(this._lView[1],this._lView,this.context)}checkNoChanges(){!function Wp(i,o,a){cl(!0);try{gf(i,o,a)}finally{cl(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Wt(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Ou(i,o){Ac(i,o,o[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new Wt(902,"");this._appRef=o}}class y1 extends Vf{constructor(o){super(o),this._view=o}detectChanges(){Gh(this._view)}checkNoChanges(){!function Hh(i){cl(!0);try{Gh(i)}finally{cl(!1)}}(this._view)}get context(){return null}}class sv extends Mm{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const a=ae(o);return new Jg(a,this.ngModule)}}function av(i){const o=[];for(let a in i)i.hasOwnProperty(a)&&o.push({propName:i[a],templateName:a});return o}class Jg extends nv{constructor(o,a){super(),this.componentDef=o,this.ngModule=a,this.componentType=o.type,this.selector=function dg(i){return i.map(hg).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!a}get inputs(){return av(this.componentDef.inputs)}get outputs(){return av(this.componentDef.outputs)}create(o,a,h,g){const v=(g=g||this.ngModule)?function x1(i,o){return{get:(a,h,g)=>{const v=i.get(a,Qg,g);return v!==Qg||h===Qg?v:o.get(a,h,g)}}}(o,g.injector):o,T=v.get(iv,Cr),M=v.get(g1,null),k=T.createRenderer(null,this.componentDef),G=this.componentDef.selectors[0][0]||"div",q=h?function af(i,o,a){if(gn(i))return i.selectRootElement(o,a===Zn.ShadowDom);let h="string"==typeof o?i.querySelector(o):o;return h.textContent="",h}(k,h,this.componentDef.encapsulation):su(T.createRenderer(null,this.componentDef),G,function v1(i){const o=i.toLowerCase();return"svg"===o?"svg":"math"===o?W:null}(G)),ue=this.componentDef.onPush?576:528,Ce=function Df(i,o){return{components:[],scheduler:i||nu,clean:Lg,playerHandler:o||null,flags:0}}(),Be=Bh(0,null,null,1,0,null,null,null,null,null),ot=Ka(null,Be,Ce,ue,null,null,T,k,M,v);let Ct,Vt;pa(ot);try{const nn=function cm(i,o,a,h,g,v){const T=a[1];a[20]=i;const k=rc(T,20,2,"#host",null),G=k.mergedAttrs=o.hostAttrs;null!==G&&(th(k,G,!0),null!==i&&(Wi(g,i,G),null!==k.classes&&Gd(g,i,k.classes),null!==k.styles&&Ep(g,i,k.styles)));const q=h.createRenderer(i,o),ue=Ka(a,sf(o),null,o.onPush?64:16,a[20],k,h,q,v||null,null);return T.firstCreatePass&&(Ga(Ns(k,a),T,o.type),Hp(T,k),Zp(k,a.length,1)),$h(a,ue),a[20]=ue}(q,this.componentDef,ot,T,k);if(q)if(h)Wi(k,q,["ng-version",_1.full]);else{const{attrs:dt,classes:vn}=function $u(i){const o=[],a=[];let h=1,g=2;for(;h<i.length;){let v=i[h];if("string"==typeof v)2===g?""!==v&&o.push(v,i[++h]):8===g&&a.push(v);else{if(!Ta(g))break;g=v}h++}return{attrs:o,classes:a}}(this.componentDef.selectors[0]);dt&&Wi(k,q,dt),vn&&vn.length>0&&Gd(k,q,vn.join(" "))}if(Vt=Ps(Be,20),void 0!==a){const dt=Vt.projection=[];for(let vn=0;vn<this.ngContentSelectors.length;vn++){const gr=a[vn];dt.push(null!=gr?Array.from(gr):null)}}Ct=function um(i,o,a,h,g){const v=a[1],T=function Nh(i,o,a){const h=si();i.firstCreatePass&&(a.providersResolver&&a.providersResolver(a),uf(i,h,o,hu(i,o,1,null),a));const g=we(o,i,h.directiveStart,h);Vi(g,o);const v=ii(h,o);return v&&Vi(v,o),g}(v,a,o);if(h.components.push(T),i[8]=T,g&&g.forEach(k=>k(T,o)),o.contentQueries){const k=si();o.contentQueries(1,T,k.directiveStart)}const M=si();return!v.firstCreatePass||null===o.hostBindings&&null===o.hostAttrs||(No(M.index),Qu(a[1],M,0,M.directiveStart,M.directiveEnd,o),Gp(o,T)),T}(nn,this.componentDef,ot,Ce,[Fc]),du(Be,ot,null)}finally{ma()}return new w1(this.componentType,Ct,ad(Vt,ot),ot,Vt)}}class w1 extends class l1{}{constructor(o,a,h,g,v){super(),this.location=h,this._rootLView=g,this._tNode=v,this.instance=a,this.hostView=this.changeDetectorRef=new y1(g),this.componentType=o}get injector(){return new zt(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}class ld{}class lv{}const cd=new Map;class hv extends ld{constructor(o,a){super(),this._parent=a,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new sv(this);const h=At(o);this._bootstrapComponents=Xa(h.bootstrap),this._r3Injector=mu(o,a,[{provide:ld,useValue:this},{provide:Mm,useValue:this.componentFactoryResolver}],It(o)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(o)}get(o,a=aa.THROW_IF_NOT_FOUND,h=Jt.Default){return o===aa||o===ld||o===xf?this:this._r3Injector.get(o,a,h)}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class e_ extends lv{constructor(o){super(),this.moduleType=o,null!==At(o)&&function T1(i){const o=new Set;!function a(h){const g=At(h,!0),v=g.id;null!==v&&(function cv(i,o,a){if(o&&o!==a)throw new Error(`Duplicate module registered for ${i} - ${It(o)} vs ${It(o.name)}`)}(v,cd.get(v),h),cd.set(v,h));const T=Xa(g.imports);for(const M of T)o.has(M)||(o.add(M),a(M))}(i)}(o)}create(o){return new hv(this.moduleType,o)}}function dv(i,o,a,h){return function fv(i,o,a,h,g,v){const T=o+a;return Ho(i,T,g)?il(i,T+1,v?h.call(v,g):h(g)):jf(i,T+1)}(mt(),Mr(),i,o,a,h)}function jf(i,o){const a=i[o];return a===On?void 0:a}function yv(i,o){const a=tr();let h;const g=i+20;a.firstCreatePass?(h=function L1(i,o){if(o)for(let a=o.length-1;a>=0;a--){const h=o[a];if(i===h.name)return h}}(o,a.pipeRegistry),a.data[g]=h,h.onDestroy&&(a.destroyHooks||(a.destroyHooks=[])).push(g,h.onDestroy)):h=a.data[g];const v=h.factory||(h.factory=gs(h.type)),T=cn(Ir);try{const M=yl(!1),k=v();return yl(M),function E(i,o,a,h){a>=i.data.length&&(i.data[a]=null,i.blueprint[a]=null),o[a]=h}(a,mt(),g,k),k}finally{cn(T)}}function vv(i,o,a,h){const g=i+20,v=mt(),T=vo(v,g);return function $f(i,o){return i[1].data[o].pure}(v,g)?function pv(i,o,a,h,g,v,T){const M=o+a;return Ia(i,M,g,v)?il(i,M+2,T?h.call(T,g,v):h(g,v)):jf(i,M+2)}(v,Mr(),o,T.transform,a,h,T):T.transform(a,h)}function t_(i){return o=>{setTimeout(i,void 0,o)}}const hc=class N1 extends Nt.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,a,h){var g,v,T;let M=o,k=a||(()=>null),G=h;if(o&&"object"==typeof o){const ue=o;M=null===(g=ue.next)||void 0===g?void 0:g.bind(ue),k=null===(v=ue.error)||void 0===v?void 0:v.bind(ue),G=null===(T=ue.complete)||void 0===T?void 0:T.bind(ue)}this.__isAsync&&(k=t_(k),M&&(M=t_(M)),G&&(G=t_(G)));const q=super.subscribe({next:M,error:k,complete:G});return o instanceof et.w0&&o.add(q),q}};function U1(){return this._results[Sa()]()}class n_{constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const a=Sa(),h=n_.prototype;h[a]||(h[a]=U1)}get changes(){return this._changes||(this._changes=new hc)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,a){return this._results.reduce(o,a)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,a){const h=this;h.dirty=!1;const g=w(o);(this._changesDetected=!function x(i,o,a){if(i.length!==o.length)return!1;for(let h=0;h<i.length;h++){let g=i[h],v=o[h];if(a&&(g=a(g),v=a(v)),v!==g)return!1}return!0}(h._results,g,a))&&(h._results=g,h.length=g.length,h.last=g[this.length-1],h.first=g[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Gf=(()=>{class i{}return i.__NG_ELEMENT_ID__=$1,i})();const V1=Gf,j1=class extends V1{constructor(o,a,h){super(),this._declarationLView=o,this._declarationTContainer=a,this.elementRef=h}createEmbeddedView(o){const a=this._declarationTContainer.tViews,h=Ka(this._declarationLView,a,o,16,null,a.declTNode,null,null,null,null);h[17]=this._declarationLView[this._declarationTContainer.index];const v=this._declarationLView[19];return null!==v&&(h[19]=v.createEmbeddedView(a)),du(a,h,o),new Vf(h)}};function $1(){return Am(si(),mt())}function Am(i,o){return 4&i.type?new j1(o,i,ad(i,o)):null}let Pm=(()=>{class i{}return i.__NG_ELEMENT_ID__=G1,i})();function G1(){return wv(si(),mt())}const H1=Pm,xv=class extends H1{constructor(o,a,h){super(),this._lContainer=o,this._hostTNode=a,this._hostLView=h}get element(){return ad(this._hostTNode,this._hostLView)}get injector(){return new zt(this._hostTNode,this._hostLView)}get parentInjector(){const o=ea(this._hostTNode,this._hostLView);if(_l(o)){const a=Bs(o,this._hostLView),h=zs(o);return new zt(a[1].data[h+8],a)}return new zt(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const a=bv(this._lContainer);return null!==a&&a[o]||null}get length(){return this._lContainer.length-10}createEmbeddedView(o,a,h){const g=o.createEmbeddedView(a||{});return this.insert(g,h),g}createComponent(o,a,h,g,v){const T=o&&!function p(i){return"function"==typeof i}(o);let M;if(T)M=a;else{const ue=a||{};M=ue.index,h=ue.injector,g=ue.projectableNodes,v=ue.ngModuleRef}const k=T?o:new Jg(ae(o)),G=h||this.parentInjector;if(!v&&null==k.ngModule){const Ce=(T?G:this.parentInjector).get(ld,null);Ce&&(v=Ce)}const q=k.create(G,g,void 0,v);return this.insert(q.hostView,M),q}insert(o,a){const h=o._lView,g=h[1];if(function Fa(i){return Nr(i[3])}(h)){const q=this.indexOf(o);if(-1!==q)this.detach(q);else{const ue=h[3],Ce=new xv(ue,ue[6],ue[3]);Ce.detach(Ce.indexOf(o))}}const v=this._adjustIndex(a),T=this._lContainer;!function tg(i,o,a,h){const g=10+h,v=a.length;h>0&&(a[g-1][4]=o),h<v-10?(o[4]=a[g],F(a,10+h,o)):(a.push(o),o[4]=null),o[3]=a;const T=o[17];null!==T&&a!==T&&function ng(i,o){const a=i[9];o[16]!==o[3][3][16]&&(i[2]=!0),null===a?i[9]=[o]:a.push(o)}(T,o);const M=o[19];null!==M&&M.insertView(i),o[2]|=128}(g,h,T,v);const M=Vd(v,T),k=h[11],G=Ic(k,T[7]);return null!==G&&function Kl(i,o,a,h,g,v){h[0]=g,h[6]=o,Ac(i,h,a,1,g,v)}(g,T[6],k,h,G,M),o.attachToViewContainerRef(),F(r_(T),v,o),o}move(o,a){return this.insert(o,a)}indexOf(o){const a=bv(this._lContainer);return null!==a?a.indexOf(o):-1}remove(o){const a=this._adjustIndex(o,-1),h=Fd(this._lContainer,a);h&&(O(r_(this._lContainer),a),bp(h[1],h))}detach(o){const a=this._adjustIndex(o,-1),h=Fd(this._lContainer,a);return h&&null!=O(r_(this._lContainer),a)?new Vf(h):null}_adjustIndex(o,a=0){return null==o?this.length+a:o}};function bv(i){return i[8]}function r_(i){return i[8]||(i[8]=[])}function wv(i,o){let a;const h=o[i.index];if(Nr(h))a=h;else{let g;if(8&i.type)g=dn(h);else{const v=o[11];g=v.createComment("");const T=ii(i,o);jr(v,Ic(v,T),g,function Bu(i,o){return gn(i)?i.nextSibling(o):o.nextSibling}(v,T),!1)}o[i.index]=a=Ju(h,o,g,i),$h(o,a)}return new xv(a,i,o)}class i_{constructor(o){this.queryList=o,this.matches=null}clone(){return new i_(this.queryList)}setDirty(){this.queryList.setDirty()}}class o_{constructor(o=[]){this.queries=o}createEmbeddedView(o){const a=o.queries;if(null!==a){const h=null!==o.contentQueries?o.contentQueries[0]:a.length,g=[];for(let v=0;v<h;v++){const T=a.getByIndex(v);g.push(this.queries[T.indexInDeclarationView].clone())}return new o_(g)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let a=0;a<this.queries.length;a++)null!==Pv(o,a).matches&&this.queries[a].setDirty()}}class Ev{constructor(o,a,h=null){this.predicate=o,this.flags=a,this.read=h}}class s_{constructor(o=[]){this.queries=o}elementStart(o,a){for(let h=0;h<this.queries.length;h++)this.queries[h].elementStart(o,a)}elementEnd(o){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(o)}embeddedTView(o){let a=null;for(let h=0;h<this.length;h++){const g=null!==a?a.length:0,v=this.getByIndex(h).embeddedTView(o,g);v&&(v.indexInDeclarationView=h,null!==a?a.push(v):a=[v])}return null!==a?new s_(a):null}template(o,a){for(let h=0;h<this.queries.length;h++)this.queries[h].template(o,a)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class a_{constructor(o,a=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(o,a){this.isApplyingToNode(a)&&this.matchTNode(o,a)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,a){this.elementStart(o,a)}embeddedTView(o,a){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,a),new a_(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const a=this._declarationNodeIndex;let h=o.parent;for(;null!==h&&8&h.type&&h.index!==a;)h=h.parent;return a===(null!==h?h.index:-1)}return this._appliesToNextNode}matchTNode(o,a){const h=this.metadata.predicate;if(Array.isArray(h))for(let g=0;g<h.length;g++){const v=h[g];this.matchTNodeWithReadOption(o,a,W1(a,v)),this.matchTNodeWithReadOption(o,a,he(a,o,v,!1,!1))}else h===Gf?4&a.type&&this.matchTNodeWithReadOption(o,a,-1):this.matchTNodeWithReadOption(o,a,he(a,o,h,!1,!1))}matchTNodeWithReadOption(o,a,h){if(null!==h){const g=this.metadata.read;if(null!==g)if(g===Uf||g===Pm||g===Gf&&4&a.type)this.addMatch(a.index,-2);else{const v=he(a,o,g,!1,!1);null!==v&&this.addMatch(a.index,v)}else this.addMatch(a.index,h)}}addMatch(o,a){null===this.matches?this.matches=[o,a]:this.matches.push(o,a)}}function W1(i,o){const a=i.localNames;if(null!==a)for(let h=0;h<a.length;h+=2)if(a[h]===o)return a[h+1];return null}function Y1(i,o,a,h){return-1===a?function X1(i,o){return 11&i.type?ad(i,o):4&i.type?Am(i,o):null}(o,i):-2===a?function K1(i,o,a){return a===Uf?ad(o,i):a===Gf?Am(o,i):a===Pm?wv(o,i):void 0}(i,o,h):we(i,i[1],a,o)}function Tv(i,o,a,h){const g=o[19].queries[h];if(null===g.matches){const v=i.data,T=a.matches,M=[];for(let k=0;k<T.length;k+=2){const G=T[k];M.push(G<0?null:Y1(o,v[G],T[k+1],a.metadata.read))}g.matches=M}return g.matches}function l_(i,o,a,h){const g=i.queries.getByIndex(a),v=g.matches;if(null!==v){const T=Tv(i,o,g,a);for(let M=0;M<v.length;M+=2){const k=v[M];if(k>0)h.push(T[M/2]);else{const G=v[M+1],q=o[-k];for(let ue=10;ue<q.length;ue++){const Ce=q[ue];Ce[17]===Ce[3]&&l_(Ce[1],Ce,G,h)}if(null!==q[9]){const ue=q[9];for(let Ce=0;Ce<ue.length;Ce++){const Be=ue[Ce];l_(Be[1],Be,G,h)}}}}}return h}function Dv(i){const o=mt(),a=tr(),h=hl();_s(h+1);const g=Pv(a,h);if(i.dirty&&Qo(o)===(2==(2&g.metadata.flags))){if(null===g.matches)i.reset([]);else{const v=g.crossesNgTemplate?l_(a,o,h,[]):Tv(a,o,g,h);i.reset(v,d1),i.notifyOnChanges()}return!0}return!1}function Cv(i,o,a){const h=tr();h.firstCreatePass&&(Av(h,new Ev(i,o,a),-1),2==(2&o)&&(h.staticViewQueries=!0)),Iv(h,mt(),o)}function Sv(i,o,a,h){const g=tr();if(g.firstCreatePass){const v=si();Av(g,new Ev(o,a,h),v.index),function J1(i,o){const a=i.contentQueries||(i.contentQueries=[]);o!==(a.length?a[a.length-1]:-1)&&a.push(i.queries.length-1,o)}(g,i),2==(2&a)&&(g.staticContentQueries=!0)}Iv(g,mt(),a)}function Mv(){return function Q1(i,o){return i[19].queries[o].queryList}(mt(),hl())}function Iv(i,o,a){const h=new n_(4==(4&a));lf(i,o,h,h.destroy),null===o[19]&&(o[19]=new o_),o[19].queries.push(new i_(h))}function Av(i,o,a){null===i.queries&&(i.queries=new s_),i.queries.track(new a_(o,a))}function Pv(i,o){return i.queries.getByIndex(o)}function Lm(...i){}const Wv=new sr("Application Initializer");let p_=(()=>{class i{constructor(a){this.appInits=a,this.resolve=Lm,this.reject=Lm,this.initialized=!1,this.done=!1,this.donePromise=new Promise((h,g)=>{this.resolve=h,this.reject=g})}runInitializers(){if(this.initialized)return;const a=[],h=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let g=0;g<this.appInits.length;g++){const v=this.appInits[g]();if(ac(v))a.push(v);else if(Cu(v)){const T=new Promise((M,k)=>{v.subscribe({complete:M,error:k})});a.push(T)}}Promise.all(a).then(()=>{h()}).catch(g=>{this.reject(g)}),0===a.length&&h(),this.initialized=!0}}return i.\u0275fac=function(a){return new(a||i)(Fn(Wv,8))},i.\u0275prov=Gr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const Xv=new sr("AppId",{providedIn:"root",factory:function Yv(){return`${m_()}${m_()}${m_()}`}});function m_(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const Kv=new sr("Platform Initializer"),Qv=new sr("Platform ID"),Jv=new sr("appBootstrapListener");let e0=(()=>{class i{log(a){console.log(a)}warn(a){console.warn(a)}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Gr({token:i,factory:i.\u0275fac}),i})();const g_=new sr("LocaleId",{providedIn:"root",factory:()=>Vo(g_,Jt.Optional|Jt.SkipSelf)||function _b(){return"undefined"!=typeof $localize&&$localize.locale||Em}()}),yb=new sr("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class vb{constructor(o,a){this.ngModuleFactory=o,this.componentFactories=a}}let xb=(()=>{class i{compileModuleSync(a){return new e_(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){const h=this.compileModuleSync(a),v=Xa(At(a).declarations).reduce((T,M)=>{const k=ae(M);return k&&T.push(new Jg(k)),T},[]);return new vb(h,v)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Gr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const wb=(()=>Promise.resolve(0))();function __(i){"undefined"==typeof Zone?wb.then(()=>{i&&i.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",i)}class Ll{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:h=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new hc(!1),this.onMicrotaskEmpty=new hc(!1),this.onStable=new hc(!1),this.onError=new hc(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const g=this;g._nesting=0,g._outer=g._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(g._inner=g._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(g._inner=g._inner.fork(Zone.longStackTraceZoneSpec)),g.shouldCoalesceEventChangeDetection=!h&&a,g.shouldCoalesceRunChangeDetection=h,g.lastRequestAnimationFrameId=-1,g.nativeRequestAnimationFrame=function Eb(){let i=Kn.requestAnimationFrame,o=Kn.cancelAnimationFrame;if("undefined"!=typeof Zone&&i&&o){const a=i[Zone.__symbol__("OriginalDelegate")];a&&(i=a);const h=o[Zone.__symbol__("OriginalDelegate")];h&&(o=h)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function Cb(i){const o=()=>{!function Db(i){i.isCheckStableRunning||-1!==i.lastRequestAnimationFrameId||(i.lastRequestAnimationFrameId=i.nativeRequestAnimationFrame.call(Kn,()=>{i.fakeTopEventTask||(i.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{i.lastRequestAnimationFrameId=-1,v_(i),i.isCheckStableRunning=!0,y_(i),i.isCheckStableRunning=!1},void 0,()=>{},()=>{})),i.fakeTopEventTask.invoke()}),v_(i))}(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(a,h,g,v,T,M)=>{try{return t0(i),a.invokeTask(g,v,T,M)}finally{(i.shouldCoalesceEventChangeDetection&&"eventTask"===v.type||i.shouldCoalesceRunChangeDetection)&&o(),n0(i)}},onInvoke:(a,h,g,v,T,M,k)=>{try{return t0(i),a.invoke(g,v,T,M,k)}finally{i.shouldCoalesceRunChangeDetection&&o(),n0(i)}},onHasTask:(a,h,g,v)=>{a.hasTask(g,v),h===g&&("microTask"==v.change?(i._hasPendingMicrotasks=v.microTask,v_(i),y_(i)):"macroTask"==v.change&&(i.hasPendingMacrotasks=v.macroTask))},onHandleError:(a,h,g,v)=>(a.handleError(g,v),i.runOutsideAngular(()=>i.onError.emit(v)),!1)})}(g)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ll.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Ll.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(o,a,h){return this._inner.run(o,a,h)}runTask(o,a,h,g){const v=this._inner,T=v.scheduleEventTask("NgZoneEvent: "+g,o,Tb,Lm,Lm);try{return v.runTask(T,a,h)}finally{v.cancelTask(T)}}runGuarded(o,a,h){return this._inner.runGuarded(o,a,h)}runOutsideAngular(o){return this._outer.run(o)}}const Tb={};function y_(i){if(0==i._nesting&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function v_(i){i.hasPendingMicrotasks=!!(i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&-1!==i.lastRequestAnimationFrameId)}function t0(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function n0(i){i._nesting--,y_(i)}class Sb{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new hc,this.onMicrotaskEmpty=new hc,this.onStable=new hc,this.onError=new hc}run(o,a,h){return o.apply(a,h)}runGuarded(o,a,h){return o.apply(a,h)}runOutsideAngular(o){return o()}runTask(o,a,h,g){return o.apply(a,h)}}let r0=(()=>{class i{constructor(a){this._ngZone=a,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),a.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ll.assertNotInAngularZone(),__(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())__(()=>{for(;0!==this._callbacks.length;){let a=this._callbacks.pop();clearTimeout(a.timeoutId),a.doneCb(this._didWork)}this._didWork=!1});else{let a=this.getPendingTasks();this._callbacks=this._callbacks.filter(h=>!h.updateCb||!h.updateCb(a)||(clearTimeout(h.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(a=>({source:a.source,creationLocation:a.creationLocation,data:a.data})):[]}addCallback(a,h,g){let v=-1;h&&h>0&&(v=setTimeout(()=>{this._callbacks=this._callbacks.filter(T=>T.timeoutId!==v),a(this._didWork,this.getPendingTasks())},h)),this._callbacks.push({doneCb:a,timeoutId:v,updateCb:g})}whenStable(a,h,g){if(g&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(a,h,g),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(a,h,g){return[]}}return i.\u0275fac=function(a){return new(a||i)(Fn(Ll))},i.\u0275prov=Gr({token:i,factory:i.\u0275fac}),i})(),o0=(()=>{class i{constructor(){this._applications=new Map,x_.addToWindow(this)}registerApplication(a,h){this._applications.set(a,h)}unregisterApplication(a){this._applications.delete(a)}unregisterAllApplications(){this._applications.clear()}getTestability(a){return this._applications.get(a)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(a,h=!0){return x_.findTestabilityInTree(this,a,h)}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Gr({token:i,factory:i.\u0275fac}),i})();class Mb{addToWindow(o){}findTestabilityInTree(o,a,h){return null}}function Ib(i){x_=i}let Fl,x_=new Mb;const s0=new sr("AllowMultipleToken");class kb{constructor(o,a){this.name=o,this.token=a}}function a0(i,o,a=[]){const h=`Platform: ${o}`,g=new sr(h);return(v=[])=>{let T=l0();if(!T||T.injector.get(s0,!1))if(i)i(a.concat(v).concat({provide:g,useValue:!0}));else{const M=a.concat(v).concat({provide:g,useValue:!0},{provide:Xh,useValue:"platform"});!function Rb(i){if(Fl&&!Fl.destroyed&&!Fl.injector.get(s0,!1))throw new Wt(400,"");Fl=i.get(c0);const o=i.get(Kv,null);o&&o.forEach(a=>a())}(aa.create({providers:M,name:h}))}return function Lb(i){const o=l0();if(!o)throw new Wt(401,"");return o}()}}function l0(){return Fl&&!Fl.destroyed?Fl:null}let c0=(()=>{class i{constructor(a){this._injector=a,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(a,h){const M=function Fb(i,o){let a;return a="noop"===i?new Sb:("zone.js"===i?void 0:i)||new Ll({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==o?void 0:o.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==o?void 0:o.ngZoneRunCoalescing)}),a}(h?h.ngZone:void 0,{ngZoneEventCoalescing:h&&h.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:h&&h.ngZoneRunCoalescing||!1}),k=[{provide:Ll,useValue:M}];return M.run(()=>{const G=aa.create({providers:k,parent:this.injector,name:a.moduleType.name}),q=a.create(G),ue=q.injector.get(bh,null);if(!ue)throw new Wt(402,"");return M.runOutsideAngular(()=>{const Ce=M.onError.subscribe({next:Be=>{ue.handleError(Be)}});q.onDestroy(()=>{w_(this._modules,q),Ce.unsubscribe()})}),function Ob(i,o,a){try{const h=a();return ac(h)?h.catch(g=>{throw o.runOutsideAngular(()=>i.handleError(g)),g}):h}catch(h){throw o.runOutsideAngular(()=>i.handleError(h)),h}}(ue,M,()=>{const Ce=q.injector.get(p_);return Ce.runInitializers(),Ce.donePromise.then(()=>(function dx(i){$n(i,"Expected localeId to be defined"),"string"==typeof i&&(Py=i.toLowerCase().replace(/_/g,"-"))}(q.injector.get(g_,Em)||Em),this._moduleDoBootstrap(q),q))})})}bootstrapModule(a,h=[]){const g=u0({},h);return function Ab(i,o,a){const h=new e_(a);return Promise.resolve(h)}(0,0,a).then(v=>this.bootstrapModuleFactory(v,g))}_moduleDoBootstrap(a){const h=a.injector.get(b_);if(a._bootstrapComponents.length>0)a._bootstrapComponents.forEach(g=>h.bootstrap(g));else{if(!a.instance.ngDoBootstrap)throw new Wt(403,"");a.instance.ngDoBootstrap(h)}this._modules.push(a)}onDestroy(a){this._destroyListeners.push(a)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Wt(404,"");this._modules.slice().forEach(a=>a.destroy()),this._destroyListeners.forEach(a=>a()),this._destroyed=!0}get destroyed(){return this._destroyed}}return i.\u0275fac=function(a){return new(a||i)(Fn(aa))},i.\u0275prov=Gr({token:i,factory:i.\u0275fac}),i})();function u0(i,o){return Array.isArray(o)?o.reduce(u0,i):Object.assign(Object.assign({},i),o)}let b_=(()=>{class i{constructor(a,h,g,v,T){this._zone=a,this._injector=h,this._exceptionHandler=g,this._componentFactoryResolver=v,this._initStatus=T,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const M=new Et.y(G=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{G.next(this._stable),G.complete()})}),k=new Et.y(G=>{let q;this._zone.runOutsideAngular(()=>{q=this._zone.onStable.subscribe(()=>{Ll.assertNotInAngularZone(),__(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,G.next(!0))})})});const ue=this._zone.onUnstable.subscribe(()=>{Ll.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{G.next(!1)}))});return()=>{q.unsubscribe(),ue.unsubscribe()}});this.isStable=function en(...i){const o=(0,u.yG)(i),a=(0,u._6)(i,1/0),h=i;return h.length?1===h.length?(0,Oe.Xf)(h[0]):(0,Y.J)(a)((0,wt.D)(h,o)):Mt.E}(M,k.pipe(function Bn(i={}){const{connector:o=(()=>new Nt.x),resetOnError:a=!0,resetOnComplete:h=!0,resetOnRefCountZero:g=!0}=i;return v=>{let T=null,M=null,k=null,G=0,q=!1,ue=!1;const Ce=()=>{null==M||M.unsubscribe(),M=null},Be=()=>{Ce(),T=k=null,q=ue=!1},ot=()=>{const Ct=T;Be(),null==Ct||Ct.unsubscribe()};return(0,Ot.e)((Ct,Vt)=>{G++,!ue&&!q&&Ce();const nn=k=null!=k?k:o();Vt.add(()=>{G--,0===G&&!ue&&!q&&(M=Ft(ot,g))}),nn.subscribe(Vt),T||(T=new st.Hp({next:dt=>nn.next(dt),error:dt=>{ue=!0,Ce(),M=Ft(Be,a,dt),nn.error(dt)},complete:()=>{q=!0,Ce(),M=Ft(Be,h),nn.complete()}}),(0,wt.D)(Ct).subscribe(T))})(v)}}()))}bootstrap(a,h){if(!this._initStatus.done)throw new Wt(405,"");let g;g=a instanceof nv?a:this._componentFactoryResolver.resolveComponentFactory(a),this.componentTypes.push(g.componentType);const v=function Pb(i){return i.isBoundToModule}(g)?void 0:this._injector.get(ld),M=g.create(aa.NULL,[],h||g.selector,v),k=M.location.nativeElement,G=M.injector.get(r0,null),q=G&&M.injector.get(o0);return G&&q&&q.registerApplication(k,G),M.onDestroy(()=>{this.detachView(M.hostView),w_(this.components,M),q&&q.unregisterApplication(k)}),this._loadComponent(M),M}tick(){if(this._runningTick)throw new Wt(101,"");try{this._runningTick=!0;for(let a of this._views)a.detectChanges()}catch(a){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(a))}finally{this._runningTick=!1}}attachView(a){const h=a;this._views.push(h),h.attachToAppRef(this)}detachView(a){const h=a;w_(this._views,h),h.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView),this.tick(),this.components.push(a),this._injector.get(Jv,[]).concat(this._bootstrapListeners).forEach(g=>g(a))}ngOnDestroy(){this._views.slice().forEach(a=>a.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return i.\u0275fac=function(a){return new(a||i)(Fn(Ll),Fn(aa),Fn(bh),Fn(Mm),Fn(p_))},i.\u0275prov=Gr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function w_(i,o){const a=i.indexOf(o);a>-1&&i.splice(a,1)}let d0=!0;function Bb(){d0=!1}let Nb=(()=>{class i{}return i.__NG_ELEMENT_ID__=Ub,i})();function Ub(i){return function Vb(i,o,a){if(_o(i)&&!a){const h=oi(i.index,o);return new Vf(h,h)}return 47&i.type?new Vf(o[16],o):null}(si(),mt(),16==(16&i))}class _0{constructor(){}supports(o){return ah(o)}create(o){return new qb(o)}}const Zb=(i,o)=>o;class qb{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||Zb}forEachItem(o){let a;for(a=this._itHead;null!==a;a=a._next)o(a)}forEachOperation(o){let a=this._itHead,h=this._removalsHead,g=0,v=null;for(;a||h;){const T=!h||a&&a.currentIndex<v0(h,g,v)?a:h,M=v0(T,g,v),k=T.currentIndex;if(T===h)g--,h=h._nextRemoved;else if(a=a._next,null==T.previousIndex)g++;else{v||(v=[]);const G=M-g,q=k-g;if(G!=q){for(let Ce=0;Ce<G;Ce++){const Be=Ce<v.length?v[Ce]:v[Ce]=0,ot=Be+Ce;q<=ot&&ot<G&&(v[Ce]=Be+1)}v[T.previousIndex]=q-G}}M!==k&&o(T,M,k)}}forEachPreviousItem(o){let a;for(a=this._previousItHead;null!==a;a=a._nextPrevious)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachMovedItem(o){let a;for(a=this._movesHead;null!==a;a=a._nextMoved)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}forEachIdentityChange(o){let a;for(a=this._identityChangesHead;null!==a;a=a._nextIdentityChange)o(a)}diff(o){if(null==o&&(o=[]),!ah(o))throw new Wt(900,"");return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let g,v,T,a=this._itHead,h=!1;if(Array.isArray(o)){this.length=o.length;for(let M=0;M<this.length;M++)v=o[M],T=this._trackByFn(M,v),null!==a&&Object.is(a.trackById,T)?(h&&(a=this._verifyReinsertion(a,v,T,M)),Object.is(a.item,v)||this._addIdentityChange(a,v)):(a=this._mismatch(a,v,T,M),h=!0),a=a._next}else g=0,function _m(i,o){if(Array.isArray(i))for(let a=0;a<i.length;a++)o(i[a]);else{const a=i[Sa()]();let h;for(;!(h=a.next()).done;)o(h.value)}}(o,M=>{T=this._trackByFn(g,M),null!==a&&Object.is(a.trackById,T)?(h&&(a=this._verifyReinsertion(a,M,T,g)),Object.is(a.item,M)||this._addIdentityChange(a,M)):(a=this._mismatch(a,M,T,g),h=!0),a=a._next,g++}),this.length=g;return this._truncate(a),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,a,h,g){let v;return null===o?v=this._itTail:(v=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._reinsertAfter(o,v,g)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(h,g))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._moveAfter(o,v,g)):o=this._addAfter(new Wb(a,h),v,g),o}_verifyReinsertion(o,a,h,g){let v=null===this._unlinkedRecords?null:this._unlinkedRecords.get(h,null);return null!==v?o=this._reinsertAfter(v,o._prev,g):o.currentIndex!=g&&(o.currentIndex=g,this._addToMoves(o,g)),o}_truncate(o){for(;null!==o;){const a=o._next;this._addToRemovals(this._unlink(o)),o=a}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,a,h){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const g=o._prevRemoved,v=o._nextRemoved;return null===g?this._removalsHead=v:g._nextRemoved=v,null===v?this._removalsTail=g:v._prevRemoved=g,this._insertAfter(o,a,h),this._addToMoves(o,h),o}_moveAfter(o,a,h){return this._unlink(o),this._insertAfter(o,a,h),this._addToMoves(o,h),o}_addAfter(o,a,h){return this._insertAfter(o,a,h),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,a,h){const g=null===a?this._itHead:a._next;return o._next=g,o._prev=a,null===g?this._itTail=o:g._prev=o,null===a?this._itHead=o:a._next=o,null===this._linkedRecords&&(this._linkedRecords=new y0),this._linkedRecords.put(o),o.currentIndex=h,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const a=o._prev,h=o._next;return null===a?this._itHead=h:a._next=h,null===h?this._itTail=a:h._prev=a,o}_addToMoves(o,a){return o.previousIndex===a||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new y0),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,a){return o.item=a,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class Wb{constructor(o,a){this.item=o,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Xb{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,a){let h;for(h=this._head;null!==h;h=h._nextDup)if((null===a||a<=h.currentIndex)&&Object.is(h.trackById,o))return h;return null}remove(o){const a=o._prevDup,h=o._nextDup;return null===a?this._head=h:a._nextDup=h,null===h?this._tail=a:h._prevDup=a,null===this._head}}class y0{constructor(){this.map=new Map}put(o){const a=o.trackById;let h=this.map.get(a);h||(h=new Xb,this.map.set(a,h)),h.add(o)}get(o,a){const g=this.map.get(o);return g?g.get(o,a):null}remove(o){const a=o.trackById;return this.map.get(a).remove(o)&&this.map.delete(a),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function v0(i,o,a){const h=i.previousIndex;if(null===h)return h;let g=0;return a&&h<a.length&&(g=a[h]),h+o+g}class x0{constructor(){}supports(o){return o instanceof Map||ed(o)}create(){return new Yb}}class Yb{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let a;for(a=this._mapHead;null!==a;a=a._next)o(a)}forEachPreviousItem(o){let a;for(a=this._previousMapHead;null!==a;a=a._nextPrevious)o(a)}forEachChangedItem(o){let a;for(a=this._changesHead;null!==a;a=a._nextChanged)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}diff(o){if(o){if(!(o instanceof Map||ed(o)))throw new Wt(900,"")}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let a=this._mapHead;if(this._appendAfter=null,this._forEach(o,(h,g)=>{if(a&&a.key===g)this._maybeAddToChanges(a,h),this._appendAfter=a,a=a._next;else{const v=this._getOrCreateRecordForKey(g,h);a=this._insertBeforeOrAppend(a,v)}}),a){a._prev&&(a._prev._next=null),this._removalsHead=a;for(let h=a;null!==h;h=h._nextRemoved)h===this._mapHead&&(this._mapHead=null),this._records.delete(h.key),h._nextRemoved=h._next,h.previousValue=h.currentValue,h.currentValue=null,h._prev=null,h._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,a){if(o){const h=o._prev;return a._next=o,a._prev=h,o._prev=a,h&&(h._next=a),o===this._mapHead&&(this._mapHead=a),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=a,a._prev=this._appendAfter):this._mapHead=a,this._appendAfter=a,null}_getOrCreateRecordForKey(o,a){if(this._records.has(o)){const g=this._records.get(o);this._maybeAddToChanges(g,a);const v=g._prev,T=g._next;return v&&(v._next=T),T&&(T._prev=v),g._next=null,g._prev=null,g}const h=new Kb(o);return this._records.set(o,h),h.currentValue=a,this._addToAdditions(h),h}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,a){Object.is(a,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=a,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,a){o instanceof Map?o.forEach(a):Object.keys(o).forEach(h=>a(o[h],h))}}class Kb{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function b0(){return new S_([new _0])}let S_=(()=>{class i{constructor(a){this.factories=a}static create(a,h){if(null!=h){const g=h.factories.slice();a=a.concat(g)}return new i(a)}static extend(a){return{provide:i,useFactory:h=>i.create(a,h||b0()),deps:[[i,new lo,new ao]]}}find(a){const h=this.factories.find(g=>g.supports(a));if(null!=h)return h;throw new Wt(901,"")}}return i.\u0275prov=Gr({token:i,providedIn:"root",factory:b0}),i})();function w0(){return new M_([new x0])}let M_=(()=>{class i{constructor(a){this.factories=a}static create(a,h){if(h){const g=h.factories.slice();a=a.concat(g)}return new i(a)}static extend(a){return{provide:i,useFactory:h=>i.create(a,h||w0()),deps:[[i,new lo,new ao]]}}find(a){const h=this.factories.find(v=>v.supports(a));if(h)return h;throw new Wt(901,"")}}return i.\u0275prov=Gr({token:i,providedIn:"root",factory:w0}),i})();const ew=a0(null,"core",[{provide:Qv,useValue:"unknown"},{provide:c0,deps:[aa]},{provide:o0,deps:[]},{provide:e0,deps:[]}]);let tw=(()=>{class i{constructor(a){}}return i.\u0275fac=function(a){return new(a||i)(Fn(b_))},i.\u0275mod=it({type:i}),i.\u0275inj=To({}),i})()},140:(er,Gt,Le)=>{"use strict";Le.d(Gt,{rH:()=>Os,Od:()=>Gl,Bz:()=>Bs,lC:()=>Ye});var Y=Le(223),Oe=Le(669),Mt=Le(76);function u(...A){const C=(0,Oe.yG)(A);return(0,Mt.D)(A,C)}var wt=Le(579);class en extends wt.x{constructor(C){super(),this._value=C}get value(){return this.getValue()}_subscribe(C){const D=super._subscribe(C);return!D.closed&&C.next(this._value),D}getValue(){const{hasError:C,thrownError:D,_value:L}=this;if(C)throw D;return this._throwIfClosed(),L}next(C){super.next(this._value=C)}}var Nt=Le(306);const{isArray:et}=Array,{getPrototypeOf:Et,prototype:Me,keys:st}=Object;var Ft=Le(671),Rt=Le(4);const{isArray:an}=Array;var xn=Le(403),ut=Le(672);function Dt(...A){const C=(0,Oe.yG)(A),D=(0,Oe.jO)(A),{args:L,keys:U}=function Ot(A){if(1===A.length){const C=A[0];if(et(C))return{args:C,keys:null};if(function Bn(A){return A&&"object"==typeof A&&Et(A)===Me}(C)){const D=st(C);return{args:D.map(L=>C[L]),keys:D}}}return{args:A,keys:null}}(A);if(0===L.length)return(0,Mt.D)([],C);const X=new Nt.y(function fn(A,C,D=Ft.y){return L=>{Wt(C,()=>{const{length:U}=A,X=new Array(U);let he=U,we=U;for(let je=0;je<U;je++)Wt(C,()=>{const Lt=(0,Mt.D)(A[je],C);let _n=!1;Lt.subscribe((0,xn.x)(L,zt=>{X[je]=zt,_n||(_n=!0,we--),we||L.next(D(X.slice()))},()=>{--he||L.complete()}))},L)},L)}}(L,C,U?he=>function zn(A,C){return A.reduce((D,L,U)=>(D[L]=C[U],D),{})}(U,he):Ft.y));return D?X.pipe(function Nn(A){return(0,Rt.U)(C=>function It(A,C){return an(C)?A(...C):A(C)}(A,C))}(D)):X}function Wt(A,C,D){A?(0,ut.f)(D,A,C):C()}var tn=Le(576);function ft(A,C){const D=(0,tn.m)(A)?A:()=>A,L=U=>U.error(D());return new Nt.y(C?U=>C.schedule(L,0,U):L)}const $e=(0,Le(888).d)(A=>function(){A(this),this.name="EmptyError",this.message="no elements in sequence"});var He=Le(189);function _t(...A){return function qe(){return(0,He.J)(1)}()((0,Mt.D)(A,(0,Oe.yG)(A)))}var Ve=Le(421);function En(A){return new Nt.y(C=>{(0,Ve.Xf)(A()).subscribe(C)})}var Qt=Le(727),br=Le(482);function hn(){return(0,br.e)((A,C)=>{let D=null;A._refCount++;const L=(0,xn.x)(C,void 0,void 0,void 0,()=>{if(!A||A._refCount<=0||0<--A._refCount)return void(D=null);const U=A._connection,X=D;D=null,U&&(!X||U===X)&&U.unsubscribe(),C.unsubscribe()});A.subscribe(L),L.closed||(D=A.connect())})}class $r extends Nt.y{constructor(C,D){super(),this.source=C,this.subjectFactory=D,this._subject=null,this._refCount=0,this._connection=null,(0,br.A)(C)&&(this.lift=C.lift)}_subscribe(C){return this.getSubject().subscribe(C)}getSubject(){const C=this._subject;return(!C||C.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:C}=this;this._subject=this._connection=null,null==C||C.unsubscribe()}connect(){let C=this._connection;if(!C){C=this._connection=new Qt.w0;const D=this.getSubject();C.add(this.source.subscribe((0,xn.x)(D,void 0,()=>{this._teardown(),D.complete()},L=>{this._teardown(),D.error(L)},()=>this._teardown()))),C.closed&&(this._connection=null,C=Qt.w0.EMPTY)}return C}refCount(){return hn()(this)}}var yi=Le(515);function ur(A,C){return(0,br.e)((D,L)=>{let U=null,X=0,he=!1;const we=()=>he&&!U&&L.complete();D.subscribe((0,xn.x)(L,je=>{null==U||U.unsubscribe();let Lt=0;const _n=X++;(0,Ve.Xf)(A(je,_n)).subscribe(U=(0,xn.x)(L,zt=>L.next(C?C(je,zt,_n,Lt++):zt),()=>{U=null,we()}))},()=>{he=!0,we()}))})}function Fi(A,C,D,L,U){return(X,he)=>{let we=D,je=C,Lt=0;X.subscribe((0,xn.x)(he,_n=>{const zt=Lt++;je=we?A(je,_n,zt):(we=!0,_n),L&&he.next(je)},U&&(()=>{we&&he.next(je),he.complete()})))}}function Eo(A,C){return(0,br.e)(Fi(A,C,arguments.length>=2,!0))}function Zi(A,C){return(0,br.e)((D,L)=>{let U=0;D.subscribe((0,xn.x)(L,X=>A.call(C,X,U++)&&L.next(X)))})}function Lr(A){return(0,br.e)((C,D)=>{let X,L=null,U=!1;L=C.subscribe((0,xn.x)(D,void 0,void 0,he=>{X=(0,Ve.Xf)(A(he,Lr(A)(C))),L?(L.unsubscribe(),L=null,X.subscribe(D)):U=!0})),U&&(L.unsubscribe(),L=null,X.subscribe(D))})}var $n=Le(577);function Gn(A,C){return(0,tn.m)(C)?(0,$n.z)(A,C,1):(0,$n.z)(A,1)}function Cn(A){return A<=0?()=>yi.E:(0,br.e)((C,D)=>{let L=[];C.subscribe((0,xn.x)(D,U=>{L.push(U),A<L.length&&L.shift()},()=>{for(const U of L)D.next(U);D.complete()},void 0,()=>{L=null}))})}function qi(A=ds){return(0,br.e)((C,D)=>{let L=!1;C.subscribe((0,xn.x)(D,U=>{L=!0,D.next(U)},()=>L?D.complete():D.error(A())))})}function ds(){return new $e}function Gr(A){return(0,br.e)((C,D)=>{let L=!1;C.subscribe((0,xn.x)(D,U=>{L=!0,D.next(U)},()=>{L||D.next(A),D.complete()}))})}var To=Le(698);function Pn(A,C){const D=arguments.length>=2;return L=>L.pipe(A?Zi((U,X)=>A(U,X,L)):Ft.y,(0,To.q)(1),D?Gr(C):qi(()=>new $e))}function Yr(A,C,D){const L=(0,tn.m)(A)||C||D?{next:A,error:C,complete:D}:A;return L?(0,br.e)((U,X)=>{var he;null===(he=L.subscribe)||void 0===he||he.call(L);let we=!0;U.subscribe((0,xn.x)(X,je=>{var Lt;null===(Lt=L.next)||void 0===Lt||Lt.call(L,je),X.next(je)},()=>{var je;we=!1,null===(je=L.complete)||void 0===je||je.call(L),X.complete()},je=>{var Lt;we=!1,null===(Lt=L.error)||void 0===Lt||Lt.call(L,je),X.error(je)},()=>{var je,Lt;we&&(null===(je=L.unsubscribe)||void 0===je||je.call(L)),null===(Lt=L.finalize)||void 0===Lt||Lt.call(L)}))}):Ft.y}var ti=Le(808);class xi{constructor(C,D){this.id=C,this.url=D}}class cr extends xi{constructor(C,D,L="imperative",U=null){super(C,D),this.navigationTrigger=L,this.restoredState=U}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class uo extends xi{constructor(C,D,L){super(C,D),this.urlAfterRedirects=L}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class fs extends xi{constructor(C,D,L){super(C,D),this.reason=L}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class ho extends xi{constructor(C,D,L){super(C,D),this.error=L}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Jt extends xi{constructor(C,D,L,U){super(C,D),this.urlAfterRedirects=L,this.state=U}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class wr extends xi{constructor(C,D,L,U){super(C,D),this.urlAfterRedirects=L,this.state=U}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class un extends xi{constructor(C,D,L,U,X){super(C,D),this.urlAfterRedirects=L,this.state=U,this.shouldActivate=X}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class cn extends xi{constructor(C,D,L,U){super(C,D),this.urlAfterRedirects=L,this.state=U}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class fo extends xi{constructor(C,D,L,U){super(C,D),this.urlAfterRedirects=L,this.state=U}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Po{constructor(C){this.route=C}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class hr{constructor(C){this.route=C}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class fi{constructor(C){this.snapshot=C}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Hn{constructor(C){this.snapshot=C}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class po{constructor(C){this.snapshot=C}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Zn{constructor(C){this.snapshot=C}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class mo{constructor(C,D,L){this.routerEvent=C,this.position=D,this.anchor=L}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const qt="primary";class ps{constructor(C){this.params=C||{}}has(C){return Object.prototype.hasOwnProperty.call(this.params,C)}get(C){if(this.has(C)){const D=this.params[C];return Array.isArray(D)?D[0]:D}return null}getAll(C){if(this.has(C)){const D=this.params[C];return Array.isArray(D)?D:[D]}return[]}get keys(){return Object.keys(this.params)}}function pi(A){return new ps(A)}const Kn="ngNavigationCancelingError";function no(A){const C=Error("NavigationCancelingError: "+A);return C[Kn]=!0,C}function ro(A,C,D){const L=D.path.split("/");if(L.length>A.length||"full"===D.pathMatch&&(C.hasChildren()||L.length<A.length))return null;const U={};for(let X=0;X<L.length;X++){const he=L[X],we=A[X];if(he.startsWith(":"))U[he.substring(1)]=we;else if(he!==we.path)return null}return{consumed:A.slice(0,L.length),posParams:U}}function oe(A,C){const D=A?Object.keys(A):void 0,L=C?Object.keys(C):void 0;if(!D||!L||D.length!=L.length)return!1;let U;for(let X=0;X<D.length;X++)if(U=D[X],!V(A[U],C[U]))return!1;return!0}function V(A,C){if(Array.isArray(A)&&Array.isArray(C)){if(A.length!==C.length)return!1;const D=[...A].sort(),L=[...C].sort();return D.every((U,X)=>L[X]===U)}return A===C}function Z(A){return Array.prototype.concat.apply([],A)}function se(A){return A.length>0?A[A.length-1]:null}function _e(A,C){for(const D in A)A.hasOwnProperty(D)&&C(A[D],D)}function Ie(A){return(0,Y.CqO)(A)?A:(0,Y.QGY)(A)?(0,Mt.D)(Promise.resolve(A)):u(A)}const Ee={exact:function it(A,C,D){if(!Xt(A.segments,C.segments)||!de(A.segments,C.segments,D)||A.numberOfChildren!==C.numberOfChildren)return!1;for(const L in C.children)if(!A.children[L]||!it(A.children[L],C.children[L],D))return!1;return!0},subset:Kt},Fe={exact:function nt(A,C){return oe(A,C)},subset:function Ht(A,C){return Object.keys(C).length<=Object.keys(A).length&&Object.keys(C).every(D=>V(A[D],C[D]))},ignored:()=>!0};function Xe(A,C,D){return Ee[D.paths](A.root,C.root,D.matrixParams)&&Fe[D.queryParams](A.queryParams,C.queryParams)&&!("exact"===D.fragment&&A.fragment!==C.fragment)}function Kt(A,C,D){return ve(A,C,C.segments,D)}function ve(A,C,D,L){if(A.segments.length>D.length){const U=A.segments.slice(0,D.length);return!(!Xt(U,D)||C.hasChildren()||!de(U,D,L))}if(A.segments.length===D.length){if(!Xt(A.segments,D)||!de(A.segments,D,L))return!1;for(const U in C.children)if(!A.children[U]||!Kt(A.children[U],C.children[U],L))return!1;return!0}{const U=D.slice(0,A.segments.length),X=D.slice(A.segments.length);return!!(Xt(A.segments,U)&&de(A.segments,U,L)&&A.children[qt])&&ve(A.children[qt],C,X,L)}}function de(A,C,D){return C.every((L,U)=>Fe[D](A[U].parameters,L.parameters))}class ae{constructor(C,D,L){this.root=C,this.queryParams=D,this.fragment=L}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=pi(this.queryParams)),this._queryParamMap}toString(){return Si.serialize(this)}}class Se{constructor(C,D){this.segments=C,this.children=D,this.parent=null,_e(D,(L,U)=>L.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Or(this)}}class Ze{constructor(C,D){this.path=C,this.parameters=D}get parameterMap(){return this._parameterMap||(this._parameterMap=pi(this.parameters)),this._parameterMap}toString(){return Qr(this)}}function Xt(A,C){return A.length===C.length&&A.every((D,L)=>D.path===C[L].path)}class Tr{}class Fr{parse(C){const D=new Ts(C);return new ae(D.parseRootSegment(),D.parseQueryParams(),D.parseFragment())}serialize(C){const D=`/${ms(C.root,!0)}`,L=function Dr(A){const C=Object.keys(A).map(D=>{const L=A[D];return Array.isArray(L)?L.map(U=>`${Ut(D)}=${Ut(U)}`).join("&"):`${Ut(D)}=${Ut(L)}`}).filter(D=>!!D);return C.length?`?${C.join("&")}`:""}(C.queryParams);return`${D}${L}${"string"==typeof C.fragment?`#${function kn(A){return encodeURI(A)}(C.fragment)}`:""}`}}const Si=new Fr;function Or(A){return A.segments.map(C=>Qr(C)).join("/")}function ms(A,C){if(!A.hasChildren())return Or(A);if(C){const D=A.children[qt]?ms(A.children[qt],!1):"",L=[];return _e(A.children,(U,X)=>{X!==qt&&L.push(`${X}:${ms(U,!1)}`)}),L.length>0?`${D}(${L.join("//")})`:D}{const D=function Er(A,C){let D=[];return _e(A.children,(L,U)=>{U===qt&&(D=D.concat(C(L,U)))}),_e(A.children,(L,U)=>{U!==qt&&(D=D.concat(C(L,U)))}),D}(A,(L,U)=>U===qt?[ms(A.children[qt],!1)]:[`${U}:${ms(L,!1)}`]);return 1===Object.keys(A.children).length&&null!=A.children[qt]?`${Or(A)}/${D[0]}`:`${Or(A)}/(${D.join("//")})`}}function Mi(A){return encodeURIComponent(A).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ut(A){return Mi(A).replace(/%3B/gi,";")}function dr(A){return Mi(A).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function ci(A){return decodeURIComponent(A)}function go(A){return ci(A.replace(/\+/g,"%20"))}function Qr(A){return`${dr(A.path)}${function mi(A){return Object.keys(A).map(C=>`;${dr(C)}=${dr(A[C])}`).join("")}(A.parameters)}`}const io=/^[^\/()?;=#]+/;function qo(A){const C=A.match(io);return C?C[0]:""}const Mn=/^[^=?&#]+/,oo=/^[^&#]+/;class Ts{constructor(C){this.url=C,this.remaining=C}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Se([],{}):new Se([],this.parseChildren())}parseQueryParams(){const C={};if(this.consumeOptional("?"))do{this.parseQueryParam(C)}while(this.consumeOptional("&"));return C}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const C=[];for(this.peekStartsWith("(")||C.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),C.push(this.parseSegment());let D={};this.peekStartsWith("/(")&&(this.capture("/"),D=this.parseParens(!0));let L={};return this.peekStartsWith("(")&&(L=this.parseParens(!1)),(C.length>0||Object.keys(D).length>0)&&(L[qt]=new Se(C,D)),L}parseSegment(){const C=qo(this.remaining);if(""===C&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(C),new Ze(ci(C),this.parseMatrixParams())}parseMatrixParams(){const C={};for(;this.consumeOptional(";");)this.parseParam(C);return C}parseParam(C){const D=qo(this.remaining);if(!D)return;this.capture(D);let L="";if(this.consumeOptional("=")){const U=qo(this.remaining);U&&(L=U,this.capture(L))}C[ci(D)]=ci(L)}parseQueryParam(C){const D=function Ro(A){const C=A.match(Mn);return C?C[0]:""}(this.remaining);if(!D)return;this.capture(D);let L="";if(this.consumeOptional("=")){const he=function Wo(A){const C=A.match(oo);return C?C[0]:""}(this.remaining);he&&(L=he,this.capture(L))}const U=go(D),X=go(L);if(C.hasOwnProperty(U)){let he=C[U];Array.isArray(he)||(he=[he],C[U]=he),he.push(X)}else C[U]=X}parseParens(C){const D={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const L=qo(this.remaining),U=this.remaining[L.length];if("/"!==U&&")"!==U&&";"!==U)throw new Error(`Cannot parse url '${this.url}'`);let X;L.indexOf(":")>-1?(X=L.substr(0,L.indexOf(":")),this.capture(X),this.capture(":")):C&&(X=qt);const he=this.parseChildren();D[X]=1===Object.keys(he).length?he[qt]:new Se([],he),this.consumeOptional("//")}return D}peekStartsWith(C){return this.remaining.startsWith(C)}consumeOptional(C){return!!this.peekStartsWith(C)&&(this.remaining=this.remaining.substring(C.length),!0)}capture(C){if(!this.consumeOptional(C))throw new Error(`Expected "${C}".`)}}class Ii{constructor(C){this._root=C}get root(){return this._root.value}parent(C){const D=this.pathFromRoot(C);return D.length>1?D[D.length-2]:null}children(C){const D=Xo(C,this._root);return D?D.children.map(L=>L.value):[]}firstChild(C){const D=Xo(C,this._root);return D&&D.children.length>0?D.children[0].value:null}siblings(C){const D=Ai(C,this._root);return D.length<2?[]:D[D.length-2].children.map(U=>U.value).filter(U=>U!==C)}pathFromRoot(C){return Ai(C,this._root).map(D=>D.value)}}function Xo(A,C){if(A===C.value)return C;for(const D of C.children){const L=Xo(A,D);if(L)return L}return null}function Ai(A,C){if(A===C.value)return[C];for(const D of C.children){const L=Ai(A,D);if(L.length)return L.unshift(C),L}return[]}class Hr{constructor(C,D){this.value=C,this.children=D}toString(){return`TreeNode(${this.value})`}}function Rn(A){const C={};return A&&A.children.forEach(D=>C[D.value.outlet]=D),C}class We extends Ii{constructor(C,D){super(C),this.snapshot=D,Lo(this,C)}toString(){return this.snapshot.toString()}}function kt(A,C){const D=function Jr(A,C){const he=new Pi([],{},{},"",{},qt,C,null,A.root,-1,{});return new Oi("",new Hr(he,[]))}(A,C),L=new en([new Ze("",{})]),U=new en({}),X=new en({}),he=new en({}),we=new en(""),je=new Nr(L,U,he,we,X,qt,C,D.root);return je.snapshot=D.root,new We(new Hr(je,[]),D)}class Nr{constructor(C,D,L,U,X,he,we,je){this.url=C,this.params=D,this.queryParams=L,this.fragment=U,this.data=X,this.outlet=he,this.component=we,this._futureSnapshot=je}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Rt.U)(C=>pi(C)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Rt.U)(C=>pi(C)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Pr(A,C="emptyOnly"){const D=A.pathFromRoot;let L=0;if("always"!==C)for(L=D.length-1;L>=1;){const U=D[L],X=D[L-1];if(U.routeConfig&&""===U.routeConfig.path)L--;else{if(X.component)break;L--}}return function _o(A){return A.reduce((C,D)=>({params:Object.assign(Object.assign({},C.params),D.params),data:Object.assign(Object.assign({},C.data),D.data),resolve:Object.assign(Object.assign({},C.resolve),D._resolvedData)}),{params:{},data:{},resolve:{}})}(D.slice(L))}class Pi{constructor(C,D,L,U,X,he,we,je,Lt,_n,zt){this.url=C,this.params=D,this.queryParams=L,this.fragment=U,this.data=X,this.outlet=he,this.component=we,this.routeConfig=je,this._urlSegment=Lt,this._lastPathIndex=_n,this._resolve=zt}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=pi(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=pi(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(L=>L.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Oi extends Ii{constructor(C,D){super(D),this.url=C,Lo(this,D)}toString(){return Pt(this._root)}}function Lo(A,C){C.value._routerState=A,C.children.forEach(D=>Lo(A,D))}function Pt(A){const C=A.children.length>0?` { ${A.children.map(Pt).join(", ")} } `:"";return`${A.value}${C}`}function In(A){if(A.snapshot){const C=A.snapshot,D=A._futureSnapshot;A.snapshot=D,oe(C.queryParams,D.queryParams)||A.queryParams.next(D.queryParams),C.fragment!==D.fragment&&A.fragment.next(D.fragment),oe(C.params,D.params)||A.params.next(D.params),function Sn(A,C){if(A.length!==C.length)return!1;for(let D=0;D<A.length;++D)if(!oe(A[D],C[D]))return!1;return!0}(C.url,D.url)||A.url.next(D.url),oe(C.data,D.data)||A.data.next(D.data)}else A.snapshot=A._futureSnapshot,A.data.next(A._futureSnapshot.data)}function Tn(A,C){const D=oe(A.params,C.params)&&function At(A,C){return Xt(A,C)&&A.every((D,L)=>oe(D.parameters,C[L].parameters))}(A.url,C.url);return D&&!(!A.parent!=!C.parent)&&(!A.parent||Tn(A.parent,C.parent))}function Ko(A,C,D){if(D&&A.shouldReuseRoute(C.value,D.value.snapshot)){const L=D.value;L._futureSnapshot=C.value;const U=function An(A,C,D){return C.children.map(L=>{for(const U of D.children)if(A.shouldReuseRoute(L.value,U.value.snapshot))return Ko(A,L,U);return Ko(A,L)})}(A,C,D);return new Hr(L,U)}{if(A.shouldAttach(C.value)){const X=A.retrieve(C.value);if(null!==X){const he=X.route;return he.value._futureSnapshot=C.value,he.children=C.children.map(we=>Ko(A,we)),he}}const L=function Ra(A){return new Nr(new en(A.url),new en(A.params),new en(A.queryParams),new en(A.fragment),new en(A.data),A.outlet,A.component,A)}(C.value),U=C.children.map(X=>Ko(A,X));return new Hr(L,U)}}function Cs(A){return"object"==typeof A&&null!=A&&!A.outlets&&!A.segmentPath}function zi(A){return"object"==typeof A&&null!=A&&A.outlets}function kr(A,C,D,L,U){let X={};return L&&_e(L,(he,we)=>{X[we]=Array.isArray(he)?he.map(je=>`${je}`):`${he}`}),new ae(D.root===A?C:Ol(D.root,A,C),X,U)}function Ol(A,C,D){const L={};return _e(A.children,(U,X)=>{L[X]=U===C?D:Ol(U,C,D)}),new Se(A.segments,L)}class Bi{constructor(C,D,L){if(this.isAbsolute=C,this.numberOfDoubleDots=D,this.commands=L,C&&L.length>0&&Cs(L[0]))throw new Error("Root segment cannot have matrix parameters");const U=L.find(zi);if(U&&U!==se(L))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Ss{constructor(C,D,L){this.segmentGroup=C,this.processChildren=D,this.index=L}}function qs(A,C,D){if(A||(A=new Se([],{})),0===A.segments.length&&A.hasChildren())return ca(A,C,D);const L=function bn(A,C,D){let L=0,U=C;const X={match:!1,pathIndex:0,commandIndex:0};for(;U<A.segments.length;){if(L>=D.length)return X;const he=A.segments[U],we=D[L];if(zi(we))break;const je=`${we}`,Lt=L<D.length-1?D[L+1]:null;if(U>0&&void 0===je)break;if(je&&Lt&&"object"==typeof Lt&&void 0===Lt.outlets){if(!Ur(je,Lt,he))return X;L+=2}else{if(!Ur(je,{},he))return X;L++}U++}return{match:!0,pathIndex:U,commandIndex:L}}(A,C,D),U=D.slice(L.commandIndex);if(L.match&&L.pathIndex<A.segments.length){const X=new Se(A.segments.slice(0,L.pathIndex),{});return X.children[qt]=new Se(A.segments.slice(L.pathIndex),A.children),ca(X,0,U)}return L.match&&0===U.length?new Se(A.segments,{}):L.match&&!A.hasChildren()?so(A,C,D):L.match?ca(A,0,U):so(A,C,D)}function ca(A,C,D){if(0===D.length)return new Se(A.segments,{});{const L=function Un(A){return zi(A[0])?A[0].outlets:{[qt]:A}}(D),U={};return _e(L,(X,he)=>{"string"==typeof X&&(X=[X]),null!==X&&(U[he]=qs(A.children[he],C,X))}),_e(A.children,(X,he)=>{void 0===L[he]&&(U[he]=X)}),new Se(A.segments,U)}}function so(A,C,D){const L=A.segments.slice(0,C);let U=0;for(;U<D.length;){const X=D[U];if(zi(X)){const je=gs(X.outlets);return new Se(L,je)}if(0===U&&Cs(D[0])){L.push(new Ze(A.segments[C].path,ua(D[0]))),U++;continue}const he=zi(X)?X.outlets[qt]:`${X}`,we=U<D.length-1?D[U+1]:null;he&&we&&Cs(we)?(L.push(new Ze(he,ua(we))),U+=2):(L.push(new Ze(he,{})),U++)}return new Se(L,{})}function gs(A){const C={};return _e(A,(D,L)=>{"string"==typeof D&&(D=[D]),null!==D&&(C[L]=so(new Se([],{}),0,D))}),C}function ua(A){const C={};return _e(A,(D,L)=>C[L]=`${D}`),C}function Ur(A,C,D){return A==D.path&&oe(C,D.parameters)}class As{constructor(C,D,L,U){this.routeReuseStrategy=C,this.futureState=D,this.currState=L,this.forwardEvent=U}activate(C){const D=this.futureState._root,L=this.currState?this.currState._root:null;this.deactivateChildRoutes(D,L,C),In(this.futureState.root),this.activateChildRoutes(D,L,C)}deactivateChildRoutes(C,D,L){const U=Rn(D);C.children.forEach(X=>{const he=X.value.outlet;this.deactivateRoutes(X,U[he],L),delete U[he]}),_e(U,(X,he)=>{this.deactivateRouteAndItsChildren(X,L)})}deactivateRoutes(C,D,L){const U=C.value,X=D?D.value:null;if(U===X)if(U.component){const he=L.getContext(U.outlet);he&&this.deactivateChildRoutes(C,D,he.children)}else this.deactivateChildRoutes(C,D,L);else X&&this.deactivateRouteAndItsChildren(D,L)}deactivateRouteAndItsChildren(C,D){C.value.component&&this.routeReuseStrategy.shouldDetach(C.value.snapshot)?this.detachAndStoreRouteSubtree(C,D):this.deactivateRouteAndOutlet(C,D)}detachAndStoreRouteSubtree(C,D){const L=D.getContext(C.value.outlet),U=L&&C.value.component?L.children:D,X=Rn(C);for(const he of Object.keys(X))this.deactivateRouteAndItsChildren(X[he],U);if(L&&L.outlet){const he=L.outlet.detach(),we=L.children.onOutletDeactivated();this.routeReuseStrategy.store(C.value.snapshot,{componentRef:he,route:C,contexts:we})}}deactivateRouteAndOutlet(C,D){const L=D.getContext(C.value.outlet),U=L&&C.value.component?L.children:D,X=Rn(C);for(const he of Object.keys(X))this.deactivateRouteAndItsChildren(X[he],U);L&&L.outlet&&(L.outlet.deactivate(),L.children.onOutletDeactivated(),L.attachRef=null,L.resolver=null,L.route=null)}activateChildRoutes(C,D,L){const U=Rn(D);C.children.forEach(X=>{this.activateRoutes(X,U[X.value.outlet],L),this.forwardEvent(new Zn(X.value.snapshot))}),C.children.length&&this.forwardEvent(new Hn(C.value.snapshot))}activateRoutes(C,D,L){const U=C.value,X=D?D.value:null;if(In(U),U===X)if(U.component){const he=L.getOrCreateContext(U.outlet);this.activateChildRoutes(C,D,he.children)}else this.activateChildRoutes(C,D,L);else if(U.component){const he=L.getOrCreateContext(U.outlet);if(this.routeReuseStrategy.shouldAttach(U.snapshot)){const we=this.routeReuseStrategy.retrieve(U.snapshot);this.routeReuseStrategy.store(U.snapshot,null),he.children.onOutletReAttached(we.contexts),he.attachRef=we.componentRef,he.route=we.route.value,he.outlet&&he.outlet.attach(we.componentRef,we.route.value),In(we.route.value),this.activateChildRoutes(C,null,he.children)}else{const we=function bi(A){for(let C=A.parent;C;C=C.parent){const D=C.routeConfig;if(D&&D._loadedConfig)return D._loadedConfig;if(D&&D.component)return null}return null}(U.snapshot),je=we?we.module.componentFactoryResolver:null;he.attachRef=null,he.route=U,he.resolver=je,he.outlet&&he.outlet.activateWith(U,je),this.activateChildRoutes(C,null,he.children)}}else this.activateChildRoutes(C,null,L)}}class Ws{constructor(C,D){this.routes=C,this.module=D}}function ni(A){return"function"==typeof A}function ki(A){return A instanceof ae}const W=Symbol("INITIAL_VALUE");function B(){return ur(A=>Dt(A.map(C=>C.pipe((0,To.q)(1),function vi(...A){const C=(0,Oe.yG)(A);return(0,br.e)((D,L)=>{(C?_t(A,D,C):_t(A,D)).subscribe(L)})}(W)))).pipe(Eo((C,D)=>{let L=!1;return D.reduce((U,X,he)=>U!==W?U:(X===W&&(L=!0),L||!1!==X&&he!==D.length-1&&!ki(X)?U:X),C)},W),Zi(C=>C!==W),(0,Rt.U)(C=>ki(C)?C:!0===C),(0,To.q)(1)))}class J{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new Te,this.attachRef=null}}class Te{constructor(){this.contexts=new Map}onChildOutletCreated(C,D){const L=this.getOrCreateContext(C);L.outlet=D,this.contexts.set(C,L)}onChildOutletDestroyed(C){const D=this.getContext(C);D&&(D.outlet=null,D.attachRef=null)}onOutletDeactivated(){const C=this.contexts;return this.contexts=new Map,C}onOutletReAttached(C){this.contexts=C}getOrCreateContext(C){let D=this.getContext(C);return D||(D=new J,this.contexts.set(C,D)),D}getContext(C){return this.contexts.get(C)||null}}let Ye=(()=>{class A{constructor(D,L,U,X,he){this.parentContexts=D,this.location=L,this.resolver=U,this.changeDetector=he,this.activated=null,this._activatedRoute=null,this.activateEvents=new Y.vpe,this.deactivateEvents=new Y.vpe,this.attachEvents=new Y.vpe,this.detachEvents=new Y.vpe,this.name=X||qt,D.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const D=this.parentContexts.getContext(this.name);D&&D.route&&(D.attachRef?this.attach(D.attachRef,D.route):this.activateWith(D.route,D.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const D=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(D.instance),D}attach(D,L){this.activated=D,this._activatedRoute=L,this.location.insert(D.hostView),this.attachEvents.emit(D.instance)}deactivate(){if(this.activated){const D=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(D)}}activateWith(D,L){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=D;const he=(L=L||this.resolver).resolveComponentFactory(D._futureSnapshot.routeConfig.component),we=this.parentContexts.getOrCreateContext(this.name).children,je=new yt(D,we,this.location.injector);this.activated=this.location.createComponent(he,this.location.length,je),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return A.\u0275fac=function(D){return new(D||A)(Y.Y36(Te),Y.Y36(Y.s_b),Y.Y36(Y._Vd),Y.$8M("name"),Y.Y36(Y.sBO))},A.\u0275dir=Y.lG2({type:A,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),A})();class yt{constructor(C,D,L){this.route=C,this.childContexts=D,this.parent=L}get(C,D){return C===Nr?this.route:C===Te?this.childContexts:this.parent.get(C,D)}}let rn=(()=>{class A{}return A.\u0275fac=function(D){return new(D||A)},A.\u0275cmp=Y.Xpm({type:A,selectors:[["ng-component"]],decls:1,vars:0,template:function(D,L){1&D&&Y._UZ(0,"router-outlet")},directives:[Ye],encapsulation:2}),A})();function gn(A,C=""){for(let D=0;D<A.length;D++){const L=A[D];Cr(L,Sr(C,L))}}function Cr(A,C){A.children&&gn(A.children,C)}function Sr(A,C){return C?A||C.path?A&&!C.path?`${A}/`:!A&&C.path?C.path:`${A}/${C.path}`:"":A}function dn(A){const C=A.children&&A.children.map(dn),D=C?Object.assign(Object.assign({},A),{children:C}):Object.assign({},A);return!D.component&&(C||D.loadChildren)&&D.outlet&&D.outlet!==qt&&(D.component=rn),D}function _r(A){return A.outlet||qt}function Vr(A,C){const D=A.filter(L=>_r(L)===C);return D.push(...A.filter(L=>_r(L)!==C)),D}const ei={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function ii(A,C,D){var L;if(""===C.path)return"full"===C.pathMatch&&(A.hasChildren()||D.length>0)?Object.assign({},ei):{matched:!0,consumedSegments:[],remainingSegments:D,parameters:{},positionalParamSegments:{}};const X=(C.matcher||ro)(D,A,C);if(!X)return Object.assign({},ei);const he={};_e(X.posParams,(je,Lt)=>{he[Lt]=je.path});const we=X.consumed.length>0?Object.assign(Object.assign({},he),X.consumed[X.consumed.length-1].parameters):he;return{matched:!0,consumedSegments:X.consumed,remainingSegments:D.slice(X.consumed.length),parameters:we,positionalParamSegments:null!==(L=X.posParams)&&void 0!==L?L:{}}}function yo(A,C,D,L,U="corrected"){if(D.length>0&&function oi(A,C,D){return D.some(L=>Do(A,C,L)&&_r(L)!==qt)}(A,D,L)){const he=new Se(C,function vo(A,C,D,L){const U={};U[qt]=L,L._sourceSegment=A,L._segmentIndexShift=C.length;for(const X of D)if(""===X.path&&_r(X)!==qt){const he=new Se([],{});he._sourceSegment=A,he._segmentIndexShift=C.length,U[_r(X)]=he}return U}(A,C,L,new Se(D,A.children)));return he._sourceSegment=A,he._segmentIndexShift=C.length,{segmentGroup:he,slicedSegments:[]}}if(0===D.length&&function Qo(A,C,D){return D.some(L=>Do(A,C,L))}(A,D,L)){const he=new Se(A.segments,function Ps(A,C,D,L,U,X){const he={};for(const we of L)if(Do(A,D,we)&&!U[_r(we)]){const je=new Se([],{});je._sourceSegment=A,je._segmentIndexShift="legacy"===X?A.segments.length:C.length,he[_r(we)]=je}return Object.assign(Object.assign({},U),he)}(A,C,D,L,A.children,U));return he._sourceSegment=A,he._segmentIndexShift=C.length,{segmentGroup:he,slicedSegments:D}}const X=new Se(A.segments,A.children);return X._sourceSegment=A,X._segmentIndexShift=C.length,{segmentGroup:X,slicedSegments:D}}function Do(A,C,D){return(!(A.hasChildren()||C.length>0)||"full"!==D.pathMatch)&&""===D.path}function Fa(A,C,D,L){return!!(_r(A)===L||L!==qt&&Do(C,D,A))&&("**"===A.path||ii(C,A,D).matched)}function Oo(A,C,D){return 0===C.length&&!A.children[D]}class ks{constructor(C){this.segmentGroup=C||null}}class da{constructor(C){this.urlTree=C}}function pn(A){return ft(new ks(A))}function sl(A){return ft(new da(A))}class Oa{constructor(C,D,L,U,X){this.configLoader=D,this.urlSerializer=L,this.urlTree=U,this.config=X,this.allowRedirects=!0,this.ngModule=C.get(Y.h0i)}apply(){const C=yo(this.urlTree.root,[],[],this.config).segmentGroup,D=new Se(C.segments,C.children);return this.expandSegmentGroup(this.ngModule,this.config,D,qt).pipe((0,Rt.U)(X=>this.createUrlTree(za(X),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Lr(X=>{if(X instanceof da)return this.allowRedirects=!1,this.match(X.urlTree);throw X instanceof ks?this.noMatchError(X):X}))}match(C){return this.expandSegmentGroup(this.ngModule,this.config,C.root,qt).pipe((0,Rt.U)(U=>this.createUrlTree(za(U),C.queryParams,C.fragment))).pipe(Lr(U=>{throw U instanceof ks?this.noMatchError(U):U}))}noMatchError(C){return new Error(`Cannot match any routes. URL Segment: '${C.segmentGroup}'`)}createUrlTree(C,D,L){const U=C.segments.length>0?new Se([],{[qt]:C}):C;return new ae(U,D,L)}expandSegmentGroup(C,D,L,U){return 0===L.segments.length&&L.hasChildren()?this.expandChildren(C,D,L).pipe((0,Rt.U)(X=>new Se([],X))):this.expandSegment(C,L,D,L.segments,U,!0)}expandChildren(C,D,L){const U=[];for(const X of Object.keys(L.children))"primary"===X?U.unshift(X):U.push(X);return(0,Mt.D)(U).pipe(Gn(X=>{const he=L.children[X],we=Vr(D,X);return this.expandSegmentGroup(C,we,he,X).pipe((0,Rt.U)(je=>({segment:je,outlet:X})))}),Eo((X,he)=>(X[he.outlet]=he.segment,X),{}),function Es(A,C){const D=arguments.length>=2;return L=>L.pipe(A?Zi((U,X)=>A(U,X,L)):Ft.y,Cn(1),D?Gr(C):qi(()=>new $e))}())}expandSegment(C,D,L,U,X,he){return(0,Mt.D)(L).pipe(Gn(we=>this.expandSegmentAgainstRoute(C,D,L,we,U,X,he).pipe(Lr(Lt=>{if(Lt instanceof ks)return u(null);throw Lt}))),Pn(we=>!!we),Lr((we,je)=>{if(we instanceof $e||"EmptyError"===we.name){if(Oo(D,U,X))return u(new Se([],{}));throw new ks(D)}throw we}))}expandSegmentAgainstRoute(C,D,L,U,X,he,we){return Fa(U,D,X,he)?void 0===U.redirectTo?this.matchSegmentAgainstRoute(C,D,U,X,he):we&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(C,D,L,U,X,he):pn(D):pn(D)}expandSegmentAgainstRouteUsingRedirect(C,D,L,U,X,he){return"**"===U.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(C,L,U,he):this.expandRegularSegmentAgainstRouteUsingRedirect(C,D,L,U,X,he)}expandWildCardWithParamsAgainstRouteUsingRedirect(C,D,L,U){const X=this.applyRedirectCommands([],L.redirectTo,{});return L.redirectTo.startsWith("/")?sl(X):this.lineralizeSegments(L,X).pipe((0,$n.z)(he=>{const we=new Se(he,{});return this.expandSegment(C,we,D,he,U,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(C,D,L,U,X,he){const{matched:we,consumedSegments:je,remainingSegments:Lt,positionalParamSegments:_n}=ii(D,U,X);if(!we)return pn(D);const zt=this.applyRedirectCommands(je,U.redirectTo,_n);return U.redirectTo.startsWith("/")?sl(zt):this.lineralizeSegments(U,zt).pipe((0,$n.z)(pr=>this.expandSegment(C,D,L,pr.concat(Lt),he,!1)))}matchSegmentAgainstRoute(C,D,L,U,X){if("**"===L.path)return L.loadChildren?(L._loadedConfig?u(L._loadedConfig):this.configLoader.load(C.injector,L)).pipe((0,Rt.U)(zt=>(L._loadedConfig=zt,new Se(U,{})))):u(new Se(U,{}));const{matched:he,consumedSegments:we,remainingSegments:je}=ii(D,L,U);return he?this.getChildConfig(C,L,U).pipe((0,$n.z)(_n=>{const zt=_n.module,pr=_n.routes,{segmentGroup:Qn,slicedSegments:Us}=yo(D,we,je,pr),Zr=new Se(Qn.segments,Qn.children);if(0===Us.length&&Zr.hasChildren())return this.expandChildren(zt,pr,Zr).pipe((0,Rt.U)(rs=>new Se(we,rs)));if(0===pr.length&&0===Us.length)return u(new Se(we,{}));const Ni=_r(L)===X;return this.expandSegment(zt,Zr,pr,Us,Ni?qt:X,!0).pipe((0,Rt.U)(ta=>new Se(we.concat(ta.segments),ta.children)))})):pn(D)}getChildConfig(C,D,L){return D.children?u(new Ws(D.children,C)):D.loadChildren?void 0!==D._loadedConfig?u(D._loadedConfig):this.runCanLoadGuards(C.injector,D,L).pipe((0,$n.z)(U=>U?this.configLoader.load(C.injector,D).pipe((0,Rt.U)(X=>(D._loadedConfig=X,X))):function zl(A){return ft(no(`Cannot load children because the guard of the route "path: '${A.path}'" returned false`))}(D))):u(new Ws([],C))}runCanLoadGuards(C,D,L){const U=D.canLoad;return U&&0!==U.length?u(U.map(he=>{const we=C.get(he);let je;if(function dc(A){return A&&ni(A.canLoad)}(we))je=we.canLoad(D,L);else{if(!ni(we))throw new Error("Invalid CanLoad guard");je=we(D,L)}return Ie(je)})).pipe(B(),Yr(he=>{if(!ki(he))return;const we=no(`Redirecting to "${this.urlSerializer.serialize(he)}"`);throw we.url=he,we}),(0,Rt.U)(he=>!0===he)):u(!0)}lineralizeSegments(C,D){let L=[],U=D.root;for(;;){if(L=L.concat(U.segments),0===U.numberOfChildren)return u(L);if(U.numberOfChildren>1||!U.children[qt])return ft(new Error(`Only absolute redirects can have named outlets. redirectTo: '${C.redirectTo}'`));U=U.children[qt]}}applyRedirectCommands(C,D,L){return this.applyRedirectCreatreUrlTree(D,this.urlSerializer.parse(D),C,L)}applyRedirectCreatreUrlTree(C,D,L,U){const X=this.createSegmentGroup(C,D.root,L,U);return new ae(X,this.createQueryParams(D.queryParams,this.urlTree.queryParams),D.fragment)}createQueryParams(C,D){const L={};return _e(C,(U,X)=>{if("string"==typeof U&&U.startsWith(":")){const we=U.substring(1);L[X]=D[we]}else L[X]=U}),L}createSegmentGroup(C,D,L,U){const X=this.createSegments(C,D.segments,L,U);let he={};return _e(D.children,(we,je)=>{he[je]=this.createSegmentGroup(C,we,L,U)}),new Se(X,he)}createSegments(C,D,L,U){return D.map(X=>X.path.startsWith(":")?this.findPosParam(C,X,U):this.findOrReturn(X,L))}findPosParam(C,D,L){const U=L[D.path.substring(1)];if(!U)throw new Error(`Cannot redirect to '${C}'. Cannot find '${D.path}'.`);return U}findOrReturn(C,D){let L=0;for(const U of D){if(U.path===C.path)return D.splice(L),U;L++}return C}}function za(A){const C={};for(const L of Object.keys(A.children)){const X=za(A.children[L]);(X.segments.length>0||X.hasChildren())&&(C[L]=X)}return function fc(A){if(1===A.numberOfChildren&&A.children[qt]){const C=A.children[qt];return new Se(A.segments.concat(C.segments),C.children)}return A}(new Se(A.segments,C))}class tr{constructor(C){this.path=C,this.route=this.path[this.path.length-1]}}class al{constructor(C,D){this.component=C,this.route=D}}function si(A,C,D){const L=A._root;return Xs(L,C?C._root:null,D,[L.value])}function Jo(A,C,D){const L=function xo(A){if(!A)return null;for(let C=A.parent;C;C=C.parent){const D=C.routeConfig;if(D&&D._loadedConfig)return D._loadedConfig}return null}(C);return(L?L.module.injector:D).get(A)}function Xs(A,C,D,L,U={canDeactivateChecks:[],canActivateChecks:[]}){const X=Rn(C);return A.children.forEach(he=>{(function Bl(A,C,D,L,U={canDeactivateChecks:[],canActivateChecks:[]}){const X=A.value,he=C?C.value:null,we=D?D.getContext(A.value.outlet):null;if(he&&X.routeConfig===he.routeConfig){const je=function fh(A,C,D){if("function"==typeof D)return D(A,C);switch(D){case"pathParamsChange":return!Xt(A.url,C.url);case"pathParamsOrQueryParamsChange":return!Xt(A.url,C.url)||!oe(A.queryParams,C.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Tn(A,C)||!oe(A.queryParams,C.queryParams);default:return!Tn(A,C)}}(he,X,X.routeConfig.runGuardsAndResolvers);je?U.canActivateChecks.push(new tr(L)):(X.data=he.data,X._resolvedData=he._resolvedData),Xs(A,C,X.component?we?we.children:null:D,L,U),je&&we&&we.outlet&&we.outlet.isActivated&&U.canDeactivateChecks.push(new al(we.outlet.component,he))}else he&&Rs(C,we,U),U.canActivateChecks.push(new tr(L)),Xs(A,null,X.component?we?we.children:null:D,L,U)})(he,X[he.value.outlet],D,L.concat([he.value]),U),delete X[he.value.outlet]}),_e(X,(he,we)=>Rs(he,D.getContext(we),U)),U}function Rs(A,C,D){const L=Rn(A),U=A.value;_e(L,(X,he)=>{Rs(X,U.component?C?C.children.getContext(he):null:C,D)}),D.canDeactivateChecks.push(new al(U.component&&C&&C.outlet&&C.outlet.isActivated?C.outlet.component:null,U))}class Bo{}function ul(A){return new Nt.y(C=>C.error(A))}class fa{constructor(C,D,L,U,X,he){this.rootComponentType=C,this.config=D,this.urlTree=L,this.url=U,this.paramsInheritanceStrategy=X,this.relativeLinkResolution=he}recognize(){const C=yo(this.urlTree.root,[],[],this.config.filter(he=>void 0===he.redirectTo),this.relativeLinkResolution).segmentGroup,D=this.processSegmentGroup(this.config,C,qt);if(null===D)return null;const L=new Pi([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},qt,this.rootComponentType,null,this.urlTree.root,-1,{}),U=new Hr(L,D),X=new Oi(this.url,U);return this.inheritParamsAndData(X._root),X}inheritParamsAndData(C){const D=C.value,L=Pr(D,this.paramsInheritanceStrategy);D.params=Object.freeze(L.params),D.data=Object.freeze(L.data),C.children.forEach(U=>this.inheritParamsAndData(U))}processSegmentGroup(C,D,L){return 0===D.segments.length&&D.hasChildren()?this.processChildren(C,D):this.processSegment(C,D,D.segments,L)}processChildren(C,D){const L=[];for(const X of Object.keys(D.children)){const he=D.children[X],we=Vr(C,X),je=this.processSegmentGroup(we,he,X);if(null===je)return null;L.push(...je)}const U=mc(L);return function Nl(A){A.sort((C,D)=>C.value.outlet===qt?-1:D.value.outlet===qt?1:C.value.outlet.localeCompare(D.value.outlet))}(U),U}processSegment(C,D,L,U){for(const X of C){const he=this.processSegmentAgainstRoute(X,D,L,U);if(null!==he)return he}return Oo(D,L,U)?[]:null}processSegmentAgainstRoute(C,D,L,U){if(C.redirectTo||!Fa(C,D,L,U))return null;let X,he=[],we=[];if("**"===C.path){const Qn=L.length>0?se(L).parameters:{};X=new Pi(L,Qn,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,dl(C),_r(C),C.component,C,pa(D),Ul(D)+L.length,Vl(C))}else{const Qn=ii(D,C,L);if(!Qn.matched)return null;he=Qn.consumedSegments,we=Qn.remainingSegments,X=new Pi(he,Qn.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,dl(C),_r(C),C.component,C,pa(D),Ul(D)+he.length,Vl(C))}const je=function hl(A){return A.children?A.children:A.loadChildren?A._loadedConfig.routes:[]}(C),{segmentGroup:Lt,slicedSegments:_n}=yo(D,he,we,je.filter(Qn=>void 0===Qn.redirectTo),this.relativeLinkResolution);if(0===_n.length&&Lt.hasChildren()){const Qn=this.processChildren(je,Lt);return null===Qn?null:[new Hr(X,Qn)]}if(0===je.length&&0===_n.length)return[new Hr(X,[])];const zt=_r(C)===U,pr=this.processSegment(je,Lt,_n,zt?qt:U);return null===pr?null:[new Hr(X,pr)]}}function _s(A){const C=A.value.routeConfig;return C&&""===C.path&&void 0===C.redirectTo}function mc(A){const C=[],D=new Set;for(const L of A){if(!_s(L)){C.push(L);continue}const U=C.find(X=>L.value.routeConfig===X.value.routeConfig);void 0!==U?(U.children.push(...L.children),D.add(U)):C.push(L)}for(const L of D){const U=mc(L.children);C.push(new Hr(L.value,U))}return C.filter(L=>!D.has(L))}function pa(A){let C=A;for(;C._sourceSegment;)C=C._sourceSegment;return C}function Ul(A){let C=A,D=C._segmentIndexShift?C._segmentIndexShift:0;for(;C._sourceSegment;)C=C._sourceSegment,D+=C._segmentIndexShift?C._segmentIndexShift:0;return D-1}function dl(A){return A.data||{}}function Vl(A){return A.resolve||{}}function Ri(A){return[...Object.keys(A),...Object.getOwnPropertySymbols(A)]}function fr(A){return ur(C=>{const D=A(C);return D?(0,Mt.D)(D).pipe((0,Rt.U)(()=>C)):u(C)})}class Ba extends class Fs{shouldDetach(C){return!1}store(C,D){}shouldAttach(C){return!1}retrieve(C){return null}shouldReuseRoute(C,D){return C.routeConfig===D.routeConfig}}{}const jl=new Y.OlP("ROUTES");class $l{constructor(C,D,L,U){this.injector=C,this.compiler=D,this.onLoadStartListener=L,this.onLoadEndListener=U}load(C,D){if(D._loader$)return D._loader$;this.onLoadStartListener&&this.onLoadStartListener(D);const U=this.loadModuleFactory(D.loadChildren).pipe((0,Rt.U)(X=>{this.onLoadEndListener&&this.onLoadEndListener(D);const he=X.create(C);return new Ws(Z(he.injector.get(jl,void 0,Y.XFs.Self|Y.XFs.Optional)).map(dn),he)}),Lr(X=>{throw D._loader$=void 0,X}));return D._loader$=new $r(U,()=>new wt.x).pipe(hn()),D._loader$}loadModuleFactory(C){return Ie(C()).pipe((0,$n.z)(D=>D instanceof Y.YKP?u(D):(0,Mt.D)(this.compiler.compileModuleAsync(D))))}}class ga{shouldProcessUrl(C){return!0}extract(C){return C}merge(C,D){return C}}function _a(A){throw A}function Js(A,C,D){return C.parse("/")}function gi(A,C){return u(null)}const pl={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Mu={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ui=(()=>{class A{constructor(D,L,U,X,he,we,je){this.rootComponentType=D,this.urlSerializer=L,this.rootContexts=U,this.location=X,this.config=je,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new wt.x,this.errorHandler=_a,this.malformedUriErrorHandler=Js,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:gi,afterPreactivation:gi},this.urlHandlingStrategy=new ga,this.routeReuseStrategy=new Ba,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=he.get(Y.h0i),this.console=he.get(Y.c2e);const zt=he.get(Y.R0b);this.isNgZoneEnabled=zt instanceof Y.R0b&&Y.R0b.isInAngularZone(),this.resetConfig(je),this.currentUrlTree=function Pe(){return new ae(new Se([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new $l(he,we,pr=>this.triggerEvent(new Po(pr)),pr=>this.triggerEvent(new hr(pr))),this.routerState=kt(this.currentUrlTree,this.rootComponentType),this.transitions=new en({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var D;return null===(D=this.location.getState())||void 0===D?void 0:D.\u0275routerPageId}setupNavigations(D){const L=this.events;return D.pipe(Zi(U=>0!==U.id),(0,Rt.U)(U=>Object.assign(Object.assign({},U),{extractedUrl:this.urlHandlingStrategy.extract(U.rawUrl)})),ur(U=>{let X=!1,he=!1;return u(U).pipe(Yr(we=>{this.currentNavigation={id:we.id,initialUrl:we.currentRawUrl,extractedUrl:we.extractedUrl,trigger:we.source,extras:we.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),ur(we=>{const je=this.browserUrlTree.toString(),Lt=!this.navigated||we.extractedUrl.toString()!==je||je!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||Lt)&&this.urlHandlingStrategy.shouldProcessUrl(we.rawUrl))return Na(we.source)&&(this.browserUrlTree=we.extractedUrl),u(we).pipe(ur(zt=>{const pr=this.transitions.getValue();return L.next(new cr(zt.id,this.serializeUrl(zt.extractedUrl),zt.source,zt.restoredState)),pr!==this.transitions.getValue()?yi.E:Promise.resolve(zt)}),function mt(A,C,D,L){return ur(U=>function Bc(A,C,D,L,U){return new Oa(A,C,D,L,U).apply()}(A,C,D,U.extractedUrl,L).pipe((0,Rt.U)(X=>Object.assign(Object.assign({},U),{urlAfterRedirects:X}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Yr(zt=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:zt.urlAfterRedirects})}),function fl(A,C,D,L,U){return(0,$n.z)(X=>function Qs(A,C,D,L,U="emptyOnly",X="legacy"){try{const he=new fa(A,C,D,L,U,X).recognize();return null===he?ul(new Bo):u(he)}catch(he){return ul(he)}}(A,C,X.urlAfterRedirects,D(X.urlAfterRedirects),L,U).pipe((0,Rt.U)(he=>Object.assign(Object.assign({},X),{targetSnapshot:he}))))}(this.rootComponentType,this.config,zt=>this.serializeUrl(zt),this.paramsInheritanceStrategy,this.relativeLinkResolution),Yr(zt=>{if("eager"===this.urlUpdateStrategy){if(!zt.extras.skipLocationChange){const Qn=this.urlHandlingStrategy.merge(zt.urlAfterRedirects,zt.rawUrl);this.setBrowserUrl(Qn,zt)}this.browserUrlTree=zt.urlAfterRedirects}const pr=new Jt(zt.id,this.serializeUrl(zt.extractedUrl),this.serializeUrl(zt.urlAfterRedirects),zt.targetSnapshot);L.next(pr)}));if(Lt&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:pr,extractedUrl:Qn,source:Us,restoredState:Zr,extras:Ni}=we,Ui=new cr(pr,this.serializeUrl(Qn),Us,Zr);L.next(Ui);const ta=kt(Qn,this.rootComponentType).snapshot;return u(Object.assign(Object.assign({},we),{targetSnapshot:ta,urlAfterRedirects:Qn,extras:Object.assign(Object.assign({},Ni),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=we.rawUrl,we.resolve(null),yi.E}),fr(we=>{const{targetSnapshot:je,id:Lt,extractedUrl:_n,rawUrl:zt,extras:{skipLocationChange:pr,replaceUrl:Qn}}=we;return this.hooks.beforePreactivation(je,{navigationId:Lt,appliedUrlTree:_n,rawUrlTree:zt,skipLocationChange:!!pr,replaceUrl:!!Qn})}),Yr(we=>{const je=new wr(we.id,this.serializeUrl(we.extractedUrl),this.serializeUrl(we.urlAfterRedirects),we.targetSnapshot);this.triggerEvent(je)}),(0,Rt.U)(we=>Object.assign(Object.assign({},we),{guards:si(we.targetSnapshot,we.currentSnapshot,this.rootContexts)})),function Ys(A,C){return(0,$n.z)(D=>{const{targetSnapshot:L,currentSnapshot:U,guards:{canActivateChecks:X,canDeactivateChecks:he}}=D;return 0===he.length&&0===X.length?u(Object.assign(Object.assign({},D),{guardsResult:!0})):function cl(A,C,D,L){return(0,Mt.D)(A).pipe((0,$n.z)(U=>function pc(A,C,D,L,U){const X=C&&C.routeConfig?C.routeConfig.canDeactivate:null;return X&&0!==X.length?u(X.map(we=>{const je=Jo(we,C,U);let Lt;if(function z(A){return A&&ni(A.canDeactivate)}(je))Lt=Ie(je.canDeactivate(A,C,D,L));else{if(!ni(je))throw new Error("Invalid CanDeactivate guard");Lt=Ie(je(A,C,D,L))}return Lt.pipe(Pn())})).pipe(B()):u(!0)}(U.component,U.route,D,C,L)),Pn(U=>!0!==U,!0))}(he,L,U,A).pipe((0,$n.z)(we=>we&&function Fo(A){return"boolean"==typeof A}(we)?function Mr(A,C,D,L){return(0,Mt.D)(C).pipe(Gn(U=>_t(function Ks(A,C){return null!==A&&C&&C(new fi(A)),u(!0)}(U.route.parent,L),function zo(A,C){return null!==A&&C&&C(new po(A)),u(!0)}(U.route,L),function es(A,C,D){const L=C[C.length-1],X=C.slice(0,C.length-1).reverse().map(he=>function ll(A){const C=A.routeConfig?A.routeConfig.canActivateChild:null;return C&&0!==C.length?{node:A,guards:C}:null}(he)).filter(he=>null!==he).map(he=>En(()=>u(he.guards.map(je=>{const Lt=Jo(je,he.node,D);let _n;if(function La(A){return A&&ni(A.canActivateChild)}(Lt))_n=Ie(Lt.canActivateChild(L,A));else{if(!ni(Lt))throw new Error("Invalid CanActivateChild guard");_n=Ie(Lt(L,A))}return _n.pipe(Pn())})).pipe(B())));return u(X).pipe(B())}(A,U.path,D),function Ls(A,C,D){const L=C.routeConfig?C.routeConfig.canActivate:null;if(!L||0===L.length)return u(!0);const U=L.map(X=>En(()=>{const he=Jo(X,C,D);let we;if(function ri(A){return A&&ni(A.canActivate)}(he))we=Ie(he.canActivate(C,A));else{if(!ni(he))throw new Error("Invalid CanActivate guard");we=Ie(he(C,A))}return we.pipe(Pn())}));return u(U).pipe(B())}(A,U.route,D))),Pn(U=>!0!==U,!0))}(L,X,A,C):u(we)),(0,Rt.U)(we=>Object.assign(Object.assign({},D),{guardsResult:we})))})}(this.ngModule.injector,we=>this.triggerEvent(we)),Yr(we=>{if(ki(we.guardsResult)){const Lt=no(`Redirecting to "${this.serializeUrl(we.guardsResult)}"`);throw Lt.url=we.guardsResult,Lt}const je=new un(we.id,this.serializeUrl(we.extractedUrl),this.serializeUrl(we.urlAfterRedirects),we.targetSnapshot,!!we.guardsResult);this.triggerEvent(je)}),Zi(we=>!!we.guardsResult||(this.restoreHistory(we),this.cancelNavigationTransition(we,""),!1)),fr(we=>{if(we.guards.canActivateChecks.length)return u(we).pipe(Yr(je=>{const Lt=new cn(je.id,this.serializeUrl(je.extractedUrl),this.serializeUrl(je.urlAfterRedirects),je.targetSnapshot);this.triggerEvent(Lt)}),ur(je=>{let Lt=!1;return u(je).pipe(function ma(A,C){return(0,$n.z)(D=>{const{targetSnapshot:L,guards:{canActivateChecks:U}}=D;if(!U.length)return u(D);let X=0;return(0,Mt.D)(U).pipe(Gn(he=>function ts(A,C,D,L){return function _c(A,C,D,L){const U=Ri(A);if(0===U.length)return u({});const X={};return(0,Mt.D)(U).pipe((0,$n.z)(he=>function No(A,C,D,L){const U=Jo(A,C,L);return Ie(U.resolve?U.resolve(C,D):U(C,D))}(A[he],C,D,L).pipe(Yr(we=>{X[he]=we}))),Cn(1),(0,$n.z)(()=>Ri(X).length===U.length?u(X):yi.E))}(A._resolve,A,C,L).pipe((0,Rt.U)(X=>(A._resolvedData=X,A.data=Object.assign(Object.assign({},A.data),Pr(A,D).resolve),null)))}(he.route,L,A,C)),Yr(()=>X++),Cn(1),(0,$n.z)(he=>X===U.length?u(D):yi.E))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Yr({next:()=>Lt=!0,complete:()=>{Lt||(this.restoreHistory(je),this.cancelNavigationTransition(je,"At least one route resolver didn't emit any value."))}}))}),Yr(je=>{const Lt=new fo(je.id,this.serializeUrl(je.extractedUrl),this.serializeUrl(je.urlAfterRedirects),je.targetSnapshot);this.triggerEvent(Lt)}))}),fr(we=>{const{targetSnapshot:je,id:Lt,extractedUrl:_n,rawUrl:zt,extras:{skipLocationChange:pr,replaceUrl:Qn}}=we;return this.hooks.afterPreactivation(je,{navigationId:Lt,appliedUrlTree:_n,rawUrlTree:zt,skipLocationChange:!!pr,replaceUrl:!!Qn})}),(0,Rt.U)(we=>{const je=function Yo(A,C,D){const L=Ko(A,C._root,D?D._root:void 0);return new We(L,C)}(this.routeReuseStrategy,we.targetSnapshot,we.currentRouterState);return Object.assign(Object.assign({},we),{targetRouterState:je})}),Yr(we=>{this.currentUrlTree=we.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(we.urlAfterRedirects,we.rawUrl),this.routerState=we.targetRouterState,"deferred"===this.urlUpdateStrategy&&(we.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,we),this.browserUrlTree=we.urlAfterRedirects)}),((A,C,D)=>(0,Rt.U)(L=>(new As(C,L.targetRouterState,L.currentRouterState,D).activate(A),L)))(this.rootContexts,this.routeReuseStrategy,we=>this.triggerEvent(we)),Yr({next(){X=!0},complete(){X=!0}}),function Kr(A){return(0,br.e)((C,D)=>{try{C.subscribe(D)}finally{D.add(A)}})}(()=>{var we;X||he||this.cancelNavigationTransition(U,`Navigation ID ${U.id} is not equal to the current navigation id ${this.navigationId}`),(null===(we=this.currentNavigation)||void 0===we?void 0:we.id)===U.id&&(this.currentNavigation=null)}),Lr(we=>{if(he=!0,function ko(A){return A&&A[Kn]}(we)){const je=ki(we.url);je||(this.navigated=!0,this.restoreHistory(U,!0));const Lt=new fs(U.id,this.serializeUrl(U.extractedUrl),we.message);L.next(Lt),je?setTimeout(()=>{const _n=this.urlHandlingStrategy.merge(we.url,this.rawUrlTree),zt={skipLocationChange:U.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||Na(U.source)};this.scheduleNavigation(_n,"imperative",null,zt,{resolve:U.resolve,reject:U.reject,promise:U.promise})},0):U.resolve(!1)}else{this.restoreHistory(U,!0);const je=new ho(U.id,this.serializeUrl(U.extractedUrl),we);L.next(je);try{U.resolve(this.errorHandler(we))}catch(Lt){U.reject(Lt)}}return yi.E}))}))}resetRootComponentType(D){this.rootComponentType=D,this.routerState.root.component=this.rootComponentType}setTransition(D){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),D))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(D=>{const L="popstate"===D.type?"popstate":"hashchange";"popstate"===L&&setTimeout(()=>{var U;const X={replaceUrl:!0},he=(null===(U=D.state)||void 0===U?void 0:U.navigationId)?D.state:null;if(he){const je=Object.assign({},he);delete je.navigationId,delete je.\u0275routerPageId,0!==Object.keys(je).length&&(X.state=je)}const we=this.parseUrl(D.url);this.scheduleNavigation(we,L,he,X)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(D){this.events.next(D)}resetConfig(D){gn(D),this.config=D.map(dn),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(D,L={}){const{relativeTo:U,queryParams:X,fragment:he,queryParamsHandling:we,preserveFragment:je}=L,Lt=U||this.routerState.root,_n=je?this.currentUrlTree.fragment:he;let zt=null;switch(we){case"merge":zt=Object.assign(Object.assign({},this.currentUrlTree.queryParams),X);break;case"preserve":zt=this.currentUrlTree.queryParams;break;default:zt=X||null}return null!==zt&&(zt=this.removeEmptyProps(zt)),function Ds(A,C,D,L,U){if(0===D.length)return kr(C.root,C.root,C,L,U);const X=function ol(A){if("string"==typeof A[0]&&1===A.length&&"/"===A[0])return new Bi(!0,0,A);let C=0,D=!1;const L=A.reduce((U,X,he)=>{if("object"==typeof X&&null!=X){if(X.outlets){const we={};return _e(X.outlets,(je,Lt)=>{we[Lt]="string"==typeof je?je.split("/"):je}),[...U,{outlets:we}]}if(X.segmentPath)return[...U,X.segmentPath]}return"string"!=typeof X?[...U,X]:0===he?(X.split("/").forEach((we,je)=>{0==je&&"."===we||(0==je&&""===we?D=!0:".."===we?C++:""!=we&&U.push(we))}),U):[...U,X]},[]);return new Bi(D,C,L)}(D);if(X.toRoot())return kr(C.root,new Se([],{}),C,L,U);const he=function Ms(A,C,D){if(A.isAbsolute)return new Ss(C.root,!0,0);if(-1===D.snapshot._lastPathIndex){const X=D.snapshot._urlSegment;return new Ss(X,X===C.root,0)}const L=Cs(A.commands[0])?0:1;return function Is(A,C,D){let L=A,U=C,X=D;for(;X>U;){if(X-=U,L=L.parent,!L)throw new Error("Invalid number of '../'");U=L.segments.length}return new Ss(L,!1,U-X)}(D.snapshot._urlSegment,D.snapshot._lastPathIndex+L,A.numberOfDoubleDots)}(X,C,A),we=he.processChildren?ca(he.segmentGroup,he.index,X.commands):qs(he.segmentGroup,he.index,X.commands);return kr(he.segmentGroup,we,C,L,U)}(Lt,this.currentUrlTree,D,zt,null!=_n?_n:null)}navigateByUrl(D,L={skipLocationChange:!1}){const U=ki(D)?D:this.parseUrl(D),X=this.urlHandlingStrategy.merge(U,this.rawUrlTree);return this.scheduleNavigation(X,"imperative",null,L)}navigate(D,L={skipLocationChange:!1}){return function ml(A){for(let C=0;C<A.length;C++){const D=A[C];if(null==D)throw new Error(`The requested path contains ${D} segment at index ${C}`)}}(D),this.navigateByUrl(this.createUrlTree(D,L),L)}serializeUrl(D){return this.urlSerializer.serialize(D)}parseUrl(D){let L;try{L=this.urlSerializer.parse(D)}catch(U){L=this.malformedUriErrorHandler(U,this.urlSerializer,D)}return L}isActive(D,L){let U;if(U=!0===L?Object.assign({},pl):!1===L?Object.assign({},Mu):L,ki(D))return Xe(this.currentUrlTree,D,U);const X=this.parseUrl(D);return Xe(this.currentUrlTree,X,U)}removeEmptyProps(D){return Object.keys(D).reduce((L,U)=>{const X=D[U];return null!=X&&(L[U]=X),L},{})}processNavigations(){this.navigations.subscribe(D=>{this.navigated=!0,this.lastSuccessfulId=D.id,this.currentPageId=D.targetPageId,this.events.next(new uo(D.id,this.serializeUrl(D.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,D.resolve(!0)},D=>{this.console.warn(`Unhandled Navigation Error: ${D}`)})}scheduleNavigation(D,L,U,X,he){var we,je,Lt;if(this.disposed)return Promise.resolve(!1);const _n=this.transitions.value,zt=Na(L)&&_n&&!Na(_n.source),pr=_n.rawUrl.toString()===D.toString(),Qn=_n.id===(null===(we=this.currentNavigation)||void 0===we?void 0:we.id);if(zt&&pr&&Qn)return Promise.resolve(!0);let Zr,Ni,Ui;he?(Zr=he.resolve,Ni=he.reject,Ui=he.promise):Ui=new Promise((Vs,Au)=>{Zr=Vs,Ni=Au});const ta=++this.navigationId;let rs;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(U=this.location.getState()),rs=U&&U.\u0275routerPageId?U.\u0275routerPageId:X.replaceUrl||X.skipLocationChange?null!==(je=this.browserPageId)&&void 0!==je?je:0:(null!==(Lt=this.browserPageId)&&void 0!==Lt?Lt:0)+1):rs=0,this.setTransition({id:ta,targetPageId:rs,source:L,restoredState:U,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:D,extras:X,resolve:Zr,reject:Ni,promise:Ui,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Ui.catch(Vs=>Promise.reject(Vs))}setBrowserUrl(D,L){const U=this.urlSerializer.serialize(D),X=Object.assign(Object.assign({},L.extras.state),this.generateNgRouterState(L.id,L.targetPageId));this.location.isCurrentPathEqualTo(U)||L.extras.replaceUrl?this.location.replaceState(U,"",X):this.location.go(U,"",X)}restoreHistory(D,L=!1){var U,X;if("computed"===this.canceledNavigationResolution){const he=this.currentPageId-D.targetPageId;"popstate"!==D.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(U=this.currentNavigation)||void 0===U?void 0:U.finalUrl)||0===he?this.currentUrlTree===(null===(X=this.currentNavigation)||void 0===X?void 0:X.finalUrl)&&0===he&&(this.resetState(D),this.browserUrlTree=D.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(he)}else"replace"===this.canceledNavigationResolution&&(L&&this.resetState(D),this.resetUrlToCurrentUrlTree())}resetState(D){this.routerState=D.currentRouterState,this.currentUrlTree=D.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,D.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(D,L){const U=new fs(D.id,this.serializeUrl(D.extractedUrl),L);this.triggerEvent(U),D.resolve(!1)}generateNgRouterState(D,L){return"computed"===this.canceledNavigationResolution?{navigationId:D,\u0275routerPageId:L}:{navigationId:D}}}return A.\u0275fac=function(D){Y.$Z()},A.\u0275prov=Y.Yz7({token:A,factory:A.\u0275fac}),A})();function Na(A){return"imperative"!==A}let Os=(()=>{class A{constructor(D,L,U,X,he){this.router=D,this.route=L,this.tabIndexAttribute=U,this.renderer=X,this.el=he,this.commands=null,this.onChanges=new wt.x,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(D){if(null!=this.tabIndexAttribute)return;const L=this.renderer,U=this.el.nativeElement;null!==D?L.setAttribute(U,"tabindex",D):L.removeAttribute(U,"tabindex")}ngOnChanges(D){this.onChanges.next(this)}set routerLink(D){null!=D?(this.commands=Array.isArray(D)?D:[D],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const D={skipLocationChange:Uo(this.skipLocationChange),replaceUrl:Uo(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,D),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Uo(this.preserveFragment)})}}return A.\u0275fac=function(D){return new(D||A)(Y.Y36(ui),Y.Y36(Nr),Y.$8M("tabindex"),Y.Y36(Y.Qsj),Y.Y36(Y.SBq))},A.\u0275dir=Y.lG2({type:A,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(D,L){1&D&&Y.NdJ("click",function(){return L.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[Y.TTD]}),A})(),ns=(()=>{class A{constructor(D,L,U){this.router=D,this.route=L,this.locationStrategy=U,this.commands=null,this.href=null,this.onChanges=new wt.x,this.subscription=D.events.subscribe(X=>{X instanceof uo&&this.updateTargetUrlAndHref()})}set routerLink(D){this.commands=null!=D?Array.isArray(D)?D:[D]:null}ngOnChanges(D){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(D,L,U,X,he){if(0!==D||L||U||X||he||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const we={skipLocationChange:Uo(this.skipLocationChange),replaceUrl:Uo(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,we),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:Uo(this.preserveFragment)})}}return A.\u0275fac=function(D){return new(D||A)(Y.Y36(ui),Y.Y36(Nr),Y.Y36(ti.S$))},A.\u0275dir=Y.lG2({type:A,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(D,L){1&D&&Y.NdJ("click",function(X){return L.onClick(X.button,X.ctrlKey,X.shiftKey,X.altKey,X.metaKey)}),2&D&&Y.uIk("target",L.target)("href",L.href,Y.LSH)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[Y.TTD]}),A})();function Uo(A){return""===A||!!A}let Gl=(()=>{class A{constructor(D,L,U,X,he,we){this.router=D,this.element=L,this.renderer=U,this.cdr=X,this.link=he,this.linkWithHref=we,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new Y.vpe,this.routerEventsSubscription=D.events.subscribe(je=>{je instanceof uo&&this.update()})}ngAfterContentInit(){u(this.links.changes,this.linksWithHrefs.changes,u(null)).pipe((0,He.J)()).subscribe(D=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){var D;null===(D=this.linkInputChangesSubscription)||void 0===D||D.unsubscribe();const L=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(U=>!!U).map(U=>U.onChanges);this.linkInputChangesSubscription=(0,Mt.D)(L).pipe((0,He.J)()).subscribe(U=>{this.isActive!==this.isLinkActive(this.router)(U)&&this.update()})}set routerLinkActive(D){const L=Array.isArray(D)?D:D.split(" ");this.classes=L.filter(U=>!!U)}ngOnChanges(D){this.update()}ngOnDestroy(){var D;this.routerEventsSubscription.unsubscribe(),null===(D=this.linkInputChangesSubscription)||void 0===D||D.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const D=this.hasActiveLinks();this.isActive!==D&&(this.isActive=D,this.cdr.markForCheck(),this.classes.forEach(L=>{D?this.renderer.addClass(this.element.nativeElement,L):this.renderer.removeClass(this.element.nativeElement,L)}),this.isActiveChange.emit(D))})}isLinkActive(D){const L=function Uc(A){return!!A.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return U=>!!U.urlTree&&D.isActive(U.urlTree,L)}hasActiveLinks(){const D=this.isLinkActive(this.router);return this.link&&D(this.link)||this.linkWithHref&&D(this.linkWithHref)||this.links.some(D)||this.linksWithHrefs.some(D)}}return A.\u0275fac=function(D){return new(D||A)(Y.Y36(ui),Y.Y36(Y.SBq),Y.Y36(Y.Qsj),Y.Y36(Y.sBO),Y.Y36(Os,8),Y.Y36(ns,8))},A.\u0275dir=Y.lG2({type:A,selectors:[["","routerLinkActive",""]],contentQueries:function(D,L,U){if(1&D&&(Y.Suo(U,Os,5),Y.Suo(U,ns,5)),2&D){let X;Y.iGM(X=Y.CRH())&&(L.links=X),Y.iGM(X=Y.CRH())&&(L.linksWithHrefs=X)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[Y.TTD]}),A})();class Ua{}class Wi{preload(C,D){return u(null)}}let gl=(()=>{class A{constructor(D,L,U,X){this.router=D,this.injector=U,this.preloadingStrategy=X,this.loader=new $l(U,L,je=>D.triggerEvent(new Po(je)),je=>D.triggerEvent(new hr(je)))}setUpPreloading(){this.subscription=this.router.events.pipe(Zi(D=>D instanceof uo),Gn(()=>this.preload())).subscribe(()=>{})}preload(){const D=this.injector.get(Y.h0i);return this.processRoutes(D,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(D,L){const U=[];for(const X of L)if(X.loadChildren&&!X.canLoad&&X._loadedConfig){const he=X._loadedConfig;U.push(this.processRoutes(he.module,he.routes))}else X.loadChildren&&!X.canLoad?U.push(this.preloadConfig(D,X)):X.children&&U.push(this.processRoutes(D,X.children));return(0,Mt.D)(U).pipe((0,He.J)(),(0,Rt.U)(X=>{}))}preloadConfig(D,L){return this.preloadingStrategy.preload(L,()=>(L._loadedConfig?u(L._loadedConfig):this.loader.load(D.injector,L)).pipe((0,$n.z)(X=>(L._loadedConfig=X,this.processRoutes(X.module,X.routes)))))}}return A.\u0275fac=function(D){return new(D||A)(Y.LFG(ui),Y.LFG(Y.Sil),Y.LFG(Y.zs3),Y.LFG(Ua))},A.\u0275prov=Y.Yz7({token:A,factory:A.\u0275fac}),A})(),Va=(()=>{class A{constructor(D,L,U={}){this.router=D,this.viewportScroller=L,this.options=U,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},U.scrollPositionRestoration=U.scrollPositionRestoration||"disabled",U.anchorScrolling=U.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(D=>{D instanceof cr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=D.navigationTrigger,this.restoredId=D.restoredState?D.restoredState.navigationId:0):D instanceof uo&&(this.lastId=D.id,this.scheduleScrollEvent(D,this.router.parseUrl(D.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(D=>{D instanceof mo&&(D.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(D.position):D.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(D.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(D,L){this.router.triggerEvent(new mo(D,"popstate"===this.lastSource?this.store[this.restoredId]:null,L))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return A.\u0275fac=function(D){Y.$Z()},A.\u0275prov=Y.Yz7({token:A,factory:A.\u0275fac}),A})();const Xi=new Y.OlP("ROUTER_CONFIGURATION"),_l=new Y.OlP("ROUTER_FORROOT_GUARD"),zs=[ti.Ye,{provide:Tr,useClass:Fr},{provide:ui,useFactory:function Vc(A,C,D,L,U,X,he={},we,je){const Lt=new ui(null,A,C,D,L,U,Z(X));return we&&(Lt.urlHandlingStrategy=we),je&&(Lt.routeReuseStrategy=je),function xc(A,C){A.errorHandler&&(C.errorHandler=A.errorHandler),A.malformedUriErrorHandler&&(C.malformedUriErrorHandler=A.malformedUriErrorHandler),A.onSameUrlNavigation&&(C.onSameUrlNavigation=A.onSameUrlNavigation),A.paramsInheritanceStrategy&&(C.paramsInheritanceStrategy=A.paramsInheritanceStrategy),A.relativeLinkResolution&&(C.relativeLinkResolution=A.relativeLinkResolution),A.urlUpdateStrategy&&(C.urlUpdateStrategy=A.urlUpdateStrategy),A.canceledNavigationResolution&&(C.canceledNavigationResolution=A.canceledNavigationResolution)}(he,Lt),he.enableTracing&&Lt.events.subscribe(_n=>{var zt,pr;null===(zt=console.group)||void 0===zt||zt.call(console,`Router Event: ${_n.constructor.name}`),console.log(_n.toString()),console.log(_n),null===(pr=console.groupEnd)||void 0===pr||pr.call(console)}),Lt},deps:[Tr,Te,ti.Ye,Y.zs3,Y.Sil,jl,Xi,[class rr{},new Y.FiY],[class Nc{},new Y.FiY]]},Te,{provide:Nr,useFactory:function Zl(A){return A.routerState.root},deps:[ui]},gl,Wi,class yc{preload(C,D){return D().pipe(Lr(()=>u(null)))}},{provide:Xi,useValue:{enableTracing:!1}}];function Hl(){return new Y.PXZ("Router",ui)}let Bs=(()=>{class A{constructor(D,L){}static forRoot(D,L){return{ngModule:A,providers:[zs,vc(D),{provide:_l,useFactory:vl,deps:[[ui,new Y.FiY,new Y.tp0]]},{provide:Xi,useValue:L||{}},{provide:ti.S$,useFactory:yl,deps:[ti.lw,[new Y.tBr(ti.mr),new Y.FiY],Xi]},{provide:Va,useFactory:$a,deps:[ui,ti.EM,Xi]},{provide:Ua,useExisting:L&&L.preloadingStrategy?L.preloadingStrategy:Wi},{provide:Y.PXZ,multi:!0,useFactory:Hl},[Ns,{provide:Y.ip1,multi:!0,useFactory:ql,deps:[Ns]},{provide:ea,useFactory:Wl,deps:[Ns]},{provide:Y.tb,multi:!0,useExisting:ea}]]}}static forChild(D){return{ngModule:A,providers:[vc(D)]}}}return A.\u0275fac=function(D){return new(D||A)(Y.LFG(_l,8),Y.LFG(ui,8))},A.\u0275mod=Y.oAB({type:A}),A.\u0275inj=Y.cJS({}),A})();function $a(A,C,D){return D.scrollOffset&&C.setOffset(D.scrollOffset),new Va(A,C,D)}function yl(A,C,D={}){return D.useHash?new ti.Do(A,C):new ti.b0(A,C)}function vl(A){return"guarded"}function vc(A){return[{provide:Y.deG,multi:!0,useValue:A},{provide:jl,multi:!0,useValue:A}]}let Ns=(()=>{class A{constructor(D){this.injector=D,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new wt.x}appInitializer(){return this.injector.get(ti.V_,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let L=null;const U=new Promise(we=>L=we),X=this.injector.get(ui),he=this.injector.get(Xi);return"disabled"===he.initialNavigation?(X.setUpLocationChangeListener(),L(!0)):"enabled"===he.initialNavigation||"enabledBlocking"===he.initialNavigation?(X.hooks.afterPreactivation=()=>this.initNavigation?u(null):(this.initNavigation=!0,L(!0),this.resultOfPreactivationDone),X.initialNavigation()):L(!0),U})}bootstrapListener(D){const L=this.injector.get(Xi),U=this.injector.get(gl),X=this.injector.get(Va),he=this.injector.get(ui),we=this.injector.get(Y.z2F);D===we.components[0]&&(("enabledNonBlocking"===L.initialNavigation||void 0===L.initialNavigation)&&he.initialNavigation(),U.setUpPreloading(),X.init(),he.resetRootComponentType(we.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return A.\u0275fac=function(D){return new(D||A)(Y.LFG(Y.zs3))},A.\u0275prov=Y.Yz7({token:A,factory:A.\u0275fac}),A})();function ql(A){return A.appInitializer.bind(A)}function Wl(A){return A.bootstrapListener.bind(A)}const ea=new Y.OlP("Router Initializer")}},er=>{er(er.s=574)}]);